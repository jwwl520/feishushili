"use strict";(self.webpackChunkbear_fe=self.webpackChunkbear_fe||[]).push([[66951],{645653:(e,t,n)=>{n.d(t,{sv:()=>k,pO:()=>S,jP:()=>g});var a=n(31474),o=n(954922),s=n(410699),r=n(947778),c=n(940814),i=n(550160),u=n(646935),l=n(360154),h=n(811831);const d="SHEET_CLIENT_VARS",p="v0.0.1";var f,m;function k(e){const t=e||(0,o.Mo)(a.Z.href);return parseInt(t.open_type||"0",10)}function I(e,t,n,s,r){const i=e.getInstance({}),l=(0,u.Zpv)(),h=i.getMemberId(),d=i.getTicket(),p={row:0,row_count:0,col:0,col_count:0},f=t||(0,c.Y)(),m=(0,o.Mo)(a.Z.href),I=n||m.sheet||location.hash.slice(1);let S={};if(r){const{getClientVarsRequestExtraParams:e}=r;"function"==typeof e&&(S=e())}return{timeout:l,memberId:h,sheetRange:p,ticket:d,requestIdField:f,activeSheetIdField:I,openTypeField:s||k(m),extraParams:S}}function S(e,t,n,a,o){return function(e,t,n,a,o){const{timeout:c,memberId:u,requestIdField:h,activeSheetIdField:m,openTypeField:k,extraParams:S}=I(i.IO,t,n,a,o),g=(0,r.a$)(),v=Object.assign({url:g,method:"POST"},c?{timeout:c}:{},{key:d,headers:{"Content-Type":"application/json","Request-Id":h,"x-tt-trace-id":h,"x-command":"api.sheet.rce.message"},data:{sheetRange:{sheetId:(0,l.XR)(m)},openType:k,memberId:u,token:e,schemaVersion:f.MUTATION,clientVersion:p,containerId:S.container_id,containerType:S.container_type,wikiSpaceId:S.wiki_space_id}});return(0,s.fetchData)("".concat(e,"_").concat(d),v)}(e,t,n,a,o)}function g(e,t){const n=t?[t]:[],a=(0,c.Y)(),o={url:h.GET_SHEET_RESOURCE_V3,method:"POST",headers:{"Content-Type":"application/json","Request-Id":a,"x-request-id":a,"x-tt-trace-id":a},data:{path:["comments"],token:e,sheetIDs:n}};return(0,s.fetchData)("".concat(e,"_").concat(t,"_").concat(h.GET_SHEET_RESOURCE_V3),o)}!function(e){e[e.OLD=3]="OLD",e[e.NEW_SPLIT_CODE=4]="NEW_SPLIT_CODE",e[e.CS_GZIP=5]="CS_GZIP",e[e.NODE=6]="NODE",e[e.REF=7]="REF",e[e.MUTATION=9]="MUTATION"}(f||(f={})),function(e){e.CLIENT_VARS="CLIENT_VARS"}(m||(m={}))},506558:(e,t,n)=>{n.d(t,{QY:()=>o,Vq:()=>s,wt:()=>r,uB:()=>c,Yw:()=>i,n0:()=>u,u:()=>l});var a=n(646935);const o=0,s=0,r="SHEET_CLIENT_VARS",c=20,i=(0,a.cmV)();var u,l;!function(e){e[e.OLD=3]="OLD",e[e.NEW_SPLIT_CODE=4]="NEW_SPLIT_CODE",e[e.CS_GZIP=5]="CS_GZIP",e[e.NODE=6]="NODE",e[e.REF=7]="REF",e[e.MUTATION=9]="MUTATION"}(u||(u={})),function(e){e.CLIENT_VARS="CLIENT_VARS"}(l||(l={}))},360154:(e,t,n)=>{n.d(t,{Tp:()=>u,Bj:()=>l,yy:()=>h,Ho:()=>d,XR:()=>p});var a=n(829033),o=n(31474),s=n(954922),r=n(940814),c=n(646935),i=n(506558);function u(e){const t=null==e?void 0:e.schemaVersion;return!!(t&&t>=i.n0.MUTATION)}function l(e,t,n,a,u){const l=e.getInstance({}),h=(0,c.Zpv)(),d=l.getMemberId(),p=l.getTicket(),f={row:0,row_count:i.QY,col:0,col_count:i.Vq},m=t||(0,r.Y)(),k=(0,s.Mo)(o.Z.href),I=n||k.sheet||location.hash.slice(1);let S={};if(u){const{getClientVarsRequestExtraParams:e}=u;"function"==typeof e&&(S=e())}const g=a||function(e){const t=e||(0,s.Mo)(o.Z.href);return parseInt(t.open_type||"0",10)}(k);return{timeout:h,memberId:d,sheetRange:f,ticket:p,requestIdField:m,activeSheetIdField:I,openTypeField:g,extraParams:S}}function h(e){return!(0,a.default)(e.clientvars)}function d(e){return h(e)?e.clientvars:e}function p(e){return(Array.isArray(e)?e[0]:e)||""}},680971:(e,t,n)=>{n.r(t),n.d(t,{IOInstance:()=>w,clearBackupPreload:()=>j,clearSnapshotBuffer:()=>Z,default:()=>M,fetchClientVarsComments:()=>N,getBackupPreload:()=>q,getDataAdaptInfo:()=>x,getFetchClientVarsReq:()=>B,getOpenTypeFromURL:()=>o.sv,getSnapshotBuffer:()=>L,preloadSheetData:()=>A,resetDataAdaptInfo:()=>F});var a=n(550160),o=n(645653),s=n(919264),r=n(715327),c=n(193035),i=n(573455),u=n(112064),l=n(822462),h=n(542620),d=n(804175),p=n(243101),f=n(410699),m=n(46724),k=n(940814),I=n(531756),S=n(646935),g=n(506558);let v=function(){function e(){(0,s.Z)(this,e),this.tokens=[],this.maps={},this.totalRowCount=0}return(0,d.Z)(e,[{key:"addBlockToBundle",value:function(e,t){const{id:n,index:a}=t,{rowsCount:o,token:s}=e;this.tokens.push(s),this.maps[s]=Object.assign({},e,{sheetId:n,index:a}),this.totalRowCount+=o}}]),e}();function D(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=(0,l.Z)(e);if(t){var o=(0,l.Z)(this).constructor;n=Reflect.construct(a,arguments,o)}else n=a.apply(this,arguments);return(0,u.Z)(this,n)}}let _=function(e){(0,i.Z)(n,e);var t=D(n);function n(e,a){var o;return(0,s.Z)(this,n),(o=t.call(this,a)).token=e,o.snapshotBuffer=null,o.dataTransformTime={length:0,time:0,count:0},o.resetDataAdaptInfo=()=>{o.dataTransformTime={length:0,time:0,count:0}},o.getDataAdaptInfo=()=>o.dataTransformTime,o.getSnapshotBuffer=()=>o.snapshotBuffer,o.clearSnapshotBuffer=()=>{o.snapshotBuffer=null},o.stageSnapshotBufferAndGetSnapshot=e=>{const t=(0,h.$Y)(e);o.snapshotBuffer=t;return(0,h.uH)(t)},o}return n}((function e(t){(0,s.Z)(this,e),this.fetchSubBlockUrl=t,this.reqRecords=new I.Z,this.executeQueueLen=g.Yw,this.queue=[],this.bundleFetchSplitData=(e,t)=>{this.getFetchBlocks((0,p.Z)(e,(e=>e.id===t))),this.executeQueueLen>this.queue.length&&(this.executeQueueLen=this.queue.length);for(let e=0;e<this.executeQueueLen;e++)this.reqRecords.add({bundleIndex:e,time:Number(Date.now())}),this.fetchBundleBlocks(this.queue[e])},this.fetchBundleBlocks=e=>{const t=e.tokens.join(",");if((0,f.getKeys)().includes(t))return void this.fetchBlockCallback();const n=(0,k.Y)(),a=this.getBlockParams(e,t),o=(0,S.FQY)(),s=Object.assign({url:this.fetchSubBlockUrl,method:"GET"},o?{timeout:o}:{},{baseURL:(0,m.X)("/"),params:a,key:t,once:!0,headers:{"Request-Id":n,"x-request-id":n,"x-tt-trace-id":n},callback:this.fetchBlockCallback});(0,f.fetchData)(t,s)},this.getFetchBlocks=e=>{const{queue:t}=this;let n=new v;Object.keys(e).forEach((a=>{const o=e[a],s=o.blocks;s&&s.length>0&&s.forEach((e=>{n.tokens.length<g.uB||(t.push(n),n=new v),n.addBlockToBundle(e,o)}))})),n.totalRowCount>0&&t.push(n)},this.fetchBlockCallback=()=>{const{queue:e}=this;if(this.executeQueueLen>e.length-1)return;const t=e[this.executeQueueLen].tokens.join(",");if((0,f.getData)(t))return this.executeQueueLen++,void this.fetchBlockCallback();this.isOverLimit()?this.fetchBlockCallback():(this.reqRecords.add({bundleIndex:this.executeQueueLen,time:Number(Date.now())}),this.fetchBundleBlocks(e[this.executeQueueLen]),this.executeQueueLen++)},this.isOverLimit=()=>{const{reqRecords:e}=this,t=Number(Date.now())-1e3;for(;!e.isEmpty()&&e.head.value.time<=t;)e.dequeue();return e.size()>g.Yw}})),E=function(e){(0,i.Z)(n,e);var t=D(n);function n(e,a){var o;return(0,s.Z)(this,n),(o=t.call(this,e,"/api/v2/sheet/sub_block")).clientVarsCore=a,o.getBlockParams=(e,t)=>({token:o.token,block_token:t,schema_version:1}),o.preFetchSplitData=()=>{const{clientVarsCore:e}=(0,c.Z)(o),t=e.gzip_snapshot;t&&!e.snapshot&&(o.resetDataAdaptInfo(),e.snapshot=o.stageSnapshotBufferAndGetSnapshot(t)),o.fetchSplitData()},o.fetchSplitData=()=>{const{clientVarsCore:e}=(0,c.Z)(o),{snapshot:t}=e;let n;e.extra_data&&(n=e.extra_data.sheet_id),t&&n&&o.bundleFetchSplitData(t.sheets,n)},o}return n}(_),O=function(e){(0,i.Z)(n,e);var t=D(n);function n(e,a){var o;return(0,s.Z)(this,n),(o=t.call(this,e,"api/v3/sheet/block")).clientVars=a,o.getBlockParams=e=>({token:o.token,blockIds:e.tokens}),o.preFetchSplitData=()=>{const{snapshot:e}=o.clientVars,{gzipBlockMeta:t}=e,n=t?(0,h.ec)(t):void 0;e.blockMeta=n,o.fetchSplitData(n,o.clientVars.sheetId)},o.fetchSplitData=(e,t)=>{if(!e||!t)return;const n=Object.keys(e).reduce(((t,n,a)=>{const{cellBlockMetas:o=[]}=e[n],s={id:n,index:a,blocks:o.map((e=>({blockId:e.blockId,revision:e.revision,rowsCount:e.range.rowEnd-e.range.rowStart,startRowIndex:e.range.rowStart,range:e.range,token:e.blockId,size:e.size})))};return t[n]=s,t}),{});o.bundleFetchSplitData(n,t)},o}return n}(_);var T=n(359980),b=n(947778),R=n(671911),y=n(360154);const P="v0.0.1";let C=function e(t){(0,s.Z)(this,e),this.token=t,this.isValidClientVars=e=>!!e&&(e.token===this.token&&(!!(0,y.Tp)(e)||(!!(0,y.yy)(e)||e.type===g.u.CLIENT_VARS))),this.getClientVars=async()=>{var e,t;if(!(0,r.i9)(this.token))return;let n;const a=null===(e=(0,T.default)(window,"DATA.clientVars"))||void 0===e?void 0:e.data;return a&&this.isValidClientVars(a)&&(n=a),!n&&(0,R.o7)().isSheet&&(n=(await this.getSheetClientVars(this.token)).data),!0!==(null===(t=n)||void 0===t?void 0:t.isHistorySnapshot)?n:void 0},this.getSheetClientVars=async(e,t,n,a,o)=>this.getFetchSheetClientVarsV3(e,t,n,a,o),this.getFetchSheetClientVarsV3=async(e,t,n,o,s)=>{const{timeout:r,memberId:c,requestIdField:i,activeSheetIdField:u,openTypeField:l,extraParams:h}=(0,y.Bj)(a.IO,t,n,o,s),d=(0,b.a$)(),p=Object.assign({url:d,method:"POST"},r?{timeout:r}:{},{key:g.wt,headers:{"Content-Type":"application/json","Request-Id":i,"x-tt-trace-id":i,"x-command":"api.sheet.rce.message"},data:{sheetRange:{sheetId:(0,y.XR)(u)},openType:l,memberId:c,token:e,schemaVersion:g.n0.MUTATION,clientVersion:P,containerId:h.container_id,containerType:h.container_type,wikiSpaceId:h.wiki_space_id}});return(0,f.fetchData)("".concat(e,"_").concat(g.wt),p).promise},this.getFetchSheetClientVarsV2=(e,t,n,o,s)=>{const{timeout:r,memberId:c,requestIdField:i,activeSheetIdField:u,openTypeField:l,extraParams:h}=(0,y.Bj)(a.IO,t,n,o,s),d=(0,b.uY)(Object.assign({sheet_id:u,open_type:l,member_id:c,token:e,version:g.n0.REF,client_version:P},h)),p=Object.assign({url:d,method:"GET"},r?{timeout:r}:{},{key:g.wt,headers:{"Content-Type":"application/json","Request-Id":i,"x-tt-trace-id":i,"x-command":"api.sheet.rce.message"}});return(0,f.fetchData)("".concat(e,"_").concat(g.wt),p).promise}};const w=a.IO.getInstance({}),B=(e,t,n,a,s)=>{const r=(0,o.pO)(e,t,n,a,s);return{source:r.source,promise:r.promise.then((e=>e.data))}},N=e=>{const t=(0,o.jP)(e);return{source:t.source,promise:t.promise.then((e=>{var t;const n={},a=null===(t=e.data)||void 0===t?void 0:t.resource;return a?(Object.keys(a).forEach((e=>{var t;n[e]=(e=>{const t=[];return e?(Object.keys(e).forEach(((e,n)=>{t.push({commentId:e,preloadIndex:n+1})})),t):t})(null==a||null===(t=a[e])||void 0===t?void 0:t.comments)})),n):n}))}},V=new function e(){(0,s.Z)(this,e),this.preloadClientVarsAndBlock=async e=>{const t=new C(e),n=await t.getClientVars();n&&((0,y.Tp)(n)?n.formerlySchema?this.splitDataPreloader=new E(e,(0,y.Ho)(n.formerlySchema)):this.splitDataPreloader=new O(e,n):this.splitDataPreloader=new E(e,(0,y.Ho)(n)),this.splitDataPreloader.preFetchSplitData())},this.preloadSheetData=async e=>{(0,r.i9)(e)&&(this.preloadClientVarsAndBlock(e),window.backupPreloadModule||n.e(64186).then(n.bind(n,72575)).then((t=>{const{preloadSheetbackup:n}=t;n(e)})))}},A=e=>{V.preloadSheetData(e)};function F(){var e;null===(e=V.splitDataPreloader)||void 0===e||e.resetDataAdaptInfo()}function x(){var e;return null===(e=V.splitDataPreloader)||void 0===e?void 0:e.getDataAdaptInfo()}function L(){var e;return null===(e=V.splitDataPreloader)||void 0===e?void 0:e.getSnapshotBuffer()}function Z(){var e;null===(e=V.splitDataPreloader)||void 0===e||e.clearSnapshotBuffer()}function q(e){return window.backupPreloadModule?window.backupPreloadModule.getBackupPreload(e):null}function j(){return window.backupPreloadModule?window.backupPreloadModule.clearBackupPreload():null}const M=A},410699:(e,t,n)=>{n.r(t),n.d(t,{SuccessType:()=>m,FetchType:()=>k,requestor:()=>S,fetchData:()=>g,getData:()=>v,setData:()=>D,delData:()=>_,setCacheDataMap:()=>E,getKeys:()=>O,clearAllCache:()=>b});var a=n(647246),o=n(359980),s=n(31474),r=n(529644),c=n.n(r),i=n(960679),u=n(564682),l=n(319308),h=n(640),d=n(228898);(0,i.Mo)().localhost;let p={},f={};var m,k;!function(e){e[e.NO_PRELOAD=0]="NO_PRELOAD",e[e.HAS_PRELOAD=1]="HAS_PRELOAD"}(m||(m={})),function(e){e[e.NO_PENDING=0]="NO_PENDING",e[e.PENDINIG=1]="PENDINIG",e[e.ERROER=2]="ERROER"}(k||(k={}));const I="preloadHttpHelper",S=d.WY;function g(e,t){const n=S(t);n.then((n=>(p[e]=n,delete f[e],t&&t.callback&&t.callback(e,n.data.blocks),n)),(e=>("url"===l.ZP.from&&T(I,{success:m.NO_PRELOAD,isFetching:k.ERROER,message:e.message}),e)));const a=c().CancelToken.source();return f[e]={promise:n,source:a},f[e]}function v(e,t=!0){const n="url"===l.ZP.from;if(p[e]||f[e]){if(p[e]){n&&T(I,{success:m.HAS_PRELOAD,isFetching:k.NO_PENDING});const o=t?(0,a.default)(p[e]):p[e];return{data:o,promise:Promise.resolve(o)}}return n&&T(I,{success:m.HAS_PRELOAD,isFetching:k.PENDINIG}),Object.assign({},f[e])}n&&T(I,{success:m.NO_PRELOAD})}function D(e,t){if(!f[e]){const{promise:n,source:a}=t;f[e]={promise:n,source:a}}}function _(e){delete p[e],delete f[e]}function E(e,t){null===t?delete p[e]:p[e]=t}function O(){return Object.keys(p).concat(Object.keys(f))}function T(e,t={}){(0,o.default)(window,"local.localhost"),(0,u.nh)(e,Object.assign({},t))}function b(){p={},f={}}let R;h.Z.listen((()=>{const e=s.Z.pathname;R!==e&&(b(),R=e)}))}}]);