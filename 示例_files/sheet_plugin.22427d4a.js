"use strict";(self.webpackChunkbear_fe=self.webpackChunkbear_fe||[]).push([["vsh_6006"],{vsh_82358:function(e,t,n){n.d(t,{_t:function(){return To},Z2:function(){return bo},aZ:function(){return jo},DQ:function(){return Uo}});var r=n("vsh_67017"),o=n.n(r),i=n("vsh_19264"),a=n("vsh_4175"),s=n("vsh_4561"),l=n("vsh_75119"),u=n("vsh_74561"),c=n("vsh_35838"),h=n("vsh_95065"),d=n("vsh_40285"),f=n("vsh_44858"),v=n("vsh_74607"),p=n("vsh_746"),g=n("vsh_94477"),m=n("vsh_25845"),_=n("vsh_24627"),y=n("vsh_6127"),C=n.n(y),S=n("vsh_9812"),k=n("vsh_32613"),E=n("vsh_94753"),T=n("vsh_80055"),b=n("vsh_78638"),I=n("vsh_76020"),R=n("vsh_7959"),w=function(){function e(){(0,i.Z)(this,e),this.className="FontFamily",this.name=S.p.FontFamily}return(0,a.Z)(e,[{key:"deserialize",value:function(e){var t=e.node,n=e.deltaSet,r=e.zoneId;if(t instanceof HTMLElement){var o=t.getAttribute("font-family");o&&(0,T.d)(n,r,(0,u.Z)({},_.Psm.FontFamily,o))}return n}},{key:"serialize",value:function(e){var t=e.type,n=e.node,r=e.op;if(r&&r.attributes){var o=r.attributes[_.Psm.FontFamily];if(t===b.T.LEAF&&o){var i=document.createElement("span");return i.appendChild(n),i.style["font-family"]=o,Object.assign(e,{node:i})}}return e}},{key:"match",value:function(e){return e===_.Psm.FontFamily}},{key:"render",value:function(e){var t=e.children,n=e.attributes.fontfamily;return n=(0,R.MF3)(n),(0,l.az)(I.x,{style:{fontFamily:n}},t)}}]),e}(),A=n("vsh_72834"),F=function(){function e(t){var n=t.editor,r=t.sheetBridge;(0,i.Z)(this,e),this.className="FontSize",this.name=S.p.FontSize,this.editor=n,this.sheetBridge=r}return(0,a.Z)(e,[{key:"deserialize",value:function(e){var t=e.node,n=e.deltaSet,r=e.zoneId;if(t instanceof HTMLElement){var o=t.getAttribute(_.Psm.FontSize);o&&(0,T.d)(n,r,(0,u.Z)({},_.Psm.FontSize,String(o)))}return n}},{key:"serialize",value:function(e){var t=e.type,n=e.node,r=e.op;if(r&&r.attributes){var o=r.attributes[_.Psm.FontSize];if(t===b.T.LEAF&&o){var i=document.createElement("span");return i.appendChild(n),i.style["font-size"]=o,Object.assign(e,{node:i})}if(t===b.T.ROOT&&o){var a=document.createElement("div");return a.appendChild(n),a.style["font-size"]=o,Object.assign(e,{node:a})}}return e}},{key:"match",value:function(e){return e===_.Psm.FontSize}},{key:"render",value:function(e){var t,n,r,o=e.children,i=e.attributes.fontsize,a=void 0===i?A.OvR:i,s=Uo(this.editor);if(!s)return o;var u=null===(t=C().isH5)||void 0===t||t||(null===(r=null===(n=this.sheetBridge)||void 0===n?void 0:n.isZoomDisabled)||void 0===r?void 0:r.call(n))?1:_.UIE.getItem(s),c=parseInt(a,10)*u;return(0,l.az)(I.x,{style:{fontSize:c+"px"}},o)}}]),e}(),D=n("vsh_56049"),N=n("vsh_5079"),P=function(){function e(){(0,i.Z)(this,e)}return(0,a.Z)(e,[{key:"match",value:function(e){return"link_background"===e}},{key:"render",value:function(e){var t=e.children;return(0,l.az)(N.G,{style:{backgroundColor:R.tvt}},t)}}]),e}(),O=n("vsh_10002"),M=n("vsh_65498"),L=n("vsh_82631"),x=n("vsh_83640"),V=n("vsh_37075"),Z=function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":(0,M.Z)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},B=function(){function e(t){(0,i.Z)(this,e),this.editor=t.editor}return(0,a.Z)(e,[{key:"editorWillPaste",value:function(e){var t=(0,L.cB)(this.editor),n=new V.D;e.deltaSet.forEach((function(r,o){if(o===e.zoneId){var i=r.create({zoneId:o}),a=r.reduce((function(e,n){var r;if(!n.insert||null!==(r=n.attributes)&&void 0!==r&&r.lmkr)return e.push(n);var o=n.attributes;o&&(delete o[_.Psm.Bold],delete o[_.Psm.Italic],delete o[_.Psm.Underline],delete o[_.Psm.Strikethrough],delete o[_.Psm.TextColor],delete o[_.Psm.FontSize],delete o[_.Psm.FormulaColor],delete o[_.Psm.FontFamily]),Object.keys(t).length&&(o=Object.assign({},o||{},{},t));for(var i=n.insert,a="";i.length>0;){var s=i.includes("\n"),l=i.split("\n",1)[0];a=i.substring(l.length+1),i=l,e.insert(i,o),i=a,s&&e.insertEnter(n.attributes)}return e}),i);n=n.concat(a)}else n=n.concat(r)})),e.deltaSet=n}}]),e}();Z([(0,x.gv)(1001)],B.prototype,"editorWillPaste",null);var H,U,j=n("vsh_78325"),G=n("vsh_20770"),K=n("vsh_85585"),W=n("vsh_95096"),z=n("vsh_78400"),Y=n("vsh_69691"),J=z.N900,q=function(){function e(){(0,i.Z)(this,e),this.className="FormulaHighlight",this.name=S.p.FormulaHighlight}return(0,a.Z)(e,[{key:"match",value:function(e){return e===_.Psm.FormulaHighlight}},{key:"render",value:function(e){var t=e.children,n=e.attributes,r=e.style,o=n.formulahighlight;return(void 0===o?"":o)&&Object.assign(r,{backgroundColor:(0,Y.getAlphaColor)((0,Y.getThemeColor)(J),.3),borderRadius:"2px"}),t}}]),e}(),X=n("vsh_1139"),Q=n("vsh_12064"),ee=n("vsh_22462"),te=n("vsh_73455"),ne=n("vsh_22023"),re=n("vsh_83927"),oe=n("vsh_33476"),ie=n.n(oe),ae=n("vsh_98652"),se=n("vsh_9452"),le=n("vsh_7121"),ue=n("vsh_39504"),ce=n("vsh_39560");function he(e,t){var n=ie()(e);return"number"==typeof t&&n.setAlpha(t),n.toRgbString().replace(/\s+/g,"")}function de(e){return ie()(e).isValid()}var fe,ve,pe,ge,me,_e,ye="COLOR_PINK_LIGHT_BACKGROUND",Ce="COLOR_ORANGE_LIGHT_BACKGROUND",Se="COLOR_YELLOW_LIGHT_BACKGROUND",ke="COLOR_GREEN_LIGHT_BACKGROUND",Ee="COLOR_BLUE_LIGHT_BACKGROUND",Te="COLOR_PURPLE_LIGHT_BACKGROUND",be="COLOR_GRAY_LIGHT_BACKGROUND",Ie="COLOR_PINK_DARK_BACKGROUND",Re="COLOR_ORANGE_DARK_BACKGROUND",we="COLOR_YELLOW_DARK_BACKGROUND",Ae="COLOR_GREEN_DARK_BACKGROUND",Fe="COLOR_BLUE_DARK_BACKGROUND",De="COLOR_PURPLE_DARK_BACKGROUND",Ne="COLOR_GRAY_DARK_BACKGROUND",Pe="COLOR_PINK_TEXT",Oe="COLOR_ORANGE_TEXT",Me="COLOR_YELLOW_TEXT",Le="COLOR_GREEN_TEXT",xe="COLOR_BLUE_TEXT",Ve="COLOR_PURPLE_TEXT",Ze="COLOR_GRAY_TEXT",Be=(H={},(0,u.Z)(H,ye,"ccmtoken-doc-highlightcolor-red-soft"),(0,u.Z)(H,Ce,"ccmtoken-doc-highlightcolor-orange-soft"),(0,u.Z)(H,Se,"ccmtoken-doc-highlightcolor-sunflower-soft"),(0,u.Z)(H,ke,"ccmtoken-doc-highlightcolor-green-soft"),(0,u.Z)(H,Ee,"ccmtoken-doc-highlightcolor-blue-soft"),(0,u.Z)(H,Te,"ccmtoken-doc-highlightcolor-purple-soft"),(0,u.Z)(H,be,"ccmtoken-doc-highlightcolor-neutral-soft"),(0,u.Z)(H,Ie,"ccmtoken-doc-highlightcolor-red-solid"),(0,u.Z)(H,Re,"ccmtoken-doc-highlightcolor-orange-solid"),(0,u.Z)(H,we,"ccmtoken-doc-highlightcolor-sunflower-solid"),(0,u.Z)(H,Ae,"ccmtoken-doc-highlightcolor-green-solid"),(0,u.Z)(H,Fe,"ccmtoken-doc-highlightcolor-blue-solid"),(0,u.Z)(H,De,"ccmtoken-doc-highlightcolor-purple-solid"),(0,u.Z)(H,Ne,"ccmtoken-doc-highlightcolor-neutral-solid"),(0,u.Z)(H,Pe,"R600"),(0,u.Z)(H,Oe,"O600"),(0,u.Z)(H,Me,"Y600"),(0,u.Z)(H,Le,"G600"),(0,u.Z)(H,xe,"B600"),(0,u.Z)(H,Ve,"P600"),(0,u.Z)(H,Ze,"N500"),H),He=(new Map([[ye,"rgb(255, 188, 178)"],[Ce,["rgb(254, 212, 164)","rgb(248, 230, 171)"]],[Se,"rgb(255, 243, 98)"],[ke,["rgb(176, 253, 167)","rgb(183, 237, 177)"]],[be,"rgb(222, 224, 227)"],[Re,"rgb(255, 211, 126)"],[we,"rgb(250, 211, 85)"],[Fe,"rgb(167, 206, 255)"],[De,"rgb(223, 176, 255)"]]),U={},(0,u.Z)(U,le.ThemeType.LIGHT,ce.Z),(0,u.Z)(U,le.ThemeType.DARK,ue.Z),U);function Ue(e,t){var n=Be[e];if(n){var r=function(e,t){var n=(0,le.getThemeValue)(t);return n&&n[e]||He[t][e]}(n,t);return r&&he(r)}return n}function je(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:le.ThemeType.LIGHT,t=[[ye],[Ce],[Se],[ke],[Ee],[Te],[be],[Ie],[Re],[we],[Ae],[Fe],[De],[Ne]],n=new Map(t.map((function(t){var n=(0,X.Z)(t,1)[0];return[n,Ue(n,e)]}))),r=[[Pe],[Oe],[Me],[Le],[xe],[Ve],[Ze]],o=new Map(r.map((function(t){var n=(0,X.Z)(t,1)[0];return[n,Ue(n,e)]})));return{backgroundColorMap:n,textColorMap:o}}var Ge,Ke="highlight";!function(e){e.TEXT="TEXT",e.BACKGROUND="BACKGROUND"}(Ge||(Ge={}));var We=je(),ze=We.backgroundColorMap,Ye=We.textColorMap,Je=(new Map(Array.from(ze,(function(e){return e.reverse()}))),new Map(Array.from(Ye,(function(e){return e.reverse()}))),"COLOR_CLEAR"),qe=new Map([].concat((0,ae.Z)(ze),(0,ae.Z)(Ye),[[Je,"clear"]])),$e=new Set((0,ae.Z)(qe.values())),Xe=(0,u.Z)({COLOR_PINK:"colorPink",COLOR_ORANGE:"colorOrange",COLOR_YELLOW:"colorYellow",COLOR_BLUE:"colorBlue",COLOR_GREEN:"colorGreen",COLOR_PURPLE:"colorPurple"},Je,"colorClear"),Qe={BACKGROUND:"backcolor",TEXT:"textcolor",CLEAR:"highlight_cancel"},et=(fe={},(0,u.Z)(fe,Qe.TEXT,"color"),(0,u.Z)(fe,Qe.BACKGROUND,"backgroundColor"),fe),tt=(ve={},(0,u.Z)(ve,Qe.TEXT,"text"),(0,u.Z)(ve,Qe.BACKGROUND,"background"),pe={},(0,u.Z)(pe,Qe.BACKGROUND,"rgba(0,0,0,0)"),(0,u.Z)(pe,Qe.TEXT,he(se.xA)),ge={},(0,u.Z)(ge,Qe.BACKGROUND,"white"),(0,u.Z)(ge,Qe.TEXT,se.xA),me={},(0,u.Z)(me,Qe.TEXT,"foreColor"),(0,u.Z)(me,Qe.BACKGROUND,"backColor"),se.gR,se.bV,se.VB,se.YC,se.J1,se.f5,se.T5,se.hH,se.$H,se.KH,se.jC,se.ak,se.xS,se.cS,he(se.AX,.55),he(se.HD,.55),he(se.q3,.8),he(se.vJ,.7),he(se.VY,.7),_e={},(0,u.Z)(_e,Xe.COLOR_PINK,["rgba(255, 188, 178, 1)","#ffbcb2","rgb(255, 188, 178)"]),(0,u.Z)(_e,Xe.COLOR_ORANGE,["rgba(255, 211, 126, 1)","#ffd37e","rgb(255, 211, 126)"]),(0,u.Z)(_e,Xe.COLOR_YELLOW,["rgba(255, 243, 98, 1)","#fff362","rgb(255, 243, 98)"]),(0,u.Z)(_e,Xe.COLOR_BLUE,["rgba(167, 206, 255, 1)","#a7ceff","rgb(167, 206, 255)"]),(0,u.Z)(_e,Xe.COLOR_GREEN,["rgba(176, 253, 167, 1)","#b0fda7","rgb(176, 253, 167)"]),(0,u.Z)(_e,Xe.COLOR_PURPLE,["rgba(223, 176, 255, 1)","#dfb0ff","rgb(223, 176, 255)"]),_e),nt="".concat((0,Y.encryptTea)(window.User.id),"_HIGHLIGHT_COLOR_KEY_V2"),rt="COLOR_YELLOW_LIGHT_BACKGROUND",ot={background:ze.get(rt)},it=(JSON.stringify(ot),tt[Xe.COLOR_YELLOW][1],tt[Xe.COLOR_PINK][0],[_.kHU.SHEET_BLOCK,_.kHU.BITABLE_BLOCK,_.kHU.CHAT_CARD_BLOCK,_.kHU.POLL_BLOCK,_.kHU.FILE_CARD_BLOCK]),at=n("vsh_47246");function st(e,t){var n=null;try{n=JSON.parse(e,t)}catch(t){n=(0,at.default)(e)}return n}var lt=je(),ut=lt.backgroundColorMap,ct=lt.textColorMap,ht={background:new Map(Array.from(ut,(function(e){return e.reverse()}))),text:new Map(Array.from(ct,(function(e){return e.reverse()})))};var dt=n("vsh_33916");function ft(){if(window.localStorage)try{var e=localStorage.getItem(nt),t=st(e);if(!t)return null;if("string"!=typeof t){var n=(r=t,o=(0,le.getCurrentThemeType)()||le.ThemeType.LIGHT,["text","background"].map((function(e){var t=r[e];if(t){var n=Ue(ht[e].get(t),o);n&&(!i&&(i=(0,at.default)(r)),i[e]=n)}})),i);if(n)return JSON.stringify(Object.assign({},t,{backgroundLocalColor:n.background,textLocalColor:n.text}))}return e}catch(e){return console.info("localStorage get error from highlight: ".concat(e)),null}var r,o,i;return null}function vt(e){return $e.has(e)}function pt(){var e={background:ot.background,backgroundLocalColor:_t().get(rt)};return[JSON.stringify(e),e]}var gt=ze,mt={};function _t(){return gt}function yt(e){var t=mt[e];t||(t=je(e),mt[e]=t),gt=t.backgroundColorMap,t.textColorMap}yt((0,le.getCurrentThemeType)()||le.ThemeType.LIGHT),(0,le.onUIStateChange)((function(e){yt("DARK"===(e.mode&&e.mode.toUpperCase())?le.ThemeType.DARK:le.ThemeType.LIGHT)}));var Ct=function(){function e(){(0,i.Z)(this,e),this.storedColor=function(){var e=ft();if(e)try{var t=JSON.parse(e),n=t.text,r=t.background;return vt(n)||vt(r)?[e,t]:pt()}catch(e){return console.error("Highlight local value format is damaged: ".concat(e)),pt()}return pt()}()[1]}return(0,a.Z)(e,[{key:"getHighlightAttributes",value:function(e,t){var n,r=e.colorData;if(null===(n=t.selection.getSelection())||void 0===n||!n.isCollapsed()){var o=this.parseColorData(r);return this.resetStoredColor(o),this.getAttributePairs(o)}}},{key:"doSupportComposeColor",value:function(){return!0}},{key:"parseColorData",value:function(e){if((t=e)===Xe[Je]||t===Je)return null;var t,n=e?st(e):this.storedColor;return"object"===(0,M.Z)(n)?n:null}},{key:"getAttributePairs",value:function(e){return e?Object.entries(e).map((function(e){var t=(0,X.Z)(e,2),n=t[0],r=t[1];return[Qe[n.toUpperCase()],r]})):[[Qe.BACKGROUND,""],[Qe.TEXT,""]]}},{key:"resetStoredColor",value:function(e){e&&(this.storedColor=Object.assign({},this.storedColor,{},e))}}]),e}(),St=function(e){function t(e){var n,r=e.editor;return(0,i.Z)(this,t),(n=(0,Q.Z)(this,(0,ee.Z)(t).call(this))).name=Ke,n.register=function(e){e.registerCommand(Ke,(function(e,t,r,o){var i,a=o.source,s=o.button,l=o.value,u=(null==s||null===(i=s.getAttribute)||void 0===i?void 0:i.call(s,"data-color"))||l||"",c=n.highlightColor.getHighlightAttributes({colorData:u,source:a},t);c&&((0,ne.default)(n.lastUsedColors,c)?n.sendCollectorData(a,{action:"highlight_default"}):(n.lastUsedColors=c,n.sendCollectorData(a,{action:"highlight_switch_color"})),c.forEach((function(e){var t=(0,X.Z)(e,2),r=t[0],o=t[1],i=n.getCollectorParams({attribKey:r,attribValue:o});n.sendCollectorData(a,i)})))}))},n.editor=r,n.highlightColor=new Ct,n.register(r),n}return(0,te.Z)(t,e),(0,a.Z)(t,[{key:"handleStyle",value:function(e,t,n){var r=function(e){return String(e).startsWith("var(")}(t);if(r||de(t)){var o=r?t:he(t),i=function(e,t){return(0,R.Ehf)(e,t?dt.ColorThemeType.Color:dt.ColorThemeType.Background)}(o,e===Qe.TEXT)||o;n[et[e]]=i}}},{key:"sendCollectorData",value:function(e,t){var n=this.editor.getContentState().getActiveZone();_.Ps3.collectEvent("toggle_attribute",Object.assign({},t,{source:e,zone:n.getType()}))}},{key:"getCollectorParams",value:function(e){var t=e.attribKey,n=e.attribValue;if(de(n)){var r=ie()(n),o=r.toHexString(),i=r.getAlpha();return{action:t,color_value:"".concat(o," ").concat(i)}}return{action:Qe.CLEAR}}},{key:"match",value:function(e){return e===Qe.BACKGROUND||e===Qe.TEXT}},{key:"render",value:function(e){var t=e.attributes,n=e.children,r={};return function(e){return!!(e.aceTable||e.gallery||e.dataMetaBlockProps&&it.some((function(t){return e.dataMetaBlockProps.includes(t)})))}(t)||(t[Qe.TEXT]&&this.handleStyle(Qe.TEXT,t[Qe.TEXT],r),e.style=Object.assign({},e.style,{},r)),n}},{key:"editorWillApplyChange",value:function(e){return e.deltaSet.forEach((function(e){e instanceof d.I&&e.forEach((function(e){e.attributes&&e.attributes["temp-ignore-color"]&&delete e.attributes["temp-ignore-color"]}))})),e.deltaSet}},{key:"serialize",value:function(e){var t=e.type,n=e.node,r=e.op;if(r&&r.attributes){var o=r.attributes[Qe.TEXT],i=r.attributes[Qe.BACKGROUND];if(t===b.T.LEAF&&(o||i)){var a=document.createElement("span");return a.appendChild(n),a.style[et[Qe.TEXT]]=o,a.style[et[Qe.BACKGROUND]]=i,Object.assign(e,{node:a})}}return e}}]),t}(re.S);St.KEY=Ke;var kt=n("vsh_96580"),Et=n("vsh_39977"),Tt=new RegExp("mention-type|".concat("IGNORE_HYPERLINK"));function bt(e){return e.startsWith("url-")||e.startsWith("url:")||e===kt.in}var It=n("vsh_11725"),Rt=function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":(0,M.Z)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},wt=function(e){function t(){return(0,i.Z)(this,t),(0,Q.Z)(this,(0,ee.Z)(t).apply(this,arguments))}return(0,te.Z)(t,e),(0,a.Z)(t,[{key:"match",value:function(e){return bt(e)}},{key:"renderInlineWrapper",value:function(e){var t,n=e.index,r=e.attributes,o=e.lineState,i=Object.keys(r).find((function(e){return bt(e)}));if(!i)return null;var a=n-1,s=null;a>=0&&(null===(t=o.getOps()[a].attributes)||void 0===t?void 0:t[i])&&(s=i);var u=i;if(this.inlineWrapperCache&&u===s)return this.inlineWrapperCache;var c=(0,l.az)(I.x,{"outer-u-container":!0});return this.inlineWrapperCache=c,c}},{key:"getUrl",value:function(e){var t="",n=Object.keys(e);n.forEach((function(n){var r=e[n];/url-(\S+)/.exec(n)&&"javascript:void(0)"!==r&&(t+=" ".concat(n,":").concat(r)),"url:"===n&&(t+=" ".concat(n).concat(r)),n===kt.in&&(t+=" url:".concat(r))}));var r=/(?:^| )url-([A-Za-z0-9]*):(\S+)/.exec(t),o=/(^| )url:(\S+)/.exec(t),i=n.find((function(e){return"removeLink"===e})),a=(r||o)[2];try{this.handleValidLink(a)||(a=decodeURIComponent(a))}catch(e){}return 0===a.indexOf("javascript")&&(a=""),Tt.test(t)&&a?{href:"",linkId:""}:a&&!i?{href:(0,Y.completeURLProtocol)(a),linkId:""}:{href:"",linkId:""}}},{key:"deserialize",value:function(e){var t=e.node,n=e.deltaSet,r=e.zoneId,o=e.text,i=n;if(t&&o&&function(e,t){var n,r,o;return!!(0,_.CBv)(t)&&"A"===(null==e||null===(n=e.parentNode)||void 0===n?void 0:n.tagName)&&1===(null==e||null===(r=e.parentNode)||void 0===r||null===(o=r.parentNode)||void 0===o?void 0:o.childElementCount)&&e.parentNode.href===t}(t,o)&&(i=(new V.D).concat((new d.I).insert(o))),t instanceof HTMLElement){var a=t.className,s=t.tagName;if(a.indexOf("removeLink")>-1&&(i=(0,T.d)(i,r,{removeLink:"true"})),"A"===s){for(var l=t.parentNode;null!==l&&"span"!==l.tagName.toLocaleLowerCase()&&"body"!==l.tagName.toLocaleLowerCase();)l=l.parentNode;var c=t.getAttribute(It.Jl),h=(0,It.Jc)(c);(0,It.rD)(t,h)&&((0,It.$j)(t,h),i=(new V.D).concat((new d.I).insert(h.title)));var f=l&&l.className,v=f&&f.indexOf("url-")>-1,p=f&&f.indexOf("mention")>-1,g=f&&!v&&f.indexOf("url")>-1,m=t.href,y="string"==typeof m&&(m.indexOf("javascript:void(0)")>-1||0===m.length);if(v){var C=/(?:^| )url-([A-Za-z0-9]*)/.exec(f),S=/(^\s*)|(\s*$)/g;if(C&&!y){var k=C[0].replace(S,"");i=(0,T.d)(i,r,(0,u.Z)({},k,m))}else if(C){var E=C[0].replace(S,"");i=(0,T.d)(i,r,(0,u.Z)({},E,$(t).data("href")||m))}}if(!(v||y||p||g)){var b="url-".concat((0,_.zsn)(10));i=(0,T.d)(i,r,(0,u.Z)({},b,m))}}}return i}},{key:"serialize",value:function(e){var t=e.type,n=e.node,r=e.op;if(t===b.T.LEAF){if(!r)return e;var o=r.attributes&&Object.keys(r.attributes).find((function(e){return e.includes("url-")}));if(o&&r.attributes){var i=document.createElement("a");i.style.fontSize=r.attributes.fontsize;var a=r.attributes[o];try{a=decodeURIComponent(a)}catch(e){console.error("serialize editor hyperlink error",e)}i.setAttribute("href",a),i.setAttribute("target","_blank"),i.setAttribute("rel","noopener noreferrer"),i.appendChild(n),e.node=i}}return e}}]),t}(Et.vx);Rt([(0,x.gv)(1001)],wt.prototype,"deserialize",null);var At=n("vsh_86982"),Ft=n("vsh_10189"),Dt=n("vsh_23154"),Nt="FILE_CARD",Pt="FILE_CARD_BLOCK",Ot="dataMetaBlockProps";function Mt(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Lt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Lt(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function Lt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function xt(e){var t="";if(t+="<"+e.name,e.attributes)for(var n in e.attributes)t+=" "+n+'="'+e.attributes[n]+'"';if(t+=">",e.children){var r,o=Mt(e.children);try{for(o.s();!(r=o.n()).done;){t+=xt(r.value)}}catch(e){o.e(e)}finally{o.f()}}return t+="</"+e.name+">"}function Vt(e){var t;return null===(t=C().isH5)||void 0===t||t?e:xt(e)}var Zt="#3370FF",Bt=Vt({name:"svg",type:"element",value:"",attributes:{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"4 4 16 16"},children:[{name:"path",type:"element",value:"",attributes:{d:"M13.56 8.38a.75.75 0 0 1 1.06 1.06L10 14.08a.72.72 0 0 0 1.02 1.02l5.27-5.28a2.19 2.19 0 1 0-3.1-3.09L7.7 12.21a3.56 3.56 0 1 0 5.04 5.04l3.98-3.98a.75.75 0 1 1 1.06 1.06l-3.98 3.98a5.06 5.06 0 0 1-7.16-7.16l5.49-5.48a3.69 3.69 0 1 1 5.2 5.21l-5.26 5.28a2.22 2.22 0 0 1-3.14-3.14l4.63-4.64z",fill:Zt},children:[]}]}),Ht=function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":(0,M.Z)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Ut={};if("true"!=={NODE_ENV:"production",CDN_URL:navigator.cdn_host+"/eesz/bear/sheet/module",FASTER_TEST:void 0}.bear_web_custom_story)try{var jt=n("vsh_18801");Ut=jt.eventEmitter}catch(e){}var Gt=function(e){function t(e){var n;return(0,i.Z)(this,t),(n=(0,Q.Z)(this,(0,ee.Z)(t).call(this))).name=Nt,n.handleClick=function(e){var t=(0,At.Z)(e,["driveKey","name","size","type"]);Ut.emit("SHEET_PREVIEW_ATTACHMENT",t)},n}return(0,te.Z)(t,e),(0,a.Z)(t,[{key:"match",value:function(e,t){if(e===Ot)try{if(JSON.parse(t).blockType===Pt)return!0}catch(e){console.error("".concat(Ot," local value format is damaged: ").concat(e))}return!1}},{key:"render",value:function(e){var t,n,r,o=this,i=(0,It.CX)(null===(t=e.attributes)||void 0===t?void 0:t.dataMetaBlockProps),a=null==i?void 0:i.props.data;return(0,l.az)(Ft.c,null,(0,l.az)(l.ZC,{on:{click:function(){a&&o.handleClick(a.fileInfo)},mousedown:function(e){e.nativeEvent.preventDefault()}},style:Object.assign({},e.style,{padding:"2px",underline:!0,fontColor:"--B500",cursor:"pointer",$hover:{backgroundColor:"--primary-fill-solid-02",underline:!0,borderRadius:"4px"}})},(0,l.az)(l.hk,{disableRTL:!0},(0,Dt.Wb1)({src:Bt}),(0,l.az)(I.x,{style:{marginLeft:"4px"}},null!==(r=null===(n=null==a?void 0:a.fileInfo)||void 0===n?void 0:n.name)&&void 0!==r?r:""))))}},{key:"serialize",value:function(e){var t,n,r,o,i,a,s=e.type,l=e.op,u=null===(t=null==l?void 0:l.attributes)||void 0===t?void 0:t.dataMetaBlockProps;if(s===b.T.LEAF&&u){var c=(0,It.CX)(u);if((null==c?void 0:c.blockType)===Pt){var h=document.createElement("span");c.props.fromCopy=!0;var d=(0,It.e$)(c,"");h.innerHTML=d;var f=h.firstChild;null===(n=f)||void 0===n||n.classList.add("block-old-uuid-".concat(c.blockId));var v=null===(r=null==f?void 0:f.firstChild)||void 0===r?void 0:r.classList;v.add(_.U1p),v.add("block-id-".concat(c.blockId)),v.add("block-type-".concat(c.blockType));var p=document.createTextNode(null===(a=null===(i=null===(o=c.props)||void 0===o?void 0:o.data)||void 0===i?void 0:i.fileInfo)||void 0===a?void 0:a.name),g=document.createElement("span");g.className="ignore-collect",g.appendChild(p),null==f||f.appendChild(g),e.node=f}}return e}},{key:"deserialize",value:function(e){var t=e.node,n=e.deltaSet,r=e.zoneId;if(!(t&&t instanceof HTMLElement))return n;if(t.classList.contains("editor-kit-file-card")){var o=t.getAttribute("data-file-card-meta-block-props");if(o){var i=new d.I({zoneId:r}).insert(" ",{dataMetaBlockProps:o});return n.replace(r,i)}}return n}},{key:"editorWillCopy",value:function(e){var t;e.deltaSet.forEach((function(e){e.forEach((function(e){var n;if(" "===e.insert&&(null===(n=e.attributes)||void 0===n?void 0:n[Ot]))try{var r=JSON.parse(e.attributes[Ot]);r.blockType===Pt&&r.props&&(t||(t=_.Ps3.getUrlToken()),r.props.suitToken=t,e.attributes[Ot]=JSON.stringify(r))}catch(e){console.error("".concat(Ot," local value format is damaged: ").concat(e))}}))}))}},{key:"editorWillPaste",value:function(e){e.deltaSet.forEach((function(e){e.forEach((function(e){var t;if(" "===e.insert&&(null===(t=e.attributes)||void 0===t?void 0:t[Ot]))try{var n=JSON.parse(e.attributes[Ot]);n.blockType===Pt&&n.props&&(n.props.fromCopy=!0,n.blcokId=(0,It.Es)(),e.attributes[Ot]=JSON.stringify(n))}catch(e){console.error("".concat(Ot," local value format is damaged: ").concat(e))}}))}))}}]),t}(re.S);Gt.KEY=Nt,Ht([(0,x.gv)(500)],Gt.prototype,"render",null),Ht([(0,x.gv)(500)],Gt.prototype,"serialize",null);var Kt=n("vsh_71257"),Wt=n("vsh_71453");function zt(){return/shortcut=true/.test(Wt.Z.search)}zt();var Yt=function(e){var t=e.url,n=e.title;return(0,l.az)(Ft.c,{on:{click:function(){zt()||(window.location.href=t)}}},(0,l.az)(Kt.r,{src:t,label:n},(0,l.az)(l.xv,{content:n})))},Jt=function(e){var t=zt();return(0,l.az)(N.G,{style:{padding:"2px 0"}},(0,l.az)(l.hk,{style:{spill:"ellipsis",maxLines:1}},e.icon?(0,l.az)(Dt.Eep,{fit:"fill",src:e.icon,width:16,height:16,style:{width:"16px",height:"16px",marginRight:"8px",backgroundColor:"--N00"}}):null,(0,l.az)(Kt.r,{src:"",onClick:function(){(t||e.forceOpen)&&window.open((0,Y.completeURLProtocol)(e.url),"_blank","noopener,noreferrer")},label:e.url,style:{fontSize:"14px",lineHeight:"16px"}},(0,l.az)(l.xv,{content:e.url}))))},qt=function(e){return e.url?(0,l.az)(Dt.Eep,{fit:"fill",src:e.url,width:60,height:60,style:{flexGrow:1,flexShrink:0,backgroundColor:"#fff"}}):null},$t=function(e){return(0,l.az)(Ft.c,null,(0,l.az)(N.G,{style:{maxWidth:"300px",borderRadius:"4px",border:"1px solid --line-border-card",backgroundColor:"--bg-body-overlay",cursor:"pointer",$hover:{borderColor:"--primary-pri-200"}}},(0,l.az)(l.gq,null,(0,l.az)(N.G,{style:{flexGrow:2,padding:"6px 8px"}},(0,l.az)(l.MG,null,(0,l.az)(I.x,{style:{fontSize:"16px",fontWeight:"500",lineHeight:"26px"}},e.title),(0,l.az)(Jt,{url:e.url,icon:e.icon,forceOpen:!0})))),(0,l.az)(qt,{url:e.cover_url,width:e.cover_width,height:e.cover_height}),(0,l.az)(I.x,{style:{fontSize:"".concat((80+(e.cover_height||0))/1.4,"px")}})))};$t._displayName="Bookmark";var Xt,Qt,en=$t;!function(e){e.Record="record",e.Card="card",e.Embed="embed",e.Database="database",e.Bookmark="bookmark"}(Xt||(Xt={})),function(e){e.Pano="pano",e.SmartLink="smartLink"}(Qt||(Qt={}));var tn="editor-kit-link",nn="data-link-meta-block-props",rn="LINK",on="dataMetaBlockProps",an="LINK_BLOCK",sn=function(e){function t(){var e;return(0,i.Z)(this,t),(e=(0,Q.Z)(this,(0,ee.Z)(t).call(this))).name=rn,e.data={},e.createLinkNode=function(e){var t=document.createElement("a");return t.className=tn,t.setAttribute(nn,e),t},e}return(0,te.Z)(t,e),(0,a.Z)(t,[{key:"match",value:function(e,t){var n;if(e===on)try{var r=JSON.parse(t);if(r.blockType===an)return this.data=null===(n=null==r?void 0:r.props)||void 0===n?void 0:n.data,!0}catch(e){console.error("".concat(on," local value format is damaged: ").concat(e))}return!1}},{key:"render",value:function(e){switch(this.data.linkType){case Xt.Record:return(0,l.az)(Yt,{url:this.data.url,title:this.data.title});case Xt.Bookmark:return(0,l.az)(en,{title:this.data.title,url:this.data.url,icon:this.data.icon,cover_url:this.data.cover_url,cover_width:this.data.cover_width,cover_height:this.data.cover_height});default:return console.error("It comes an unrecognized link type: ".concat(this.data.linkType)),(0,l.az)(Yt,{url:this.data.url,title:this.data.title})}}},{key:"serialize",value:function(e){var t,n,r;if(" "===(null===(t=e.op)||void 0===t?void 0:t.insert)&&(null===(r=null===(n=e.op)||void 0===n?void 0:n.attributes)||void 0===r?void 0:r.dataMetaBlockProps))try{if(JSON.parse(e.op.attributes.dataMetaBlockProps).blockType===an){var o=this.createLinkNode(e.op.attributes.dataMetaBlockProps);e.node=o}}catch(e){console.error("".concat(on," local value format is damaged: ").concat(e))}return e}},{key:"deserialize",value:function(e){var t=e.node,n=e.deltaSet,r=e.zoneId;if(!(t&&t instanceof HTMLElement))return n;if(t.classList.contains(tn)){var o=t.getAttribute(nn);if(o){var i=new d.I({zoneId:r}).insert(" ",{dataMetaBlockProps:JSON.stringify(o)});return n.replace(r,i)}}return n}}]),t}(re.S);sn.KEY=rn;var ln,un=n("vsh_93035"),cn=n("vsh_56589"),hn=n("vsh_50923"),dn=n("vsh_30043"),fn=n("vsh_35067"),vn=n("vsh_98125"),pn=n.n(vn),gn=n("vsh_78898"),mn=n.n(gn);!function(e){e.Readable="readable",e.Editable="editable"}(ln||(ln={}));var _n,yn,Cn,Sn,kn,En,Tn,bn,In,Rn,wn,An,Fn="HIDE_SHARE_POPUP",Dn=n("vsh_45832");if("true"==={NODE_ENV:"production",CDN_URL:navigator.cdn_host+"/eesz/bear/sheet/module",FASTER_TEST:void 0}.bear_web_custom_story)_n=function(e,t){return{}},yn={},Cn=function(e){return{}},Sn=function(e){return{}},kn=function(e){return{}},En=function(){return!1},Tn=function(){return!0},bn={},In={},wn=function(e){return""},Rn={},An={};else try{var Nn=n("vsh_22488"),Pn=n("vsh_18801"),On=n("vsh_23585");_n=Nn.grantPermission,yn=Nn.suiteUserManager,Cn=Nn.logNotifyProfileAuthFailed,Sn=Nn.logNotifyAuthOk,kn=Nn.logNotifyAuthCancel,En=Nn.isAnnouncement,Tn=Nn.getShouldBlockMentionUser,bn=Nn.grantPermissionBlockIdMap,In=Nn.notifyBlockIdMap,wn=Nn.getUserShowNameForLang,Rn=Pn.eventEmitter,An=On.AtUserShareConfirm}catch(e){}var Mn,Ln,xn,Vn,Zn=new Set,Bn={1:"READABLE",4:"EDITABLE"},Hn=function(e){function t(e){var n;(0,i.Z)(this,t),(n=(0,Q.Z)(this,(0,ee.Z)(t).call(this,e))).isSelf=!1,n.currentUserId="",n.bindEventState=!1,n.hidePopupTimeoutId=0,n.isHoverPopup=!1,n.blockId="",n.isMentionNotify=!1,n.onHideSharePopup=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!e&&n.isHoverPopup||(mn().unmountComponentAtNode(n.popOverRoot),n.popOverRoot.remove())},n.onConfirmGrantSharePermission=function(){var e=(0,fn.Z)(o().mark((function e(t,r){var i,a,s,l,u,c,h,d,f;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.props.user,a=n.props,s=a.suiteType,l=a.suiteToken,u=a.source,void 0,Zn.add(i.id),e.next=6,_n(Bn[r],{fileType:s,fileToken:l,userId:i.id,source:u,permType:undefined,noToast:!1});case 6:if(c=e.sent,n.onHideSharePopup(!0),h=c.payload||{},!(d=h.block_user_map)||!Object.keys(d).length){e.next=14;break}return Zn.delete(i.id),f=Object.keys(d)[0],Cn({product:u,errCode:f}),e.abrupt("return");case 14:Sn({product:u,send_notification:n.isMentionNotify});case 15:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),n.onCancelSharePermission=function(){var e=n.props.source;n.onHideSharePopup(!0),kn({product:e,send_notification:n.isMentionNotify})},n.onMouseEnter=function(){n.isHoverPopup=!0,window.clearTimeout(n.hidePopupTimeoutId),n.hidePopupTimeoutId=0},n.onMouseLeave=function(){n.isHoverPopup=!1,window.clearTimeout(n.hidePopupTimeoutId),n.hidePopupTimeoutId=window.setTimeout((function(){n.onHideSharePopup()}),1e3)},n.onKeyDown=function(){n.onHideSharePopup(!0)},n.currentUserId=(0,It.ei)();var r=e.user,a=e.blockId,s=e.popOverRoot,l=r?r.id:"";return n.isSelf=n.currentUserId===l,n.blockId=a,n.popupShowLock=n.sharePopup(),n.isMentionNotify=n.mentionNotify(),n.popOverRoot=s,l&&yn.addUser(l),n.state={visible:!1,todoToastVisible:!1,user:r},n}var n;return(0,te.Z)(t,e),(0,a.Z)(t,[{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=this,n=e.suiteShareable;!this.isSelf&&n&&this.popupShowLock&&setTimeout((function(){t.checkShowPermissionPopup()}),200)}},{key:"showPermissionPopup",value:function(){this.popupShowLock&&(this.popupShowLock=!1,this.bindEvents(),this.setState({visible:!0}))}},{key:"checkShowPermissionPopup",value:(n=(0,fn.Z)(o().mark((function e(){var t,n,r,i,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.props,n=t.suiteShareable,r=t.user,!this.isSelf){e.next=3;break}return e.abrupt("return");case 3:if(!En()){e.next=5;break}return e.abrupt("return");case 5:if(!Tn()){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,yn.registerUserPermission(r.id);case 9:i=e.sent,a=i&&i[ln.Readable],n?this.popupShowLock&&!1===a&&this.showPermissionPopup():this.isMentionNotify&&console.log("[Mention] current user not have permission to share");case 12:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"sharePopup",value:function(){var e=bn[this.blockId];return delete bn[this.blockId],e}},{key:"mentionNotify",value:function(){var e=In[this.blockId];return delete In[this.blockId],e}},{key:"componentWillUnmount",value:function(){this.unbindEvents(),this.hidePopupTimeoutId&&window.clearTimeout(this.hidePopupTimeoutId)}},{key:"componentDidMount",value:function(){var e=this;setTimeout((function(){e.checkShowPermissionPopup()}),200)}},{key:"bindEvents",value:function(){var e=this;Rn.on(Fn,this.onHideSharePopup),this.props.editor.on(Dn.r.KEYDOWN,this.onKeyDown),this.bindEventState=!0,this.hidePopupTimeoutId=window.setTimeout((function(){e.onHideSharePopup()}),3e3)}},{key:"unbindEvents",value:function(){this.bindEventState&&(this.bindEventState=!1,Rn.off(Fn,this.onHideSharePopup),this.props.editor.off(Dn.r.KEYDOWN,this.onKeyDown))}},{key:"render",value:function(){var e=this.state,t=e.visible,n=e.todoToastVisible,r=e.user,o=r?wn(r):"",i=r?r.id:"";return pn().createElement(An,{className:"do-not-blur-on-sheet-when-clicked atuser-share-popover",userInfo:{id:String(i),name:o},visible:t,todoToastVisible:n,onConfirm:this.onConfirmGrantSharePermission,onCancel:this.onCancelSharePermission,onPopoverMouseEnter:this.onMouseEnter,onPopoverMouseLeave:this.onMouseLeave},pn().createElement(pn().Fragment,null))}}]),t}(pn().PureComponent);if("true"==={NODE_ENV:"production",CDN_URL:navigator.cdn_host+"/eesz/bear/sheet/module",FASTER_TEST:void 0}.bear_web_custom_story)Mn=function(e){return{}},Ln=function(e,t){return{}},xn=function(e){return{}},Vn=function(e){return{}};else try{var Un=n("vsh_18856");Mn=Un.selectCanInviteCollaborator,Ln=Un.selectDocUserPermission,xn=Un.selectCurrentSuiteToken,Vn=Un.selectCurrentSuiteType}catch(e){}(0,dn.connect)((function(e,t){var n=t.user,r=n?n.id:"";return{suiteShareable:Mn(e),suiteType:Vn(e),suiteToken:xn(e),userPermission:Ln(e,r)}}),{})(Hn);if("true"==={NODE_ENV:"production",CDN_URL:navigator.cdn_host+"/eesz/bear/sheet/module",FASTER_TEST:void 0}.bear_web_custom_story)({});else try{var jn=n("vsh_18801");jn.store}catch(e){}var Gn,Kn={name:"svg",type:"element",value:"",parent:null,attributes:{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",fill:"none",viewBox:"0 0 24 24"},children:[{name:"path",type:"element",value:"",parent:null,attributes:{d:"M4 3h12.595c.93 0 1.806.355 2.439.96.63.604.966 1.403.966 2.217V21H7.405a3.53 3.53 0 0 1-2.439-.96A3.068 3.068 0 0 1 4 17.823V3ZM3 1a1 1 0 0 0-1 1v15.824c0 1.372.57 2.69 1.583 3.66A5.529 5.529 0 0 0 7.405 23H21a1 1 0 0 0 1-1V6.177c0-1.373-.57-2.69-1.583-3.66A5.53 5.53 0 0 0 16.595 1H3Z",fill:Zt},children:[]},{name:"path",type:"element",value:"",parent:null,attributes:{d:"M6.25 8a1 1 0 0 1 1-1h1.5a1 1 0 0 1 0 2h-1.5a1 1 0 0 1-1-1ZM6.25 12a1 1 0 0 1 1-1h1.5a1 1 0 1 1 0 2h-1.5a1 1 0 0 1-1-1ZM6.25 16a1 1 0 0 1 1-1h1.5a1 1 0 1 1 0 2h-1.5a1 1 0 0 1-1-1ZM11.25 8a1 1 0 0 1 1-1h4.5a1 1 0 1 1 0 2h-4.5a1 1 0 0 1-1-1ZM11.25 12a1 1 0 0 1 1-1h4.5a1 1 0 1 1 0 2h-4.5a1 1 0 0 1-1-1ZM11.25 16a1 1 0 0 1 1-1h4.5a1 1 0 1 1 0 2h-4.5a1 1 0 0 1-1-1Z",fill:Zt},children:[]}]},Wn={name:"svg",type:"element",value:"",parent:null,attributes:{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",fill:"none",viewBox:"0 0 24 24"},children:[{name:"path",type:"element",value:"",parent:null,attributes:{d:"M4 3h12.595c.93 0 1.806.355 2.439.96.63.604.966 1.403.966 2.216V21H7.405a3.53 3.53 0 0 1-2.439-.96A3.068 3.068 0 0 1 4 17.823V3ZM3 1a1 1 0 0 0-1 1v15.823c0 1.373.57 2.69 1.583 3.66A5.529 5.529 0 0 0 7.405 23H21a1 1 0 0 0 1-1V6.176c0-1.372-.57-2.69-1.583-3.66A5.53 5.53 0 0 0 16.595 1H3Z",fill:Zt},children:[]},{name:"path",type:"element",value:"",parent:null,attributes:{d:"M6.75 8a1 1 0 0 1 1-1h8.5a1 1 0 1 1 0 2h-8.5a1 1 0 0 1-1-1ZM6.75 12a1 1 0 0 1 1-1h8.5a1 1 0 1 1 0 2h-8.5a1 1 0 0 1-1-1ZM6.75 16a1 1 0 0 1 1-1h4.5a1 1 0 1 1 0 2h-4.5a1 1 0 0 1-1-1Z",fill:Zt},children:[]}]},zn={name:"svg",type:"element",value:"",parent:null,attributes:{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",fill:"none",viewBox:"0 0 24 24"},children:[{name:"path",type:"element",value:"",parent:null,attributes:{d:"M4 3h12.595c.93 0 1.806.355 2.439.96.63.604.966 1.403.966 2.216V21H7.405a3.53 3.53 0 0 1-2.439-.96A3.068 3.068 0 0 1 4 17.823V3ZM3 1a1 1 0 0 0-1 1v15.823c0 1.373.57 2.69 1.583 3.66A5.529 5.529 0 0 0 7.405 23H21a1 1 0 0 0 1-1V6.176c0-1.372-.57-2.69-1.583-3.66A5.53 5.53 0 0 0 16.595 1H3Z",fill:Zt},children:[]},{name:"path",type:"element",value:"",parent:null,attributes:{d:"M6.75 8a1 1 0 0 1 1-1h8.5a1 1 0 1 1 0 2h-8.5a1 1 0 0 1-1-1ZM6.75 12a1 1 0 0 1 1-1h8.5a1 1 0 1 1 0 2h-8.5a1 1 0 0 1-1-1ZM6.75 16a1 1 0 0 1 1-1h4.5a1 1 0 1 1 0 2h-4.5a1 1 0 0 1-1-1Z",fill:Zt},children:[]}]},Yn={name:"svg",type:"element",value:"",parent:null,attributes:{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none"},children:[{name:"path",type:"element",value:"",parent:null,attributes:{d:"M7 12.5a1 1 0 0 1 1-1h8a1 1 0 1 1 0 2H8a1 1 0 0 1-1-1Zm0 5a1 1 0 0 1 1-1h5a1 1 0 1 1 0 2H8a1 1 0 0 1-1-1Z",fill:Zt},children:[]},{name:"path",type:"element",value:"",parent:null,attributes:{d:"M5 1a2 2 0 0 0-2 2v19a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V7.553a2 2 0 0 0-.555-1.383l-4.354-4.552A2 2 0 0 0 14.645 1H5Zm0 21V3h9.5v3.5a1 1 0 0 0 1 1h3.45l.05.053V22H5Z",fill:Zt},children:[]}]},Jn={name:"svg",type:"element",value:"",parent:null,attributes:{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",fill:"none",viewBox:"0 0 24 24"},children:[{name:"path",type:"element",value:"",parent:null,attributes:{d:"M4 3h12.595c.93 0 1.806.355 2.439.96.63.604.966 1.403.966 2.217V21H7.405a3.53 3.53 0 0 1-2.439-.96A3.068 3.068 0 0 1 4 17.823V3ZM3 1a1 1 0 0 0-1 1v15.824c0 1.372.57 2.69 1.583 3.66A5.529 5.529 0 0 0 7.405 23H21a1 1 0 0 0 1-1V6.177c0-1.373-.57-2.69-1.583-3.66A5.53 5.53 0 0 0 16.595 1H3Z",fill:Zt},children:[]},{name:"path",type:"element",value:"",parent:null,attributes:{d:"M12 12a1 1 0 0 1 1-1h3a1 1 0 1 1 0 2h-3a1 1 0 0 1-1-1ZM12.49 15.269a2 2 0 0 1-1.733-1.004l-1.598-2.78a1 1 0 0 0-.867-.5H6.8a1 1 0 1 0 0 2h.913l1.31 2.277a4 4 0 0 0 3.468 2.007h3.764a1 1 0 0 0 0-2h-3.764Z",fill:Zt},children:[]},{name:"path",type:"element",value:"",parent:null,attributes:{d:"M12.49 8.7a2 2 0 0 0-1.733 1.003l-1.598 2.78a1 1 0 0 1-.867.5l-1.492.001a1 1 0 1 1 0-2h.913l1.31-2.278A4 4 0 0 1 12.491 6.7h3.764a1 1 0 1 1 0 2h-3.764Z",fill:Zt},children:[]}]},qn={name:"svg",type:"element",value:"",parent:null,attributes:{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",fill:"none",viewBox:"0 0 24 24"},children:[{name:"path",type:"element",value:"",parent:null,attributes:{d:"M4 3h12.595c.93 0 1.806.355 2.439.96.63.604.966 1.403.966 2.216V21H7.405a3.53 3.53 0 0 1-2.439-.96A3.068 3.068 0 0 1 4 17.823V3ZM3 1a1 1 0 0 0-1 1v15.823c0 1.373.57 2.69 1.583 3.66A5.529 5.529 0 0 0 7.405 23H21a1 1 0 0 0 1-1V6.176c0-1.372-.57-2.69-1.583-3.66A5.53 5.53 0 0 0 16.595 1H3Z",fill:Zt},children:[]},{name:"path",type:"element",value:"",parent:null,attributes:{d:"M6.5 6.5h9.3a1.7 1.7 0 0 1 1.7 1.7v9.3H8.2a1.7 1.7 0 0 1-1.7-1.7V6.5Zm2 2v7h7v-7h-7Z",fill:Zt},children:[]},{name:"path",type:"element",value:"",parent:null,attributes:{d:"M12.9 11.1V8h-1.8v3.1H8v1.8h3.1V16h1.8v-3.1H16v-1.8h-3.1Z",fill:Zt},children:[]}]},$n={name:"svg",type:"element",value:"",parent:null,attributes:{xmlns:"http://www.w3.org/2000/svg",width:"15",height:"14",viewBox:"0 0 15 14",fill:"none"},children:[{name:"path",type:"element",value:"",parent:null,attributes:{d:"M12.078 1.467a3.23 3.23 0 0 0-2.23-.884h-7.93a.583.583 0 0 0-.585.584v9.231c0 .801.333 1.569.923 2.135a3.229 3.229 0 0 0 2.23.884h7.93c.324 0 .585-.261.585-.584V3.602c0-.801-.333-1.569-.923-2.135Zm-.243 10.784H4.487a2.054 2.054 0 0 1-1.422-.561 1.794 1.794 0 0 1-.564-1.293V1.749h7.348c.543 0 1.053.207 1.422.561.366.352.564.819.564 1.293v8.648Z",fill:Zt},children:[]},{name:"path",type:"element",value:"",parent:null,attributes:{d:"M3.797 7.352c.168 1.703 1.841 3.115 3.55 3.032 2.128-.103 3.278-2.032 3.216-3.464a.267.267 0 0 0-.27-.246H7.431V3.882a.271.271 0 0 0-.258-.272c-1.846-.025-3.589 1.593-3.377 3.74v.002ZM6.581 9.17a2.22 2.22 0 0 1-1.579-1.563A2.246 2.246 0 0 1 6.356 4.91v2.572c0 .148.12.269.269.269h2.65A2.245 2.245 0 0 1 6.58 9.17Z",fill:Zt},children:[]},{name:"path",type:"element",value:"",parent:null,attributes:{d:"M10.553 5.554c-.27-.9-1.003-1.642-1.98-1.933a.281.281 0 0 0-.366.266V5.92h2.079c.189 0 .32-.184.267-.365Z",fill:Zt},children:[]}]},Xn={name:"svg",type:"element",value:"",parent:null,attributes:{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none"},children:[{name:"path",type:"element",value:"",parent:null,attributes:{d:"M13.728 18.56h1.914c.376 0 .736-.146 1.002-.406l5.601-5.48a2.357 2.357 0 0 0 0-3.379 2.472 2.472 0 0 0-3.447 0l-5.6 5.48c-.265.26-.415.614-.415.982v1.877c0 .512.423.926.945.926Zm-4.612-.35c.043.471-.094.959-.27 1.4a3.27 3.27 0 0 0-.026.068c.196-.028.438-.082.715-.165a9.1 9.1 0 0 0 1.183-.456 1.184 1.184 0 0 1 1.565.544 1.14 1.14 0 0 1-.555 1.534c-.808.377-2.13.875-3.21.865-.53-.005-1.393-.142-1.87-.93-.316-.522-.318-1.105-.194-1.649-1.014.504-2.183 1.31-2.549 1.586a1.19 1.19 0 0 1-1.646-.209 1.136 1.136 0 0 1 .214-1.613c.455-.344 1.986-1.407 3.294-1.994.332-.149.69-.286 1.04-.367.31-.073.8-.147 1.285.03a1.55 1.55 0 0 1 1.024 1.356ZM2 5.513a3.374 3.374 0 0 1 3.374-3.375h14.087a3.374 3.374 0 0 1 3.374 3.375v.294a1 1 0 1 1-2 0v-.294c0-.76-.615-1.375-1.374-1.375H5.374C4.615 4.138 4 4.754 4 5.513V15.5a1 1 0 1 1-2 0V5.513Z",fill:Zt},children:[]}]},Qn={name:"svg",type:"element",value:"",parent:null,attributes:{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",fill:"none",viewBox:"0 0 24 24"},children:[{name:"path",type:"element",value:"",parent:null,attributes:{d:"M4 3h12.595c.93 0 1.806.355 2.439.96.63.604.966 1.403.966 2.216V21H7.405a3.53 3.53 0 0 1-2.439-.96A3.068 3.068 0 0 1 4 17.823V3ZM3 1a1 1 0 0 0-1 1v15.823c0 1.373.57 2.69 1.583 3.66A5.529 5.529 0 0 0 7.405 23H21a1 1 0 0 0 1-1V6.176c0-1.372-.57-2.69-1.583-3.66A5.53 5.53 0 0 0 16.595 1H3Z",fill:Zt},children:[]},{name:"path",type:"element",value:"",parent:null,attributes:{d:"M6.75 8a1 1 0 0 1 1-1h8.5a1 1 0 1 1 0 2h-8.5a1 1 0 0 1-1-1ZM6.75 12a1 1 0 0 1 1-1h8.5a1 1 0 1 1 0 2h-8.5a1 1 0 0 1-1-1ZM6.75 16a1 1 0 0 1 1-1h4.5a1 1 0 1 1 0 2h-4.5a1 1 0 0 1-1-1Z",fill:Zt},children:[]}]},er=(Gn={},(0,u.Z)(Gn,G.wy.BITABLE,{at:Vt(Kn)}),(0,u.Z)(Gn,G.wy.DOC,{at:Vt(Wn)}),(0,u.Z)(Gn,G.wy.DOCX,{at:Vt(zn)}),(0,u.Z)(Gn,G.wy.FOLDER,{at:Vt(zn)}),(0,u.Z)(Gn,G.wy.BOX,{at:Vt(Yn)}),(0,u.Z)(Gn,G.wy.MINDNOTE,{at:Vt(Jn)}),(0,u.Z)(Gn,G.wy.SHEET,{at:Vt(qn)}),(0,u.Z)(Gn,G.wy.SLIDES,{at:Vt($n)}),(0,u.Z)(Gn,G.wy.WHITE_BOARD,{at:Vt(Xn)}),(0,u.Z)(Gn,G.wy.WIKI,{at:Vt(Qn)}),Gn),tr=n("vsh_78331"),nr=n("vsh_5153"),rr=function(e){var t,n=e.url,r=e.onError;if(null===(t=C().isH5)||void 0===t||t)return(0,l.az)(Dt.Eep,{fit:"fill",src:n,width:"100%",height:"100%",imgStyle:{baselineOffset:"-0.14em"},onError:r});var o=C().isIPad?"-0.20em":"-0.14em";return(0,l.az)(Dt.Eep,{fit:"fill",src:n,wrapperStyle:{width:"1em",height:"1em",verticalAlign:o},onError:r})};rr._displayName="CustomIcon";var or,ir,ar,sr,lr,ur,cr=rr;function hr(){return hr=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},hr.apply(this,arguments)}if("true"==={NODE_ENV:"production",CDN_URL:navigator.cdn_host+"/eesz/bear/sheet/module",FASTER_TEST:void 0}.bear_web_custom_story)or={},ir=function(e,t){return{}},ar=function(){return!1},sr={},lr={},ur={};else try{var dr=n("vsh_12484"),fr=n("vsh_18856"),vr=n("vsh_22488"),pr=n("vsh_18801");ur=dr.atuserPermissions,ir=fr.selectDocUserPermission,ar=vr.getIsAnonymousAccess,or=vr.suiteUserManager,sr=pr.eventEmitter,lr=pr.store}catch(e){}var gr=function(e){function t(){var e;return(0,i.Z)(this,t),(e=(0,Q.Z)(this,(0,ee.Z)(t).apply(this,arguments))).state={allowCustomImg:!0,userPermission:ir(lr.getState(),e.props.data.token)},e.handleUserPermissionChange=function(){e.setState({userPermission:ir(lr.getState(),e.props.data.token)})},e.handleImgErr=function(){e.setState({allowCustomImg:!1})},e}return(0,te.Z)(t,e),(0,a.Z)(t,[{key:"componentDidMount",value:function(){this.props.data.type===G.wy.USER&&(sr.on("userPermissionChange",this.handleUserPermissionChange),or.addUser(this.props.data.token,[ur.Perceive]))}},{key:"componentWillUnmount",value:function(){this.props.data.type===G.wy.USER&&(sr.off("userPermissionChange",this.handleUserPermissionChange),or.removeUser(this.props.data.token))}},{key:"render",value:function(){var e=this.props.data;return this.renderMentionBlock(e)}},{key:"renderMentionBlock",value:function(e){var t=this.props,n=t.onMouseEnter,r=t.onMouseLeave,o=t.onClick;if(e.type===G.wy.USER){var i=this.state.userPermission,a=!1===(i&&i.readable),s=ar(),u=!(!s&&a),c=e.token===(0,It.ei)()&&!s,h=function(e){var t=e.isAtSelf,n=e.isWithPermission,r=e.editorSource,o={paddingTop:.5,paddingBottom:.5,cursor:"pointer"};if("formula_bar"===r&&t)Object.assign(o,{backgroundColor:"--function-info-fill-default",marginLeft:2,marginRight:2,$hover:{backgroundColor:"--B400-BG"}});else{var i={fontColor:n?"--B500":"--text-caption",$hover:{backgroundColor:"--B100"}};Object.assign(o,i,n?{}:{fontWeight:"500"})}return{name:e.title,type:"formula_bar"===r&&t?"self":n?"readable":"unreadable",wrapperStyle:o,disableHover:"formula_bar"!==r&&t}}(Object.assign(e,{isWithPermission:u,isAtSelf:c}));return(0,l.az)(l.ZC,null,(0,l.az)(tr.H,hr({},h,{onMouseEnter:n,onMouseLeave:r,onClick:o,on:{touchend:function(e){_.Ps3.browser.isIPad&&e.nativeEvent.stopImmediatePropagation()}}})))}var d=function(e,t){var n,r,o=e.title,i=e.url,a=e.type,s=e.iconInfo,u=_.Ps3.getMentionIconSource({mentionType:a,iconInfo:s}).resource;return{title:o,type:"readable",icon:t.allowCustomImg&&_.Ps3.getIsSheetCustomIconEnabled()?(0,l.az)(cr,{url:u,onError:t.onError}):(null===(n=er[a])||void 0===n?void 0:n.at)?(0,Dt.Wb1)({src:null===(r=er[a])||void 0===r?void 0:r.at}):void 0,url:i,wrapperStyle:{marginLeft:"2px",fontColor:"--B500",$hover:{backgroundColor:"--B100"}}}}(e,{allowCustomImg:this.state.allowCustomImg,onError:this.handleImgErr});return(0,l.az)(nr.u,hr({},d,{onMouseEnter:n,onMouseLeave:r,onClick:o}))}}]),t}(l.wA),mr=n("vsh_90827"),_r="user",yr="AT_USER_BLOCK",Cr="mentionBlock",Sr="data-inline-type",kr="dataMetaBlockProps",Er="inline";var Tr,br=n("vsh_98986"),Ir=n("vsh_90468");if("true"==={NODE_ENV:"production",CDN_URL:navigator.cdn_host+"/eesz/bear/sheet/module",FASTER_TEST:void 0}.bear_web_custom_story)Tr=function(){return{}};else try{var Rr=n("vsh_22488");Tr=Rr.locateRoute}catch(e){Tr=function(){return{isWikiIndex:!1}}}function wr(e){return e===G.wy.USER}var Ar,Fr,Dr,Nr,Pr,Or,Mr,Lr,xr,Vr=function(e){if(!Ar){var t=G.wy.FILE,n=G.wy.SHEET,r=G.wy.BITABLE,o=G.wy.MINDNOTE,i=G.wy.BOX,a=G.wy.SLIDES,s=G.wy.SLIDE,l=G.wy.WIKI,u=G.wy.DOCX,c=G.wy.WHITE_BOARD;Ar=new Set([t,n,r,o,i,a,s,l,u,c])}return Ar.has(e)};function Zr(e){var t=e.left,n=e.top,r=e.bottom,o={left:t,height:e.height};return void 0!==r?o.bottom=r:o.top=n,o}function Br(e,t){return Tr(new URL(t).pathname).isWikiIndex?G.wy.WIKI:e}if("true"==={NODE_ENV:"production",CDN_URL:navigator.cdn_host+"/eesz/bear/sheet/module",FASTER_TEST:void 0}.bear_web_custom_story)Fr=function(){return!0},Mr=function(e){return!1},Lr=function(){return!1},Dr={},Nr={},Pr=Promise.resolve(),Or=function(e,t){return{left:0,top:0,width:0,height:0}};else try{var Hr=n("vsh_22488"),Ur=n("vsh_23585"),jr=n("vsh_18801");Fr=Hr.getEmbedObjShareEnable,Mr=Hr.shouldItemUseFileSecureMode,Lr=Hr.getIsAnonymousAccess,xr=Hr.isWikiToken,Dr=Ur.MentionPopOverShortCut,Nr=Ur.MentionPopOverUser,Pr=jr.importMentionPopover,Or=jr.getPositionByRect}catch(e){}var Gr,Kr,Wr,zr,Yr,Jr,qr,$r,Xr,Qr,eo,to,no,ro="sheet-mention-popover",oo=function(){function e(t){var n=this;(0,i.Z)(this,e),this.props=t,this.popOver=null,this.cursorInPopover=!1,this.bindEvents=function(){n.props.editor.on(Dn.r.KEYDOWN,n.closePopOver),n.removeMousedownOutsideEvent=(0,Ir.oy)(null,(function(){n.closePopOver()}),[ro],document.body),_.Ps3.browser.isIPad&&(n.removeTouchStartOutsideEvent=(0,Ir.SX)(null,(function(){n.closePopOver()}),[ro],document.body))},this.unbindEvents=function(){n.props.editor.off(Dn.r.KEYDOWN,n.closePopOver),n.removeMousedownOutsideEvent&&n.removeMousedownOutsideEvent(),n.removeTouchStartOutsideEvent&&n.removeTouchStartOutsideEvent()},this.handleMentionEnter=function(e,t){wr(e.type)||Vr(e.type)&&n.handleDocMentionEnter(e,t)},this.handleDocMentionEnter=function(e,t){var r=e.type;n.canShowPopover()&&Vr(r)&&(n.clearShowPopOverTimer(),n.clearHidePopoverTimer(),n.showPopOverTimer=window.setTimeout((function(){n.showDocShortcut(e,t)}),200))},this.showDocShortcut=function(){var e=(0,fn.Z)(o().mark((function e(t,r){var i,a,s,l,u,c,h,d,f,v,p,g,m,_;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=n.props.container,a=t.token,s=t.title,l=t.url,u=t.type,c=G.wy.FILE,h=G.wy.DOCX,d=xr(a)?Br(u,decodeURIComponent(l)):u,Vr(d)&&!Mr(d)){e.next=6;break}return e.abrupt("return");case 6:return v=d===h,p="doc shortcut ".concat((f=d===c)?" docs":" sheet"," ").concat(ro),378,378,g=Or(r,{horizontalAlign:"center",boxWidth:f||v?344:348,boxMaxHeight:378,boxMinHeight:378,gap:8,$boxContainer:$(".".concat(i.className)),biggerSpaceIfBothOverflow:!0,coverNavBar:!1,lineHeight:18,getFallbackBoxContainer:function(){return"body"}}),m=Zr(g),e.next=16,Pr();case 16:_=e.sent,n.closePopOver(),n.clearHidePopoverTimer(),n.popOver=new _({className:p,style:m,container:i,handlePopOverEnter:n.handlePopOverEnter,handlePopOverLeave:n.handlePopOverLeave,component:pn().createElement(Dr,Object.assign({},{token:a,type:d,sourceString:"sheet",title:s,link:l,embedObjShareEnable:Fr()},{closePopover:n.closePopOver}))}),n.popOver.trigger="hover";case 21:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),this.handleMentionClick=function(e,t){var r=e.url,o=e.type;Vr(o)?n.handleDocMentionClicked(r):wr(o)&&n.handleUserMentionClicked(e,t)},this.destroy=function(){n.unbindEvents()},this.handleMentionLeave=function(){n.clearShowPopOverTimer(),n.popOver&&"click"!==n.popOver.trigger&&!n.cursorInPopover&&n.delayClosePopover()},this.delayClosePopover=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;n.clearHidePopoverTimer(),n.hidePopoverTimer=window.setTimeout((function(){n.closePopOver()}),e)},this.closePopOver=function(){n.popOver&&(n.popOver.close(),n.popOver=null)},this.handlePopOverEnter=function(){n.cursorInPopover=!0,n.clearHidePopoverTimer()},this.handlePopOverLeave=function(){n.cursorInPopover=!1,n.delayClosePopover(100)},this.bindEvents()}var t,n;return(0,a.Z)(e,[{key:"canShowPopover",value:function(){var e=this.props.isOnline;return(void 0===e?function(){return!0}:e)()&&!Lr()}},{key:"handleDocMentionClicked",value:function(e){window.open((0,Y.completeURLProtocol)(e),"_blank","noopener,noreferrer")}},{key:"handleUserMentionClicked",value:(n=(0,fn.Z)(o().mark((function e(t,n){var r,i=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.type,this.canShowPopover()&&wr(r)){e.next=3;break}return e.abrupt("return");case 3:this.clearShowPopOverTimer(),this.clearHidePopoverTimer(),this.showPopOverTimer=window.setTimeout((function(){i.showUserProfile(t,n)}),200);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"showUserProfile",value:(t=(0,fn.Z)(o().mark((function e(t,n){var r,i,a,s,l,u,c,h,d,f;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.token,i=t.title,a=t.is_external,s=G.HL,l=G.E5,u=l,c="doc mention-profile ".concat(ro),h=Or(n,{horizontalAlign:"left",boxWidth:s,boxMaxHeight:u,boxMinHeight:l,gap:10,$boxContainer:$("body"),biggerSpaceIfBothOverflow:!0,coverNavBar:!0,lineHeight:18,getFallbackBoxContainer:function(){return"body"},flatDom:!0,closeContainerBottom:!0}),d=Zr(h),window.innerHeight-n.top<G.E5&&(d.bottom=0),e.next=10,Pr();case 10:f=e.sent,this.closePopOver(),this.clearHidePopoverTimer(),this.popOver=new f({className:c,style:d,container:document.body,component:pn().createElement(Nr,Object.assign({closePopover:this.closePopOver,isExternal:a},{token:r,sourceString:"sheet",source:2,name:i||""},{editor:this.props.editor}))}),this.popOver.trigger="click";case 15:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"clearShowPopOverTimer",value:function(){null!==this.showPopOverTimer&&(clearTimeout(this.showPopOverTimer),this.showPopOverTimer=null)}},{key:"clearHidePopoverTimer",value:function(){null!==this.hidePopoverTimer&&(clearTimeout(this.hidePopoverTimer),this.hidePopoverTimer=null)}}]),e}(),io=function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":(0,M.Z)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},ao=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function s(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))},so=function(){return!0};try{var lo=n("vsh_22488");so=lo.isOnline;var uo=n("vsh_96579"),co=n("vsh_18801");no=n("vsh_63886").loadBizMention,Gr=lo.initLarkServices,Kr=lo.getLocale,Wr=lo.suiteType,Jr=lo.getCurrentMentionType,qr=lo.getMentionRecommendSource,Xr=lo.isUnderWikiUrl,Qr=lo.getIsAnonymousAccess,eo=lo.getCommentCopyLinkEnableV2,Yr=uo.LogFlow,zr=co.store,$r=co.eventEmitter,to=co.parseAnchorUrl}catch(e){}var ho=function(e){function t(e){var n;return(0,i.Z)(this,t),(n=(0,Q.Z)(this,(0,ee.Z)(t).call(this,e))).props=e,n.defaultNeedNotification=!1,n.handleClick=function(e,t,r){var o,i,a,s=decodeURIComponent(t.url);if(eo()){var l=to(s),u=l.isCommentAnchor,c=l.commentId,h=zr.getState(),d=null!==(a=null===(i=null===(o=null==h?void 0:h.sheet)||void 0===o?void 0:o.history)||void 0===i?void 0:i.visible)&&void 0!==a&&a;if(u&&!d&&c&&(0,Y.isSameFileToken)(window.location.href,s,"sheet"))return e.stopPropagation(),void $r.emit("commentAnchorJumpToActiveComment",{commentId:c})}var f=r.zoneId,v=r.attributes,p=n.calcMentionRectToViewport(f,v);if(p){var g=t.title,m=t.token,_=t.type,y=t.is_external;n.popover.handleMentionClick({token:m,title:g,type:_,url:s,is_external:y},p)}},n.handleMouseEnter=function(e,t,r){var o=n.calcMentionRectToViewport(e,t);if(o){var i=r.title,a=r.type,s=r.token,l=r.url,u=r.is_external,c=r.mentionId;n.popover.handleMentionEnter({token:s,title:i,type:a,url:l,is_external:u,mentionId:c},o)}},n.handleMouseLeave=function(){n.popover.handleMentionLeave()},n.destroy=function(){n.mentionHelper&&n.mentionHelper.destory(),(0,cn.Z)(((0,un.Z)(n),(0,ee.Z)(t.prototype)),"destroy",(0,un.Z)(n)).call((0,un.Z)(n)),n.unsubscribeUIState(),n.popover.destroy(),window.removeEventListener("click",n.onWindowClick)},n.container=e.container,n.init(),n}return(0,te.Z)(t,e),(0,a.Z)(t,[{key:"init",value:function(){return ao(this,void 0,void 0,o().mark((function e(){var t,n,r,i=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,no();case 2:t=e.sent,n=t.MentionHelper,r=t.TabKey,this.mentionHelper=new n(this.container,{className:br.wP,token:this.props.token,suiteType:this.props.suiteType,source:this.props.source,tabs:[r.ALL,r.USER,r.DOCS],onSelect:this.handleSelect.bind(this),onClose:this.mentionSuggest.closeSuggest.bind(this.mentionSuggest),focusOnOuter:function(){var e=i.props.editor;e.once("paint",(function(){e.focus()}))},initLarkService:Gr,defaultNeedNotification:this.defaultNeedNotification},{local:Kr(),panelZIndex:999,renderLevel:"container",viewPortContainer:Xr()?".wiki-space-main-content":".app-main-container",theme:(0,le.getCurrentThemeType)()}),this.popover=new oo({container:this.container,editor:this.props.editor,isOnline:so}),window.addEventListener("click",this.onWindowClick),this.unsubscribeUIState=(0,le.onUIStateChange)((function(e){var t,n,r=e.mode;null===(n=null===(t=i.mentionHelper)||void 0===t?void 0:t.changeTheme)||void 0===n||n.call(t,r)}));case 9:case"end":return e.stop()}}),e,this)})))}},{key:"closeSuggest",value:function(){var e,t;(null===(e=this.mentionHelper)||void 0===e?void 0:e.isShow())&&(null===(t=this.mentionHelper)||void 0===t||t.dismiss())}},{key:"renderAt",value:function(e,t,n,r){var o=this,i=n.iconInfo||t["mention-icon-info"];return(0,l.az)(gr,{data:Object.assign(Object.assign({},n),{iconInfo:i,editorSource:this.props.editorSource}),onMouseEnter:function(){return o.handleMouseEnter(e,t,Object.assign(Object.assign({},n),{is_external:r.is_external,mentionId:r.mentionId}))},onMouseLeave:this.handleMouseLeave,onClick:function(i){return o.handleClick(i,Object.assign(Object.assign({},n),{is_external:r.is_external}),{zoneId:e,attributes:t})}})}},{key:"calcMentionRectToViewport",value:function(e,t){var n=this.props.editor,r=n.rectModule,o=n.getContentState().getZoneState(e);if(!o||!r)return null;var i=t.mention?o.getEntities([["mention",t.mention]]).find((function(e){return(0,ne.default)(e.attributes,t)})):o.getEntities([[kr,t.dataMetaBlockProps]])[0];if(!i)return null;var a=i.start,s=i.end,l=r.getRangeRect({start:a,end:s});return this.mentionSuggest.relativeRectToScreen(l)}},{key:"handleSelect",value:function(e,t){var n,r;if(e.type===_r){var o=e.entity,i=o.avatarUrl,a=o.id,s=o.name,l=o.isCrossTenant,u=o.i18nNames||{},c=u.zh_cn;n={type:0,avatar_url:i,cn_name:c||s,en_name:u.en_us||s,id:a,is_external:l,name:c||s,not_notify:!1,mentionNotify:t,mentionId:(0,It.Es)()},r=" "}else{var h=e.entity,d=h.url,f=void 0===d?"":d,v=h.id,p=h.name;n={type:h.type,url:f,link:f,token:v,title:p,iconInfo:h.iconInfo},r=p}this.mentionSuggest.handleConfirm(n,r)}},{key:"applyMention",value:function(e,n){var r;(0,cn.Z)((0,ee.Z)(t.prototype),"applyMention",this).call(this,e,n);var o,i,a=e.blockType,s=e.props,l="",u=!1;a===yr?(o=0,i=s.data.user.id,u=null===(r=s.data)||void 0===r?void 0:r.mentionNotify):(o=s.type,i=s.token,l=s.uuid);this.report(o,i,l,u)}},{key:"report",value:function(e,t,n,r){var o=this.props.editor,i="";switch(e){case G.JC.FILE:i="doc";break;case G.JC.SHEET:i="sheet";break;case G.JC.BITABLE:i="bitable";break;case G.JC.MINDNOTE:i="mindnote";break;case G.JC.BOX:i="file";break;case G.JC.SLIDE:i="slide";break;case G.JC.SLIDES:i="slides";break;case G.JC.JIRA_FILTER:i="jira_filter";break;case G.JC.WIKI:i="wiki";break;case G.JC.WHITE_BOARD:i="white_board"}Yr("confirm_mention").report({source:Wr(),event_type:"keydown",mention_type:Jr(e),mention_sub_type:i,panel_source:"mention_panel",mention_obj_id:(0,Y.encryptTea)(t),mention_notification_status:r?r.toString():"false",zone:(0,It.nA)(o),uuid:n,recommend_source:qr(e===G.JC.USER?1:void 0),line_is_empty:(0,It.ll)(o).toString(),link_file_source:i&&("wiki"===i?"wiki":"space")})}},{key:"onWindowClick",value:function(){$r.trigger(Fn)}},{key:"canMention",value:function(){var e;if(null==Qr?void 0:Qr())return!1;var t=this.props.editor,n=t.selection.getSelection().start,r=n.offset,o=n.line,i=null===(e=t.getContentState().getActiveZone().getLine(o))||void 0===e?void 0:e.getModelText();if(function(e){var t,n=e.selection.getSelection().start,r=n.offset,o=n.line,i=r-2,a=((null===(t=e.getContentState().getActiveZone().getLine(o))||void 0===t?void 0:t.getEntities({start:i,end:i}))||[])[0];return!(!a||!a.attributes)&&Object.keys(a.attributes).some((function(e){return e.includes("mention")}))}(t))return!0;var a=(null==i?void 0:i[r-2])||"";return!/[\d\w]/.test(a)}},{key:"serialize",value:function(e){var t,n,r,o=e.type,i=e.op,a=e.node,s=null===(t=null==i?void 0:i.attributes)||void 0===t?void 0:t.dataMetaBlockProps;if(o===b.T.LEAF&&s){var l=(0,It.CX)(s);if((null==l?void 0:l.blockType)===yr){var u=document.createElement("span"),c=(0,It.e$)(l,"");u.innerHTML=c;var h=u.firstChild;null===(n=h)||void 0===n||n.classList.add("block-old-uuid-".concat(l.blockId));var d=null==h?void 0:h.firstChild,f=null==d?void 0:d.classList;f.add(_.U1p),f.add("block-id-".concat(l.blockId)),f.add("block-type-".concat(l.blockType));var v=document.createTextNode("@".concat(l.props.data.user.name)),p=document.createElement("span");p.className="ignore-collect",p.appendChild(v),null==h||h.appendChild(p),null==d||d.setAttribute(Sr,_r),e.node=h}}else{var g=(0,It.M9)(null==i?void 0:i.attributes);if(o===b.T.LEAF&&g["mention-link"]){var m=decodeURIComponent(g["mention-link"]),y=g["mention-type"],C=document.createElement("span");if(C.classList.add("mention"),(null==i?void 0:i.attributes)&&Object.keys(i.attributes).forEach((function(e){return e.includes("mention")&&C.classList.add(e)})),(0,_.epN)(y)){C.setAttribute(Sr,"mention_doc");var S=null===(r=null==i?void 0:i.attributes)||void 0===r?void 0:r["mention-icon-info"],k=(0,It.Jc)(S);(null==k?void 0:k.key)&&(C.classList.add("mention-custom-icon-key_".concat(k.key)),C.classList.add("mention-custom-icon-type_".concat(k.type)),C.classList.add("mention-custom-icon-info_".concat(encodeURIComponent(S))))}var E=document.createElement("a");E.setAttribute("rel","noopener noreferrer"),E.setAttribute("href",m),E.dataset.href=m,E.href=m,E.appendChild(a),C.appendChild(E),e.node=C}}return e}},{key:"deserialize",value:function(e){var t,n=e.node,r=e.deltaSet,o=e.zoneId;if(n instanceof HTMLElement)if(n.dataset.metaBlockProps)for(var i=0,a=Array.from(n.attributes);i<a.length;i++){var s=a[i];if(/^data-meta/.test(s.nodeName)&&s.nodeValue&&"data-meta-block-props"===s.nodeName){var l=new d.I({zoneId:o}).insert(" ",{dataMetaBlockProps:s.nodeValue});r.replace(o,l)}}else if(n.dataset.sheetMention)for(var u=0,c=Array.from(n.attributes);u<c.length;u++){var h=c[u];if("data-sheet-mention"===h.nodeName&&h.nodeValue){var f=(0,It.Jc)(h.nodeValue);if((0,It.ze)(f)){var v=this.generateData({id:f.token,cn_name:f.name,en_name:f.en_name,avatar_url:f.link,type:_.UkI.USER,isReply:!1});if(v){var p=new d.I({zoneId:o}).insert(" ",{dataMetaBlockProps:JSON.stringify(v)});r.replace(o,p)}}}}else if(n.dataset.larkAtuser)for(var g=0,m=Array.from(n.attributes);g<m.length;g++){var y=m[g];if("data-lark-atuser"===y.nodeName&&y.nodeValue){var C=(0,It.Jc)(y.nodeValue);if((0,It.zE)(C)){var S=this.generateData({id:C.userid,cn_name:C.username||C.cn_name,en_name:C.en_name||"",avatar_url:C.avatar_url||"",type:_.UkI.USER,isReply:!1});if(S){var k=new d.I({zoneId:o}).insert(" ",{dataMetaBlockProps:JSON.stringify(S)});r.replace(o,k)}}}}else if(n.className.startsWith("mention")&&"mention"!==n.className){var E={};(0,ae.Z)(n.classList).forEach((function(e){e.startsWith("mention_uuid")?E[e]=0:E[e]="true"}));var T=new d.I({zoneId:o}).insert(null!==(t=n.textContent)&&void 0!==t?t:"",Object.assign({},E));r.replace(o,T)}return r}},{key:"updateUUID",value:function(e){var t=this;e.forEach((function(e){e.forEach((function(e){var n,r,o,i;if(" "===e.insert&&(null===(n=e.attributes)||void 0===n?void 0:n[t.getAttributesKey()])){var a=t.formatAttributesFromEditor(e.attributes,e.insert);if(a&&a.blockType===yr){var s=(0,It.Es)();a.blockId=s,(null===(o=null===(r=a.props)||void 0===r?void 0:r.data)||void 0===o?void 0:o.user)&&(a.props.data.user.mentionId=s),a.props&&(a.props.fromCopy=!0),e.attributes=Object.assign(Object.assign({},e.attributes),t.formatAttributesToEditor(a))}}else if("true"===(null===(i=e.attributes)||void 0===i?void 0:i.mention)){var l,c=(0,It.Wb)();e.attributes=Object.assign(Object.assign({},e.attributes),(l={},(0,u.Z)(l,"mention-tempId_".concat(c),"true"),(0,u.Z)(l,"mention-uuid_".concat(c),"0"),l))}}))}))}},{key:"editorWillPaste",value:function(e){this.updateUUID(e.deltaSet)}}]),t}(hn.p);ho=io([function(e){var t=function(e){function t(){return(0,i.Z)(this,t),(0,Q.Z)(this,(0,ee.Z)(t).apply(this,arguments))}return(0,te.Z)(t,e),(0,a.Z)(t,[{key:"match",value:function(e,t){if(e===this.getAttributesKey())try{var n=JSON.parse(t);return n.blockType===yr||n.blockType===Cr}catch(e){console.error("mention parse dataMetaBlockProps error.",e)}return!!e.match(/^mention.*/)}},{key:"getAttributesKey",value:function(){return kr}},{key:"formatAttributesFromEditor",value:function(e,t){var n=null==e?void 0:e[this.getAttributesKey()];if(!n){var r,o,i,a,s=e["mention-icon-info"],l="mention-uuid_",u=t;for(var c in e)c.startsWith("mention-type_")?r=Number(c.slice(13)):c.startsWith("mention-link_")?o=c.slice(13):c.startsWith("mention-token_")?i=c.slice(14):c.startsWith(l)&&(a=c.slice(l.length));var h={blockType:Cr,props:{link:encodeURIComponent(decodeURIComponent(o)),type:r,title:u,token:i,iconInfo:s}},d=(0,mr._s)(h);return a&&(d.blockId=a),d}try{return JSON.parse(n)}catch(e){throw console.error("mention parse dataMetaBlockProps error.",e),e}}},{key:"formatAttributesToEditor",value:function(e){if(e.blockType===yr){var t=this.getAttributesKey();return(0,u.Z)({},t,JSON.stringify(e))}var n,r=e.props,o=r.link,i=r.type,a=r.token,s=r.uuid,l=r.iconInfo;return n={mention:"true"},(0,u.Z)(n,"at-holder","0"),(0,u.Z)(n,"mention-tempId_".concat(s),"true"),(0,u.Z)(n,"mention-link_".concat(o),"true"),(0,u.Z)(n,"mention-type_".concat(i),"true"),(0,u.Z)(n,"mention-token_".concat(a),"true"),(0,u.Z)(n,"mention-uuid_".concat(s),"0"),(0,u.Z)(n,"mention-icon-info",l),n}},{key:"generateData",value:function(e){var t;if(e.type===G.wy.USER){var n=e.type,r=e.id,o=e.name,i=e.cn_name,a=e.en_name,s=e.avatar_url,l=e.is_external,u=e.not_notify,c=e.mentionNotify,h=e.mentionId;t={blockType:yr,props:{data:{mentionNotify:c,user:{avatar_url:encodeURIComponent(decodeURIComponent(s)),type:n,id:r,name:o,cn_name:i,en_name:a,is_external:l,not_notify:u,mentionId:h}},displayMode:Er}}}else{var d=e.link,f=void 0===d?"":d,v=e.type,p=e.title,g=e.token,m=e.url,_=void 0===m?"":m,y=e.iconInfo,C=encodeURIComponent(decodeURIComponent(f))||encodeURIComponent(decodeURIComponent(_)),S=(0,It.Wb)();t={blockType:Cr,props:{link:C,type:v,title:p,token:g,uuid:S,displayMode:Er,iconInfo:y}}}return(0,mr._s)(t)}}]),t}(e);return function(e){function t(){return(0,i.Z)(this,t),(0,Q.Z)(this,(0,ee.Z)(t).apply(this,arguments))}return(0,te.Z)(t,e),t}(t)}],ho);var fo,vo,po=function(e){function t(){return(0,i.Z)(this,t),(0,Q.Z)(this,(0,ee.Z)(t).apply(this,arguments))}return(0,te.Z)(t,e),(0,a.Z)(t,[{key:"closeSuggest",value:function(){(0,cn.Z)((0,ee.Z)(t.prototype),"closeSuggest",this).call(this),this.props.mentionPlugin.closeSuggest()}}]),t}(n("vsh_25934").n),go=n("vsh_15657"),mo=function(e){var t;return e&&Array.isArray(e)&&e.length&&(null===(t=e[0])||void 0===t?void 0:t.type)!==_.K6s.EMBED_IMAGE},_o=function(){function e(t){var n=t.formatterService;(0,i.Z)(this,e),this.name=S.p.SheetValueHandler,this.formatterService=n}return(0,a.Z)(e,[{key:"deserialize",value:function(e){var t=this,n=e.node,r=e.deltaSet,o=e.zoneId;if(n instanceof HTMLElement&&n.dataset.sheetValue)for(var i=0,a=Array.from(n.attributes);i<a.length;i++){var s=a[i];if("data-sheet-value"===s.nodeName&&s.nodeValue){var l=(0,It.Jc)(s.nodeValue);if(mo(l)){l.forEach((function(e){!(null==e?void 0:e.style)||e.style instanceof A.bgS||(e.style=A.bgS.fromJSON(t.formatterService,e.style)),(null==e?void 0:e.mentionNotify)&&(e.mentionNotify=!1)}));var u=(0,A.UDU)(l,(0,A.ECF)()),c=(0,go.WH)(null,u),h=(0,go.s2)(c);r.replace(o,h)}}}return r}}]),e}(),yo=(fo={},(0,u.Z)(fo,S.p.SheetValueHandler,_o),(0,u.Z)(fo,S.p.Mention,ho),(0,u.Z)(fo,S.p.HyperlinkBackground,P),(0,u.Z)(fo,S.p.FontSize,F),(0,u.Z)(fo,S.p.FontFamily,w),(0,u.Z)(fo,S.p.PasteStyleInherit,B),(0,u.Z)(fo,S.p.CopyCutHandler,(function e(t){var n=this,r=t.editor;(0,i.Z)(this,e),this.handleKeydown=function(e){var t=e.evt,r=C().isIPad&&t.metaKey&&t.keyCode===_.VDZ.C,o=C().isIPad&&t.metaKey&&t.keyCode===_.VDZ.X;if(r){var i=n.editor.selection.getSelection();n.editor.clipboard.copyRange(i)}if(o){var a=n.editor.selection.getSelection();n.editor.clipboard.cutRange(a)}},this.editor=r,this.editor.on("keydown",this.handleKeydown)})),(0,u.Z)(fo,S.p.FormulaColor,D.V),(0,u.Z)(fo,S.p.FormulaHighlight,q),(0,u.Z)(fo,S.p.Undo,(function e(t){(0,i.Z)(this,e),this.editor=t.editor,this.editor.on(G.BV,(function(){(0,j.mc)({action:G.BV})}))})),(0,u.Z)(fo,S.p.Redo,(function e(t){(0,i.Z)(this,e),this.editor=t.editor,this.editor.on(G.Mc,(function(){(0,j.mc)({action:G.Mc})}))})),(0,u.Z)(fo,S.p.Bold,E.d),(0,u.Z)(fo,S.p.Italic,O.T),(0,u.Z)(fo,S.p.Underline,W.v),(0,u.Z)(fo,S.p.Strikethrough,K.n),(0,u.Z)(fo,S.p.Highlight,St),(0,u.Z)(fo,S.p.FileCard,Gt),(0,u.Z)(fo,S.p.Link,sn),(0,u.Z)(fo,S.p.HyperLinks,wt),fo),Co={MentionSuggest:po},So=(vo={},(0,u.Z)(vo,S.p.TextNodeDeserializer,c.r),(0,u.Z)(vo,S.p.BlockElementNodeDeserializer,h.u),(0,u.Z)(vo,S.p.KeyboardShortcuts,f.W),(0,u.Z)(vo,S.p.TooltipMenu,v.i),(0,u.Z)(vo,S.p.BlankLine,p.Q),(0,u.Z)(vo,S.p.TextPlaceholder,g.P),vo),ko=function(){function e(t){var n=this;(0,i.Z)(this,e),this.options=t,this.registerPlugin=function(t){if(!e.isPluginModuleLoaded())return[];n.editor=t;var r=n.options.sheetBridge,o=("cell-note"===n.options.source?e.notePluginModule:e.pluginModule).pluginOrder,i=[];return o.forEach((function(e){var o=e.key,a=e.map;if(!n.options.disabledPlugins.includes(o))switch(o){case S.p.KeyboardShortcuts:var s=new f.W({editor:t,shortcutsMap:k.rW});i.push(s);break;case S.p.Mention:var l,u,c,h,d;if(!n.options.mention)break;null!==(l=n.options.mention)&&void 0!==l&&l.getContainer&&(h=n.options.mention.getContainer()),null!==(u=n.options.mention)&&void 0!==u&&u.getSource&&(d=n.options.mention.getSource());var v=n.options.mention,p=v.suiteTypeNum,y=v.token,E="en"===_.Ps3.getLanguage()?"en":"",T=new yo.Mention({source:d,editor:t,suiteType:p,token:y,editorSource:null!==(c=n.options.source)&&void 0!==c?c:"",lang:E,container:h,MentionKeyboard:m.m,MentionSuggest:Co.MentionSuggest,attributesAllowList:["backgroundcolor","bold","italic","underline","strikethrough",_.Psm.FontSize,_.Psm.TextColor,_.Psm.FontFamily],onSuggest:function(e){e.onConfirm;var t,n,r,o=e.anchorRect,i=(e.mountNode,e.query);return null!==(t=T.mentionHelper)&&void 0!==t&&t.isShow()?(null===(n=T.mentionHelper)||void 0===n||n.updateQuery(i),{close:function(){return{}}}):T.canMention()?(null===(r=T.mentionHelper)||void 0===r||r.show(o),{close:function(){return{}}}):null}});i.push(T);break;case S.p.HyperLinks:var b=new yo.HyperLinks(Object.assign({type:S.Y,editor:t,alwayHasUnderline:!0,linkColor:"--B500",customLinkRegexp:_.G9b},n.options.hyperlink,{onClick:function(e,t){e.preventDefault(),function(e){var t=_.Ps3.mpLinkHelper;if(t){var n=t.isMpWhitelistLink,r=t.showMPLinkDialog;if(!n(e))return void r(e)}window.open(e,"_blank","noopener,noreferrer")}(t)}}));i.push(b);break;case S.p.TooltipMenu:C().mobile&&!C().isBytedanceApp&&i.push(new a[o]({editor:t}));break;case S.p.TextPlaceholder:i.push(new g.P(t,{}));break;case S.p.SheetValueHandler:var I;i.push(new a[o]({formatterService:null===(I=n.options.spread)||void 0===I?void 0:I.formatterService}));break;default:i.push(new a[o]({editor:t,sheetBridge:r}))}})),i}}return(0,a.Z)(e,[{key:"closeMention",value:function(){var e=this.editor.pluginManager.getPlugin(S.p.Mention);null==e||e.closeSuggest()}},{key:"isMentionBoxVisible",value:function(){var e;return(null===(e=this.editor.pluginManager.getPlugin(S.p.Mention).mentionHelper)||void 0===e?void 0:e.isShow())||!1}},{key:"clickDeleteUrl",value:function(e){var t,n=e.hyperDom,r=this.editor,o=null===(t=r.selection.getElementRange(n))||void 0===t?void 0:t.toPosition();if(o){var i,a=(new d.I).retain(o.start).retain(o.len,(i={},(0,u.Z)(i,[][0],""),(0,u.Z)(i,"removeLink","true"),i));r.getContentState().apply(a)}}},{key:"setHyperlinkDom",value:function(e,t){var n=e.selection.getElementRange(t);n&&this.editor.selection.setSelection(n)}},{key:"destroy",value:function(){this.options={}}}],[{key:"isPluginModuleLoaded",value:function(){return Boolean(this.pluginModule)}}]),e}();ko.pluginModule={pluginOrder:[{key:S.p.SheetValueHandler,map:yo},{key:S.p.Mention,map:yo},{key:S.p.TextNodeDeserializer,map:So},{key:S.p.BlockElementNodeDeserializer,map:So},{key:S.p.PasteStyleInherit,map:yo},{key:S.p.FormulaHighlight,map:yo},{key:S.p.HyperlinkBackground,map:yo},{key:S.p.FormulaColor,map:yo},{key:S.p.Bold,map:yo},{key:S.p.Italic,map:yo},{key:S.p.Underline,map:yo},{key:S.p.Strikethrough,map:yo},{key:S.p.FontSize,map:yo},{key:S.p.FontFamily,map:yo},{key:S.p.Highlight,map:yo},{key:S.p.FileCard,map:yo},{key:S.p.HyperLinks,map:yo},{key:S.p.Link,map:yo},{key:S.p.KeyboardShortcuts,map:So},{key:S.p.TooltipMenu,map:So},{key:S.p.BlankLine,map:So},{key:S.p.CopyCutHandler,map:yo}]},ko.notePluginModule={pluginOrder:[{key:S.p.TextNodeDeserializer,map:So},{key:S.p.KeyboardShortcuts,map:So},{key:S.p.BlankLine,map:So},{key:S.p.TextPlaceholder,map:So},{key:S.p.CopyCutHandler,map:yo}]};var Eo,To,bo,Io=n("vsh_47006"),Ro=(Eo={},(0,u.Z)(Eo,_.rvF.BOLD,_.Psm.Bold),(0,u.Z)(Eo,_.rvF.ITALIC,_.Psm.Italic),(0,u.Z)(Eo,_.rvF.UNDERLINE,_.Psm.Underline),(0,u.Z)(Eo,_.rvF.LINE_THROUGH,_.Psm.Strikethrough),(0,u.Z)(Eo,_.rvF.INCREASE_FONT_SIZE,_.Psm.FontSize),(0,u.Z)(Eo,_.rvF.DECREASE_FONT_SIZE,_.Psm.FontSize),Eo);!function(e){e.HYPERLINK="hyperlink"}(To||(To={})),function(e){e[e.Insert=0]="Insert",e[e.Replace=1]="Replace",e[e.NotReplace=2]="NotReplace"}(bo||(bo={}));var wo=function(){function e(t){var n=this;(0,i.Z)(this,e),this.command=t,this.onSelectionChange=function(){if(n.command.isAtStartOfLine()&&n.command.checkEditorLineEmpty())for(var e=n.command.getActiveCellStyle(),t=(0,A.$go)(e),r=0;r<_.cvC.length;r++){var o=_.cvC[r],i=t[o];[_.Psm.TextColor,_.Psm.FontSize,_.Psm.FontFamily].includes(o)?i?n.command.setAttributesOnCurrentSelection(o,i,!1,!1):n.command.setAttributesOnCurrentSelection(o,"",!1,!1):"true"===i?n.command.setAttributesOnCurrentSelection(o,"true",!1,!1):n.command.setAttributesOnCurrentSelection(o,"",!1,!1)}}}return(0,a.Z)(e,[{key:"handleSheetCommand2EditorEvent",value:function(e){var t=this.command.getAttributesOnCurrentSelection(),n=Ro[e];if(e===_.rvF.INCREASE_FONT_SIZE){var r=t[_.Psm.FontSize],o=_.xOW.indexOf(r);this.triggerEditorEvent(n,_.xOW[Math.min(o+1,_.xOW.length-1)])}else if(e===_.rvF.DECREASE_FONT_SIZE){var i=t[_.Psm.FontSize],a=_.xOW.indexOf(i);this.triggerEditorEvent(n,_.xOW[Math.max(a-1,0)])}else n&&n&&this.triggerEditorEvent(n,"true");return!0}},{key:"exec",value:function(e){if(Object.prototype.hasOwnProperty.call(e,To.HYPERLINK)){var t=this.command.getAttributesOnCurrentSelection(),n=e[To.HYPERLINK];if(n.type===bo.NotReplace){this.command.removeMatchedAttributeOnSelection("url-"),this.command.removeMatchedAttributeOnSelection(_.Psm.HyperlinkCellPosition),n.editorAttributeKey="url-".concat((0,_.zsn)(10));for(var r=this.command.getEntitiesOnCurrentSelection(),o=0;o<r.length;o++){var i,a=r[o],s=(0,It.ro)(a.attributes);if(null==s||null===(i=s.props)||void 0===i||!i.data){for(var l=Object.keys(a.attributes),u=!1,c=0;c<l.length;c++){var h=l[c];if(new RegExp("mention-token").test(h)){u=!0;break}}if(!u){var d=this.command.editorRangeToPosition({start:a.start,end:a.end});this.command.applyContentState(Ao(Object.assign({},n,{from:d.start,count:d.len}),t))}}}}else n.type===bo.Replace?this.command.applyContentState(Ao(n,this.command.getInlineAttributesOfPreviousPosition())):this.command.applyContentState(Ao(n,t))}}},{key:"onFocus",value:function(){this.onSelectionChange()}},{key:"triggerEditorEvent",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];switch(e){case _.Psm.FontSize:case _.Psm.TextColor:this.command.setAttributesOnCurrentSelection(e,null==t?void 0:t.toString(),!1,n);break;default:this.command.setAttributesOnCurrentSelection(e,null==t?void 0:t.toString(),!0,n)}}}]),e}();function Ao(e,t){var n,r=e.from,o=e.count,i=e.text,a=e.link,s=e.extraInfo,l=e.type,c=e.editorAttributeKey,h=new d.I,f=void 0===c?"url-".concat((0,_.zsn)(10)):c,v=Object.assign({},s,(n={},(0,u.Z)(n,f,a),(0,u.Z)(n,"removeLink",""),n));switch(l){case bo.Insert:var p,g=(p={},(0,u.Z)(p,_.Psm.FontSize,t[_.Psm.FontSize]||""),(0,u.Z)(p,_.Psm.TextColor,t[_.Psm.TextColor]||""),p);return t[_.Psm.Bold]&&(g.bold="true"),t[_.Psm.Italic]&&(g.italic="true"),t[_.Psm.Underline]&&(g.underline="true"),t[_.Psm.Strikethrough]&&(g.strikethrough="true"),Object.assign(v,g),h.retain(r).insert(i,v).delete(o);case bo.NotReplace:return h.retain(r).retain(o,v);case bo.Replace:var m=(0,At.Z)(t,_.cvC);return h.retain(r).insert(i,Object.assign(v,m)).delete(o)}}var Fo=n("vsh_20680"),Do=n("vsh_63992"),No=function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":(0,M.Z)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Po=[_.rvF.BOLD,_.rvF.ITALIC,_.rvF.UNDERLINE,_.rvF.LINE_THROUGH,_.rvF.INCREASE_FONT_SIZE,_.rvF.DECREASE_FONT_SIZE];function Oo(e,t,n){var r=n.value;return n.value=function(){try{return r.apply(this,arguments)}catch(e){this.handleError(t,e)}},n}var Mo=function(){function e(t,n,r,o){var a=this;(0,i.Z)(this,e),this.editor=t,this.spread=n,this.sdk=r,this.options=o,this.getActiveCellStyle=function(){return a.spread.getActiveSheet().getActiveCellStyle()},this.handleSelectionChange=function(e){var t,n;a.clearStoreAttribute(),a.sheetCommand.onSelectionChange(),null===(t=(n=a.options).onSelectionChange)||void 0===t||t.call(n,e)},this.handleEditorContentChange=function(e){var t,n;null===(t=(n=a.options).onEditorContentChange)||void 0===t||t.call(n,e)},this.handleError=function(e,t){var n,r;_.Ps3.collectSuiteEvent("client_sheet_editor_exception",{func_name:e}),_.Ps3.moirae.ravenCatch(t,{tags:{key:"SHEET_EDITOR_ERROR",editorErrorName:e}}),null===(n=(r=a.options).onEditorError)||void 0===n||n.call(r,t)},this.handleEditorClick=function(e){var t,n;null===(t=(n=a.options).onEditorClick)||void 0===t||t.call(n,e)},this.handleBeforeInput=function(e){var t,n;null===(t=(n=a.options).onEditorBeforeInput)||void 0===t||t.call(n,e)},this.handleCompositionStart=function(e){var t,n;null===(t=(n=a.options).onEditorCompositionStart)||void 0===t||t.call(n,e)},this.handleKeydown=function(e){var t,n,r;e.keyCode!==_.VDZ.Tab||e.ctrlKey||e.altKey||e.metaKey||(e.preventDefault(),e.stopEvent(),e.preventEvent()),"cell-note"===a.options.getEditorSource()||e.keyCode!==_.VDZ.Enter||e.ctrlKey||e.altKey||e.metaKey||(e.preventDefault(),e.stopEvent(),e.preventEvent()),null===(t=(n=a.options).onEditorKeydown)||void 0===t||t.call(n,e);var o=(0,Fo.aK)(e.nativeEvent,null===(r=a.sdk)||void 0===r?void 0:r.getPlugin(Fo.B_));if(o&&Po.includes(o.fnName)){var i=a.getEditorSelectedText().length,s=a.isSelectingAll();return _.Ps3.collectSuiteEvent("sheet_opration",{action:o.fnName,mode:a.options.getEditorSource(),object_count:i,is_select_all:s,source:"shortkey"}),a.sheetCommand.handleSheetCommand2EditorEvent(o.fnName)&&(e.preventDefault(),e.stopEvent(),e.preventEvent()),!1}return!0},this.handleFocus=function(e){a.options.onEditorFocus&&a.options.onEditorFocus(e)},this.handleCopyWithoutPermission=function(){var e,t,n,r,o,i=null===(e=null===(t=a.sdk)||void 0===t||null===(n=t.getPlugin("PermissionPlugin"))||void 0===n?void 0:n.getCopyable())||void 0===e||e;i?a.editor.copyable=i:null===(r=(o=_.Ps3.clipboardManager).showCopyErrorToast)||void 0===r||r.call(o)},this.eventList=[{key:Dn.r.SELECTION_CHANGE,handler:this.handleSelectionChange},{key:Dn.r.CONTENT_CHANGE,handler:this.handleEditorContentChange},{key:"error",handler:function(e){return a.handleError("DocSDK error - ".concat(null==e?void 0:e.message),e)}},{key:"keydown",handler:this.handleKeydown},{key:"focus",handler:this.handleFocus},{key:"click",handler:this.handleEditorClick},{key:"COPY_WITHOUT_PERMISSION",handler:this.handleCopyWithoutPermission},{key:Dn.r.BEFORE_INPUT,handler:this.handleBeforeInput},{key:Dn.r.COMPOSITION_START,handler:this.handleCompositionStart}],this.bindEvent(),this.sheetCommand=new wo({setAttributesOnCurrentSelection:this.setAttributesOnCurrentSelection.bind(this),applyContentState:this.applyContentState.bind(this),getEditorSelection:this.getEditorSelection.bind(this),isAtStartOfLine:this.isAtStartOfLine.bind(this),checkEditorLineEmpty:this.checkEditorLineEmpty.bind(this),getActiveCellStyle:this.getActiveCellStyle,getAttributesOnCurrentSelection:this.getAttributesOnCurrentSelection.bind(this),getEntitiesOnCurrentSelection:this.getEntitiesOnCurrentSelection.bind(this),editorRangeToPosition:this.editorRangeToPosition.bind(this),getInlineAttributesOfPreviousPosition:function(){return a.getInlineAttributesOfPreviousPosition().toMap()},removeMatchedAttributeOnSelection:this.removeMatchedAttributeOnSelection.bind(this)})}return(0,a.Z)(e,[{key:"clearEditorContentHighlight",value:function(){var e=this.editor.getContentState().getActiveZone().getModelText().length-1;this.setEditorContentHighlight(!1,{start:0,len:e})}},{key:"destroy",value:function(){this.unBindEvent(),this.options={}}},{key:"bindEvent",value:function(){var e=this;this.eventList.forEach((function(t){return e.editor.on(t.key,t.handler,t.priority||1)}))}},{key:"unBindEvent",value:function(){var e=this;this.eventList.forEach((function(t){return e.editor.off(t.key,t.handler)}))}},{key:"reset",value:function(){this.editor&&(this.editor.reset(),this.checkEditorEmpty()||this.handleError("editor did't reset correct！",{errorText:this.getEditorText()}))}},{key:"setAttributesOnCurrentSelection",value:function(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=this.editor.selection.getSelection(),i=this.editor.getContentState(),a=i.getActiveZone(),s=a.getZoneId();if(o.isCollapsed())if(n){var l=this.getAttributesOnCurrentSelection()[e].toString(),c=l===t?"":t;this.forceSetEditorAttributesWhenCaretCollapsed(e,c,o)}else this.forceSetEditorAttributesWhenCaretCollapsed(e,t,o);else if(n)this.editor.toggleAttribute(e,t);else{var h=o.toPosition(),f=h.start,v=h.len,p=new d.I({zoneId:s}).retain(f).retain(v,(0,u.Z)({},e,t));this.applyContentState(p)}r&&o.start&&o.end&&(this.setWithSelection(s,[o.start.line,o.start.offset],[o.end.line,o.end.offset]),this.editor.isFocus()||(this.editor.focus(),this.editor.selection.updateViewSelection(!0)))}},{key:"setAttributesOnAllContent",value:function(e,t){var n=this.editor.getContentState().getActiveZone(),r=n.length()-1;if(n.getLine(r)){var o=n.getZoneId(),i=new d.I({zoneId:o}).retain(n.getModelText().length,(0,u.Z)({},e,t));this.applyContentState(i)}}},{key:"setWithSelection",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return this.editor.selection.setSelection({start:{line:t[0],offset:t[1],zoneId:e},end:{line:n[0],offset:n[1],zoneId:e}},r)}},{key:"setSelectionByOffset",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.editor.getContentState().getActiveZone(),o=r.offsetToPoint(e),i=void 0===t?o:r.offsetToPoint(t);this.setWithSelection(r.getZoneId(),[o.line,o.offset],[i.line,i.offset],n)}},{key:"getAttributesOnCurrentSelection",value:function(){return this.innerGetAttributesOnCurrentSelection({trueValue:!0,falseValue:!1})}},{key:"getAttributeOnCurrentSelectionForApply",value:function(){return this.innerGetAttributesOnCurrentSelection({trueValue:"true",falseValue:""})}},{key:"innerGetAttributesOnCurrentSelection",value:function(e){var t,n=e.trueValue,r=e.falseValue,o=(t={},(0,u.Z)(t,_.Psm.Bold,r),(0,u.Z)(t,_.Psm.Italic,r),(0,u.Z)(t,_.Psm.Underline,r),(0,u.Z)(t,_.Psm.Strikethrough,r),(0,u.Z)(t,_.Psm.TextColor,""),(0,u.Z)(t,_.Psm.FontSize,A.OvR+"px"),(0,u.Z)(t,_.Psm.FontFamily,(0,_.M10)()),t);if(!this.editor)return o;var i=this.editor.selection.getSelection(),a=this.editor.getContentState(),s=[_.Psm.Bold,_.Psm.Italic,_.Psm.Underline,_.Psm.Strikethrough];if(i.isCollapsed()){var l=this.getInlineAttributesOfPreviousPosition().toMap(),c=a.getInlineStyleOverride({zoneId:i.start.zoneId,start:i.start.offset});o[_.Psm.FontSize]=c[_.Psm.FontSize]||l[_.Psm.FontSize]||A.OvR+"px",o[_.Psm.TextColor]=c[_.Psm.TextColor]||l[_.Psm.TextColor]||"",o[_.Psm.FontFamily]=c[_.Psm.FontFamily]||l[_.Psm.FontFamily]||"";for(var h=0;h<s.length;h++){var d=s[h];void 0!==c[d]?o[d]=c[d]?n:r:o[d]="true"===l[d]?n:r}}else{var f=a.getEntities(i);0!==f.length&&(o[_.Psm.FontSize]=f[0].attributes[_.Psm.FontSize]||A.OvR+"px",o[_.Psm.TextColor]=f[0].attributes[_.Psm.TextColor]||"",o[_.Psm.FontFamily]=f[0].attributes[_.Psm.FontFamily]||"");for(var v=0;v<f.length;v++){var p=f[v];if("\n"!==p.text)for(var g=0;g<s.length;g++){var m=s[g];"true"===p.attributes[m]&&(o[m]=n)}}}return o}},{key:"getInlineAttributesOfPreviousPosition",value:function(){if(!this.editor)return{toMap:function(){return{}}};var e=this.editor.getContentState(),t=e.getActiveZone(),n=t.getZoneId(),r=this.editor.selection.getSelection(),o=t.getLine(r.start.line),i=o.getLineMarker(),a=r.start,s=r.start;return i===r.start.offset&&o.length()>i?s={line:r.start.line,offset:r.start.offset+1,zoneId:n}:r.start.offset>i&&(a={line:r.start.line,offset:r.start.offset-1,zoneId:n}),e.getAttributes(a,s)}},{key:"forceSetEditorAttributesWhenCaretCollapsed",value:function(e,t,n){var r,o;if(this.editor){var i=n.start,a=n.end;this.editor.getContentState().setAttributes({start:i,end:a},(0,u.Z)({},e,t)),null===(r=(o=this.options).onSetStoreAttributes)||void 0===r||r.call(o,e,t)}}},{key:"applyContentState",value:function(e,t){this.editor&&this.editor.getContentState().apply(e,t)}},{key:"setContent",value:function(e){var t,n;if(this.editor&&e.ops.length){var r=this.editor.getContentState(),o=r.getActiveZone().getZoneId(),i=r.getZoneState(o);if(i){var a=i.getModelText().length-1,s=e;if(null!==(t=e.ops[e.ops.length-1])&&void 0!==t&&null!==(n=t.insert)&&void 0!==n&&n.endsWith("\n")){var l=e.length();s=e.compose((new d.I).retain(l-1).delete(1))}if(a>0){var u=(new d.I).delete(a);this.applyContentState(u.concat(s))}else this.applyContentState(s)}}}},{key:"getEditorSelection",value:function(){return this.editor?this.editor.selection.getSelection():null}},{key:"isAtStartOfLine",value:function(){var e=this.getEditorSelection();if(null===e)return!1;if(!e.isCollapsed())return!1;var t=e.start,n=t.zoneId,r=t.line,o=t.offset,i=this.editor.getContentState().getZoneState(n),a=null==i?void 0:i.getLine(r);return!!a&&Number(a.hasLineMarker())===o}},{key:"checkEditorLineEmpty",value:function(e){void 0===e&&(e=this.editor.selection.getSelection().start.line);var t=this.editor.getContentState().getActiveZone().getLine(e);return!(!t||"\n"!==t.getText())}},{key:"getEntitiesOnCurrentSelection",value:function(){var e=this.editor.selection.getSelection();return this.editor.getContentState().getEntities(e)}},{key:"editorRangeToPosition",value:function(e){return this.editor.getContentState().rangeToPosition(e)}},{key:"removeMatchedAttributeOnSelection",value:function(e){var t=this.editor,n=t.getContentState(),r=t.selection.getSelection(),o={};n.getEntities(r,(function(t){return!!t.includes(e)&&(o[t]="",!0)})),n.setAttributes(r,o)}},{key:"setEditorContentHighlight",value:function(e,t){if(t||(t=this.editor.selection.getSelection().toPosition()),0!==t.len){var n=new d.I,r=e?"true":"";n.retain(t.start).retain(t.len,{link_background:r}),n.length()>0&&this.applyContentState(n,{nonundoable:!0})}}},{key:"collapseSelection",value:function(e){var t=this.getEditorSelection(),n=t.start,r=t.end;e?r=n:n=r,this.setWithSelection(n.zoneId,[n.line,n.offset],[r.line,r.offset],!0)}},{key:"getInInternationalComposition",value:function(){return this.editor.getStatus("isComposing")}},{key:"updateBrowserSelectionFromRep",value:function(){this.editor.selection.updateViewSelection(!0)}},{key:"getEditorText",value:function(){var e=this.editor.getContentState(),t=e.getActiveZone();return(0,Do.p)(t,this.spread.getActiveSheet())}},{key:"getEditorSelectedText",value:function(){var e=this.editor.selection.getSelection(),t=e.start,n=e.end,r=this.editor.getContentState().getActiveZone().slice(t,n);return(0,Do.p)(r,this.spread.getActiveSheet())}},{key:"checkEditorEmpty",value:function(){return!(1!==this.editor.getContentState().getActiveZone().length()||!this.checkEditorLineEmpty(0))}},{key:"clearStoreAttribute",value:function(){this.editor.getContentState()._clearInlineStyleOverride()}},{key:"clearAllStack",value:function(){this.editor.undoModule.clear()}},{key:"clearEditorContent",value:function(){var e=this.editor.getContentState(),t=e.getActiveZone().getZoneId(),n=e.getZoneState(t);if(n){var r=n.getModelText().length-1,o=(new d.I).delete(r);e.apply(o)}}},{key:"replaceAllText",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=(new d.I).insert(e,t);this.setContent(n)}},{key:"focusAtEnd",value:function(){this.editor.focusAtEnd(),this.sheetCommand.onFocus()}},{key:"focus",value:function(){this.editor.focus(),this.sheetCommand.onFocus()}},{key:"getEditorContent",value:function(){return{text:this.editor.getText(),html:this.editor.getHTML()}}},{key:"isSelectingAll",value:function(){return this.editor.selection.isSelectingAll()}},{key:"getDocBody",value:function(){return this.editor.getContainer()}},{key:"setSelectionToFirstCharacter",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.editor.getContentState().getActiveZone(),n=t.getLine(0);if(n){var r=n.getLineMarker(),o={line:0,offset:r,zoneId:t.getZoneId()},i=o;e&&(i=this.editor.selection.getSelection().start),this.editor.selection.setSelection({start:o,end:i},!0)}}},{key:"setSelectionToLastCharacter",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.editor,r=n.getContentState(),o=r.getActiveZone(),i=o.length()-1,a=o.getLine(i),s=a&&a.getText().length,l={line:i,offset:s,zoneId:o.getZoneId()},u=l;e&&(u=this.getEditorSelection().start),this.setWithSelection(u.zoneId,[u.line,u.offset],[l.line,l.offset],t)}},{key:"generateAndReplaceEditorValue",value:function(e,t){this.checkEditorEmpty()||this.clearEditorContent();var n=e.getActiveCellStyle();Array.isArray(t)||(t=[{type:_.K6s.TEXT,text:String(t)}]);var r=(0,A.UDU)(t,n),o=(0,go.WH)(this.editor,r);(0,go.r4)(o,this.editor)}}]),e}();No([Oo],Mo.prototype,"reset",null),No([Oo],Mo.prototype,"setAttributesOnCurrentSelection",null),No([Oo],Mo.prototype,"setWithSelection",null),No([Oo],Mo.prototype,"applyContentState",null),No([Oo],Mo.prototype,"getInInternationalComposition",null),No([Oo],Mo.prototype,"updateBrowserSelectionFromRep",null),No([Oo],Mo.prototype,"getEditorText",null),No([Oo],Mo.prototype,"getEditorSelectedText",null),No([Oo],Mo.prototype,"replaceAllText",null),No([Oo],Mo.prototype,"setSelectionToLastCharacter",null),No([Oo],Mo.prototype,"generateAndReplaceEditorValue",null);n("vsh_14415");var Lo=n("vsh_94596"),xo=n.n(Lo),Vo=n("vsh_82905"),Zo=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function s(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))},Bo={},Ho=new WeakMap;function Uo(e){return Ho.get(e)}var jo=function(){function e(t){var n=this;(0,i.Z)(this,e),this.options=t,this._scrollbarWidth=0,this.source="",this.onEditorContentChange=function(e){var t,r;null===(r=(t=n.options).onEditorContentChange)||void 0===r||r.call(t,e)},this.options.source&&(this.source=this.options.source),this.container=this.options.container,this.pluginManager=new ko(t),this.mounted()}return(0,a.Z)(e,[{key:"createRoadsterContext",value:function(e){return Zo(this,void 0,void 0,o().mark((function t(){var n=this;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._resizeObserver=new(xo())((function(e){n.refresh()})),this._resizeObserver.observe(this._scroller),this._roadsterContext=l.ZP.createContext({container:e,scroller:this._scroller,maxContentWidth:1/0}),"cell-note"!==this.options.source){t.next=8;break}return t.next=6,this._roadsterContext.use(l.kE,{enableGlobalEvent:!0}).use(l.Hi).use(l._i,{needControlBar:C().mobile});case 6:t.next=10;break;case 8:return t.next=10,this._roadsterContext.use(l.kE,{enableGlobalEvent:!0}).use(l.Hi).use(l._i,{needControlBar:C().mobile}).use(l.Tj);case 10:case"end":return t.stop()}}),t,this)})))}},{key:"getEditor",value:function(){return this.editor}},{key:"updateTheme",value:function(e){e||(e=(0,le.getCurrentThemeType)());var t=e===le.ThemeType.DARK?"rgba(76,133,255,0.34)":"rgba(51,112,255,0.34)";(0,l.tE)({color:t});var n=(0,Dt.FgM)(this._roadsterContext,e),r=(0,Y.getThemeConfig)()[e];k.Jn.forEach((function(e){n.addToken(e,r[e.slice(2)])}))}},{key:"setSheetId",value:function(e){Ho.set(this.editor,e)}},{key:"mounted",value:function(){var e,t,n=this,r=this.options,o=r.sheetId,i=r.style,a=void 0===i?Bo:i,u=r.onInit,c=void 0===u?s.default:u,h=r.enableVirtualScroll,d=void 0!==h&&h,f=r.editable,v=document.createElement("div");v.style.overflow="hidden";var p=this._scroller=document.createElement("div");p.style.overflowY="auto",p.style.overflowX="hidden",p.style.position="relative",p.style.height="100%",p.appendChild(v),this.options.container.appendChild(p),this.createRoadsterContext(v),this.updateTheme(),this._offUIChange=(0,le.onUIStateChange)((function(e){var t=e.mode;n.updateTheme(t)}));try{this._roadsterContext.render((0,l.az)(Io.M,{scroller:p,enableVirtualScroll:d,sheetId:o,style:a,register:this.pluginManager.registerPlugin,editable:f,isInline:this.options.isInline,placeholder:this.options.placeholder,onInit:function(e,t){n.editor=e,Ho.set(e,o),n.editorCommand=new Mo(e,n.options.spread,n.options.sdk,{onSelectionChange:n.options.onSelectionChange,onEditorContentChange:n.onEditorContentChange,onEditorFocus:n.options.onEditorFocus,onEditorKeydown:n.options.onEditorKeydown,onEditorError:function(e){var t,r;n.destroy(),null===(r=(t=n.options).onEditorError)||void 0===r||r.call(t,e)},getEditorSource:function(){return n.source},onSetStoreAttributes:n.options.onSetStoreAttributes,onEditorClick:n.options.onEditorClick,onEditorBeforeInput:n.options.onEditorBeforeInput,onEditorCompositionStart:n.options.onEditorCompositionStart}),Promise.resolve().then((function(){n._roadsterContext.destroyed||c(e,t)}))}}))}catch(n){this.destroy(),null===(t=(e=this.options).onEditorError)||void 0===t||t.call(e,n)}}},{key:"resizeEditor",value:function(e,t){var n,r,o=this;if(this._roadsterContext.destroyed)null===(r=(n=this.options).onEditorError)||void 0===r||r.call(n,new Error("roadster is destroyed"));else{var i=e.maxContentWidth,a=e.maxContentHeight;this._roadsterContext.resize(i-this._scrollbarWidth,a),this._roadsterContext.once(l.FP.PAINT,(function(){var e=o._roadsterContext.getVisibleArea();(void 0===t||e&&(null==e?void 0:e.width)&&e.width>t)&&(o._scrollbarWidth=o._scroller.offsetWidth-o._scroller.clientWidth),o._roadsterContext.resize(i-o._scrollbarWidth,a)}))}}},{key:"refresh",value:function(){var e;null===(e=this._roadsterContext)||void 0===e||e.refresh()}},{key:"destroy",value:function(){try{this._roadsterContext&&!this._roadsterContext.destroyed&&this._roadsterContext.destroy(),this._resizeObserver.disconnect(),this._scroller.remove(),this._offUIChange&&this._offUIChange(),this._offUIChange=void 0,this.pluginManager.destroy(),this.editorCommand&&this.editorCommand.destroy(),Ho.delete(this.editor),this.editor.destroy(),this.options={},this.editor.selection._mouseHandler.scrollHelper.scrollContainer=null}catch(e){this.options.spread.getService(Vo.QX).error("sheet editor","destroy error ".concat(e.message)),this.options.spread.getService(Vo.zv).captureException(e,{key:"SHEET_EDITOR_DESTROY_ERROR"})}}}],[{key:"canCreateEditor",value:function(){return ko.isPluginModuleLoaded()}}]),e}()},vsh_56049:function(e,t,n){n.d(t,{V:function(){return h}});var r=n("vsh_19264"),o=n("vsh_4175"),i=n("vsh_65498"),a=n("vsh_83640"),s=n("vsh_24627"),l=n("vsh_9812"),u=n("vsh_69691"),c=function(e,t,n,r){var o,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":(0,i.Z)(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(s=(a<3?o(s):a>3?o(t,n,s):o(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s},h=function(){function e(){(0,r.Z)(this,e),this.className="FormulaColor",this.name=l.p.FormulaColor}return(0,o.Z)(e,[{key:"match",value:function(e){return e===s.Psm.FormulaColor}},{key:"render",value:function(e){var t=e.children,n=e.attributes,r=e.style,o=n.formulacolor;return o&&(r.color=(0,u.getThemeColor)(o,u.ColorType.FOREGROUND)),t}}]),e}();c([(0,a.gv)(1001)],h.prototype,"render",null)},vsh_75986:function(e,t,n){n.d(t,{z7Q:function(){return l.z7},POC:function(){return l.PO},flx:function(){return l.fl},He8:function(){return l.He},eFM:function(){return l.eF},VTT:function(){return l.VT},HyL:function(){return l.Hy},Phb:function(){return i.P},Fw5:function(){return l.Fw},Aw6:function(){return l.Aw},ieN:function(){return l.ie},uzX:function(){return l.uz},IEf:function(){return l.IE},yOL:function(){return s.yO},l$w:function(){return l.l$},OOo:function(){return l.OO},TVz:function(){return l.TV},I9w:function(){return F.I9},C4Z:function(){return l.C4},$LI:function(){return l.$L},FKO:function(){return l.FK},SyH:function(){return j},sFs:function(){return U},RJT:function(){return l.RJ},Vkf:function(){return l.Vk},p4G:function(){return l.p4},U2$:function(){return l.U2},Dvk:function(){return l.Dv},kCP:function(){return l.kC},Fmx:function(){return l.Fm},M_4:function(){return l.M_},XT5:function(){return l.XT},YM0:function(){return l.YM},MCw:function(){return l.MC},WcQ:function(){return l.Wc},keX:function(){return l.ke},VJc:function(){return l.VJ},Wcw:function(){return l.Bz},KD:function(){return l.KD},VnT:function(){return l.Vn},PJ7:function(){return l.PJ},XKZ:function(){return l.XK},iKG:function(){return l.iK},CmE:function(){return l.Cm},xae:function(){return l.x},npV:function(){return s.np},MCu:function(){return _.MC},wtx:function(){return l.wt},hMM:function(){return l.hM},B_B:function(){return l.B_},Qrc:function(){return l.Qr},JzW:function(){return l.Jz},SbZ:function(){return l.Sb},peQ:function(){return p},iDx:function(){return l.iD},GgZ:function(){return l.Gg},fS9:function(){return l.fS},jmN:function(){return l.jm},sv1:function(){return l.dN},WAT:function(){return l.WA},dRy:function(){return l.dR},AM3:function(){return l.AM},OGo:function(){return y.OG},OAE:function(){return y.OA},qau:function(){return l.q},c3h:function(){return l.c3},IfW:function(){return G.I},O9p:function(){return B.O},txv:function(){return l.tx},YGW:function(){return s.YG},stD:function(){return s.st},QpK:function(){return s.Qp},$vl:function(){return l.$v},Qhw:function(){return s.Qh},wPC:function(){return l.wP},fWD:function(){return l.fW},sGe:function(){return l.sG},CfE:function(){return _.Cf},ufo:function(){return o.u},CH4:function(){return _.CH},vPQ:function(){return l.vP},WH2:function(){return g.WH},_D$:function(){return l._D},upZ:function(){return A},SqY:function(){return l.Sq},X_r:function(){return l.X_},JkZ:function(){return m.Jk},F6z:function(){return l.F6},LK9:function(){return _.LK},Lxd:function(){return _.Lx},u6t:function(){return a.u6},SOh:function(){return H.SO},XzI:function(){return l.Xz},IGk:function(){return V},cTx:function(){return O},D00:function(){return L},oyH:function(){return a.oy},YTK:function(){return l.YT},nWK:function(){return _.nW},jEU:function(){return _.jE},s2M:function(){return g.s2},HHS:function(){return _.HH}});n("vsh_94920");var r,o=n("vsh_72210"),i=n("vsh_43247"),a=(n("vsh_93444"),n("vsh_90468")),s=n("vsh_30964"),l=n("vsh_97580"),u=(n("vsh_36009"),n("vsh_98125")),c=n.n(u),h=n("vsh_50098"),d=n("vsh_26278"),f=["styles"],v=function(e){e.styles;var t=(0,d.Z)(e,f);return c().createElement("svg",(0,h.Z)({width:"88",height:"88",viewBox:"0 0 88 88",fill:"none"},t),c().createElement("g",{clipPath:"url(#559354cd8c448cb13f674ae6a7cdb76b-clip0)"},c().createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M37.62 32.08l-1.5 6.01-22.78 7.52s-1.2-5.41 9.89-12.03c4.22-2.52 1.73-3.84.9-4.81-1.8-2.1.6-3.6 4.2-5.11 3.58-1.5 0-3.01-.6-5.87-.6-2.85 4.8-9.77 11.39-11.28 6.59-1.5 16.66-.81 15.28 10.23-.3 2.4-.6 4.21-.6 4.21s-.6-2.1-3-1.2c-1.94.73-.9 2.1-3.6 0-2.39-1.2-5.39-3.91-5.09-7.52-1.8 2.7-3.3 5.41-6.9 6.61-.9 10.83 2.4 13.24 2.4 13.24z",fill:"#18263C"}),c().createElement("path",{d:"M48.7 24.86s5.1-.3 4.8-3.6c-.3-3.32-4.2-.31-4.2-.31M35.22 18.54s-1.3 14.25 5.1 14.44",stroke:"#18263C",strokeLinecap:"round",strokeLinejoin:"round"}),c().createElement("path",{d:"M13.64 45.31l22.48-7.22 1.5-5.71M26.12 44.06s4.03 14.03 17.06 10.22c13.04-3.8 10.67-19.5 10.67-19.5M42.11 11.93c-.6.3-1.5 5.11-8.69 7.52M49 20.95s-5.69-2.7-6.29-6.32",stroke:"#18263C",strokeLinecap:"round",strokeLinejoin:"round"}),c().createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M38.88 23.12c-.43.43-1.12.43-1.54 0a1.1 1.1 0 010-1.55 1.09 1.09 0 011.54 0 1.1 1.1 0 010 1.55zM45.52 22.86a1.1 1.1 0 11-2.19 0 1.1 1.1 0 012.19 0z",fill:"#18263C"}),c().createElement("path",{d:"M40.91 28.47l-1.8.3 1.5-6.62",stroke:"#18263C",strokeLinecap:"round",strokeLinejoin:"round"}),c().createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M53.2 22.75l-1.5 9.63-5.7 2.1v-3.9s2.4-4.22 2.7-5.42c0 0 1.61-.42 2.1-.6.65-.24 2.4-1.8 2.4-1.8z",fill:"#18263C"}),c().createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9.32 74.01h61.4V30.1H9.31V74z",fill:"#D6DAE1"}),c().createElement("path",{d:"M39.54 29.57l-2.83 22.22h5.67l-3.3 22.22",stroke:"#fff"}),c().createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M62.73 30h7.9v-3.95h-7.9V30z",fill:"#FFC200"}),c().createElement("path",{d:"M.53 42.48l4.93-.41c4.98-.42 11.21-8.34 14.12-7.92 2.9.41-4.15 6.25-1.66 9.17 2.78 3.25 16.2-.84 15.78 2.91-.41 3.75-15.36 5-15.78 2.92-.41-2.08 17.86 0 17.86 3.75s-17.86 3.34-18.27 1.67c-.42-1.67 15.78.42 15.78 3.75s-16.62 3.33-17.03 1.67c-.42-1.67 14.56 1.13 14.12 3.33-.83 4.17-30.26 2.5-30.26 2.5M79.4 42.48l-4.92-.41c-4.99-.42-11.22-8.34-14.12-7.92-2.91.41 4.15 6.25 1.66 9.17-2.78 3.25-16.2-.84-15.78 2.91.41 3.75 15.36 5 15.78 2.92.41-2.08-17.86 0-17.86 3.75s17.86 3.34 18.27 1.67c.42-1.67-15.78.42-15.78 3.75s16.61 3.33 17.03 1.67c.42-1.67-14.56 1.13-14.12 3.33.83 4.17 30.26 2.5 30.26 2.5",stroke:"#18263C",strokeLinecap:"round",strokeLinejoin:"round"})),c().createElement("defs",null,c().createElement("clipPath",{id:"559354cd8c448cb13f674ae6a7cdb76b-clip0"},c().createElement("path",{fill:"#fff",d:"M0 0h88v88H0z"}))))},p=function(e){var t=e.text,n=void 0===t?"":t;return c().createElement("div",{className:"sheet-error-block block-error-view"},c().createElement("div",{className:"block-error-view-img"},c().createElement(v,null)),c().createElement("div",{className:"block-error-view-text"},n))},g=n("vsh_15657"),m=n("vsh_11725"),_=n("vsh_30856"),y=n("vsh_36290"),C=n("vsh_74561"),S=n("vsh_58140"),k=n("vsh_10717"),E=n("vsh_53164"),T=n("vsh_36615"),b=n("vsh_24627"),I=n("vsh_72834"),R=n("vsh_73043"),w=(r={},(0,C.Z)(r,b.h2P.Checkbox,(function(e){return R("CreationDoc_Sheets_Checkbox_DataInvalidDescrip")})),(0,C.Z)(r,b.h2P.Number,(function(e){var t,n=null===(t=e.formulas)||void 0===t?void 0:t.map((function(e){return e.value})),r=(0,k.Z)(n),o=(0,T.Z)(n),i=e.isOnlyReceiveInteger?R("Sheets_DataValidationInteger"):R("Sheets_DataValidationNumber");return{isAValidNumber:e.isOnlyReceiveInteger?R("Sheets_ValueMustBeAValidNumberDataValidationError_Integer"):R("Sheets_ValueMustBeAValidNumberDataValidationError"),between:R("Sheets_ValueBetweenDataValidationError",r,o,i),notBetween:R("Sheets_ValueNotBetweenDataValidationError",r,o,i),equalTo:R("Sheets_ValueEqualValidationError",o,i),notEqualTo:R("Sheets_ValueNotEqualDataValidationError",o,i),lessThan:R("Sheets_ValueLessThanDataValidationError",o,i),greaterThan:R("Sheets_ValueMoreThanDataValidationError",o,i),lessThanOrEqualTo:R("Sheets_ValueLessThanOrEqualToDataValidationError",o,i),greaterThanOrEqualTo:R("Sheets_ValueMoreThanOrEqualToDataValidationError",o,i)}[e.operator]||""})),(0,C.Z)(r,b.h2P.Date,(function(e){var t=e.getFormattedValue((0,S.Z)(e.formulas,"value")),n=e.getFormattedValue((0,E.Z)(e.formulas,"value"));return{isAValidDate:R("Sheets_ValueValidDateDataValidationError"),between:R("Sheets_DataValueBetweenDataValidationError",t,n),notBetween:R("Sheets_NotBetweenDataValidationError",t,n),equalTo:R("Sheets_ValueEqualDataValidationError",n),notEqualTo:R("Sheets_NotEqualValueDataValidationError",n),lessThan:R("Sheets_ValueEarlierThanDataValidationError",n),greaterThan:R("Sheets_ValueLaterThanDataValidationError",n),lessThanOrEqualTo:R("Sheets_ValueEarlierThanOrEqualToDataValidationError",n),greaterThanOrEqualTo:R("Sheets_ValueLaterThanOrEqualToDataValidationError",n)}[e.operator]||""})),(0,C.Z)(r,b.h2P.TextLength,(function(e){var t,n=null===(t=e.formulas)||void 0===t?void 0:t.map((function(e){return e.value})),r=(0,k.Z)(n),o=(0,T.Z)(n);return{between:R("Sheets_TextLengthBetweenDataValidationError",r,o),notBetween:R("Sheets_TextLengthNotBetweenDataValidationError",r,o),equalTo:R("Sheets_TextLengthEqualDataValidationError",o),notEqualTo:R("Sheets_TextLengthNotEqualDataValidationError",o),lessThan:R("Sheets_TextLengthLessThanDataValidationError",o),greaterThan:R("Sheets_TextLengthMoreThanDataValidationError",o),lessThanOrEqualTo:R("Sheets_LessThanOrEqualToDataValidationError",o),greaterThanOrEqualTo:R("Sheets_MoreThanOrEqualToDataValidationError",o)}[e.operator]||""})),r);function A(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,I.NgA)(e)||(0,I.qY6)(e)||(0,I.GCO)(e)||(0,I.gsJ)(e)?w[e.type](e):(0,I.Ju9)(e)?t?R("Sheets_MustBeAnOptionInTheDropdownListDataValidationError"):e.isOptionError?R("LarkCCM_Sheets_InvalidDropdownSettings_Description"):R("Docs_Sheets_DropDown_DropdownValueOnly"):""}var F=n("vsh_88177"),D=n("vsh_67017"),N=n.n(D),P=n("vsh_35067");function O(){return M.apply(this,arguments)}function M(){return(M=(0,P.Z)(N().mark((function e(){return N().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.resolve().then(n.bind(n,"vsh_55413")));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function L(){return x.apply(this,arguments)}function x(){return(x=(0,P.Z)(N().mark((function e(){return N().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.e("vsh_1183").then(n.bind(n,"vsh_84663")));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(){return Z.apply(this,arguments)}function Z(){return(Z=(0,P.Z)(N().mark((function e(){return N().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.resolve().then(n.bind(n,"vsh_70938")));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var B=n("vsh_70257"),H=n("vsh_69006"),U=(n("vsh_5914"),24),j=224,G=n("vsh_40285")},vsh_43247:function(e,t,n){n.d(t,{P:function(){return c}});var r=n("vsh_74561"),o=n("vsh_19264"),i=n("vsh_69691"),a=n("vsh_60505"),s=n("vsh_24627"),l=n("vsh_74340");function u(e){try{var t=e.node_list,n=e.entities,r=t[0];return n.nodes[r]}catch(e){console.error("transform creata api data error",e)}return e}var c=function e(t,n){var c=this;(0,o.Z)(this,e),this._token=t,this._requestProvider=n,this._requestSource=null,this.destroy=function(){c._requestSource&&c._requestSource.cancel()},this.createSpreadsheet=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=(0,s.ivc)(JSON.stringify(t)),i=(0,s.ivc)(JSON.stringify(n));return c.createSpreadSheetRequest(e,r,o,i).then((function(e){if(!e.code)return e.data.token;throw new Error("创建 spreadsheet 出错")})).catch((function(e){var t={};return t.msg=e.msg,t.code=e.code,t.data=e.data,Promise.reject(t)}))},this.createSheetWithSnapshotV3=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return c.createSpreadSheetRequestV3(e,t,n).then((function(e){var t;if(!e.code)return null===(t=u(e.data))||void 0===t?void 0:t.obj_token;throw new Error("创建 spreadsheet 出错")})).catch((function(e){var t={};return t.msg=e.msg,t.code=e.code,t.data=e.data,Promise.reject(t)}))},this.createSpreadSheetRequest=function(e,t,n,o){var i={title:e,snapshot:n,src_token:c._token,block_infos:o};t&&(i.replace_tags="image");var s=c._requestProvider.postRequest(c._requestProvider.apiUrls.POST_CREATE_SPREADSHEET,(0,a.stringify)(i),{headers:(0,r.Z)({"Content-Type":"application/x-www-form-urlencoded"},l.OrD,l.GH1),baseURL:c._requestProvider.prependAPI("/")});return c._requestSource=s.source,s.promise},this.createSpreadSheetRequestV3=function(e,t,n){var o={type:i.NUM_FILE_TYPE.SHEET,name:e,content:t,ext_info:JSON.stringify({schema_version:"9"})},s=c._requestProvider.postRequest(c._requestProvider.apiUrls.POST_CREATE_FILE_V2,(0,a.stringify)(o),{headers:(0,r.Z)({"Content-Type":"application/x-www-form-urlencoded"},l.OrD,l.GH1),baseURL:c._requestProvider.prependAPI("/")});return c._requestSource=s.source,s.promise}}},vsh_94920:function(e,t,n){n.d(t,{X:function(){return I}});var r=n("vsh_74561"),o=n("vsh_67017"),i=n.n(o),a=n("vsh_35067"),s=n("vsh_19264"),l=n("vsh_4175"),u=n("vsh_47253"),c=n("vsh_21469"),h=n("vsh_29033"),d=n("vsh_24627"),f=n("vsh_72834"),v=n("vsh_74340"),p=n("vsh_82905"),g=n("vsh_7959"),m=n("vsh_25469"),_=n("vsh_35911"),y=n("vsh_87882"),C=n("vsh_24325"),S=n("vsh_43247"),k=n("vsh_72210"),E=n("vsh_73043"),T="sheet_opration",b=0,I=function(){function e(t,n){var r=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},l=arguments.length>3?arguments[3]:void 0,h=arguments.length>4?arguments[4]:void 0,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},m=arguments.length>6?arguments[6]:void 0;(0,s.Z)(this,e),this.getColorByMember=m,this.showTemplate=!1,this.hasInitializeLoadedStatus=!1,this.recoverRefreshTimes=0,this.subscriber=null,this.pluginEventSubscription=null,this.serviceEventSubscription=null,this.handleCursorChange=(0,u.default)((function(){if(d.Ps3.opendoc.showCollaborators()){var e=r._context.getAllMembers();if(e){var t=r.cursorsSelector(e);r._sdk.shellForEach((function(e){e.sheetView().updateDistrictCursor(t)}))}}}),800),this._editable=!1,this._destroyed=!1,this.bindCollaborativeContextEvents=function(){var e=r._context;r.unbindCollaborativeContextEvents(),r.getContextBindList().map((function(t){e&&e.bind(t.key,t.handler)}))},this.unbindCollaborativeContextEvents=function(){var e=r._context;r.getContextBindList().map((function(t){e&&e.unbind(t.key,t.handler)}))},this.onRecover=function(e){e&&(e.changesets&&r.applyChangesets(e.changesets,!0),r.setEditable(r._editable))},this.applyChangesets=function(e,t){var n=r._spread;if(e&&e.length>0){var o=e.some((function(e){return e.content.some((function(e){return e.action===d.aOo.RECOVER}))}));if((!r.context.isEmbed()||r.context.getHistoryType()!==d.Z3k.DOC_MIXED)&&o&&r.recoverRefreshTimes<10)return r.recoverRefreshTimes++,r.setEditable(!1),void setTimeout((function(){r.resetState(),r.switch()}),500);r.recoverRefreshTimes>=10&&d.Ps3.moirae.teaLog({key:"client_sheet_fetch_recover_history_fail"}),o?r.showServerErrorModal({code:d.D1r.ERR_CLIENTVARS_INVALID,reason:"recover action reload over times"},"collaborative_spread"):e.forEach((function(e){var r=e.content||[];n.applyActions(r,!1,t)}))}},this.bindEvents=function(){r.unbindEvents();var e=r._spread;e&&(r.subscriber=e.subscribe(r.getDepends()),r.suspendCalcService(e),r.stopUseFuncCache(e))},this.unbindEvents=function(){r._spread&&(r.subscriber&&r.subscriber.unsubscribe(),r.subscriber=null)},this._onInvalid=function(e){var t=e.invalidType,n=e.message,o=void 0===n?"":n;if(void 0!==t)if(console.trace("InvalidType: ".concat(t," - msg: ").concat(o)),t===d.TiA.copyPaste)d.Ps3.Toast.show({key:"INVALID_OPRERATION",type:"error",content:"".concat(o),duration:3e3,closable:!1});else switch(t){case d.TiA.exportFile:d.Ps3.Toast.show({key:"INVALID_OPRERATION",type:"error",content:"".concat(o),duration:3e3,closable:!1});break;case d.TiA.dragFill:r.showModal({title:E("common.prompt"),body:E("sheet.fill_no_merge"),confirmText:E("common.confirm"),cancelText:!1});break;case d.TiA.editProtectedRange:r.showError(d.ZB9.ERROR_EDIT_PROTECTED_RANGE,void 0,o),d.Ps3.collectSuiteEvent(T,{action:"protect_range_remind"});break;case d.TiA.cellLimitExceed:r.showServerErrorModal({code:d.D1r.ERROR_MAX_CELL_LIMIT_OPERATION},"collaborative_spread");break;case d.TiA.coverPivot:r.showModal({title:E("common.prompt"),body:E("CreationDoc_Sheets_PivotTable_Failed_CanNotReplace"),confirmText:E("common.confirm"),cancelText:!1});break;case d.TiA.changeOutlineGroupOnProtectedRange:r.showModal({title:E("common.prompt"),body:E("LarkCCM_Sheets_Group_GroupContainsProtectionRanges_Description"),confirmText:E("common.confirm"),cancelText:!1});break;case d.TiA.editConnectorSheet:r.showError(d.ZB9.ERROR_EDIT_CONNECTOR_SHEET)}},this.handleErrorRecordServiceException=function(){var e=(0,a.Z)(i().mark((function e(t){var n,o,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=t.code,a=t.data,r.logMessage("handleErrorRecordServiceException code:".concat(o)),e.t0=o,e.next=e.t0===p.jK.ERR_OLD_VERSION?5:e.t0===p.jK.ERR_CLIENT_FOLLOW_REJECT||e.t0===p.jK.ERR_SERVER_REJECT_COMMIT||e.t0===p.jK.ERR_SERVER_RECOVER?8:e.t0===p.jK.ERR_SERVER_CONTENT_RESPONSE_ERROR||e.t0===p.jK.ERR_SERVER_RETRY_FAILED?10:e.t0===d.D1r.STOP_WRITE_FOR_MIGRATE?13:e.t0===d.D1r.ERR_BACKUP_INCONSISTENT||e.t0===d.D1r.ERR_FETCH_CLIENTVARS?14:17;break;case 5:return r.setSpreadSheetHalt(),r.onConflict(a.rejectType),e.abrupt("return");case 8:return r.onConflict(a.rejectType),e.abrupt("return");case 10:return e.next=12,r.onServerResponseError(t);case 12:case 13:return e.abrupt("return");case 14:if(!r.context.isEmbed()){e.next=16;break}return e.abrupt("return");case 16:return e.abrupt("break",17);case 17:return r.endEditWhenException({code:o,command:null==a?void 0:a.command}),e.next=20,r.checkAndProcessAbortLocalBackupDataError(o,!0);case 20:return e.next=22,r.checkAndProcessUnRecoverableError(o,!0);case 22:null===(n=r.sdk.getPlugin(y.T))||void 0===n||n.noticeError(t);case 23:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.endEditWhenException=function(e){var t=r._spread.getActiveSheet(),n=r.sdk.getPlugin("CellEditorPlugin");null==n||n.endEdit({sheet:t,ignoreValueChange:e.code===d.D1r.ERROR_CMD_EX&&e.command===d.rvF.EDIT_CELL})},this.handleNewChanges=function(){r.setIsShowTemplate(!1)},this.onError=function(){var e=(0,a.Z)(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.onServerResponseError=function(){var e=(0,a.Z)(i().mark((function e(t){var n,o,a,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=t.code,a=t.data,s=String(a.code),r.logMessage("onServerResponseError code: ".concat(o," innerCode:").concat(s),a),s!==p.jK.ERR_OLD_VERSION){e.next=7;break}return r.onConflict(d.KNj.TOO_OLD_REV),e.abrupt("return");case 7:if(s!==d.D1r.ERR_LOCK_FAILED||a.from!==d.f9g.SEND_USER_CS&&a.from!==d.f9g.IO_MESSAGE){e.next=9;break}return e.abrupt("return",r.setSpreadSheetHalt());case 9:if(s!==p.jK.ERR_LOCK_FAILED_FOR_CACHE_CALC){e.next=11;break}return e.abrupt("return");case 11:if(!(0,d.nS0)(s)){e.next=14;break}return d.Ps3.moirae.teaLog({key:"client_sheet_permission_error",code:s,handle_type:"reload"}),e.abrupt("return",location.reload());case 14:return e.next=16,r.checkAndProcessAbortLocalBackupDataError(s,!1);case 16:return e.next=18,r.checkAndProcessUnRecoverableError(s,!1);case 18:null===(n=r.sdk.getPlugin(y.T))||void 0===n||n.noticeError(t);case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.setIsShowTemplate=function(e){r.showTemplate=e},this.getIsShowTemplate=function(){return r.showTemplate},this.addLocalRecord=(0,a.Z)(i().mark((function e(){var t,n,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={timestamp:Date.now(),baseRev:-1,actions:"",version:d.Da0.V1},r.logMessage("addLocalRecord start timestamp ".concat(t.timestamp)),e.prev=2,e.next=5,r._backup.getBackupActions();case 5:return o=e.sent,r.logMessage("addLocalRecord has actions: ".concat(!!o,", current rev:").concat(null===(n=r._engine)||void 0===n?void 0:n.getBaseRev())),t.actions=(0,d.ivc)(JSON.stringify(o)),e.next=10,r._backup.addLocalRecord(t);case 10:return r.logMessage("addLocalRecord success timestamp: ".concat(t.timestamp)),e.abrupt("return",!0);case 14:return e.prev=14,e.t0=e.catch(2),d.Ps3.moirae.ravenCatch(e.t0),r.logMessage("addLocalRecord failed timestamp: ".concat(t.timestamp)),e.abrupt("return",!1);case 19:case"end":return e.stop()}}),e,null,[[2,14]])}))),this.doKeydown=function(e){},this.switch=(0,a.Z)(i().mark((function e(){var t,n,o,a=arguments;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=a.length>0&&void 0!==a[0]?a[0]:{},o=a.length>1?a[1]:void 0,console.info("[SHEET LOG] collaborativeSpread switch, openType: ".concat(JSON.stringify(n))),null===(t=r.sdk.getPlugin("DataLoaderPlugin"))||void 0===t||t.startLoad(n,o);case 4:case"end":return e.stop()}}),e)}))),this.createSpreadsheet=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return r._collaSpreadCreator.createSpreadsheet(e,t,n,o)},this.createSheetWithSnapshotV3=function(e,t,n){return r._collaSpreadCreator.createSheetWithSnapshotV3(e,t,n)},this.applyActions=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=r._spread;o.applyActions(e,t,n)},this.setEditable=function(e){var t;r._editable=e,r._spread&&(r.setSpreadEdit(r.sdk,e),null===(t=r.sdk.getPlugin(C.Wc))||void 0===t||t.setEditable(e))},this.waitForSpreadLoaded=function(){var e;return null===(e=r.sdk.getPlugin("DataLoaderPlugin"))||void 0===e?void 0:e.waitForSpreadLoaded()},this.waitForSheetLoaded=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return null===(t=r.sdk.getPlugin("DataLoaderPlugin"))||void 0===t?void 0:t.waitForSheetLoaded(e,n)},this.loadedSheetByNotice=function(e){var t;return null===(t=r.sdk.getPlugin("DataLoaderPlugin"))||void 0===t?void 0:t.loadSheets([e])},this.onReceiveRecoverPreproccess=function(){var e=(0,a.Z)(i().mark((function e(t){var n,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r._backup.getBackupItem(v.ysr.Actions);case 2:return n=e.sent,e.next=5,r._backup.getBackupItem(v.ysr.Submit);case 5:o=e.sent,n||o?(console.info("Sheet log colla_spread receive recover action with localActions: ".concat(!!n," submittingCs: ").concat(!!o)),r.sdk.getService(p.Tl).record(p.FP.Module,p.NI.ClientError,p.jK.ERR_SERVER_RECOVER,{rejectType:d.KNj.RECOVER_CONFLICT})):(r._context.trigger(v.YVA.RECEIVE_RECOVER,t),r.sdk.getService(v.qif).pushNewState({type:v.pb3.NEW_CHANGES}));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.onClientVarsRefetch=function(){r.resetState()},this.getContextBindList=(0,c.Z)((function(){var e=[{key:v.YVA.RECOVER_SPREAD,handler:r.onRecover},{key:v.YVA.ERROR,handler:r.onError},{key:v.YVA.CONFLICT_HANDLE,handler:r.reload},{key:v.YVA.MEMBER_CURSOR_CHANGED,handler:r.handleCursorChange}];return r._context.isEmbed()||(e=e.concat([{key:v.YVA.APPLY_ACTIONS,handler:r.applyActions}])),e.forEach((function(e){e.handler=e.handler.bind(r)})),e})),d.Ps3.moirae.suspend(),this.store=o.store,this._spreadOptions=o,this._context=new v.DW6(t,"main"),this._context.setEmbed(n),this._requestProvider=l,this._collaSpreadCreator=new S.P(t,this._requestProvider),this._sdk=(0,k.u)(this._spreadOptions,this._context),this._spread=this._sdk.spread,this._spread._context=this._context,this.initPluginService(t,g),this._backup=this.sdk.getService(v.AKO),this._sync=this.sdk.getService(v.ClJ),this._engine=this.sdk.getService(v.AHm),(0,f.oLG)(this._spread),this._statusCollector=h,this._statusCollector.setSdk(this._sdk),this.bindServiceEvents(),this.bindPluginEvents(),this.bindCollaborativeContextEvents(),this.bindEvents();var _=window;_.Spread={},_.Spread.collaSpread=this,_.Spread.spread=this._spread,_.Spread.sync=this._sync,_.Spread.engine=this._engine,_.Spread.context=this._context,_.Spread.backup=this._backup,_.spread=_.Spread.spread,b+=1,(0,d.fs4)(this._spread),this._id="Colla_".concat(b),console.log("Create CollaSpread",this._id)}var t,n;return(0,l.Z)(e,[{key:"cursorsSelector",value:function(e){var t=(0,g.MWT)(),n=t.length,r=this._context.isEmbed(),o=d.Ps3.getColorByUserId,i=function(e){return t[e.color_id%n]};return r&&o&&(i=this.getColorByMember||function(e){return o(e.user_id)}),e.filter((function(e){return e.cursor_info&&void 0!==e.cursor_info.sheet_id})).map((function(e){return Object.assign({},e,{color:i(e)})}))}},{key:"bindServiceEvents",value:function(){var e,t,n,r,o=this;[this.sdk.getService(p.Tl).subscribeError(this.handleErrorRecordServiceException),this.sdk.getService(v.ClJ).subscribeEvent(v.vbU.RECOVER_PROCESS,this.onReceiveRecoverPreproccess),null===(e=this._engine)||void 0===e||null===(t=e.subscribeEvent)||void 0===t?void 0:t.call(e,v.NLr.NEW_CHANGES,this.handleNewChanges),null===(n=this._engine)||void 0===n||null===(r=n.subscribeEvent)||void 0===r?void 0:r.call(n,v.NLr.COLLECT_USER_CHANGES,this.handleNewChanges)].forEach((function(e){!o.serviceEventSubscription&&e?o.serviceEventSubscription=e:o.serviceEventSubscription&&o.serviceEventSubscription.add(e)}))}},{key:"unbindServiceEvents",value:function(){var e;null===(e=this.serviceEventSubscription)||void 0===e||e.unsubscribe(),this.serviceEventSubscription=null}},{key:"collectCpuPerformance",value:function(){this.sdk.getService(v.GbX).calcCpuPerformance().then((function(e){d.Ps3.setCpuPerformance(e)}))}},{key:"onInitializeCollectData",value:function(){var e=this._spread,t=e.getCalcEngine();this.isSheetRoute()&&d.Ps3.collectLoadPerformance.collectData(e,"client_performance_loadall");var n=t.compiler;if(null!=n){var r=n.getPerformanceData();null!=r&&d.Ps3.moirae.teaLog({key:"client_sheet_formula_compile",time_cost:r.timeCost,formula_count:r.formulaCount,lexical_analysis:r[f.DmQ.LexicalAnalysis],syntax_analysis:r[f.DmQ.SyntaxAnalysis],semantic_analysis:r[f.DmQ.SemanticAnalysis]}),n.stopCollectPerformance()}var o=t.getFuncStatistics();null!=o&&o.forEach((function(e,t,n){e>0&&d.Ps3.moirae.teaLog({key:"client_sheet_formulas",formula_name:t,usage_count:e})}))}},{key:"getDepends",value:function(){var e;return e={},(0,r.Z)(e,d.HaZ.SpreadError,this.onSpreadError.bind(this)),(0,r.Z)(e,d.U_F.InvalidOperation,this._onInvalid.bind(this)),e}},{key:"onSpreadError",value:function(e){var t=e.type,n=e.context;t===f.GI0.CommandError&&this.sdk.getService(p.Tl).record(p.FP.Core,p.NI.ClientError,n.code,n)}},{key:"suspendCalcService",value:function(e){"true"===(0,d.eYO)("no_calc")&&e.getCalcEngine().formulaService.suspend()}},{key:"stopUseFuncCache",value:function(e){"true"===(0,d.eYO)("no_formula_func_cache")&&e.getCalcEngine().formulaService.getFuncCacheManager().stopUseCache()}},{key:"checkAndProcessAbortLocalBackupDataError",value:(n=(0,a.Z)(i().mark((function e(t,n){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,d.jzH)(t)&&!(0,d.AED)(t)){e.next=5;break}return this.logMessage("checkAndProcessAbortLocalBackupDataError code:".concat(t," isLocal:").concat(n)),e.next=4,this.addLocalRecord();case 4:this._backup.clearBackup();case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"checkAndProcessUnRecoverableError",value:(t=(0,a.Z)(i().mark((function e(t,n){var r,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,d.e$B)(t)){e.next=9;break}if(this.logMessage("checkAndProcessUnRecoverableError code:".concat(t," isLocal:").concat(n)),this.setSpreadSheetHalt(),r=window,!(o=r.sTool)){e.next=7;break}return e.next=7,o.check();case 7:d.Ps3.moirae.teaLog({key:"client_sheet_uncatch_error_tracker_dev",error_message:"".concat(t)}),this.destroy(!0);case 9:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"logMessage",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];(t=this.sdk.getService(p.QX)).log.apply(t,["CollaborativeSpread",e].concat(r))}},{key:"lazyBindShell",value:function(){var e=this;if(this.loadableShell)return this.loadableShell;var t=new Promise((function(t){e.shell?t(e.shell):e.loadShellResolve=t}));return this.loadableShell=t,this.loadableShell}},{key:"destroy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this._destroyed&&(this.logMessage("call destroy inError:".concat(e)),d.Ps3.moirae.resume(),d.PxA.destroy(),this.sdk.unregisterPlugin(m.He),this.unbindEvents(),this.unbindCollaborativeContextEvents(),this.unbindServiceEvents(),this.unbindPluginEvents(),this._statusCollector.destroy(),this._context.removeAllEventHandlers(),d.Hg0.destroy(),v.Q50.destroy(),this._statusCollector=null,this._engine=null,this._sync=null,this._shell=null,this._backup=null,this._destroyed=!0,!e)){this._sdk.destroy(),this._context.removeAllEventHandlers(),this._collaSpreadCreator.destroy(),this._sdk=null,this._spread=null,this._context=null,this._collaSpreadCreator=null;var t=window;t.Spread&&t.Spread.collaSpread===this&&(t.Spread.collaSpread=null,t.Spread.spread=null,t.Spread.sync=null,t.Spread.engine=null,t.Spread.backup=null,t.Spread.context=null,t.Spread.shell=null,t.Spread=null,t.spread=null,(0,d.nVX)()),this.getContextBindList.cache.clear&&this.getContextBindList.cache.clear(),console.log("Destroy CollaSpread",this._id)}}},{key:"getActiveSheet",value:function(){return this._spread.getActiveSheet()}},{key:"bindPluginEvents",value:function(){this.bindDataLoaderPluginEvents()}},{key:"unbindPluginEvents",value:function(){this.pluginEventSubscription&&this.pluginEventSubscription.unsubscribe(),this.pluginEventSubscription=null}},{key:"bindDataLoaderPluginEvents",value:function(){var e;this.pluginEventSubscription=this.sdk.subscribePluginEventMap((e={},(0,r.Z)(e,"LoadStatusStore/ClientVarsMessageValid",this.onClientVarsMessageValid.bind(this)),(0,r.Z)(e,"LoadStatusStore/ClientVarsMessageInvalid",this.onClientVarsMessageInValid.bind(this)),(0,r.Z)(e,"LoadStatusStore/ClientVarsFetchFailed",this.onClientVarsFetchFailed.bind(this)),(0,r.Z)(e,"LoadStatusStore/ClientVarsLoaded",this.onClientVarsLoaded.bind(this)),(0,r.Z)(e,"LoadStatusStore/ContentMetaApply",this.onContentMetaDataApply.bind(this)),(0,r.Z)(e,"LoadStatusStore/SheetToUsage",this.onSheetToUsage.bind(this)),(0,r.Z)(e,"LoadStatusStore/SpreadLoaded",this.onSpreadLoaded.bind(this)),(0,r.Z)(e,"LoadStatusStore/WorksheetLoaded",this.onWorksheetLoaded.bind(this)),(0,r.Z)(e,"LoadStatusStore/FirstActiveSheetLoaded",this.onFirstActiveSheetLoaded.bind(this)),(0,r.Z)(e,"LoadStatusStore/SplitDataFetchStart",this.onSplitDataFetchStart.bind(this)),(0,r.Z)(e,"LoadStatusStore/ReloadStart",this.onClientVarsRefetch.bind(this)),e))}},{key:"initISVRelationSheet",value:function(e){if(e&&e.link_ISV_sheets){var t=this._spread.getISVRelationshipManager();t&&t.initISVRelationshipMap(e.link_ISV_sheets)}}},{key:"onSheetToUsage",value:function(e,t){var n=this;if(Promise.resolve().then((function(){d.Ps3.moirae.resume(),n.collectCpuPerformance()})),!t)return this.loadedInitialized(e),void this.sdk.getService(v.FIP).init()}},{key:"onSpreadLoaded",value:function(e){console.log("[sheet] collasSpread onSpreadLoaded"),this.loadedInitialized(e),this.onInitializeCollectData()}},{key:"onWorksheetLoaded",value:function(e,t){}},{key:"onFirstActiveSheetLoaded",value:function(e){}},{key:"onSplitDataFetchStart",value:function(){}},{key:"loadedInitialized",value:function(e){var t=this._spread;this.hasInitializeLoadedStatus||(this.hasInitializeLoadedStatus=!0,d.PxA.setSpread(t),d.QYs.setSpread(t),d.Ps3.performanceStageCollector.updateStage(d.Ps3.sheetRenderStage.FIRST_SHEET_LOADED,d.Ck$),this.initISVRelationSheet(e),v.Q50.init())}},{key:"onConflict",value:function(e){d.Ps3.moirae.teaLog({key:"client_sheet_edit_conflict",is_old_version:Number(Boolean(e===d.KNj.TOO_OLD_REV)),rejectType:e})}},{key:"reload",value:function(e){var t,n;null===(t=this.sdk)||void 0===t||null===(n=t.getPlugin(_.IE))||void 0===n||n.reload(e)}},{key:"resetState",value:function(){this.hasInitializeLoadedStatus=!1}},{key:"onClientVarsMessageValid",value:function(e){}},{key:"onClientVarsMessageInValid",value:function(e){}},{key:"onClientVarsFetchFailed",value:function(e,t,n,r){}},{key:"onClientVarsLoaded",value:function(e,t){this.setIsShowTemplate(!(!e||!e.show_template))}},{key:"onContentMetaDataApply",value:function(e){this.isSheetRoute()&&(d.Ps3.collectLoadPerformance.setBlockCount(e.snapshot),d.Ps3.collectLoadPerformance.collectData(this._spread,"client_performance_firstscreen"))}},{key:"sdk",get:function(){return this._sdk}},{key:"shell",get:function(){return this._shell},set:function(e){this._shell=e,this.loadShellResolve&&this.loadShellResolve(e),this.loadShellResolve=null,!(0,h.default)(window)&&window.Spread&&(window.Spread.shell=e)}},{key:"editable",get:function(){return this._editable}},{key:"destroyed",get:function(){return this._destroyed}},{key:"spread",get:function(){return this._spread}},{key:"context",get:function(){return this._context}},{key:"sync",get:function(){return this._sync}},{key:"spreadLoaded",get:function(){var e;return!(null===(e=this.sdk.getPlugin("DataLoaderPlugin"))||void 0===e||!e.isSpreadLoaded())}},{key:"engine",get:function(){return this._engine}},{key:"backup",get:function(){return this._backup}}]),e}()},vsh_72210:function(e,t,n){n.d(t,{u:function(){return l}});var r=n("vsh_24627"),o=n("vsh_21955"),i=n("vsh_82905"),a=n("vsh_86217"),s=n("vsh_73043");function l(e,t){var n=new o.EZ(e,t);n.getService(i.Jv).setTFunc(s);var l=n.getService(i.zv);return l.setReporter({teaLog:function(e){r.Ps3.collectSuiteEvent(e.key,e)},suspend:r.Ps3.moirae.suspend,resume:r.Ps3.moirae.resume,ravenCatch:r.Ps3.moirae.ravenCatch}),l.addReportTemplate(a.n.SheetPathTracker,(0,a.b)()),n}},vsh_15657:function(e,t,n){n.d(t,{lO:function(){return H},CN:function(){return B},WH:function(){return G},If:function(){return de},KD:function(){return j},O$:function(){return he},r4:function(){return ce},s2:function(){return X}});var r,o=n("vsh_98652"),i=n("vsh_71484"),a=n("vsh_22023"),s=n("vsh_26171"),l=n("vsh_45768"),u=n("vsh_57524"),c=n.n(u),h=n("vsh_24627"),d=n("vsh_40285"),f=n("vsh_60505"),v=n("vsh_69691"),p="https?|s?ftp|ftps|nfs|ssh",g="\\b([/#?][\\-A-Z0-9@:%_+.~#?&/=;$,!\\*\\[\\]\\(\\){}^|<>]*[-A-Z0-9&@#/%=~\\(\\)_|]?)?",m=new RegExp("((((".concat(p,")://)?(").concat(/localhost(:[0-9]{2,5})?/.source,"))|(((").concat(p,")://)(").concat(/(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}(2[0-4][0-9]|25[0-5]|1[0-9]{2}|[1-9][0-9]|[0-9])(:[0-9]{2,5})?/.source,")))").concat(g),"gi"),_="([-A-Z0-9%_+~#@][\\-A-Z:0-9%_+~#@]{0,256}\\.){1,50}",y="[a-z\\-]{2,15}",C=new RegExp("(((".concat(p,"):\\/\\/").concat(_).concat(y,")|(").concat(_,"(").concat("com|cn|tk|de|net|org|uk|info|nl|ru|hk|mx|br|my|co|pk|pe|sg|tr|au|nz|sa|pt|pl|id|ve|ph|in|qa|py|ar|bd|cy|sv|jo|kw|fj|vn|uy|ua|ec|bh|gt|eg|mt|ai",")))(:[0-9]{2,5})?").concat(g),"gi"),S=(new RegExp("^s*((".concat("https?","):\\/\\/").concat(_).concat(y,")(:[0-9]{2,5})?").concat(g,"s*$"),"i"),"[\\w.!#$%&'*+-/=?^_\\`{|}~]{1,2000}@[A-Za-z0-9_.-]+\\."),k=new RegExp("^(?!data:)((mailto:".concat(S).concat(y,")|(").concat(S,"(").concat("com|org|net|int|edu|gov|mil|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cw|cx|cy|cz|de|dj|dk|dm|do|dz|ec|ee|eg|eh|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gh|gi|gl|gm|gn|gp|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mf|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|ss|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|um|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|za|zm|zw|site|top|wtf|xxx|xyz|cloud|engineering|help|one",")))\\b"),"gi"),E=new RegExp("(".concat(m.source,")|(").concat(C.source,")|(").concat(k.source,")"),"gi"),T=n("vsh_20770"),b=n("vsh_11725"),I="".concat(void 0);!function(e){e.BOLD="bold",e.ITALIC="italic",e.UNDERLINE="underline",e.STRIKETHROUGH="strikethrough",e.TEXT_COLOR="textcolor",e.FONT_SIZE="fontsize",e.FONT_FAMILY="fontfamily"}(r||(r={}));var R=[r.BOLD,r.ITALIC,r.UNDERLINE,r.STRIKETHROUGH,r.TEXT_COLOR,r.FONT_SIZE,r.FONT_FAMILY],w="mention",A="url",F="text",D="pano",N="attachment",P="at-user-block",O="mention-link",M="mention-type",L="mention-token",x="mention-notify",V="mention-icon-info",Z="hyperlink_cellPosition",B="clientside-dataMetaBlockProps",H="dataMetaBlockProps";function U(e){return[[(t=e.depLoading,t?B:H),JSON.stringify(e)]];var t}function j(e){var t={},n=[],r=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{fileTokenSuiteMap:{},userIds:[]};return Q(arguments.length>1?arguments[1]:void 0,e)}({linkReg:E,fileTokenSuiteMap:t,userIds:n},e);if(r.length>0){var i=r[r.length-1];if("text"===i.type){var a=i.text||"";a&&"\n"!==a||r.pop(),a.endsWith("\n")&&(i.text=a.replace(/\u000A/g,""))}}return{segmentArray:r,fileTokenSuiteMap:t,userIds:(0,o.Z)(new Set(n))}}function G(e,t){return Array.isArray(t)?t.map((function(e){if(e.category===P||(0,h.tMY)(e)){var t=h.kHU.AT_USER_BLOCK,n=(0,b._s)({blockType:t,props:{data:{mentionNotify:e.mentionNotify,user:{avatar_url:e.link,cn_name:e.name,en_name:e.en_name,id:e.token,name:e.name||e.text.replace(/^@/,""),larkNotify:e.mentionNotify,mentionId:e.mentionId,not_notify:e.not_notify,block_notify:e.block_notify,is_external:e.is_external}}}});e.text=" ",e.attributes=U(n)}else if(e.type===w){var r=e.token,o=e.mentionType,i=e.link,a=e.mentionNotify,s=e.iconInfo;e.attributes=[[w,!0],["".concat(L,"_").concat(r),!0],["".concat(M,"_").concat(String(o)),!0],["".concat(O,"_").concat(i),!0],[x,a]],s&&e.attributes.push([V,s])}else if(e.type===D){var l=h.kHU.LINK_BLOCK,u=(0,b._s)({blockType:l,props:{data:{entityId:e.entityId,linkProvider:"pano",linkType:h.$om.record,title:e.text,url:e.link}}});e.text=" ",e.type="mention",e.attributes=U(u)}else if(e.type===N){var c=(0,b._s)({blockType:h.kHU.FILE_CARD_BLOCK,props:{version:2,displayMode:h.X71.INLINE,viewType:h.cOW.INLINE,data:{fileInfo:{type:(0,v.getFileExt)(e.text),actualType:e.mimeType,driveKey:e.fileToken,name:e.text,size:e.size,useDriveStorage:!0,uploadOwner:(0,b.ei)()}}}});e.text=" ",e.attributes=U(c)}return e})):t}var K=/url-/,W=/cellPosition/,z="mention-link",Y="mention-type",J="mention-token",q="mention-notify",$="mention-icon-info";function X(e){for(var t=[],n=0;n<e.length;n++){var r=e[n],o=r.attributes&&ue(r.attributes)||{};if(r.style)for(var i=0;i<R.length;i++){var a=R[i],s=r.style[a];["textcolor","fontsize","fontfamily"].includes(a)?s&&(o[a]=s):"true"===s&&(o[a]="true")}switch(r.type){case F:t.push(fe({insert:r.text,attributes:o}));continue;case A:var l="url-".concat((0,v.generateRandomString)(10));if(r.cellPosition?(o[Z]=JSON.stringify(r.cellPosition),o[l]=(0,v.completeURLProtocol)(de(r.cellPosition))):o[l]=(0,v.completeURLProtocol)(r.link||r.text),r.texts&&r.texts.length>0)for(var u=0;u<r.texts.length;u++){var c=r.texts[u],h=Object.assign({},o);if(c.style)for(var f=0;f<R.length;f++){var p=R[f],g=c.style[p];["textcolor","fontsize","fontfamily"].includes(p)?null!=g&&(h[p]=g):"true"===g?h[p]="true":delete h[p]}t.push(fe({insert:c.text,attributes:h}))}else t.push(fe({insert:r.text,attributes:o}));continue;case w:o["mention-uuid_".concat((0,b.Wb)())]="true";case N:Object.assign(o,ue(r.attributes)),t.push(fe({insert:r.text,attributes:o}));continue}}return new d.I({ops:t})}function Q(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{fileTokenSuiteMap:{},userIds:[]},n=e.getContentState(),r=[],o=n.getActiveZone(),i=o.length(),a=t.linkReg||E,s="",l=[],u=0;u<i;u++){var c=o.getLine(u);if(c){for(var d=c.getOps(),f=d.length,p=0;p<f;p++){var g=d[p],m=g.attributes||{},_=g.insert||"",y=ae(m),C={type:y,text:_};if(null==m.lmkr){var S=ne(m);if(Object.keys(S).length&&Object.assign(C,{style:S}),y===F){var k=re(s,_,t.linkReg);if(k.length){l.push(C),(0,h.hTd)(r,oe(k,l)),l=[],s="";continue}}switch(y){case w:var T=se(m),I=T[Y],R=T[J],D=T[z],N=T[q],P=T[$],O=null===N||"true"===N;0!==l.length&&((0,h.hTd)(r,l),s="",l=[]),r.push(Object.assign({},C,{text:_,type:y,mentionType:parseInt(I,10),mentionNotify:O,token:R,link:D,iconInfo:P}));continue;case A:if(0!==l.length&&((0,h.hTd)(r,l),s="",l=[]),p>=1){var M=r.length>0?r[r.length-1]:null,L=d[p-1],x=ee(M,L,C,m);if(x)continue}if("true"!==m.removeLink&&a.test(_)&&1===re(_,"").length){r.push(Object.assign({},C,{text:_,type:y,style:S,link:(0,v.completeURLProtocol)(_)}));continue}var V=ie(m),Z=V.link,B=V.cellPosition;m.removeLink?r.push({type:F,text:_,style:S}):r.push(Object.assign({},C,{text:_,type:y,style:S,link:B?"":Z?(0,v.completeURLProtocol)(Z):"",cellPosition:B||null}));continue}(0,b.zz)(m)&&(0!==l.length&&((0,h.hTd)(r,l),s="",l=[]),Object.assign(C,te(m,e,t))),C.type===F?(l.push(C),s+=C.text):r.push(C)}}0!==l.length&&((0,h.hTd)(r,l),s="",l=[])}}return r}function ee(e,t,n,r){var o=!1;if(e&&e.type===A)for(var i=t.attributes||{},a=Object.keys(i),s=0;s<a.length;s++){var l=a[s];if(K.test(l)&&i[l]===r[l]){o=!0,e.texts=e.texts||[],0===e.texts.length?(e.texts=[{type:F,text:e.text,style:e.style},{type:F,text:n.text,style:n.style}],delete e.style):e.texts.push({type:F,text:n.text,style:n.style}),e.text+=n.text;break}}return o}function te(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{fileTokenSuiteMap:{},userIds:[]},a={type:"text"},s=t.callAll("collectText",{attributes:le(e)});s&&s.length&&(a.text=(0,i.Z)(s));var l=(0,b.ro)(e);if(null!=l&&null!==(n=l.props)&&void 0!==n&&n.data)if(l.blockType===h.kHU.AT_USER_BLOCK){var u=l.props.data,c=u.user,d=u.mentionNotify;if(c&&(a.name=c.name||c.cn_name,a.en_name=c.en_name,a.name&&(a.text="@".concat(a.name)),a.category=P,a.type=w,a.mentionType=T.wy.USER,a.token=c.id,c.avatar_url&&(a.link=decodeURIComponent(c.avatar_url)),a.mentionNotify=d,a.mentionId=c.mentionId,a.not_notify=c.not_notify,a.is_external=c.is_external,a.block_notify=c.block_notify,l.props.fromCopy&&(!a.link||!a.en_name))){var f=r.userIds;f.push(c.id)}}else if(l.blockType===h.kHU.LINK_BLOCK){var v=l.props.data,p=v.url,g=v.title,m=v.entityId;a.type=D,a.link=p,a.text=g,a.entityId=m}else if(l.blockType===h.kHU.FILE_CARD_BLOCK){var _=l.props,y=_.data,C=_.fromCopy,S=_.suitToken,k=y.fileInfo;if(k&&(a.text=k.name,a.mimeType=k.actualType,a.size=k.size,a.fileToken=k.driveKey,a.type="attachment",C)){var E=r.fileTokenSuiteMap;E[S]=E[S]?[].concat((0,o.Z)(E[S]),[k.driveKey]):[k.driveKey]}}return a}function ne(e){var t={};return R.forEach((function(n){var o=e[n],i=n===r.TEXT_COLOR&&o===I?void 0:o;t[n]=i||""})),t}function re(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:E,o=A,i=F,a=e+t,l=a.length;r.lastIndex=0;for(var u=[];n=r.exec(a);){var c=n[0],h=n.index;u.push({startIndex:h,endIndex:h+c.length,text:c})}var d=[];if(u.length){u.unshift({startIndex:0,endIndex:0});var f=(0,s.Z)(u.slice(1),(function(e,t){var n=e.endIndex,r=t.startIndex,s=t.endIndex,l=a.slice(n,r);l&&d.push({text:l,type:i});var u=a.slice(r,s),c=ve(u);return d.push({text:u,type:o,link:c?"":(0,v.completeURLProtocol)(u),cellPosition:c}),t}),u[0]);f.endIndex<l&&d.push({text:a.slice(f.endIndex,l),type:i})}return d}function oe(e,t){for(var n=[],r=0,i=0;i<e.length;i++){var s=e[i],l=s.text;if(s.type===F)for(var u="";r<t.length;r++){if((u+t[r].text).length>l.length){var c=l.slice(u.length);n.push(Object.assign({},t[r],{text:c}));var d=e.slice(i+1),f=[Object.assign({},t[r],{text:t[r].text.slice(c.length)})].concat((0,o.Z)(t.slice(r+1)));return(0,h.hTd)(n,oe(d,f)),n}if(u+=t[r].text,n.push(t[r]),u===l){r++;break}}else if(s.type===A){for(var v="",p=Object.assign({},s,{texts:[]}),g=[],m=[],_=!1,y=!1,C=null,S=r;r<t.length;r++){if((v+t[r].text).length>l.length){var k=[].concat((0,o.Z)(t.slice(S,r)),[Object.assign({},t[r],{text:t[r].text.slice(0,l.length-v.length)}),Object.assign({},t[r],{text:t[r].text.slice(l.length-v.length)})],(0,o.Z)(t.slice(r+1))),E=e.slice(i);return(0,h.hTd)(n,oe(E,k)),n}v+=t[r].text,p.texts.push(t[r]),y||(C&&!t[r].style&&(y=!0),t[r].style&&C&&!(0,a.default)(t[r].style,C)&&(y=!0)),t[r].style&&(C=t[r].style,_=!0),g.push(t[r]);var T=Object.assign({},t[r]);if(delete T.style,m.push(T),v===l){r++;break}}_?y?p.texts=g:(p.texts=m,p.style=C):(delete p.style,p.texts=m),0===p.texts.length?delete p.texts:1===p.texts.length&&(_&&(p.style=C),delete p.texts),n.push(p)}}return n}function ie(e){for(var t=Object.keys(e),n={link:"",cellPosition:null},r=0;r<t.length;r++){var o=t[r];!n.link&&K.test(o)&&(n.link=e[o]),!n.cellPosition&&W.test(o)&&(n.cellPosition=JSON.parse(e[o]))}return n}function ae(e){for(var t=F,n=Object.keys(e),r=0;r<n.length;r++){var o=n[r];if(new RegExp("".concat(w,"-token")).test(o)){t=w;break}(K.test(o)||W.test(o)||"removeLink"===o&&"true"===e[o])&&(t=A)}return t}function se(e){for(var t=Object.keys(e),n={},r=0;r<t.length;r++){var o=t[r],i=/mention-token|mention-type|mention-link|mention-notify|mention-sharePermHeldBack|mention-icon-info/.exec(o);if(i){var a=o.indexOf("_");n[i[0]]=-1!==a&&o.slice(a+1)||e[o]}}return n}function le(e){return Object.keys(e).map((function(t){return[t,e[t]]}))}function ue(e){return e.reduce((function(e,t){return e[t[0]]=t[1],e}),{})}var ce=function(e,t){var n,r=t.getContentState(),o=r.getActiveZone(),i=o.getZoneId(),a=o.length()-1,s=o.getLine(a),l=s&&s.getText().length;Array.isArray(e)?r.apply(X(e)):r.replaceText({start:{line:0,offset:0,zoneId:i},end:{line:a,offset:l,zoneId:i}},null!==(n=e)&&void 0!==n?n:"");t.undoModule.clear()};function he(e){var t="",n="";return e.rangeId?(e.rangeId&&e.rangeId.startsWith("id_")?t=e.rangeId.substring("id_".length):n=e.rangeId,{rangeId:t,rangeToken:n}):{rangeId:t,rangeToken:n}}function de(e){var t=he(e),n=t.rangeId,r=t.rangeToken,o=(0,l.stringify)(Object.assign({sheet:e.sheetId},n?{rangeId:n}:{range:r}));return"".concat(location.origin).concat(location.pathname,"?").concat(o)}function fe(e){return e.attributes&&0===Object.keys(e.attributes).length&&delete e.attributes,e}function ve(e){if(!e)return null;var t=c().parse(e);if(t&&t.query){var n=(0,f.parse)(t.query);if(n.sheet)return{sheetId:n.sheet,rangeId:n.range}}return null}},vsh_11725:function(e,t,n){n.d(t,{Wb:function(){return g},ei:function(){return m},nA:function(){return _},ll:function(){return y},CX:function(){return C},Jc:function(){return S},M9:function(){return k},Es:function(){return E},tz:function(){return b},H4:function(){return I},Jl:function(){return w},Vw:function(){return A},rD:function(){return F},$j:function(){return D},Lz:function(){return N},ze:function(){return P},zE:function(){return O},ZM:function(){return M},Jk:function(){return L},_s:function(){return x},ro:function(){return V},zz:function(){return Z},e$:function(){return B}});var r=n("vsh_67017"),o=n.n(r),i=n("vsh_74561"),a=n("vsh_35067"),s=n("vsh_91777"),l=n.n(s),u=n("vsh_79591"),c=n("vsh_69691"),h=n("vsh_24627"),d=n("vsh_74340"),f=n("vsh_45617"),v=n("vsh_15657"),p=0;function g(){return p++,"".concat((0,c.generateRandomString)(6),"-").concat(p)}function m(){return window.User?window.User.id:"unknown"}function _(e){var t,n;return"0"!==(null==e||null===(t=e.getContentState())||void 0===t||null===(n=t.getActiveZone())||void 0===n?void 0:n.getZoneId())?"table":"default"}function y(e){var t=e.selection.getSelection(),n=t.start,r=t.end;if(n.line!==r.line||n.offset!==r.offset)return!1;var o=e.getContentState().getActiveZone().getLine(n.line),i=null==o?void 0:o.isTextEmpty();return"boolean"!=typeof i||i}function C(e){try{return JSON.parse(e)}catch(e){throw console.error("parse dataMetaBlockProps error.",e),e}}function S(e){if(!e)return null;try{return JSON.parse(e)}catch(e){return console.error("parse json value error.",e),null}}function k(e){return e?Object.keys(e).reduce((function(t,n){var r=/mention-token|mention-type|mention-link|mention-notify|mention-sharePermHeldBack|mention-icon/.exec(n);return r&&(t[r[0]]=n.split("_")[1]||e[n]),t}),{}):{}}function E(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}var T="editorPluginError";function b(e){console.error(T,e),h.Ps3.collectSuiteEvent("client_sheet_editor_exception",{func_name:T}),h.Ps3.moirae.ravenCatch(e,{tags:{key:"SHEET_EDITOR_ERROR",editorErrorName:T}})}function I(e,t,n){return R.apply(this,arguments)}function R(){return R=(0,a.Z)(o().mark((function e(t,n,r){var a,s=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=s.length>3&&void 0!==s[3]?s[3]:1,e.abrupt("return",u.request.post("/api/v2/sheet/gencs/",{token:t,action:"COVERSHEET",value:r,msg_timestamp:Date.now(),memberId:n,baseRev:a,msg_id:(0,f.v4)()},{headers:(0,i.Z)({},d.OrD,d.LJT)}));case 2:case"end":return e.stop()}}),e)}))),R.apply(this,arguments)}var w="data-lark-doclink",A=function(e){if(e){var t=e.getAttribute(w),n=e.getAttribute("data-doclink-type"),r=e.getAttribute("data-doclink-token"),o=S(t);return n&&r&&null!=o&&o.url&&null!=o&&o.title?{type:h.K6s.MENTION,link:encodeURIComponent(decodeURIComponent(o.url)),mentionType:Number(n),token:r,text:o.title}:void 0}},F=function(e,t){return!(!t||!e)&&!(null==t||!t.url||null==t||!t.title||e.href||e.textContent)},D=function(e,t){e.href=t.url,e.textContent=t.title},N=function(e){var t=null==e?void 0:e.fileInfo;return!!t&&!!(null!=t&&t.name&&null!=t&&t.actualType&&null!=t&&t.driveKey)},P=function(e){return!!e&&!((null==e?void 0:e.mentionType)!==h.UkI.USER||null==e||!e.token||null==e||!e.name)},O=function(e){return!!e&&!(null==e||!e.userid||null==e||!e.username)},M=function(e){var t=e.username||e.cn_name;return{category:"at-user-block",type:h.K6s.MENTION,mentionType:h.UkI.USER,token:e.userid,text:"@".concat(t),name:t,en_name:e.en_name||"",link:e.avatar_url||"",is_external:!1,mentionNotify:!1,not_notify:!1}};function L(e,t){var n=e.getMatchedAttributePositionOnSelection(null,(function(e,n){if(e===v.lO){var r=JSON.parse(n);return r.blockType===h.kHU.SHEET_BLOCK&&(r.blockMeta&&r.blockMeta.sheet_id===t)}return"sheet-id"===e&&n===t}));return n.length>0?n[0].docPosition:null}var x=function(e){var t=e.blockType,n=e.initData,r=e.props,o=e.creator,i=e.depLoading,a=Object.assign(Object.assign({},o&&o.defaultProps),r),s=n||o&&o.defaultRecord||{},l=i?{depLoading:i}:{};return Object.assign({blockId:E(),blockType:t,props:a,initData:escape(JSON.stringify(s))},l)},V=function(e){var t,n=(t=e)[v.lO]||t[v.CN];return n?C(n):null},Z=function(e){return!(!e[v.lO]&&!e[v.CN])};var B=function(e,t){var n,r,o=e.props&&e.props.displayMode===h.X71.INLINE,i=e.blockType===h.kHU.AT_USER_BLOCK,a=o||i?"span":"div";return l().sanitize(["<"+a+' class="'+h.JXV+'">','<span data-meta-block-props="'+(n=JSON.stringify(e),r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"},(n&&n.replace(/[\x00-\x2F\x3A-\x40\x5B-\x60\x7B-\xFF]/gm,(function(e){return r[e]||"&#x"+("00"+e.charCodeAt(0).toString(16)).slice(-2)+";"})))+'">'),'<span class="'+h.BCb+' dom-pass-empty-check ignore-collect">',t?'<span class="'+h.j_i+'">'+t+"</span>":"","</span>","</span>","</"+a+">"].join(""))}},vsh_90468:function(e,t,n){n.d(t,{SX:function(){return o},oy:function(){return i},xD:function(){return a},H1:function(){return s},u6:function(){return l}});var r=n("vsh_24627");function o(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:window;return s("touchstart",e,t,n,r)}function i(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:window;return s("mousedown",e,t,n,r)}function a(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:window;return s("click",e,t,n,r)}function s(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"click",t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:window,a=t?Array.isArray(t)?t:[t]:[],s=Array.isArray(o)?o:[o],l=function(e){for(var t=e.target||e.srcElement;t&&t!==document;){if(a.some((function(e){return e===t}))||s.some((function(e){return(0,r.pvT)(t,e)})))return;t=t.parentNode}n(e)};return i.addEventListener(e,l),function(){i.removeEventListener(e,l)}}function l(e){var t=window.getSelection();if(t.anchorNode)for(var n=t.anchorNode;n;){if(n.classList&&n.classList.contains(e))return!0;n=n.parentNode}return!1}},vsh_93444:function(e,t,n){var r=n("vsh_72834"),o=n("vsh_19264"),i=n("vsh_4175"),a=n("vsh_90468"),s=r.Ji0.GC$,l=r.Ji0.util,u=s,c=l._createElement,h=document,d=function(){function e(t,n){(0,o.Z)(this,e),this._ignoreElements=[],this._removeEvents=[];var r=this;r._host=t,r._gcPopupClass="gc-popup",n=n||0,r._defaultContainerCSS={position:"absolute",padding:0,margin:0,height:"auto",zIndex:n+1,outline:"none"},r._init()}return(0,i.Z)(e,[{key:"_init",value:function(){var e=this;e._hasTargetContainer(e._name)?e._container=u("#"+e._name):(e._name=e._generateName(),e._container=u(c("div")).addClass(e._gcPopupClass+" ui-widget").attr({id:e._name,tabIndex:-1}).css(e._defaultContainerCSS))}},{key:"_generateName",value:function(){for(var e=0,t="gc-dialog";this._hasTargetContainer(t+e);)e++;return t+e}},{key:"_getContainer",value:function(){if(this._container)return this._container}},{key:"_getHost",value:function(){return this._host?this._host:h.body}},{key:"_show",value:function(e){var t=this,n=t._container;t._hasTargetContainer(t._name)||(u(t._getHost()).append(n),t._resetDialogPosition(),n.css("display","none")),n.show(e)}},{key:"close",value:function(){var e=this;e._hasTargetContainer(e._name)&&e._container.remove()}},{key:"_resetDialogPosition",value:function(){var e=this._container,t=this._getHost();if(0!==e.length){var n=u(t).offset(),r=parseInt(e.css("left"))+n.left,o=parseInt(e.css("top"))+n.top,i=e.width(),a=e.height();if(!(isNaN(r)||isNaN(o)||isNaN(i)||isNaN(a))){var s=0,l=0,c=h.documentElement,d=c.clientWidth,f=c.clientHeight,v=e[0].getBoundingClientRect();v.left+i>d&&(l=v.left+i-d),v.top+a>f&&(s=v.top+a-f),(r<0||o<0||s>0||l>0)&&((r-=l)<0&&(r=0),(o-=s)<0&&(o=0),e.css({left:r-n.left+"px",top:o-n.top+"px"}))}}}},{key:"_hasTargetContainer",value:function(e){return u("#"+e).length>0}},{key:"_clickOutside",value:function(e){var t=this,n=t._ignoreElements;-1===n.indexOf(e)&&n.push(e),t._removeEvents.forEach((function(e){return e()}));var r=(0,a.H1)("mousedown",n,(function(){t.close()}),void 0,t._host);t._removeEvents.push(r)}}]),e}(),f=n("vsh_24627"),v=n("vsh_7959"),p=n("vsh_69691"),g=n("vsh_6127"),m=n.n(g),_=n("vsh_73043"),y=r.Ji0.GC$,C=r.Ji0.util,S=v.z8O.width/2,k=v.z8O.height/2,E=y,T=C._createElement,b=C._getPreferredZIndex,I=E(document),R=" btn btn-default",w="gc-fill-type-item",A="gc-fill-menu-container",F="ui-state-hover gc-smartMenu-item-hover",D="ui-state-hover gc-smart-tag-hover",N="gc-smartMenu-item-default",P="gc-smartMenu-item-active",O="ui-state-active gc-smart-tag-active",M="float",L="left",x="display",V="change",Z="input[type=radio]",B="mouseover",H="mouseout",U="click",j="fillTypeChanged",G="keydown";function K(e,t,n,r,o,i){var a=E(T("div")).css([x,"width","height","padding","margin"],["block","150px","20px",0,0]).addClass(N+" "+n+" ui-state-default"+R),s=E(T("div")).addClass("gc-menu-item-input").appendTo(a),l=E(T("div")).addClass("gc-menu-item-text").appendTo(a),u=E(T("input")).attr({id:t,value:o,type:"radio",name:"fill-group",style:"display:none"}).appendTo(s);return E(T("span")).text(r).appendTo(l),i?(a.addClass(P),u.prop("checked","checked")):u.prop("checked",""),a}var W=function(e){function t(t,n,r){var o,i=this;e.call(i,t,b(i._host)),i._sheet=n,i._smartTagContainer=E(".gc-tag-container"),i._fillInfo=null,i._setFocus=r,(o=i._menuContainer=i._getContainer()).addClass(A),K(0,"smartMenuCopyCells",w,_("CreationDoc_Sheets_CopyCells"),"0",!0).appendTo(o),K(0,"smartMenuFillSeries",w,_("CreationDoc_Sheets_FillSeries"),"1").appendTo(o)}E.inherit(t,e);var n={_show:function(){f.Ps3.collectSuiteEvent("sheet_opration",{action:"auto_fill_open"}),e.prototype._show.call(this)},_attachEvent:function(){var e=this;E("."+w).bind(B,(function(){E(this).addClass(F)})).bind(H,(function(){E(this).removeClass(F)})).bind(U,(function(){var t=E(this),n=e._smartTagContainer,r=t.find(Z),o=r[0];o.checked=!0,r.trigger(V),n.trigger(U),n.trigger(H),t.removeClass(F);var i=parseInt(E(o).attr("value"));e._changeFill(i)})),e._menuContainer.find(Z).bind(V,(function(){E("."+N).removeClass(P),E(this).parent().parent().addClass(P)}))},_dettachEvent:function(){E("."+w).unbind(B).unbind(H).unbind(U),this._menuContainer.find(Z).unbind(V)},_changeFill:function(e){var t=this,n=t._sheet,r=this._fillInfo;if(t._fillType!==e){f.Ps3.collectSuiteEvent("sheet_opration",{action:0===Number(e)?"auto_fill_copy":"auto_fill_sequence"}),t._fillType=e;var o=r.startRange,i=r.fillRange,a=r.fillDirection;n.fill(o,i,e,a),t._smartTagContainer.trigger(j,e)}},_isOpen:function(){return!!E("."+A).length}};return E.extend(t.prototype,n),t}(d);function z(e){var t=(0,p.getThemeColor)("#424E5D",p.ColorType.ICON),n=Boolean(e)?'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="'.concat(t,'"><path d="M18 8L12 16 6 8"/></svg>'):'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="'.concat(t,'" width="16" height="16"><path d="M8 5h5V2H8v3zM7 6H2v3h5V6zm4 4V8h1v2h2v1h-2v2h-1v-2H9v-1h2zM1 1h13v5H8v4H1V1zm0 10h1v1H1v-1zm0 2h1v1H1v-1zm2 0h1v1H3v-1zm2 0h1v1H5v-1zm2 0h1v1H7v-1zm0-2h1v1H7v-1z"/></svg>');return"data:image/svg+xml,".concat(encodeURIComponent(n))}var Y=function(e){function t(t,n,r,o,i,a){var s,l=this;e.call(l,t,b(l._host)),l._sheet=n,l._fillInfo=r,l._tableView=o,l._hostContainer=E(t),l._setFocus=i,l._resetFocus=a,s=l._tagContainer=l._getContainer().addClass("gc-smart-tag-default gc-tag-container gc-no-user-select ui-widget-header"+R),m().safari?(l._smartTag=E(T("object")).attr({data:z(0),type:"image/svg+xml",height:"16",width:"16"}).css([M,"pointer-events"],[L,"none"]).appendTo(s),l._smartTagDown=E(T("div")).css([M,x,"width","height","background-image"],[L,"none","16","16","url('".concat(z(1),"')")]).appendTo(s)):(l._smartTag=E(T("img")).attr("src",z(0)).css(M,L).appendTo(s),l._smartTagDown=E(T("img")).attr("src",z(1)).css([M,x],[L,"none"]).appendTo(s))}E.inherit(t,e);var n={_doMouseEvent:function(e,t,n){var r=E(t),o=this._menuDialog,i=this._smartTagDown;o&&o._isOpen()||(e?r.addClass(D):r.removeClass(D),n||(e?i.show():i.hide()))},_registerEvent:function(){var e=this,t=e._tagContainer,n=m().safari&&(m().isIPad||m().ios);t.bind(B,(function(){e._doMouseEvent(!0,this,n)})).bind(H,(function(){e._doMouseEvent(!1,this,n)})),t.bind(U,(function(){var t=E(this),r=e._menuDialog,o=e._smartTagDown;if(r&&r._isOpen())n&&o.hide(),t.removeClass(O),e._closeMenu();else{n&&o.show(),t.addClass(O),e._openMenu();var i=e._menuContainer,a=i&&i.find(Z)[e._fillInfo.fillType];a&&!a.checked&&(a.checked=!0,E(a).trigger(V))}})),e._hostContainer.bind("mousewheel",e.handleMousewheel.bind(e)),I.bind(G,(function(t){t.keyCode===f.VDZ.Esc&&(e._menuDialog&&e._menuDialog._isOpen()?e._closeMenu():e.close(),C._cancelDefault(t),e._setFocus&&e._setFocus())}))},_open:function(){var e=this,t=e._tagContainer;t&&(e._reset(),e._show(),e._registerEvent(),e._clickOutside(t[0]),e._setFocus&&e._setFocus())},_openMenu:function(){var e=this,t=e._sheet;e._menuDialog||(e._menuDialog=new W(e._host,t,e.setFocus),e._menuContainer=e._menuDialog._getContainer());var n=e._tagContainer,r=n.css(L),o=n.css("top"),i=parseFloat(o),a=e._menuDialog,s=e._fillInfo;a._fillType=s.fillType,a._fillInfo=s,isNaN(i)||(o=i+n.height()+2),e._menuContainer.css([L,"top"],[r,o]),a._show(),a._attachEvent(),a._smartTagContainer.unbind(j).bind(j,(function(e,t){s.fillType=t})),e._clickOutside(e._menuContainer[0])},_closeMenu:function(){var e=this._menuDialog;e&&(e._dettachEvent(),e.close())},_reset:function(){var e=this._menuDialog,t=this._tagContainer;e&&(e._isOpen()&&t.trigger(U),t.trigger(H))},close:function(){var t=this;t._reset(),t._tagContainer.unbind("click"),I.unbind(G),t._removeEvents.forEach((function(e){return e()})),e.prototype.close.call(t),t._hostContainer.unbind("mousewheel")},handleMousewheel:function(){this._reset(),this._resetDialogPosition()},_resetDialogPosition:function(){var e=this._fillInfo,t=this._sheet._getActiveSelectedRange(),n=this._tagContainer,r=this._tableView,o=r.cell2ViewPos({row:t.rowFrom()+t.rowCount(),col:t.colFrom()+t.colCount()});if(o.y>0&&o.x>0){var i=r.mapToGlobal(o);e.x=i.x,e.y=i.y,n.css(["visibility","left","top"],["visible",e.x+S,e.y+k])}else n.css("visibility","hidden")}};return E.extend(t.prototype,n),t}(d);r.deh._FillDialog=Y},vsh_30964:function(e,t,n){n.d(t,{yO:function(){return A},TB:function(){return i},yv:function(){return y},np:function(){return S},YG:function(){return b},st:function(){return T},IL:function(){return v},Qp:function(){return I},Qh:function(){return E}});var r=n("vsh_19264"),o=n("vsh_4175"),i=function(){function e(t){(0,r.Z)(this,e),this._spread=t,this.init()}return(0,o.Z)(e,[{key:"init",value:function(){this.initHookCreator(),this.initHooks(),this.bindHooks()}},{key:"initHookCreator",value:function(){this.hookCreator=this.getHookCreator()}},{key:"initHooks",value:function(){this.hooks={}}},{key:"unbindHooks",value:function(){for(var e=0,t=Object.keys(this.hooks);e<t.length;e++){var n=t[e];this._spread.removeHook(n,this.hooks[n])}this.hooks={}}},{key:"bindHooks",value:function(){for(var e=0,t=Object.keys(this.hookCreator);e<t.length;e++){var n=t[e],r=this.hookCreator[n].call(this);this._spread.setHook(n,r),this.hooks[n]=r}}},{key:"destroy",value:function(){this.unbindHooks()}}]),e}(),a=n("vsh_74561"),s=n("vsh_12064"),l=n("vsh_22462"),u=n("vsh_73455"),c=n("vsh_24627"),h=n("vsh_72834");function d(e,t,n){return(0,h.kER)(e,t,n,"row",c.pCG)}function f(e,t,n){return(0,h.kER)(e,t,n,"col")}function v(e,t){var n=e.getActiveSheet();if(!n)return!1;var r=(t||n.getSelections())[0];return!!r&&(0,h.l7q)(r,e)}function p(e,t,n){var r=n||t.sheetId,o=e.isvRelationshipManager;return!(!r||!o)&&o.getIsISVRelatedBySheetId(r)}function g(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return m(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var _=c.rvF.CLIPBOARD_PASTE,y=function(e){function t(){return(0,r.Z)(this,t),(0,s.Z)(this,(0,l.Z)(t).apply(this,arguments))}return(0,u.Z)(t,e),(0,o.Z)(t,[{key:"getHookCreator",value:function(){var e;return e={},(0,a.Z)(e,"".concat(c.Jfb,"_").concat(c.rvF.MERGE_CELLS),this.createMergeCellHook),(0,a.Z)(e,"".concat(c.Jfb,"_").concat(c.rvF.SET_ROW_COL_CHANGE),this.createDeleteRowOrColumnHook),(0,a.Z)(e,_,this.createPasteHook),(0,a.Z)(e,"".concat(c.Jfb,"_").concat(c.rvF.DELETE_SHEET),this.createDeleteSheetHook),e}},{key:"createHookWrapper",value:function(e){return Object.assign({},e,{beforeExecute:function(t,n){return!e.beforeExecute||!p(t,n)||e.beforeExecute(t,n)}})}},{key:"bindHooks",value:function(){for(var e=0,t=Object.keys(this.hookCreator);e<t.length;e++){var n=t[e],r=this.hookCreator[n].call(this);n!==_&&(r=this.createHookWrapper(r)),this._spread.setHook(n,r),this.hooks[n]=r}}},{key:"createDeleteRowOrColumnHook",value:function(){return{beforeExecute:function(e,t){for(var n=t.ranges,r=!0,o=0;o<n.length;o++){var i=n[o],a=i.target,s=i.count,l=i.method,u=i.type;if(l===h.Dx_.DEL&&!(r=u===h.NHZ.ROW?!d(e,a,s):!f(e,a,s)))break}return r}}}},{key:"createMergeCellHook",value:function(){return{beforeExecute:function(e,t){return!t.isMerge||!v(e,t.ranges)}}}},{key:"createPasteHook",value:function(){return{beforeExecute:function(e,t){var n=t.fromSheet,r=t.fromRanges;if(!t.isCutting||!p(e,t,n.id()))return!0;var o,i=g(r);try{for(i.s();!(o=i.n()).done;){var a=o.value;if((0,h.l7q)(a,e,void 0,n))return!1}}catch(e){i.e(e)}finally{i.f()}return!0}}}},{key:"createDeleteSheetHook",value:function(){return{beforeExecute:function(e,t){return!p(e,t)}}}}]),t}(i),C=n("vsh_63738");var S=function(e){function t(){return(0,r.Z)(this,t),(0,s.Z)(this,(0,l.Z)(t).apply(this,arguments))}return(0,u.Z)(t,e),(0,o.Z)(t,[{key:"getHookCreator",value:function(){return(0,a.Z)({},"".concat(c.Jfb,"_").concat(c.rvF.EDIT_CELL),this.createEditCellHook)}},{key:"createEditCellHook",value:function(){return{beforeExecute:function(e,t){var n,r=t.newValue,o=t.row,i=t.col,a=t.sheetId,s=e.getSheetFromId(a);if(!r||!s||!s.getReminder(o,i))return!0;if(n=r,Array.isArray(n)&&n[0]&&n[0].type===c.K6s.EMBED_IMAGE)return!0;if(function(e,t,n){var r=n.getStyle(e,t);return r.formatter&&(0,C.isTextFormatter)(r.formatter)}(o,i,s))return!0;var l=(0,c.ATv)(r);return!!function(e,t,n,r){return(0,h.Q8)(t,n,r,e).isFormula}(l,o,i,s)||!!function(e,t){var n=(0,C.getPreferredFormatter)(e.formatterService,t).formatter;return(0,C.isDateTimeFormatter)(n)}(e,l)}}}}]),t}(i),k=n("vsh_46544");function E(e,t){var n=e.getService(k.PQ);return!!n&&n.getSheetIsExitDataConnector(t)}function T(e,t){var n=e.getActiveSheet(),r=n.id();if(!n)return!1;var o=t||n.getSelections(),i=o[0];return!!o&&b(e,i,r)}function b(e,t,n){var r=e.getService(k.PQ).getSheetDataConnectorFieldsCount(n);if(t.rgType===c.xj7.ROW)return 0===t.rowFrom();if(t.rgType===c.xj7.COL)return t.colFrom()<=r-1;var o=t.rowFrom(),i=t.colFrom();return 0===o&&i<=r-1}function I(e,t,n,r){var o=e.getService(k.PQ).getSheetDataConnectorFieldsCount(r);return 0===t&&n<o}function R(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return w(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return w(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var A=function(e){function t(){return(0,r.Z)(this,t),(0,s.Z)(this,(0,l.Z)(t).apply(this,arguments))}return(0,u.Z)(t,e),(0,o.Z)(t,[{key:"getHookCreator",value:function(){var e;return e={},(0,a.Z)(e,"".concat(c.Jfb,"_").concat(c.rvF.MERGE_CELLS),this.createMergeCellHook),(0,a.Z)(e,"".concat(c.Jfb,"_").concat(c.rvF.SET_ROW_COL_CHANGE),this.createAddOrDeleteRowOrColumnHook),e}},{key:"createHookWrapper",value:function(e){return Object.assign({},e,{beforeExecute:function(t,n){var r=n.sheetId,o=n.fromSheet;return!e.beforeExecute||!E(t,r||o.id())||e.beforeExecute(t,n)}})}},{key:"createAddOrDeleteRowOrColumnHook",value:function(){return{beforeExecute:function(e,t){var n=t.ranges,r=e.getActiveSheet().id();if(!E(e,r))return!0;var o,i=!0,a=R(n);try{for(a.s();!(o=a.n()).done;){var s=o.value,l=s.target;if(s.type===h.NHZ.ROW)i=0!==l;else i=l>e.getService(k.PQ).getSheetDataConnectorFieldsCount(r)-1;if(!i)break}}catch(e){a.e(e)}finally{a.f()}return i}}}},{key:"createMergeCellHook",value:function(){return{beforeExecute:function(e,t){var n=t.sheetId;return!!n&&(!t.isMerge||!E(e,n)||!T(e,t.ranges))}}}}]),t}(i)},vsh_88177:function(e,t,n){var r,o;n.d(t,{I9:function(){return r},F5:function(){return o},mg:function(){return i},ut:function(){return a},Z0:function(){return s},k0:function(){return l}}),function(e){e[e.IDLE=0]="IDLE",e[e.EDIT=1]="EDIT",e[e.SUMMARY=2]="SUMMARY",e[e.EDIT_INVALID=3]="EDIT_INVALID",e[e.HIDDEN=4]="HIDDEN",e[e.EDIT_FAIL=5]="EDIT_FAIL",e[e.END_EDIT_SUSPENSE=6]="END_EDIT_SUSPENSE"}(r||(r={})),function(e){e[e.SHOULD_BREAK_START_EDIT=0]="SHOULD_BREAK_START_EDIT",e[e.END_EDIT_BREAK=1]="END_EDIT_BREAK",e[e.TRY_SHOW_SUMMARY=2]="TRY_SHOW_SUMMARY",e[e.HANDLE_SELECTION_HOOK=3]="HANDLE_SELECTION_HOOK",e[e.HANDLE_BEFORE_UNLOAD=4]="HANDLE_BEFORE_UNLOAD",e[e.HANDLE_RANGE_CHANGED=5]="HANDLE_RANGE_CHANGED",e[e.HANDLE_FOCUS_CHANGE=6]="HANDLE_FOCUS_CHANGE",e[e.HANDLE_OPTION_CHANGED=7]="HANDLE_OPTION_CHANGED",e[e.HANDLE_ROW_OR_COL_DRAGGED=8]="HANDLE_ROW_OR_COL_DRAGGED",e[e.HANDLE_BEFORE_ACTIVE_SHEET_CHANGE=9]="HANDLE_BEFORE_ACTIVE_SHEET_CHANGE",e[e.HANDLE_ACTIVE_SHEET_CHANGE=10]="HANDLE_ACTIVE_SHEET_CHANGE",e[e.COPY_DRIVE_IMAGE_TO_SHEET=11]="COPY_DRIVE_IMAGE_TO_SHEET",e[e.COPY_DRIVE_IMAGE_TO_SHEET_RELEASE=12]="COPY_DRIVE_IMAGE_TO_SHEET_RELEASE",e[e.COPY_DRIVE_IMAGE_TO_SHEET_CATCH=13]="COPY_DRIVE_IMAGE_TO_SHEET_CATCH",e[e.CHECK_DATA_VALIDATION=14]="CHECK_DATA_VALIDATION",e[e.SHORTCUT_PLUGIN=15]="SHORTCUT_PLUGIN",e[e.SHORTCUT_PLUGIN_GRACEFUL=16]="SHORTCUT_PLUGIN_GRACEFUL",e.ARROW_END_EDITOR="arrow_end_editor"}(o||(o={}));var i={x:0,y:0,width:0,height:0},a={bottom:0,height:0,left:0,right:0,top:0,width:0,x:0,y:0},s=2,l=s/2},vsh_69006:function(e,t,n){n.d(t,{AS:function(){return g},d1:function(){return m},Qi:function(){return _},cu:function(){return y},ZG:function(){return C},XF:function(){return S},RR:function(){return k},cN:function(){return E},P4:function(){return T},Kk:function(){return b},SO:function(){return I},rd:function(){return R},CP:function(){return w},HI:function(){return F},KD:function(){return P},wT:function(){return O},pM:function(){return L},kY:function(){return x},H$:function(){return V},Ex:function(){return Z},lq:function(){return H},RA:function(){return U},dj:function(){return G}});var r=n("vsh_19264"),o=n("vsh_4175"),i=n("vsh_70098"),a=n("vsh_24627"),s=n("vsh_72834"),l=n("vsh_63738"),u=n("vsh_55478"),c=n("vsh_7459"),h=n("vsh_33916"),d=n("vsh_7959"),f=n("vsh_7121"),v=n("vsh_46544"),p=n("vsh_73043");function g(e,t){if(e&&e.style)for(var n in t)e.style[n]=t[n]}function m(e){if("string"==typeof e&&e.match(/px$/)){var t=Number.parseFloat(e);if(!Number.isNaN(t))return t}return null}function _(e,t){var n=m(e),r=t?m(t.maxPxValue):null;return null===n||null===r?e:"".concat(Math.min(n,r),"px")}function y(e,t){return(!(0,s.uUo)(e)||!(0,i.Z)(t))&&(Array.isArray(e)&&Array.isArray(t)?JSON.stringify(e)!==JSON.stringify(t):(e=null===e?"":e)!==(t=null===t?"":t))}function C(e){var t=e.sheet,n=e.plainValue,r=e.row,o=e.col,i=t.getFormatCode(r,o);if(!i)return n;if(!/^\s*[\d.]*\s*$/.test(n))return n;var a=Number(n);return Number.isNaN(a)?n:/0%|0.0+%/.test(i)?String(a/100):n}function S(e,t,n,r,o){if(a.Ps3.collectSuiteEvent&&"string"==typeof r&&"string"==typeof o&&!e.hasFormula(t,n)&&(0,l.isDateTimeFormatter)((0,l.getPreferredFormatter)(e.formatterService,o).formatter)){var i=!!e.getReminder(t,n),u=e.getValue(t,n),c=(0,s.rjm)(e.getStyle(t,n)).formatter,h=c&&(0,l.isDateTimeFormatter)(c,u);(i||h)&&a.Ps3.collectSuiteEvent("sheet_opration",{action:"edit_date_cell",reminder_status:i?a.gHA.ON:a.gHA.OFF})}}function k(e){var t=e.sheet,n=e.row,r=e.col,o="none",i=t.getDataValidation(n,r);return i&&(o=(0,s.Ju9)(i)?i.options.supportMultipleValues?"list_multiple":"list_single":(0,s.gsJ)(i)?"text_length":i.type),o}function E(e){var t=e.sheet,n=e.row,r=e.col,o=t.getDataValidation(n,r);return o&&(0,s.Ju9)(o)?{isMultiple:o.options.supportMultipleValues,dataValidation:o}:null}function T(e){for(var t=e.sheet,n=e.row,r=e.rowCount,o=e.col,i=e.colCount,a=0;a<r;a++)if(t.getRowVisible(n+a))return!1;for(var s=0;s<i;s++)if(t.getColumnVisible(o+s))return!1;return!0}function b(e){var t=e.sheet,n=e.row,r=e.col,o=e.options;if(t.isProxyArrayFormula(n,r)&&o.newSegmentArray){var i=new s.JG4(t.parent,o.newSegmentArray).getText(t.parent.userLanguage)!==t.getValue(n,r);return i||o.newSegmentArray.length>1&&(a.Ps3.collectSuiteEvent("sheet_opration",{action:"show_array_style_tip"}),a.Ps3.Toast.info({content:p("CreationDoc_Sheets_PartialTextStyle_NotSupportArrayResult"),duration:4e3})),i}return!0}function I(e){return!!function(e){var t;return null===(t=e.getPluginState("FocusStore"))||void 0===t?void 0:t.focusedSheetId}(e)&&(!function(){var e=document.activeElement;for(;e;){if(e.classList.contains("hyperlink-editor-container"))return!0;e=e.parentElement}return!1}()&&(!function(){var e=document.activeElement;for(;e;){if(e.classList.contains("chart-range-selector-modal"))return!0;e=e.parentElement}return!1}()&&(!function(e){var t=e.getPlugin("DateTimePickerPlugin");return null==t?void 0:t.isEditing()}(e)&&(!function(){var e=document.activeElement;if(e)for(var t=e;t;){if(t.getAttribute("data-sheet-prevent-event"))return!0;t=t.parentElement}return!1}()&&!function(){var e=document.activeElement;for(;e;){if(e.classList.contains("J-color-picker"))return!0;if(e.classList.contains("prevent-when-editing"))return!0;e=e.parentElement}return!1}()))))}function R(e,t){var n,r=window.getSelection(),o=r.focusNode,i=r.getRangeAt(0),a=(n="#text"===o.nodeName?i.getBoundingClientRect():o.getBoundingClientRect()).top,s=e.getBoundingClientRect(),l=a-s.top,u=l+n.height-s.height,c=e.scrollTop;o!==e&&(t?e.scrollTop=l<=c?l:c+u:u>=0&&(e.scrollTop=c+u))}function w(e,t,n,r){var o=e.inject(v.Cy),i=o.getPivotTableNameByCell(n,r),a=o.getPivotTableByName(i);if(!i)return!0;if(!a)return!1;if(!t)return!1;var s=o.getCellInfo(n,r),l=o.getPivotInfoByName(i);if(!s&&!l)return!0;if(null!=l&&l.isEmpty||null!=l&&l.errorState)return!1;if(!s)return!0;var h=s.areaType,d=!!o.getFilterSort(n,r);switch(h){case u.A6.page:return!d;case u.A6.rowDim:case u.A6.colDim:if(d)return!0;var f=h===u.A6.rowDim&&s.isSubTotal&&a.getFieldByArea(c.N5.value).length<=1&&a.getFieldByArea(c.N5.row).length>0;if(s.measureFieldName&&s.measureFieldName===s.fieldName&&!f)return!0;var p=o.getFieldValueInfo(n,r,s);if(null!==p){var g=a.getGroupRuleByFieldName(p.fieldName,!1);if(g&&g.type===c._O.Element)return!0}return!1;case u.A6.corner:return!!d||!(!s.value||!s.fieldName);default:return!!d}}function A(e,t,n,r,o){Array.isArray(r)&&(r=r[0].text);var i=!1,s=n.getFieldByName(r);if(s&&n.getFieldArea(r)===c.N5.value){var l=(0,u.Ls)(o,s.getSummaryType());l.length>1&&(i=n.checkFieldNameExist(r,l[1]))}if(""!==o&&r!==o){if(o.length>1e3)a.Ps3.Toast.warning({showCloseIcon:!0,content:p("LarkCCM_Sheets_PivotTable_FieldCharacterLimited_Toast")});else if(i=i||n.checkFieldNameExist(r,o))a.Ps3.Toast.warning({showCloseIcon:!0,content:p("CreationDoc_Sheets_PivotTable_Failed_ExistedFieldName")});else n.renameField(r,o),e.inject(v.Cy).reRenderPivotTable(t)}}function F(e,t,n,r,o,i,s,l){var h;if(l&&"="===l[0])return a.Ps3.Toast.warning({key:"pivot_endEdit_formula",content:p("LarkCCM_Sheets_PivotTable_FormulaAsRename")}),!1;a.Ps3.Toast.remove("pivot_endEdit_formula");var d=r.areaType,f=e.inject(v.Cy),g=!!f.getFilterSort(o,i);switch(null===(h=a.Ps3.collectSheetEvent)||void 0===h||h.call(a.Ps3,"ccm_sheet_content_page_click",{click:"data_pivotd_filed_rename",target:"none",rename_type:"table_header"}),d){case u.A6.page:return!g&&l&&A(e,t,n,s,l),!0;case u.A6.rowDim:case u.A6.colDim:if(g&&l)return A(e,t,n,s,l),!0;if(r.measureFieldName===r.fieldName&&l)return A(e,t,n,s,l),!0;var m=f.getFieldValueInfo(o,i,r);if(null!==m&&l){var _=m.type,y=m.fieldName,C=m.value,S=n.getGroupRuleByFieldName(y,!1);if(S&&S.type===c._O.Element){var k=(0,c.El)(_,C);n.renameElementGroup(y,k,l),f.reRenderPivotTable(t)}}return!0;case u.A6.corner:return(g&&l||r.value&&r.fieldName&&l)&&A(e,t,n,s,l),!0;default:return g&&l&&A(e,t,n,s,l),!0}}var D=!1,N=!1;function P(){var e;D||(D=!0,null===(e=a.Ps3.collectSheetEvent)||void 0===e||e.call(a.Ps3,"ccm_sheet_rtl_usage_dev",{is_rtl:"true",is_edit:"true"}))}function O(){var e;N||(N=!0,null===(e=a.Ps3.collectSheetEvent)||void 0===e||e.call(a.Ps3,"ccm_sheet_rtl_usage_dev",{is_edit:"true"}))}var M="ccm_sheet_cell_editor_dev";function L(e){var t,n=e.cellPos,r=e.count,o=e.source,i=e.ignoreValueChange;null===(t=a.Ps3.collectSheetEvent)||void 0===t||t.call(a.Ps3,M,{action:i?"end_edit_by_ignore":"end_edit",cell_pos:n,count:r||0,source:String(o||"")})}function x(e,t){var n,r=t.status,o=String((null==t?void 0:t.source)||"");o&&e!==r&&(null===(n=a.Ps3.collectSheetEvent)||void 0===n||n.call(a.Ps3,M,{action:"editor_status_change",old_status:e,new_status:r,source:o}))}function V(e){var t;null===(t=a.Ps3.collectSheetEvent)||void 0===t||t.call(a.Ps3,M,{action:"start_input",cell_pos:e})}function Z(){var e;null===(e=a.Ps3.collectSheetEvent)||void 0===e||e.call(a.Ps3,M,{action:"end_input"})}var B=/--.+?(-\d+|, ?0\.\d+)\)$/,H=function(){function e(t){var n=this;(0,r.Z)(this,e),this.canUseOffscreenCanvas="undefined"!=typeof OffscreenCanvas,this.cache=new Map,this.defaultBg=t,this.unsubscribeUI=(0,f.onUIStateChange)((function(){return n.clearCache()}))}return(0,o.Z)(e,[{key:"clearCache",value:function(){this.cache.clear()}},{key:"isTransparent",value:function(e){var t=String(e).toLowerCase().trim();return!!t.startsWith("rgba")||(t.startsWith("#")?9===t.length:!!t.startsWith("var(")&&B.test(t))}},{key:"getThemedDefaultBg",value:function(){return(0,d.Ehf)(this.defaultBg,h.ColorThemeType.Background)}},{key:"getColor",value:function(e){if(this.cache.has(e))return this.cache.get(e);var t=(0,d.Ehf)(e,h.ColorThemeType.Background),n=t||this.getThemedDefaultBg();if(!this.canUseOffscreenCanvas||!this.isTransparent(e))return n;var r=new OffscreenCanvas(1,1).getContext("2d");if(!r)return n;var o=this.getThemedDefaultBg();r.fillStyle=o,r.fillRect(0,0,1,1);var i=t||o;r.fillStyle=i,r.fillRect(0,0,1,1);var a=r.getImageData(0,0,1,1).data.slice(0,3),s="#".concat(Array.from(a).map((function(e){return e.toString(16).padStart(2,"0")})).join(""));return this.cache.set(e,s),s}},{key:"destroy",value:function(){var e;null===(e=this.unsubscribeUI)||void 0===e||e.call(this),this.clearCache()}}]),e}(),U=function(e){return"string"==typeof e&&["=","+"].includes(e[0])},j=new Set([a.VDZ.Left,a.VDZ.Right,a.VDZ.Up,a.VDZ.Down,a.VDZ.Home,a.VDZ.End,a.VDZ.PageDown,a.VDZ.PageUp]),G=function(e){return j.has(e)}},vsh_55413:function(e,t,n){n.r(t),n.d(t,{CellEditorPlugin:function(){return z},CellEditorStore:function(){return T},DEFAULT_BORDER_WIDTH:function(){return C.Z0},DEFAULT_HALF_BORDER_WIDTH:function(){return C.k0},DefaultState:function(){return E},EditorStatus:function(){return C.I9},EditorTriggerSource:function(){return C.F5},ReactCanvasEmpty:function(){return C.ut},RectEmpty:function(){return C.mg},ThemedBgColorHelper:function(){return k.lq},canEditCell:function(){return k.Kk},collectDateTimeCellEndEdit:function(){return k.XF},endEditInPivotTable:function(){return k.HI},fixPxValue:function(){return k.Qi},getCellDropdownInfo:function(){return k.cN},getValidationType:function(){return k.RR},handleScroll:function(){return k.rd},isAllCellHidden:function(){return k.P4},isArrowKeyCode:function(){return k.dj},isContentFormula:function(){return k.RA},isEditableInPivotTable:function(){return k.CP},isEditingValueChanged:function(){return k.cu},isReadyToEdit:function(){return k.SO},modifyPlainValueIfNeed:function(){return k.ZG},parsePxValueToNumber:function(){return k.d1},reportEditStatus:function(){return k.kY},reportEndEdit:function(){return k.pM},reportEndInput:function(){return k.Ex},reportLTR:function(){return k.wT},reportRTL:function(){return k.KD},reportStartInput:function(){return k.H$},setElementStyle:function(){return k.AS}});var r=n("vsh_19264"),o=n("vsh_4175"),i=n("vsh_12064"),a=n("vsh_56589"),s=n("vsh_22462"),l=n("vsh_73455"),u=n("vsh_24627"),c=n("vsh_82905"),h=n("vsh_1139"),d=n("vsh_67017"),f=n.n(d),v=n("vsh_35067"),p=n("vsh_74561"),g=n("vsh_65498"),m=n("vsh_4561"),_=n("vsh_75119"),y=n("vsh_21955"),C=n("vsh_88177"),S=n("vsh_72834"),k=n("vsh_69006"),E={editorStatus:C.I9.IDLE,editorSelection:null,editorValue:"",editorWrapper:null,editorStyle:{textDecorationType:0,colorBg:"#FFFFFF",colorFont:"#000000",font:"12px normal",fontSize:12,hAlign:null,vAlign:null,wordWrap:S.ngh.OVERFLOW},editorRect:{rangeRect:C.mg,contentRect:C.mg,canvasRect:C.ut},editingCell:null},T={namespace:"CellEditorStore",state:E,commit:{setEditorSelection:function(e,t){e.editorSelection=t},setEditorStyle:function(e,t){e.editorStyle=Object.assign({},e.editorStyle,{},t)},setEditorWrapper:function(e,t){e.editorWrapper=t},setEditorValue:function(e,t){e.editorValue=t},setEditorStatus:function(e,t){(0,k.kY)(e.editorStatus,t),e.editorStatus=t.status},setEditorRect:function(e,t){e.editorRect=Object.assign({},e.editorRect,{},t)},setEditingCell:function(e,t){e.editingCell=t}}},b=n("vsh_70257"),I=n("vsh_78325"),R=n("vsh_8892"),w=n("vsh_90468"),A=n("vsh_6127"),F=n.n(A),D=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;(0,r.Z)(this,e),this.state=t,this.zoom=n}return(0,o.Z)(e,[{key:"scaledBorderWidth",get:function(){return C.Z0*this.zoom}},{key:"scaledHalfBorderWidth",get:function(){return this.scaledBorderWidth/2}},{key:"styleTextDecoration",get:function(){var e=this.state.editorStyle,t="";return 4==(4&e.textDecorationType)&&(t="overline"),2==(2&e.textDecorationType)&&(t+=" line-through"),1==(1&e.textDecorationType)&&(t+=" underline"),t}},{key:"styleHAlign",get:function(){var e=this.state,t=e.editorStyle,n=e.editorValue,r="left";if(t.hAlign===u.KqL.Center)r="center";else if(t.hAlign===u.KqL.Right)r="right";else if(t.hAlign===u.KqL.General){r={boolean:"center",number:"right",date:"right"}[(0,g.Z)(n)]||"left"}return r}},{key:"styleVAlign",get:function(){var e=this.state.editorStyle,t="center";return e.vAlign===u.g$I.Top?t="flex-start":e.vAlign===u.g$I.Bottom&&(t="flex-end"),t}},{key:"stylePadding",get:function(){var e,t=this.state.editorStyle;!function(e){e[e.top=18]="top",e[e.center=32]="center",e[e.centerMedium=14]="centerMedium"}(e||(e={}));var n=0,r=0;return t.vAlign===u.g$I.Top?n=t.fontSize<=e.top?3:0:t.vAlign===u.g$I.Center?t.fontSize>=e.center&&(r=4):t.vAlign===u.g$I.Bottom&&(r=4),"".concat(n,"px 4px ").concat(r,"px")}},{key:"styleLeft",get:function(){var e,t=this.state,n=t.editorStyle,r=t.editorRect,o=t.editorWrapper;if(2===n.hAlign)return"auto";var i=null==o?void 0:o.getBoundingClientRect();return"".concat(Math.min(r.rangeRect.x,r.contentRect.x+r.contentRect.width-(null!==(e=null==i?void 0:i.width)&&void 0!==e?e:0))-this.scaledHalfBorderWidth,"px")}},{key:"styleRight",get:function(){var e,t=this.state,n=t.editorStyle,r=t.editorRect,o=t.editorWrapper;if(2!==n.hAlign)return"auto";var i=null==o?void 0:o.getBoundingClientRect();return"".concat(Math.max(r.contentRect.width+r.contentRect.x-Math.max(r.rangeRect.x+r.rangeRect.width,null!==(e=null==i?void 0:i.width)&&void 0!==e?e:0),this.scaledBorderWidth),"px")}},{key:"styleTop",get:function(){var e=this.state,t=e.editorRect;if(!e.editorWrapper)return"".concat(t.rangeRect.y-this.scaledHalfBorderWidth,"px");var n=t.canvasRect.top,r=Math.abs((Math.floor(1*n)-1*n)/1),o=Math.ceil(100*r)/100;return"".concat(t.rangeRect.y+o-this.scaledHalfBorderWidth,"px")}},{key:"styleTopToWindowBottom",get:function(){var e=this.styleTop,t=parseInt(e,10);return t<0?e:"".concat(window.innerHeight-t-this.scaledHalfBorderWidth,"px")}},{key:"styleMinWidth",get:function(){var e,t=this.state.editorRect,n=t.rangeRect,r=t.contentRect;return"".concat(Math.min(n.width,r.width)/(null===(e=F().isH5)||void 0===e||e?this.zoom:1)-this.scaledHalfBorderWidth,"px")}},{key:"styleMinHeight",get:function(){var e=this.state.editorRect,t=e.rangeRect.height,n=e.canvasRect.height,r=e.canvasRect.height-e.rangeRect.y;return"".concat(0!==n&&r<t?r-this.scaledHalfBorderWidth:e.rangeRect.height-this.scaledHalfBorderWidth,"px")}},{key:"styleMaxWidth",get:function(){var e=this.state,t=e.editorStyle,n=e.editorRect;return t.hAlign===u.KqL.Right?"".concat(Math.min(n.rangeRect.x+n.rangeRect.width,n.contentRect.width)-this.scaledBorderWidth,"px"):"".concat(Math.max(n.contentRect.width+n.contentRect.x-n.rangeRect.x-this.scaledBorderWidth,n.contentRect.width),"px")}},{key:"styleMaxHeight",get:function(){var e=this.state.editorRect;return"".concat(e.contentRect.height+e.contentRect.y-e.rangeRect.y-this.scaledBorderWidth,"px")}},{key:"styleTopFromWindow",get:function(){var e=this.state.editorRect;return e.rangeRect.height<=0&&e.rangeRect.width<=0?"":"".concat(e.rangeRect.y+e.canvasRect.y-this.scaledHalfBorderWidth,"px")}}]),e}(),N=n("vsh_20680"),P=n("vsh_69691"),O=n("vsh_63738"),M=n("vsh_15657"),L=n("vsh_11725"),x=n("vsh_46544"),V=n("vsh_99024"),Z=n("vsh_73043");function B(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return H(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return H(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function H(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var U=function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":(0,g.Z)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},j=function(e,t,n){return e>=t&&e<=n},G=function(e,t){return"".concat((0,u.hdC)(t)).concat(e+1)},K=function(){function e(t){var n=this;(0,r.Z)(this,e),this.name="CellEditorPlugin",this.oldValue="",this.ignoreValidationShowWarning=!1,this.subscriber=null,this.shellSubscriber=null,this.editorErrorTimes=0,this.isH5Mode=u.Ps3.browser.isH5,this.isInputting=!1,this.inputTimer=null,this.canArrowEndEdit=!1,this.createEditor=function(e){var t,r,o,i,a,s;if(n.editorOptions=Object.assign({},n.editorOptions,{},e),n.canCreateEditor()||n.isH5Mode){var l=n._getFocusedSheetId();if(l){n.disposeEditor(),n.wrapper=document.createElement("div"),(0,k.AS)(n.wrapper,{position:"absolute",margin:0,padding:0,"box-sizing":"content-box",resize:"none",outline:"none",border:"none","box-shadow":"1px 2px 5px ".concat((0,P.getAlphaColor)((0,P.getThemeColorByToken)("shadow-default"),.4)),"z-index":2,width:"0px",height:"0px",overflow:"visible",background:(0,P.getThemeColorByToken)("N00-FG"),cursor:"text"}),n.wrapper.classList.add("cell-wrapper-element"),n.wrapper.dataset.sheetElement="cell-wrapper-element",null===(t=n.wrapper)||void 0===t||t.addEventListener("mousedown",n.handleEditorWrapperClick),null===(r=n.wrapper)||void 0===r||r.addEventListener("copy",n.handleCopy,!0),null===(o=n.wrapper)||void 0===o||o.addEventListener("cut",n.handleCopy,!0);var u=null===(i=n.sdk)||void 0===i?void 0:i.getPlugin(R.$L),c=null==u?void 0:u.getHost(l);null==c||c.insertBefore(n.wrapper,null),n.sheetEditor=n.createCellEditor(Object.assign({source:"cell_editor",container:n.wrapper,sheetId:l,spread:null===(a=n.sdk)||void 0===a?void 0:a.spread,style:{forceLineHeight:"1.4",fontColor:"--text-title",fontWeight:400},sheetBridge:{isZoomDisabled:function(){return n.isZoomDisabled()}},onInit:function(e,t){var r=e.getContainer();r instanceof HTMLDivElement||(r=(0,_.ST)(r).container.parentElement);n.editorDom=r,n.setEditorStyle=t,(0,k.AS)(n.editorDom.parentElement,{display:"flex",minWidth:"inherit",minHeight:"inherit"})},onSelectionChange:function(){return n.handleEditorSelectionChange()},onEditorContentChange:function(e){return n.handleEditorContentChanged(e)},onSetStoreAttributes:n.handleSetStoreAttributes,onEditorFocus:function(){return n.handleEditorFocus()},onEditorKeydown:function(e){return n.handleEditorKeydown(e)},onEditorError:function(e){return n.handleEditorError(e)},onEditorClick:function(e){return n.handleEditorClick(e)},onEditorBeforeInput:function(e){return n.handleEditorBeforeInput(e)},onEditorCompositionStart:function(){return n.handleCompositionSatrt()},disabledPlugins:[]},n.editorOptions,{sdk:n.sdk})),n.onEditorCreated(),null===(s=n.store)||void 0===s||s.commit("CellEditorStore/setEditorWrapper",n.wrapper)}}},this.isEditing=function(e){var t=n._getEditorStatus();return null!=t&&[C.I9.EDIT_INVALID,C.I9.EDIT,C.I9.HIDDEN,C.I9.SUMMARY].includes(t)},this.isEndEditSuspending=function(e){return n._getEditorStatus()===C.I9.END_EDIT_SUSPENSE},this.startEdit=function(e){var t,r,o,i,a=e.sheet,s=e.defaultText,l=void 0===s?null:s,c=e.isEnterEditWithoutCover,h=void 0!==c&&c,d=e.enableFocus,f=void 0===d||d,v=e.needInitContent,p=void 0===v||v,g=e.source,m=void 0===g?u.kFS.Cell:g,_=e.keepOldValue,y=void 0!==_&&_,k=e.ignoreBreakStart,E=e.shell;if(n.clearInputTimer(),n.resetInputting(),k||!n.shouldBreakStartEdit({sheet:a,isEnterEditWithoutCover:h,source:m,shell:E})){n.canArrowEndEdit=!p;var T=a.getActiveRowIndex(),b=a.getActiveColumnIndex();f&&n.focusForStartEdit(),(0,u.FPR)("BEFORE_SHOW_CELL"),a.showCell(a._activeRowIndex,a._activeColIndex,3,3);var I,R=a.getActualStyle(T,b),w=a.getCellHAlign(T,b,R);if(R=S.bgS.withUpdateStyle(R,{hAlign:w}),(0,u.FPR)("MOX_SET_DATA"),!(null!==(t=n.sheetEditor.editorCommand)&&void 0!==t&&t.checkEditorEmpty()||y))null===(I=n.sheetEditor.editorCommand)||void 0===I||I.clearEditorContent();(0,u.FPR)("START_TRIGGER_EDIT_STARTING"),(0,u.vRF)(u.FHD.ENTER_EDIT,u.G2P.START),n.updateEditorStyle({sheet:a,cellStyle:R}),null===(r=n.store)||void 0===r||r.commit("CellEditorStore/setEditingCell",{row:T,col:b}),null===(o=n.store)||void 0===o||o.commit("CellEditorStore/setEditorRect",{contentRect:a.sheetContentRect(),rangeRect:a.getCellRect(T,b),canvasRect:a.getCanvasBoundingClientRect()}),null===(i=n.store)||void 0===i||i.commit("CellEditorStore/setEditorStatus",{status:C.I9.EDIT}),(0,u.FPR)("START_TRIGGER_EDIT_STARTING"),(0,u.vRF)(u.FHD.ENTER_EDIT,u.G2P.START),n.setEditorValue({sheet:a,row:T,col:b,cellStyle:R,defaultText:l,needInitContent:p}),n.focusEditor(),n.afterEnterEdit(),(0,u.FPR)("BEFORE_SET_TIME_OUT"),setTimeout((function(){(0,u.vRF)(u.FHD.ENTER_EDIT,u.G2P.END),(0,u.FPR)("end")}),0)}},this.endEdit=function(e){var t,r,o,i,a,s=e.sheet,l=e.ignoreValueChange,u=e.exitEditWhileCheckInputInvalid,c=e.isEndEditByBlur,h=e.ignoreBreakEnd,d=e.source,f=e.h5CellEditorActiveCell;n.clearInputTimer(),n.resetInputting();var v,p,g=s&&n.shouldBreakEndEdit(s)&&!h;if(!s||g)return n.endSummaryGraceful(C.F5.END_EDIT_BREAK),null===(v=n.store)||void 0===v||v.commit("FormulaLanguageServicePlugin/updateActiveEditor",null),!0;try{var m,y;if(null===(m=n.sheetEditor.editor)||void 0===m||m.blur(),!n.isH5Mode)null===(y=n.sheetEditor.editor)||void 0===y||y.focus()}catch(e){(0,L.tz)(e)}n.isActiveEditor||(null===(p=n.store)||void 0===p||p.commit("FormulaLanguageServicePlugin/updateActiveEditor",n.sheetEditor));(0,_.wW)(n.sheetEditor.editor.getContainer())&&(0,k.KD)(),(0,k.wT)();var E,T,b,I=n.getEditingCellPosition(s),w=I.row,A=I.col,F=n.getEditorValue({force:!0}),D={sheet:s,sheetName:s.name(),row:w,col:A,editingText:F,editingArray:[],autoFormat:!0,cancel:!1},N=G(w,A),P=(null===(t=F)||void 0===t?void 0:t.length)||0;if(l)return(0,k.pM)({source:d,cellPos:N,count:P,ignoreValueChange:l}),n.sheetEditor.pluginManager.closeMention(),null===(E=n.store)||void 0===E||E.commit("CellEditorStore/setEditingCell",null),null===(T=n.store)||void 0===T||T.commit("CellEditorStore/setEditorValue",""),null===(b=n.store)||void 0===b||b.commit("CellEditorStore/setEditorStatus",{status:C.I9.IDLE}),!0;(0,k.pM)({source:d,cellPos:N,count:P});var O=n.getSegmentArrayAndFileTokenSuiteMap(s);if(!O)return!0;var M=O.segmentArray,V=O.fileTokenSuiteMap,Z=O.userIds,B=s.parent._context.getToken(),H=Object.keys(V).reduce((function(e,t){return t===B&&void 0!==t?e:e.concat(V[t])}),[]),U=s.inject(x.Cy),j=U.getPivotTableNameByCell(w,A),K=U.getPivotTableByName(j),W=U.getCellInfo(w,A),z=K&&W;if(M.length&&!z&&(H.length||Z.length))return n.updateFileTokenAndUserInfoToSheet({sheet:s,value:D.editingText,segmentArray:M,fileTokens:H,h5CellEditorActiveCell:f,userIds:Z}),!0;if(D.editingArray=M,F&&"="!==F[0]&&(M.length>1||!(0,S.WVI)(M))&&(F=M),w>=0&&A>=0&&!n.endEditCore({sheet:s,value:F,plainValue:D.editingText,editEndedArgs:D,segmentArray:M,exitEditWhileCheckInputInvalid:u,isEndEditByBlur:c,h5CellEditorActiveCell:f,pivotInfo:{pivotTable:K,tableName:j,cellInfo:W}}))return!1;var Y,J,q=null===(r=n.sdk)||void 0===r?void 0:r.getPlugin("FormulaLanguageServicePlugin");(q&&(q.initRecommendArrayFormulaStatus(),q.aiFunctionHelper.setAiFuncEditorStatus(!1)),n.sheetEditor.pluginManager.closeMention(),null===(o=n.store)||void 0===o||o.commit("CellEditorStore/setEditingCell",null),null===(i=n.store)||void 0===i||i.commit("CellEditorStore/setEditorValue",""),null===(a=n.store)||void 0===a||a.commit("CellEditorStore/setEditorStatus",{status:C.I9.IDLE}),c)||(null===(Y=n.sdk)||void 0===Y||null===(J=Y.getPlugin(R.$L))||void 0===J||J.setFocus(s.id()));return n.ignoreValidationShowWarning=!1,!0},this.getEditorValue=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{force:!1},r=t.force,o=null===(e=n.sheetEditor.editorCommand)||void 0===e?void 0:e.getEditorText(r);return!(0,S.lep)(o)&&o.length>0?o:null},this.setEditorValue=function(e){var t=e.row,r=e.col,o=e.sheet,i=e.cellStyle,a=e.defaultText,s=e.needInitContent,l=o.getFormula(t,r,{ref:new S.luK(t,r,o)});l&&(l="=".concat(l));var c,h=l;if(o.getReminder(t,r)&&(i=S.bgS.withFormatter(i,o.getReminderFormatter(t,r))),!l||0===l.length){var d=o.getSegmentArray(t,r);if(Array.isArray(d))l=d;else if(h=l=o.getValue(t,r),"string"==typeof(l=(0,u.ali)(l)?"":(0,S.Kq2)(i,l,o).value)&&!l.startsWith("=")){var f=o.getActualStyle(t,r);l=[{type:"text",text:l,style:S.bgS.withUpdateStyle(f,{backColor:void 0,borderTop:void 0,borderRight:void 0,borderBottom:void 0,borderLeft:void 0,wordWrap:S.ngh.OVERFLOW,hAlign:u.KqL.General})}]}}(n.oldValue=l,n.originalValue=h,(0,S.lep)(a)||(l=a),s)&&(null===(c=n.store)||void 0===c||c.commit("CellEditorStore/setEditorValue",l))},this.focus=function(e){var t,r,o,i,a=null===(t=n.store)||void 0===t?void 0:t.getState("FocusStore"),s=null==a?void 0:a.focusedSheetId;if(s&&(!e||e===s)){var l=null===(r=n.sdk)||void 0===r?void 0:r.spread.getSheetFromId(s),u=null===(o=n.wrapper)||void 0===o?void 0:o.parentElement;if(l&&(u&&(null==a?void 0:a.hostMap[s])===u||n.createEditor(),n.sheetEditor)){var c=null===(i=n.store)||void 0===i?void 0:i.getState("CellEditorStore");if(c&&null===c.editingCell){var h=l.getActiveRowIndex(),d=l.getActiveColumnIndex(),f=l.getCellRect(h,d);f&&(0,k.AS)(c.editorWrapper,{left:f.x-2+"px",top:f.y-2+"px"})}n.sheetEditor.setSheetId(s),n.shouldFocusOnCellEditor(l)&&!n.isH5Mode&&setTimeout((function(){n.focusEditor()}),0)}}},this.focusEditor=function(){var e,t,r,o,i,a=null===(e=n.store)||void 0===e||null===(t=e.getState("PermissionStore"))||void 0===t?void 0:t.editable,s=null===(r=n.sdk)||void 0===r?void 0:r.getPlugin("FormulaLanguageServicePlugin"),l=null==s?void 0:s.aiFunctionHelper.isAiFuncEditorFocus;a&&!l&&(null===(o=n.sheetEditor)||void 0===o||null===(i=o.editorCommand)||void 0===i||i.focusAtEnd(),n.handleEditorFocus())},this.handleSelectionHook=function(){var e,t,r=null===(e=n.sdk)||void 0===e?void 0:e.spread,o=(null==r?void 0:r.getActiveSheet())||null,i=null===(t=n.sdk)||void 0===t?void 0:t.getPlugin("FormulaLanguageServicePlugin");return!(null==i||!i.aiFunctionHelper.isRangeSelecting)||n.endEdit({sheet:o,source:C.F5.HANDLE_SELECTION_HOOK})},this.onEditorContentChangedFromOtherEditor=function(e){var t,r;n.isActiveEditor||(null===(t=n.sheetEditor.editorCommand)||void 0===t||t.applyContentState(e.deltaSet,e.options),null===(r=n.sheetEditor.editorCommand)||void 0===r||r.clearAllStack())},this.handleBeforeUnload=function(e){var t,r;if((null===(t=n.store)||void 0===t||null===(r=t.getState("PermissionStore"))||void 0===r?void 0:r.editable)&&!u.Ps3.browser.isFeed){var o=n.getCanLeaveDetail(),i=o.activeSheet,a=o.isEditingInCatch,s=o.isEditing;if(i&&s){n.endEdit({sheet:i,ignoreBreakEnd:a,source:C.F5.HANDLE_BEFORE_UNLOAD});return e.returnValue="o/","o/"}}},this.getCanLeaveDetail=function(){var e,t=null===(e=n.sdk)||void 0===e?void 0:e.spread,r=null==t?void 0:t.getActiveSheet(),o=n.isEditingInCatch();return{activeSheet:r,isEditingInCatch:o,isEditing:n.isEditing(r)||o}},this.isEditingInCatch=function(){return n._getEditorStatus()===C.I9.IDLE&&n.isActiveEditor},this.handleCellDoubleClicked=function(e){var t=e.shell,r=e.props.sheet;if(r){var o=r.getActiveRowIndex(),i=r.getActiveColumnIndex();r.getFormula(o,i)&&n.setHAlignForFormulaText();var a=r.getSelections(),s=a[a.length-1];s&&(s.colCount()>1||s.rowCount()>1)&&!(0,S.xAK)(r,s)||n.startEdit({sheet:r,isEnterEditWithoutCover:!0,shell:t})}},this._isSheetFocused=function(e){var t=n._getFocusedSheetId();return Boolean(t&&(null==e?void 0:e.id())===t)},this.handlePosChanged=function(e){var t,r,o,i=e.shell,a=e.props.sheet;if(n._isSheetFocused(a)){var s=null===(t=n.store)||void 0===t?void 0:t.getState("CellEditorStore");if(s&&[C.I9.SUMMARY,C.I9.EDIT,C.I9.EDIT_INVALID].includes(s.editorStatus)){var l,u=a.getActiveRowIndex(),c=a.getActiveColumnIndex(),h=i.sheetView();if(null!==(r=n.formulaLanguageServicePlugin)&&void 0!==r&&r.aiFunctionHelper.isRangeSelecting){var d,f;l=h.getRealCellRect(a,null===(d=s.editingCell)||void 0===d?void 0:d.row,null===(f=s.editingCell)||void 0===f?void 0:f.col)}else{var v,p;if(u!==(null===(v=s.editingCell)||void 0===v?void 0:v.row)||c!==(null===(p=s.editingCell)||void 0===p?void 0:p.col))return;l=h.getRealCellRect(a,u,c)}l&&(null===(o=n.store)||void 0===o||o.commit("CellEditorStore/setEditorRect",{rangeRect:l,canvasRect:h.getCanvasBoundingClientRect(),contentRect:a.sheetContentRect()}))}}},this.handleRangeChanged=function(e,t){var r,o=e.range;if(n._isSheetFocused(t)){var i=null===(r=n.store)||void 0===r?void 0:r.getState("CellEditorStore");if(i&&[C.I9.EDIT,C.I9.EDIT_INVALID].includes(i.editorStatus)){var a=n.getEditingCellPosition(t),s=a.row,l=a.col;null!=o&&o.containCell(s,l)&&(0,S.xAK)(t,o)&&(s===o.rowFrom()&&l===o.colFrom()||n.endEdit({sheet:t,ignoreValueChange:!0,source:C.F5.HANDLE_RANGE_CHANGED}))}}},this.handleCellClicked=function(e){var t,r=e.shell,o=e.props,i=o.sheet,a=o.row,s=o.col;if(null!==(t=i.options)&&void 0!==t&&t.isProtected){var l=r.sheetView(),u=l.getRealCellRect(i,a,s);if(n.canShowSummary(i,a,s))return void n.tryShowSummary({sheetView:l,sheet:i,row:a,col:s,cellRect:u})}var c=n._getFocusedSheetId();c&&(null==i?void 0:i.id())===c&&n.focus()},this.handleActiveCellChanged=function(e){n.focus(e.sheetId)},this.handleFocusChange=function(e,t){if(e)n.focus();else if(t){var r,o=(null===(r=n.sdk)||void 0===r?void 0:r.spread.getSheetFromId(t))||null;n.endEdit({sheet:o,isEndEditByBlur:!0,source:C.F5.HANDLE_FOCUS_CHANGE}),n.endSummaryGraceful(C.F5.HANDLE_FOCUS_CHANGE)}},this.handleOptionChanged=function(e){var t,r,o=e.value,i=e.pn,a=e.sheet;if("isProtected"===i){var s,l,u=Boolean(o);if(u){if(!n._isOnline()&&n.isEditing(a)){var c,h=null===(c=n.sheetEditor.editorCommand)||void 0===c?void 0:c.getEditorContent();h&&n._showOfflineCopyModal(h)}n.endEdit({sheet:a,ignoreValueChange:!0,source:C.F5.HANDLE_OPTION_CHANGED})}if(null!==(t=n.sdk)&&void 0!==t&&null!==(r=t.spread)&&void 0!==r&&r._context.isEmbed())null===(s=n.sheetEditor)||void 0===s||null===(l=s.editor)||void 0===l||l.setEditable(!u)}},this.handleRowOrColDragged=function(e){var t=e.sheet;n.endEdit({sheet:t,source:C.F5.HANDLE_ROW_OR_COL_DRAGGED})},this.handleBeforeActiveSheetChange=function(e){var t,r,o=e.oldSheet;null!==(t=n.sdk)&&void 0!==t&&null!==(r=t.getPlugin("FormulaLanguageServicePlugin"))&&void 0!==r&&r.shouldBreakEndEditBeforeActiveSheetChange()||n.endEdit({sheet:o,source:C.F5.HANDLE_BEFORE_ACTIVE_SHEET_CHANGE})},this.handleActiveSheetChanged=function(){n.endSummaryGraceful(C.F5.HANDLE_ACTIVE_SHEET_CHANGE)},this.handleEditorError=function(e){if(n.editorErrorTimes++,(0,L.tz)(e),n.editorErrorTimes<10){var t;n.createEditor();var r,o,i=null===(t=n.sdk)||void 0===t?void 0:t.pluginStore.getState("FormulaLanguageServicePlugin"),a=null==i?void 0:i.editorContent;if(a)null===(r=n.sheetEditor)||void 0===r||null===(o=r.editorCommand)||void 0===o||o.setContent(a.getActiveZone().getContent())}else setTimeout((function(){n.editorErrorTimes=0}),1e3)},this.handleEditorClick=function(e){var t,r;null===(t=n.sdk)||void 0===t||null===(r=t.getPlugin("FormulaLanguageServicePlugin"))||void 0===r||r.handleEditorClick()},this.handleEditorWrapperClick=function(e){var t,r;n.canArrowEndEdit=!1,e.target===(null===(t=n.editorDom)||void 0===t?void 0:t.parentElement)&&e.preventDefault();var o=(0,_.ST)(n.sheetEditor.editor.getContainer());if((null===(r=o.container)||void 0===r||!r.contains(e.target))&&n.editorDom){var i,a,s=e.offsetX,l=e.offsetY,u=n.editorDom.offsetTop,c=n.editorDom.offsetHeight,h=l<=u?1:c-1,d=null===(i=o.hitTest)||void 0===i?void 0:i.call(o,{x:s,y:h});if(!d)return;null===(a=o.setSelection)||void 0===a||a.call(o,{startPoint:d,endPoint:d,isCollapsed:!0,isBackward:!1})}},this.isEditorContentFormula=function(){var e=n.getEditorValue({force:!0});return(0,k.RA)(e)},this.shouldArrowKeyEndEditor=function(e,t){var r=n._getEditorStatus()===C.I9.EDIT_INVALID;return t&&(0,k.dj)(e.keyCode)&&n.canArrowEndEdit&&!r&&!n.isEditorContentFormula()},this.preventDefaultIfNessaary=function(e){"@"!==e.key||e.ctrlKey||e.metaKey||e.altKey||e.preventDefault()},this.isEditNextLine=function(e){return e.keyCode===u.VDZ.Enter&&(e.ctrlKey||e.altKey||e.metaKey)},this.handleEditorKeydown=function(e){var t,r,o,i,a,s;null===(t=n.formulaLanguageServicePlugin)||void 0===t||t.handleKeydown(e);var l=null===(r=n.sdk)||void 0===r?void 0:r.spread,c=null==l?void 0:l.getActiveSheet();if(!c||!(0,k.SO)(n.sdk)||null!=c&&null!==(o=c.options)&&void 0!==o&&o.isProtected)n.preventDefaultIfNessaary(e);else{(0,u.FPR)("BEFORE_KEY_DOWN");var h=n.isEditing(c);null===(i=n.sdk)||void 0===i||null===(a=i.getPlugin(N.B_))||void 0===a||a.handleUndoAndRedo(e.nativeEvent,h);var d=e.keyCode===u.VDZ.Ime;if(h)return n.checkIsInput(G(c.getActiveRowIndex(),c.getActiveColumnIndex())),n.isEditNextLine(e)&&e.preventDefault(),d&&e.stopPropagation(),n.isH5Mode&&e.keyCode===u.VDZ.Enter&&n.endEdit({sheet:c,h5CellEditorActiveCell:c?{col:c.getActiveColumnIndex(),row:c.getActiveRowIndex()}:void 0,exitEditWhileCheckInputInvalid:!0}),void(n.shouldArrowKeyEndEditor(e,c)&&n.endEdit({sheet:c,source:C.F5.ARROW_END_EDITOR}));(0,b.O)(e.nativeEvent,null===(s=n.sdk)||void 0===s?void 0:s.getPlugin(N.B_))&&!n.shouldBreakStartEdit({sheet:c||null})?((0,u.FPR)("START_EDIT_BYKEYBOARD"),"Equal"!==e.code&&e.keyCode!==u.VDZ.Plus||n.setHAlignForFormulaText(),c&&n.startEdit({sheet:c,needInitContent:!1,keepOldValue:!0,ignoreBreakStart:!0})):n.preventDefaultIfNessaary(e)}},this.checkIsInput=function(e){n.isInputting||(0,k.H$)(e),n.isInputting=!0,n.clearInputTimer(),n.inputTimer=window.setTimeout((function(){(0,k.Ex)(),n.resetInputting()}),1e4)},this.clearInputTimer=function(){n.inputTimer&&clearTimeout(n.inputTimer)},this.resetInputting=function(){n.isInputting=!1},this.handleEditorBeforeInput=function(e){var t,r;if(("="===e.data||"+"===e.data)&&(0,k.SO)(n.sdk)){var o=null===(t=n.sdk)||void 0===t?void 0:t.spread,i=null==o?void 0:o.getActiveSheet();null!=i&&null!==(r=i.options)&&void 0!==r&&r.isProtected||n.shouldBreakStartEdit({sheet:i||null})||i&&n.startEdit({sheet:i,needInitContent:!1,keepOldValue:!0,ignoreBreakStart:!0})}},this.handleCompositionSatrt=function(){var e,t;if(u.Ps3.browser.isWindows&&(u.Ps3.browser.isChrome||u.Ps3.browser.blink)){var r,o,i=null===(r=n.sdk)||void 0===r?void 0:r.spread,a=null==i?void 0:i.getActiveSheet();!a||null!==(o=a.options)&&void 0!==o&&o.isProtected||!(0,k.SO)(n.sdk)||n.isEditing()||n.shouldBreakStartEdit({sheet:a})||n.startEdit({sheet:a,needInitContent:!1,keepOldValue:!0,ignoreBreakStart:!0})}!u.Ps3.browser.isSafari||n.isEditing()||null!==(e=n.sheetEditor.editorCommand)&&void 0!==e&&e.checkEditorEmpty()||(null===(t=n.sheetEditor.editorCommand)||void 0===t||t.clearEditorContent())},this.handleEditorSelectionChange=function(){var e,t,r;if(n.isActiveEditor){var o=null===(e=n.sheetEditor.editorCommand)||void 0===e?void 0:e.getEditorSelection(),i=null===(t=n.store)||void 0===t?void 0:t.getState("CellEditorStore");(0,I.Vt)(o,null==i?void 0:i.editorSelection)||null===(r=n.store)||void 0===r||r.commit("FormulaLanguageServicePlugin/updateEditorSelection",o)}},this.handleEditorFocus=function(){var e;if(n.isEditing(null===(e=n.sdk)||void 0===e?void 0:e.spread.getActiveSheet())){var t,r,o,i;if(!n._getFocusedSheetId())null===(o=n.sdk)||void 0===o||null===(i=o.getPlugin(R.$L))||void 0===i||i.setFocus();null===(t=n.sdk)||void 0===t||t.pluginStore.commit("FormulaLanguageServicePlugin/updateActiveEditor",n.sheetEditor,"CellEditorPlugin"),null===(r=n.sdk)||void 0===r||r.pluginStore.commit("FormulaLanguageServicePlugin/updateEditorStoreAttributes",{})}},this.handleSetStoreAttributes=function(e,t){var r;null===(r=n.sdk)||void 0===r||r.pluginStore.commit("FormulaLanguageServicePlugin/updateEditorStoreAttributes",(0,p.Z)({},e,t))},this.handleEditorContentChanged=function(e){var t,r,o,i,a,s,l,u=null===(t=n.store)||void 0===t||null===(r=t.getState("CellEditorStore"))||void 0===r?void 0:r.editorStatus;(n.isActiveEditor||u===C.I9.IDLE)&&null!==(o=e.deltaSet.deltas[0])&&void 0!==o&&null!==(i=o.ops)&&void 0!==i&&i.length&&(null===(a=n.sdk)||void 0===a||null===(s=a.getPlugin("FormulaBarPlugin"))||void 0===s||s.onEditorContentChangedFromOtherEditor(e),null===(l=n.store)||void 0===l||l.commit("FormulaLanguageServicePlugin/updateEditorContent",e.current,"CellEditorPlugin"))},this.handleCopy=function(e){var t,r,o=null===(t=n.sdk)||void 0===t?void 0:t.spread;null!=o&&o.getService(c.Qh).check(c.Vw.DOCCONTENTCOPY)||(e.preventDefault(),e.stopPropagation(),n.isH5Mode&&(null===(r=n.sheetEditor.editor)||void 0===r||r.blur()))},this.updateEditorStyle=function(e){e.sheet;var t=e.cellStyle;if(t){var r,o,i,a,s=null!==(r=null===(o=n.store)||void 0===o||null===(i=o.getState("CellEditorStore"))||void 0===i?void 0:i.editorStyle.hAlign)&&void 0!==r?r:t.hAlign;(0,S.lep)(s)&&(s=(0,S._d$)(t.hAlign,n.originalValue,t.formatter)),null===(a=n.store)||void 0===a||a.commit("CellEditorStore/setEditorStyle",{textDecorationType:t.textDecoration||0,fontSize:t.fontSizePx,colorFont:t.foreColor?(0,P.getThemeColor)(t.foreColor,P.ColorType.FOREGROUND):(0,P.getThemeColorByToken)("text-title"),colorBg:t.backColor,hAlign:s||u.KqL.Left,vAlign:t.vAlign||u.g$I.Top,wordWrap:t.wordWrap||S.ngh.OVERFLOW})}},this.updateFileTokenAndUserInfoToSheet=function(){var e=(0,v.Z)(f().mark((function e(t){var r,o,i,a,s,l,c,h,d,v,p,g,m,_,y,S;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=t.sheet,i=t.value,a=t.fileTokens,s=t.userIds,l=t.segmentArray,u.Ps3.Toast.show({key:"sheet.watchdog_warning",type:"loading",duration:0,content:Z("sheet.watchdog_warning")}),c=n.getEditingCellPosition(o),h=c.row,d=c.col,v=o.parent._context.getToken(),null===(r=n.store)||void 0===r||r.commit("CellEditorStore/setEditorStatus",{status:C.I9.END_EDIT_SUSPENSE,source:C.F5.COPY_DRIVE_IMAGE_TO_SHEET}),e.prev=5,!a.length){e.next=14;break}return e.next=9,u.Ps3.imageHelper.copyDriveTokenForSheet(o,a,v,"sheet_file");case 9:if(_=e.sent,y=!1,l.forEach((function(e){if((0,u.S3_)(e)){var t=_[e.fileToken];e.fileToken=t||e.fileToken,!t&&a.includes(e.fileToken)&&(y=!0)}})),!y){e.next=14;break}throw new Error;case 14:if(!s.length){e.next=17;break}return e.next=17,n.updateUserSegment(l,s);case 17:(0,k.Kk)({sheet:o,row:h,col:d,options:{newSegmentArray:l}})&&(o.dispatch(u.U_F.BeforeEditorIdle),o.setCellValue(h,d,i,!0,l)),n.sheetEditor.pluginManager.closeMention(),null===(p=n.store)||void 0===p||p.commit("CellEditorStore/setEditingCell",null),null===(g=n.store)||void 0===g||g.commit("CellEditorStore/setEditorValue",""),null===(m=n.store)||void 0===m||m.commit("CellEditorStore/setEditorStatus",{status:C.I9.IDLE,source:C.F5.COPY_DRIVE_IMAGE_TO_SHEET_RELEASE}),e.next=30;break;case 24:return e.prev=24,e.t0=e.catch(5),u.Ps3.Toast.removeAll(),u.Ps3.Toast.error({content:Z("mention.saved_failure")}),null===(S=n.store)||void 0===S||S.commit("CellEditorStore/setEditorStatus",{status:C.I9.EDIT,source:C.F5.COPY_DRIVE_IMAGE_TO_SHEET_CATCH}),e.abrupt("return");case 30:return e.prev=30,u.Ps3.Toast.remove("sheet.watchdog_warning"),e.finish(30);case 33:case"end":return e.stop()}}),e,null,[[5,24,30,33]])})));return function(t){return e.apply(this,arguments)}}(),this.updateUserSegment=function(){var e=(0,v.Z)(f().mark((function e(t,r){var o,i,a,s,l;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,null===(o=n.sdk)||void 0===o||null===(i=o.spread.getUserPermissionManager())||void 0===i?void 0:i.fetchUsers(r);case 3:s=e.sent,(l=null==s||null===(a=s.payload)||void 0===a?void 0:a.entities)&&(0,V.YZ)(t,l),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.error("update user mention error: ",e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}(),this.endEditCore=function(e){var t=e.sheet,r=e.value,o=e.plainValue,i=e.editEndedArgs,a=e.segmentArray,s=e.exitEditWhileCheckInputInvalid,l=e.isEndEditByBlur,c=(e.h5CellEditorActiveCell,e.pivotInfo),h=n.oldValue,d=n.getEditingCellPosition(t),f=d.row,v=d.col;if((0,k.cu)(h,r)){var p=c.pivotTable,g=c.tableName,m=c.cellInfo;if(p&&m)return(0,k.HI)(t,g,p,m,f,v,n.oldValue,o);var _=(0,k.RR)({sheet:t,row:f,col:v}),y=(0,w.u6)("formulabar");u.Ps3.collectSuiteEvent("edit_cell_content",{action:"input",valid_type:_,mode:y?"formula_bar":"editor"});var C=!1,E=null,T="",b=o,I=t.getDataValidation(f,v),R=t.parent.permissionManager,A=!!R.userPerm.getPermMap().size;if(I||A){var F=(0,S.Q8)(f,v,t,b),D=F.isFormula,N=F.formulaVar,P=F.text;if(D&&N&&(b=N.getValue(),C=!0,E=N,T=P),A&&E){var M=E.getRefMap()||{},L=Object.values(M),x=L.some((function(e){var t;return!R.hasSheetVisiblePermission((null===(t=e.sheet())||void 0===t?void 0:t.id())||"")}));if(x)return u.Ps3.Toast.warning({content:Z("LarkCCM_Sheets_Protect_AreaContainProtectedCantRefer_Error")}),!1;var V,H=null===(V=n.sdk)||void 0===V?void 0:V.getPlugin("ProtectZonePlugin");if(null!=H&&H.shouldShowFormulaSecurityDialog()){var U,j=B(L);try{for(j.s();!(U=j.n()).done;){var G,K=(null===(G=U.value.sheet())||void 0===G?void 0:G.id())||"";if(R.hasInvisible(K))return H.showFormulaSecurityDialog(),!1}}catch(e){j.e(e)}finally{j.f()}}}if(I){var W=Object.assign(i,{editingText:b}),z=n.checkDataValidation({sheet:t,inputData:W,dataValidation:I,exitEditWhileCheckInputInvalid:s,isEndEditByBlur:l});if(!z.isEndEdit)return!1;if(!z.shouldSetCellValue)return!0}}if((0,k.XF)(t,f,v,h,r),(0,k.Kk)({sheet:t,row:f,col:v,options:{newSegmentArray:a}})){if(t&&t.dispatch(u.U_F.BeforeEditorIdle),I&&(0,S.Ju9)(I)){var Y=(0,S.YtE)(I);t.setCellValueByDataValidation(f,v,o,!!Y,C?T:null,C?E:null)}else t.setCellValue(f,v,o,!0,a);var J=(0,O.isDateTimeFormatter)((0,O.getPreferredFormatter)(t.formatterService,o||"").formatter);I&&!J&&(0,S.rMO)(I,f,v,"edit_input")}}else if(!t.isProxyArrayFormula(f,v)){var q=t.getVar(f,v).isFormula(),$=t.getActualStyle(f,v).formatter,X=$&&(0,O.isTextFormatter)($);(!q&&o&&["=","+"].includes(o[0])&&!X||q&&X)&&t.setCellValue(f,v,o,!0,a)}return!0},this.checkDataValidation=function(e){var t,r,o,i=e.sheet,a=e.inputData,s=e.dataValidation,l=e.exitEditWhileCheckInputInvalid,c=e.isEndEditByBlur,h=s.checkInputValid(a),d=(0,S.Od_)(s);return h||!d||n.ignoreValidationShowWarning?h||d?{isEndEdit:!0,shouldSetCellValue:!0}:l||c?{isEndEdit:!0,shouldSetCellValue:!1}:(null===(t=n.store)||void 0===t||t.commit("CellEditorStore/setEditorStatus",{status:C.I9.EDIT_INVALID,source:C.F5.CHECK_DATA_VALIDATION}),i._trigger(u.zW2.ShowValidationTipWhenReject),null===(r=n.sheetEditor.editorCommand)||void 0===r||r.setSelectionToLastCharacter(!1,!0),null===(o=n.sheetEditor.editor)||void 0===o||o.selection.updateViewSelection(!0),n.focusEditor(),{isEndEdit:!1}):(n.ignoreValidationShowWarning=!0,n.canArrowEndEdit=!1,c||n.isH5Mode?{isEndEdit:!0,shouldSetCellValue:!1}:(i._trigger(u.zW2.ShowValidationTipWhenReject),{isEndEdit:!1}))},this.handleEditorRectChange=function(){var e,t=null===(e=n.store)||void 0===e?void 0:e.getState("CellEditorStore");if(null!=t&&t.editorWrapper)switch(t.editorStatus){case C.I9.EDIT:case C.I9.EDIT_INVALID:case C.I9.SUMMARY:var r;n.isShow||(0,u.FPR)("CREATE_RICHEDITOR_END");var o=n._getFocusedSheetId();if(!o)return;var i=null===(r=n.sdk)||void 0===r?void 0:r.spread,a=null==i?void 0:i.getSheetFromId(o),s=Number(u.UIE.getItem(o));(isNaN(s)||n.isZoomDisabled())&&(s=1);var l=new D(t,s),c=l.styleMinWidth,d=l.styleMinHeight,f=function(e,t,n){var r=parseFloat(e);return isNaN(r)?e:"".concat(r+t*n,"px")};if((0,k.AS)(t.editorWrapper,{left:f(l.styleLeft,-1,s),right:f(l.styleRight,-1,s),top:f(l.styleTop,-1,s),width:"auto",height:"auto",minHeight:d,border:"".concat(2*s,"px solid var(--text-link-hover)"),zIndex:"80",overflow:"visible",visibility:"visible",opacity:1,backgroundColor:n.editorBgHelper.getColor(t.editorStyle.colorBg)}),n.setEditorStyle){var v,p,g=l.styleMaxWidth,m=l.styleMaxHeight,_=function(e){return parseInt(e,10)},y=function(e){return Number(e.slice(0,e.length-2))};n.setEditorStyle({minWidth:y(c)-8}),null===(v=n.sdk)||void 0===v||null===(p=v.getPlugin("FormulaBarPlugin"))||void 0===p||p.resizeEditor();var E=function(){_(m)<_(d)&&(m=d)};if(E(),null!=i&&i._context.isEmbed()){var T=[m,c].map(_),b=(0,h.Z)(T,2),I=b[0],R=b[1],w=Math.max(I,R),A=l.styleTopFromWindow,F=A&&!(null!=i&&i._context.isFullScreenMode())?window.innerHeight-_(A)-4:1/0;m="".concat(Math.min(F,w),"px"),E()}a.options.isProtected||t.editorStyle.wordWrap!==S.ngh.AUTOWRAP?(n.setEditorStyle({weakWidth:void 0}),n.sheetEditor.resizeEditor({maxContentWidth:y(g)},8)):(n.setEditorStyle({weakWidth:y(c)-8}),n.sheetEditor.resizeEditor({maxContentWidth:1/0})),(0,k.AS)(n.editorDom,{maxHeight:m}),(0,k.AS)(t.editorWrapper,{maxHeight:m})}n.isShow=!0;break;case C.I9.HIDDEN:(0,k.AS)(t.editorWrapper,{visibility:"hidden",opacity:1}),n.isShow=!1;break;case C.I9.IDLE:(0,k.AS)(t.editorWrapper,{width:"0px",height:"0px",minWidth:"auto",minHeight:"auto",zIndex:"-1",border:"none",overflow:"hidden",visibility:"visible",opacity:0}),n.isShow=!1}},this.handleEditorStyleChange=function(){var e,t=null===(e=n.store)||void 0===e?void 0:e.getState("CellEditorStore");if(null!=t&&t.editorWrapper&&n.editorDom&&n.setEditorStyle){var r,o,i=new D(t);(0,k.AS)(n.editorDom.parentElement,{alignItems:i.styleVAlign});var a=n._getFocusedSheetId(),s=1,l=S.OvR;a&&!n.isZoomDisabled()&&(s=Number(u.UIE.getItem(a))),null===(r=F().isH5)||void 0===r||r||(l=S.OvR*s),n.setEditorStyle({zoom:null===(o=F().isH5)||void 0===o||o?s:1,fontColor:t.editorStyle.colorFont,textAlign:i.styleHAlign,padding:i.stylePadding,backgroundColor:n.editorBgHelper.getColor(t.editorStyle.colorBg),fontSize:l+"px"})}},this.handleEditorValueChange=function(){var e,t,r,o,i,a=null===(e=n.store)||void 0===e?void 0:e.getState("CellEditorStore"),s=n._getFocusedSheetId(),l=s?null===(t=n.sdk)||void 0===t?void 0:t.spread.getSheetFromId(s):null,u=null===(r=null===(o=n.sdk)||void 0===o||null===(i=o.getPlugin("PermissionPlugin"))||void 0===i?void 0:i.getCopyable())||void 0===r||r;switch(null==a?void 0:a.editorStatus){case C.I9.EDIT:if(!l)return;var c,h;if(n.sheetEditor.editor&&(n.sheetEditor.editor.setEditable(!0),n.sheetEditor.editor.copyable=u),null!=a&&a.editorValue)null===(c=n.sheetEditor)||void 0===c||null===(h=c.editorCommand)||void 0===h||h.generateAndReplaceEditorValue(l,null==a?void 0:a.editorValue);break;case C.I9.SUMMARY:if(!l)return;var d,f;if(n.sheetEditor.editor&&(n.sheetEditor.editor.setEditable(!1),n.sheetEditor.editor.copyable=u),null!=a&&a.editorValue)null===(d=n.sheetEditor)||void 0===d||null===(f=d.editorCommand)||void 0===f||f.generateAndReplaceEditorValue(l,null==a?void 0:a.editorValue);break;case C.I9.IDLE:var v,p,g,m;if(n.sheetEditor.editor)null===(g=n.sheetEditor.editorCommand)||void 0===g||g.reset(),null===(m=n.sheetEditor.editorCommand)||void 0===m||m.replaceAllText(""),n.sheetEditor.editor.setEditable(!0),n.sheetEditor.editor.copyable=u;null===(v=n.store)||void 0===v||v.commit("CellEditorStore/setEditorStyle",{hAlign:null}),null===(p=n.store)||void 0===p||p.commit("FormulaLanguageServicePlugin/updateActiveEditor",null);break;case C.I9.HIDDEN:n.sheetEditor.editor&&(n.sheetEditor.editor.setEditable(!0),n.sheetEditor.editor.copyable=u)}},this.handleEditorStatusChange=function(){n.handleEditorRectChange(),n.handleEditorStyleChange(),n.handleEditorValueChange()},this.editorOptions=t}return(0,o.Z)(e,[{key:"init",value:function(e){var t;this.sdk=e,this.store=e.pluginStore,null===(t=this.store)||void 0===t||t.registerModule(T),this.bindEvents()}},{key:"setHooks",value:function(){var e,t=null===(e=this.sdk)||void 0===e?void 0:e.spread;t&&!this.isH5Mode&&(t.apiHookManager.setHook(S.vms.setSelection,this.handleSelectionHook,2),t.apiHookManager.setHook(S.vms.addSelection,this.handleSelectionHook,2),t.apiHookManager.setHook(S.vms.setActiveCell,this.handleSelectionHook,2))}},{key:"removeHooks",value:function(){var e,t=null===(e=this.sdk)||void 0===e?void 0:e.spread;t&&!this.isH5Mode&&(t.apiHookManager.removeHook(S.vms.setSelection,this.handleSelectionHook),t.apiHookManager.removeHook(S.vms.addSelection,this.handleSelectionHook),t.apiHookManager.removeHook(S.vms.setActiveCell,this.handleSelectionHook))}},{key:"getEditorOptions",value:function(){return Object.assign({},this.editorOptions||{})}},{key:"destroy",value:function(){var e,t,n;null===(e=this.editorBgHelperLazy)||void 0===e||e.destroy(),this.editorBgHelperLazy=void 0,this.disposeEditor(),null===(t=this.subscriber)||void 0===t||t.unsubscribe(),this.subscriber=null,null===(n=this.shellSubscriber)||void 0===n||n.unsubscribe(),this.shellSubscriber=null,this.unbindGlobalEvents(),this.unbindPluginEvents(),this.removeHooks(),this.sdk=void 0,this.editorOptions=void 0}},{key:"bindEvents",value:function(){var e,t,n;this.subscriber=null===(e=this.sdk)||void 0===e?void 0:e.spread.subscribe(this.getDepends()),this.shellSubscriber=null===(t=this.sdk)||void 0===t||null===(n=t.shellManager)||void 0===n?void 0:n.subscribe(this.getShellDepends()),this.bindGlobalEvents(),this.bindPluginEvents(),this.setHooks()}},{key:"getDepends",value:function(){var e;return e={},(0,p.Z)(e,u.U_F.OptionChanged,this.handleOptionChanged),(0,p.Z)(e,u.U_F.ActiveCellChanged,this.isH5Mode?m.default:this.handleActiveCellChanged),(0,p.Z)(e,u.U_F.RangeChanged,this.handleRangeChanged),(0,p.Z)(e,u.HaZ.BeforeActiveSheetChange,this.handleBeforeActiveSheetChange),(0,p.Z)(e,u.HaZ.ActiveSheetChanged,this.handleActiveSheetChanged),e}},{key:"getShellDepends",value:function(){var e;return e={},(0,p.Z)(e,u.jy$.CellClicked,this.isH5Mode?m.default:this.handleCellClicked),(0,p.Z)(e,u.jy$.CellDoubleClicked,this.isH5Mode?m.default:this.handleCellDoubleClicked),(0,p.Z)(e,u.jy$.PosChanged,this.handlePosChanged),(0,p.Z)(e,u.jy$.RowOrColDragged,this.handleRowOrColDragged),e}},{key:"bindGlobalEvents",value:function(){window.addEventListener("beforeunload",this.handleBeforeUnload)}},{key:"unbindGlobalEvents",value:function(){window.removeEventListener("beforeunload",this.handleBeforeUnload)}},{key:"bindPluginEvents",value:function(){var e,t,n,r,o;null===(e=this.store)||void 0===e||e.watch("FocusStore/focusedSheetId",this.handleFocusChange),null===(t=this.store)||void 0===t||t.watch("CellEditorStore/editorStyle",this.handleEditorStyleChange),null===(n=this.store)||void 0===n||n.watch("CellEditorStore/editorRect",this.handleEditorRectChange),null===(r=this.store)||void 0===r||r.watch("CellEditorStore/editorValue",this.handleEditorValueChange),null===(o=this.store)||void 0===o||o.watch("CellEditorStore/editorStatus",this.handleEditorStatusChange)}},{key:"unbindPluginEvents",value:function(){var e,t,n,r,o;null===(e=this.store)||void 0===e||e.unWatch("FocusStore/focusedSheetId",this.handleFocusChange),null===(t=this.store)||void 0===t||t.unWatch("CellEditorStore/editorStyle",this.handleEditorStyleChange),null===(n=this.store)||void 0===n||n.unWatch("CellEditorStore/editorRect",this.handleEditorRectChange),null===(r=this.store)||void 0===r||r.unWatch("CellEditorStore/editorValue",this.handleEditorValueChange),null===(o=this.store)||void 0===o||o.unWatch("CellEditorStore/editorStatus",this.handleEditorStatusChange)}},{key:"disposeEditor",value:function(){var e;if(null===(e=this.sheetEditor)||void 0===e||e.destroy(),this.wrapper){var t,n,r,o=this.wrapper.parentElement;null==o||o.removeChild(this.wrapper),null===(t=this.wrapper)||void 0===t||t.removeEventListener("mousedown",this.handleEditorWrapperClick),null===(n=this.wrapper)||void 0===n||n.removeEventListener("copy",this.handleCopy,!0),null===(r=this.wrapper)||void 0===r||r.removeEventListener("cut",this.handleCopy,!0),this.wrapper=null}}},{key:"moveEditorParentElement",value:function(e){e&&this.wrapper&&e.appendChild(this.wrapper)}},{key:"onEditorCreated",value:function(){}},{key:"_getFocusedSheetId",value:function(){var e,t;return null===(e=this.store)||void 0===e||null===(t=e.getState("FocusStore"))||void 0===t?void 0:t.focusedSheetId}},{key:"_getEditorStatus",value:function(){var e,t;return null===(e=this.store)||void 0===e||null===(t=e.getState("CellEditorStore"))||void 0===t?void 0:t.editorStatus}},{key:"isSummaryEditorOpen",value:function(){return this._getEditorStatus()===C.I9.SUMMARY}},{key:"isEditorOpen",value:function(){var e=this._getEditorStatus();return[C.I9.SUMMARY,C.I9.EDIT,C.I9.EDIT_INVALID].includes(e)}},{key:"hasSelection",value:function(){var e,t=null===(e=this.sheetEditor)||void 0===e?void 0:e.editorCommand.getEditorSelection();return Boolean(t&&t.start.offset!==t.end.offset)}},{key:"focusForStartEdit",value:function(){var e;null===(e=this.sdk)||void 0===e||e.pluginStore.commit("FormulaLanguageServicePlugin/updateActiveEditor",this.sheetEditor),this.focusEditor()}},{key:"afterEnterEdit",value:function(){var e;null===(e=this.sdk)||void 0===e||e.shellForEach((function(e){return e.sheetView().indicateRange([])}))}},{key:"setEditorStatus",value:function(e,t){var n,r,o,i=null===(n=this.store)||void 0===n?void 0:n.getState("CellEditorStore");(null==i?void 0:i.editorStatus)===C.I9.HIDDEN&&(null==t?void 0:t.status)===C.I9.EDIT&&(null===(o=this.store)||void 0===o||o.commit("CellEditorStore/setEditorValue",""));null===(r=this.store)||void 0===r||r.commit("CellEditorStore/setEditorStatus",t)}},{key:"getEditingCellPosition",value:function(e){var t,n,r=null===(t=this.store)||void 0===t||null===(n=t.getState("CellEditorStore"))||void 0===n?void 0:n.editingCell;return r&&j(r.row,0,e.getRowCount()-1)&&j(r.col,0,e.getColumnCount()-1)?Object.assign({},r):{row:e.getActiveRowIndex(),col:e.getActiveColumnIndex()}}},{key:"tryShowSummary",value:function(e){var t=e.sheet,n=e.sheetView,r=e.row,o=e.col,i=e.cellRect;if(t&&((0,S.A8G)(t,r,o)&&!(r<0||o<0||(0,S.Pq3)(t,r,o)))){var a=t.getValue(r,o);this.endSummaryGraceful(C.F5.TRY_SHOW_SUMMARY),a&&t.options.isProtected&&i&&n.getViewModel().typography.cellOverflow(r,o,!0)&&this.showSummary(t,r,o,i)}}},{key:"showSummary",value:function(e,t,n,r){var o,i,a,s,l=e.getActualStyle(t,n)||{};this.updateEditorStyle({sheet:e,cellStyle:l}),this.setEditorValue({row:t,col:n,sheet:e,cellStyle:l,needInitContent:!0}),null===(o=this.store)||void 0===o||o.commit("FormulaLanguageServicePlugin/updateActiveEditor",this.sheetEditor),null===(i=this.store)||void 0===i||i.commit("CellEditorStore/setEditingCell",{row:t,col:n}),null===(a=this.store)||void 0===a||a.commit("CellEditorStore/setEditorStatus",{status:C.I9.SUMMARY,source:C.F5.TRY_SHOW_SUMMARY}),null===(s=this.store)||void 0===s||s.commit("CellEditorStore/setEditorRect",{contentRect:e.sheetContentRect(),rangeRect:r})}},{key:"endSummaryGraceful",value:function(e){var t,n,r,o,i,a=null===(t=this.store)||void 0===t||null===(n=t.getState("CellEditorStore"))||void 0===n?void 0:n.editorStatus;a!==C.I9.SUMMARY&&a!==C.I9.EDIT_FAIL||(null===(r=this.store)||void 0===r||r.commit("CellEditorStore/setEditingCell",null),null===(o=this.store)||void 0===o||o.commit("CellEditorStore/setEditorValue",""),null===(i=this.store)||void 0===i||i.commit("CellEditorStore/setEditorStatus",{status:C.I9.IDLE,source:e}))}},{key:"setHAlignForFormulaText",value:function(){var e;null===(e=this.store)||void 0===e||e.commit("CellEditorStore/setEditorStyle",{hAlign:u.KqL.Left})}},{key:"canShowSummary",value:function(e,t,n){var r,o=this.sdk,i=null==o?void 0:o.spread;if(null!=i&&i.isRangeSelecting)return!1;if(null!=o&&null!==(r=o.getPlugin("FormulaLanguageServicePlugin"))&&void 0!==r&&r.isAcrossSheet)return!1;var a=e.getActiveCellIndex(),s=a.row,l=a.column;if(s!==t||l!==n)return!1;var u=e._selectionModel;return!u._isRowSelected(t)&&!u._isColumnSelected(n)}},{key:"shouldFocusOnCellEditor",value:function(e){var t,n,r,o,i,a=e.getActiveRowIndex(),s=e.getActiveColumnIndex(),l=e.getDataValidation(a,s),u=l&&(0,S.Ju9)(l),c=l&&(0,S.mJ9)(l);if(u&&c)return!1;if(null!==(t=this.sdk)&&void 0!==t&&null!==(n=t.spread)&&void 0!==n&&n.isRangeSelecting)return!1;if(null===(r=this.sdk)||void 0===r||null===(o=r.getPlugin("FormulaLanguageServicePlugin"))||void 0===o?void 0:o.isAcrossSheet)return!1;var h=null===(i=this.sdk)||void 0===i?void 0:i.pluginStore.getState("FormulaLanguageServicePlugin");return null==h||!h.activeEditor||(null==h?void 0:h.activeEditor)===this.sheetEditor}},{key:"_isOnline",value:function(){var e,t,n=null===(e=this.sdk)||void 0===e||null===(t=e.getPlugin("CollaborationPlugin"))||void 0===t?void 0:t.getNetworkState();return!n||"offline"!==n}},{key:"_showOfflineCopyModal",value:function(e){u.Ps3.Dialog.confirm({title:Z("LarkCCM_Sheets_OfflineNotice_Title"),content:Z("LarkCCM_Sheets_OfflineNotice_Description"),okText:Z("LarkCCM_Sheets_OfflineNotice_CopyToClipboard_Button"),cancelText:Z("LarkCCM_Sheets_OfflineNotice_GotIt_Button"),onOk:function(){var t,n,r,o;n=new Blob([e.text],{type:"text/plain"}),r=new Blob([e.html],{type:"text/html"}),o=new ClipboardItem((t={},(0,p.Z)(t,n.type,n),(0,p.Z)(t,r.type,r),t)),window.navigator.clipboard.write([o])}})}},{key:"shouldBreakEndEdit",value:function(e){var t,n;return(null===(t=this.store)||void 0===t||null===(n=t.getState("CellEditorStore"))||void 0===n?void 0:n.editorStatus)===C.I9.SUMMARY||!this.isEditing(e)}},{key:"shouldBreakStartEdit",value:function(e){var t,n,r,o,i,a,s=e.sheet,l=e.isEnterEditWithoutCover,h=void 0!==l&&l,d=e.source,f=e.shell;if(!s)return!0;if(!this.sheetEditor)return!0;if(!this._getFocusedSheetId())return!0;if(null!==(t=this.sdk)&&void 0!==t&&null!==(n=t.getPlugin("FormulaLanguageServicePlugin"))&&void 0!==n&&n.shouldBreakStartEdit())return!0;var v=s.getActiveRowIndex(),p=s.getActiveColumnIndex();if(v<0||p<0)return!0;if(this.isEndEditSuspending())return!0;var g=this.isSummaryEditorOpen();if(!g&&this.isEditing(s))return!0;if((0,k.P4)({sheet:s,row:v,rowCount:s._activeRowCount,col:p,colCount:s._activeColCount}))return!0;var m,_=s.getActualStyle(v,p).clone(),y=null===(r=this.sdk)||void 0===r?void 0:r.spread.getService(c.f3);if((null==y||!y.curRangeEditable)&&!1!==_.locked){var E=(0,S.zhK)(s,v,p),T=(0,S.Pq3)(s,v,p),b=s.isProxyArrayFormula(v,p);if(f&&E&&!b){var I=f.sheetView().getRealCellRect(s,v,p);this.showSummary(s,v,p,I)}else if(!T){var R;null===(R=this.store)||void 0===R||R.commit("CellEditorStore/setEditorStatus",{status:C.I9.EDIT_FAIL,source:C.F5.SHOULD_BREAK_START_EDIT})}return!0}if(s.tabType.isConnectorTab())return null===(m=this.store)||void 0===m||m.commit("CellEditorStore/setEditorStatus",{status:C.I9.EDIT_FAIL,source:C.F5.SHOULD_BREAK_START_EDIT}),!0;if(g)return!0;var w=(0,k.cN)({sheet:s,row:v,col:p});if(w){var A=w.isMultiple,F=d===u.kFS.Formulabar,D=w.dataValidation;if(D&&(0,S.mJ9)(D)&&(A||!F))return s._trigger(u.zW2.ShowDropdown,{row:v,col:p}),!0}var N=s.getSegmentArray(v,p);if(h&&(0,S.uUo)(N)&&!this.isH5Mode)return!0;var P=s._getModel();return!!(null==P?void 0:P.getExtralValue(v,p,u.PoN))||(!(0,k.CP)(s,this._isOnline(),v,p)||(!(!this.isH5Mode||s.getSelections().length)||(!(null===(o=this.cellNoteEditorPlugin)||void 0===o||!o.isEditing())||!(null===(i=this.sdk)||void 0===i||null===(a=i.spread)||void 0===a||!a._context.isEmbed()||this._isOnline()))))}},{key:"isZoomDisabled",value:function(){var e,t=null===(e=this.sdk)||void 0===e?void 0:e.spread;return Boolean((null==t?void 0:t._context.isEmbed())&&!t._context.isFullScreenMode())}},{key:"getSegmentArrayAndFileTokenSuiteMap",value:function(e){if(this.sheetEditor.editor){var t=(0,M.KD)(this.sheetEditor.editor),n=t.segmentArray,r=t.fileTokenSuiteMap,o=t.userIds;return n.length?{segmentArray:(0,S.Xe6)(n,e),fileTokenSuiteMap:r,userIds:o}:{segmentArray:n,fileTokenSuiteMap:r,userIds:o}}}},{key:"updateEditorStyleState",value:function(e){var t;null===(t=this.store)||void 0===t||t.commit("CellEditorStore/setEditorStyle",e)}},{key:"updateEditorValueState",value:function(e){var t;null===(t=this.store)||void 0===t||t.commit("CellEditorStore/setEditorValue",e)}},{key:"isActiveEditor",get:function(){var e,t;return(null===(e=this.store)||void 0===e||null===(t=e.getState("FormulaLanguageServicePlugin"))||void 0===t?void 0:t.activeEditor)===this.sheetEditor}},{key:"formulaLanguageServicePlugin",get:function(){var e;return null===(e=this.sdk)||void 0===e?void 0:e.getPlugin("FormulaLanguageServicePlugin")}},{key:"cellNoteEditorPlugin",get:function(){var e;return null===(e=this.sdk)||void 0===e?void 0:e.getPlugin("CellNoteEditorPlugin")}},{key:"editorBgHelper",get:function(){return this.editorBgHelperLazy||(this.editorBgHelperLazy=new k.lq("var(--N00)")),this.editorBgHelperLazy}}]),e}();K=U([(0,y.Mn)({required:[c.kM]})],K);var W=n("vsh_82358"),z=function(e){function t(){var e;return(0,r.Z)(this,t),(e=(0,i.Z)(this,(0,s.Z)(t).apply(this,arguments))).isFirstCreate=!0,e.canLeavePage=function(){var t=e.getCanLeaveDetail(),n=t.activeSheet,r=t.isEditing;return!(n&&r)},e.createCellEditor=function(e){return new W.aZ(e)},e.canCreateEditor=function(){return W.aZ.canCreateEditor()},e}return(0,l.Z)(t,e),(0,o.Z)(t,[{key:"onEditorCreated",value:function(){var e;this.isFirstCreate&&(null===(e=this.sdk)||void 0===e||e.getService(c.kM).collect(u.Ps3.sheetLoadMainStageDurationListKey.EDITOR_PLUGIN_CREATED),this.isFirstCreate=!1);(0,a.Z)((0,s.Z)(t.prototype),"onEditorCreated",this).call(this)}}]),t}(K)},vsh_25469:function(e,t,n){var r;n.d(t,{fl:function(){return l},He:function(){return j},Fw:function(){return G},EP:function(){return r}}),function(e){e.COMMAND_ACCEPTED="COMMAND_ACCEPTED"}(r||(r={}));var o,i=n("vsh_19264"),a=n("vsh_4175"),s=n("vsh_24627"),l=function(){function e(t,n,r){(0,i.Z)(this,e),this.spread=t,this.dataLoader=n,this.loggerService=r}return(0,a.Z)(e,[{key:"loadSheets",value:function(e,t){var n=this;return this.dataLoader.loadSheets(e).then((function(){n.logMessage("loadSheets completed ".concat(e.join())),t&&t(e)}))}},{key:"logMessage",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];(t=this.loggerService).log.apply(t,["action-analyzer",e].concat(r))}},{key:"analysisActionSheetDep",value:function(e){var t=this,n=new Set;return e.length&&this.dataLoader&&e.forEach((function(e){if(e.sheet_id&&!(0,s.bSc)(e)&&t.spread.getSheetFromId(e.sheet_id)){var r=e.sheet_id;if(t.dataLoader.isSheetLoaded(r)||n.add(r),(0,s.ZR1)(e)){var o=t.dataLoader.getSheetDepsRelation(r).backRef;if(e.action===s.aOo.MOVE_RANGE&&(n.add(e.value.source.sheetId),n.add(e.value.target.sheetId)),(0,s.vO)(e)){var i=e.value;if("name"===i.property_name){var a=t.spread.getBlockManager();a&&a.getErrFmlSheetIdsBySheetName(i.sheet_name).forEach((function(e){return n.add(e)}))}}o.forEach((function(e){return n.add(e)}))}}})),Array.from(n).filter((function(e){return!t.dataLoader.isSheetLoaded(e)}))}}]),e}(),u=n("vsh_67017"),c=n.n(u),h=n("vsh_35067"),d=n("vsh_98652"),f=n("vsh_74561"),v=n("vsh_65498"),p=n("vsh_22023"),g=n("vsh_92292"),m=n("vsh_93631"),_=n("vsh_72834"),y=n("vsh_74340"),C=n("vsh_21955"),S=n("vsh_46544"),k=n("vsh_82905"),E=n("vsh_36290"),T=n("vsh_88177"),b=n("vsh_12064"),I=n("vsh_56589"),R=n("vsh_22462"),w=n("vsh_73455"),A=n("vsh_47253"),F=n("vsh_4561"),D=function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":(0,v.Z)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};!function(e){e[e.UserEdit=0]="UserEdit",e[e.NetworkChanged=1]="NetworkChanged",e[e.VisibilityChanged=2]="VisibilityChanged",e[e.Heartbeat=3]="Heartbeat"}(o||(o={}));var N=function(){function e(t,n,r,o){var a=this;(0,i.Z)(this,e),this.triggers=t,this.responders=n,this.reporter=r,this.triggerSync=function(e){a.responders.forEach((function(t){return t.respond(e)}))},this.throttleTrigger=(0,A.default)(this.triggerSync,e.RECONNECT_TRIGGER_THROTTLE_TIME),this.triggers.forEach((function(e){e.setTrigger(a.throttleTrigger),e.setReporter(a.reporter),e.setLogger(o)})),this.responders.forEach((function(e){e.setReporter(a.reporter),e.setLogger(o)}))}return(0,a.Z)(e,[{key:"start",value:function(e){this.reporter.eventReport({key:"client_sheet_trigger_start",isBinded:!0,triggerType:e}),this.triggers.forEach((function(t){return t.start(e)}))}},{key:"stop",value:function(){this.reporter.eventReport({key:"client_sheet_trigger_stop",isBinded:!0}),this.triggers.forEach((function(e){return e.stop()}))}},{key:"destroy",value:function(){this.stop(),this.triggers.forEach((function(e){return e.destroy()})),this.triggers.length=0,this.responders.forEach((function(e){return e.destroy()})),this.responders.length=0}}]),e}();N.RECONNECT_TRIGGER_THROTTLE_TIME=1e4;var P=function(){function e(){(0,i.Z)(this,e),this.triggerFn=null,this.suspend=!1}return(0,a.Z)(e,[{key:"start",value:function(e){this.suspend=!1,e&&e===this.triggerType&&this.run()}},{key:"stop",value:function(){this.suspend=!0}},{key:"setTrigger",value:function(e){this.triggerFn=e}},{key:"setReporter",value:function(e){this.reporter=e}},{key:"setLogger",value:function(e){this.logger=e}},{key:"destroy",value:function(){this.triggerFn=null,this.reporter={},this.logger={}}},{key:"run",value:function(e){!this.suspend&&this.triggerFn&&(this.reporter.eventReport(Object.assign({key:"client_sheet_trigger",type:this.triggerType},this.getReportInfo(e))),this.triggerFn(this.triggerType))}},{key:"getReportInfo",value:function(e){return{}}}]),e}();D([(0,g.Bind)()],P.prototype,"run",null);var O=function(e){function t(e){var n;return(0,i.Z)(this,t),(n=(0,b.Z)(this,(0,R.Z)(t).call(this))).triggerType=o.UserEdit,n.subscription=e.subscribeEvent(y.NLr.COLLECT_USER_CHANGES,n.run),n}return(0,w.Z)(t,e),(0,a.Z)(t,[{key:"destroy",value:function(){this.subscription.unsubscribe(),(0,I.Z)((0,R.Z)(t.prototype),"destroy",this).call(this)}}]),t}(P),M=function(e){function t(){var e;return(0,i.Z)(this,t),(e=(0,b.Z)(this,(0,R.Z)(t).call(this))).triggerType=o.VisibilityChanged,e.visibilityWatcher=new s.ze4,e.visibilityWatcher.watch(),e.visibilityWatcher.on(s.zOj,e.onVisibilityChanged),e}return(0,w.Z)(t,e),(0,a.Z)(t,[{key:"destroy",value:function(){this.visibilityWatcher.off(s.zOj,this.onVisibilityChanged),this.visibilityWatcher.unwatch(),(0,I.Z)((0,R.Z)(t.prototype),"destroy",this).call(this)}},{key:"onVisibilityChanged",value:function(e){e===s.LC$.Visible&&(this.logger.log("VisibilityTrigger","onVisibilityChanged: new state is ".concat(e)),this.run())}}]),t}(P);D([(0,g.Bind)()],M.prototype,"onVisibilityChanged",null);var L=function(e){function t(e){var n;return(0,i.Z)(this,t),(n=(0,b.Z)(this,(0,R.Z)(t).call(this))).triggerType=o.NetworkChanged,n.currentNetState=e.getConnectState().netState,n.subscription=e.subscribeChannelState(n.onChannelStateChange),n}return(0,w.Z)(t,e),(0,a.Z)(t,[{key:"destroy",value:function(){this.subscription.unsubscribe(),(0,I.Z)((0,R.Z)(t.prototype),"destroy",this).call(this)}},{key:"onChannelStateChange",value:function(e){var t=e.netState;this.currentNetState!==t&&t===y.Giu.online&&this.run(),this.currentNetState!==t&&this.logger.log("NetworkStateTrigger","onChannelStateChange: ".concat(this.currentNetState," to ").concat(t)),this.currentNetState=t}}]),t}(P);D([(0,g.Bind)()],L.prototype,"onChannelStateChange",null);var x=function(e){function t(e){var n;return(0,i.Z)(this,t),(n=(0,b.Z)(this,(0,R.Z)(t).call(this))).triggerType=o.Heartbeat,n.lastHeartbeatVersion=-1,n.subscription=e.subscribeEvent(y.NLr.HEARTBEAT_REV_CHANGE,n.onHeartBeats),n}return(0,w.Z)(t,e),(0,a.Z)(t,[{key:"getReportInfo",value:function(e){return e?{lastRev:this.lastHeartbeatVersion,newRev:e.newVersion}:{}}},{key:"destroy",value:function(){this.subscription.unsubscribe(),(0,I.Z)((0,R.Z)(t.prototype),"destroy",this).call(this)}},{key:"onHeartBeats",value:function(e){this.lastHeartbeatVersion!==e&&(this.logger.log("HeartbeatTrigger","onHeartBeatsReceived: ".concat(this.lastHeartbeatVersion," to ").concat(e)),this.lastHeartbeatVersion=e,this.run({newVersion:e}))}}]),t}(P);D([(0,g.Bind)()],x.prototype,"onHeartBeats",null);var V=function(){function e(){(0,i.Z)(this,e),this.respondTriggerImplementation=F.default}return(0,a.Z)(e,[{key:"respond",value:function(e){this.respondTriggerImplementation(e)}},{key:"setReporter",value:function(e){this.reporter=e}},{key:"setLogger",value:function(e){this.logger=e}},{key:"destroy",value:function(){this.respondTriggerImplementation=F.default}}]),e}(),Z=function(e){function t(e){var n;return(0,i.Z)(this,t),(n=(0,b.Z)(this,(0,R.Z)(t).call(this))).respondTriggerImplementation=function(t){n.reporter.eventReport({key:"client_sheet_eng_trigger_respond",type:t,baseRev:e.getBaseRev(),submitting:e.getUserChangesSending()}),e.resendUserChanges()},n}return(0,w.Z)(t,e),t}(V),B=function(e){function t(e){var n;return(0,i.Z)(this,t),(n=(0,b.Z)(this,(0,R.Z)(t).call(this))).respondTriggerImplementation=function(t){t!==o.NetworkChanged&&t!==o.VisibilityChanged||(n.reporter.eventReport({key:"client_sheet_sync_trigger_respond",type:t}),e.triggerFetchMiss())},n}return(0,w.Z)(t,e),t}(V),H=n("vsh_73043"),U=function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":(0,v.Z)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},j="CollaborationPlugin",G=function(){function e(t){var n=this;(0,i.Z)(this,e),this.deps=t,this.suspendCount=0,this.freezeByWatchDog=!1,this.lastTitleTimestamp=0,this.events$=new m.xQ,this._updateBlockTokenRevisionSet=new Set,this.checkAckCommandMap=new Map,this.pendingAckCommandMap=new Map,this.name=j,this.updateCommandAckStatus=function(e){var t;if(0!==n.pendingAckCommandMap.size&&null!=e&&null!==(t=e.content)&&void 0!==t&&t.length){var o=e.content[0].sheet_id,i=n.pendingAckCommandMap.get(o);if(i){for(var a=i.pendingChangesets,s=i.commandName,l=0,u=0;l<a.length&&u<e.content.length;u++)(0,p.default)(e.content[u],a[l])&&l++;a.splice(0,l),0===a.length&&(n.pendingAckCommandMap.delete(o),n.dispatchEvent(r.COMMAND_ACCEPTED,s,o))}}}}var t,n;return(0,a.Z)(e,[{key:"init",value:function(e){this.sdk=e,this.subscribeEvents(),this.initReconnectMonitor(),this.syncService.suspend(0),this.actionAnalyzer=new l(this.sdk.spread,this.dataLoader,this.sdk.getService(k.QX))}},{key:"destroy",value:function(){this.stopCollaboration(s.Hg0.genSpecTid(s.$UQ.COLLABORATION_DESTROY)),this._updateBlockTokenRevisionSet.clear(),this.pendingAckCommandMap.clear(),this.checkAckCommandMap.clear(),this.events$.unsubscribe(),this.serviceSubscription.unsubscribe(),this.spreadEventSubscription.unsubscribe(),this.pluginStoreEventSubscription.unsubscribe(),this.reconnectMonitor.destroy(),this.deps={}}},{key:"subscribeEvents",value:function(){var e,t,n,r=this;this.pluginStoreEventSubscription=this.pluginStore.subscribeEventMap((e={},(0,f.Z)(e,"LoadStatusStore/RevInit",this.onRevInit),(0,f.Z)(e,"LoadStatusStore/SheetToUsage",this.onSheetToUsage),(0,f.Z)(e,"LoadStatusStore/ReloadStart",this.onReloadStart),e)),this.pluginStore.watch("CellEditorStore/editorStatus",this.onEditingCellChanged),this.pluginStore.watch("PermissionStore/editable",this.onPermissionsChanged),this.spreadEventSubscription=this.spread.subscribe((t={},(0,f.Z)(t,s.HaZ.CommandExecuted,this.onCommandExecuted),(0,f.Z)(t,s.Fsj.AnalyzeActionDeps,this.applyWithSheetDep),(0,f.Z)(t,s.U_F.SelectionChanged,this.handleSelectionChanged),(0,f.Z)(t,s.HaZ.ActiveSheetChanged,this.handleActiveSheetChanged),t)),[this.engineService.subscribeApplyAction(this.applyActions),this.engineService.subscribeEvent(y.NLr.ACCEPT_COMMIT,this.onAcceptCommit),this.engineService.subscribeEvent(y.NLr.NEW_CHANGES,this.onNewChanges),this.syncService.subscribeChannelState(this.onChannelStateChange),this.errorRecorderService.subscribeError(this.onHandleError),null===(n=this.sdk.getService(y.FIP))||void 0===n?void 0:n.subscribeEvent(this.onWatchDogEvent)].forEach((function(e){r.serviceSubscription?r.serviceSubscription.add(e):r.serviceSubscription=e}))}},{key:"subscribeApplyAction",value:function(e){return this.engineService.subscribeApplyAction(e)}},{key:"dispatchEvent",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.events$.next({event:e,data:n})}},{key:"subscribeEvent",value:function(e,t){return this.events$.subscribe((function(n){e===n.event&&t.call.apply(t,[null].concat((0,d.Z)(n.data)))}))}},{key:"initReconnectMonitor",value:function(){this.reconnectMonitor=new N([new O(this.engineService),new M,new L(this.syncService),new x(this.engineService)],[new Z(this.engineService),new B(this.fetchMissService)],this.reporterService,this.sdk.getService(k.QX))}},{key:"canLeavePage",value:function(){return!this.engineService.getUserChangeSendingOrSaving()}},{key:"onRevInit",value:function(e){var t=e.rev;this.engineService.initRev(t,s.Hg0.genStepTid()),this.syncService.connectIO(t),this.spread.fiberTaskScheduler&&this.spread.fiberTaskScheduler.clear()}},{key:"onReloadStart",value:function(e){this.engineService.setEngineEnable(!1,e)}},{key:"onSheetToUsage",value:function(){var e=s.Hg0.genSpecTid(s.$UQ.SHEET_TO_USAGE);this.startCollaboration(e);var t=this.getSpreadEditable();this.setEngagementCursorEnable(t),(t||this.backupService.isBackingUp)&&this.engineService.submitLocalChanges(e),this.roomMemberService.reFetchRoomMembers()}},{key:"onPermissionsChanged",value:function(e,t){t!==e&&this.setEngagementCursorEnable(e)}},{key:"onEditingCellChanged",value:function(){var e,t;if(this.freezeByWatchDog&&(null===(e=this.pluginStore.getState("CellEditorStore"))||void 0===e?void 0:e.editorStatus)===T.I9.EDIT_FAIL&&this.onWatchDogAlarmFromRetrigger(),this.roomMemberService.hasOtherUsers()){var n=this.spread.getActiveSheet(),r=null===(t=this.pluginStore.getState("CellEditorStore"))||void 0===t?void 0:t.editingCell;this.sendCursorInfo(n),this.sdk.shellForEach((function(e){e.sheetView().updateEditingCursor(r)}))}}},{key:"setEngagementCursorEnable",value:function(e){this.syncService.setEngagementCursorEnable(e)}},{key:"onChannelStateChange",value:function(e){var t;e.netState===y.Giu.online?(this.onChannelOnline(),this.reconnectMonitor.start(o.NetworkChanged)):(this.onChannelOffline(),this.reconnectMonitor.stop(),null===(t=this.sdk.getService(y.FIP))||void 0===t||t.resetAll())}},{key:"onWatchDogAlarm",value:function(){this.engineService.getUserChangeSendingOrSaving()?(this.freezeByWatchDog=!0,this.errorRecorderService.record(k.FP.Module,k.NI.ClientError,k.jK.ERROR_WATCH_DOG_ALERT,null),this.reporterService.eventReport({key:"ccm_sheet_cs_blocked_event_dev",from:"watchdog",type:"alarm",sheetIds:this.engineService.getLocalActionSheetIds()})):this.reporterService.eventReport({key:"ccm_sheet_watchdog_exception_dev",message:"sendingOrSaving is false"})}},{key:"onWatchDogAlarmFromRetrigger",value:function(){this.onWatchDogAlarm(),this.reporterService.eventReport({key:"ccm_sheet_cs_blocked_event_dev",from:"watchdog",type:"retrigger"})}},{key:"onWatchDogDone",value:function(){this.freezeByWatchDog&&(this.freezeByWatchDog=!1,this.errorRecorderService.record(k.FP.Module,k.NI.ClientError,k.jK.ERROR_WATCH_DOG_DONE,null),this.reporterService.eventReport({key:"ccm_sheet_cs_blocked_event_dev",from:"watchdog",type:"done"}))}},{key:"onWatchDogEvent",value:(n=(0,h.Z)(c().mark((function e(t){var n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:"warning"===(n=t.type)||("done"===n?this.onWatchDogDone():"alarm"===n&&this.onWatchDogAlarm());case 4:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"onHandleError",value:(t=(0,h.Z)(c().mark((function e(t){var n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.code,e.t0=n,e.next=e.t0===k.jK.ERR_OLD_VERSION?4:e.t0===k.jK.ERR_CLIENT_FOLLOW_REJECT?9:11;break;case 4:return e.next=6,this.backupService.checkBackupRev();case 6:return e.sent>=0&&this.stopCollaboration(t.data.transId),e.abrupt("break",11);case 9:return this.stopCollaboration(t.data.transId),e.abrupt("break",11);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"applyActions",value:function(e){this.spread.applyActions(e,!1,!1)}},{key:"onAcceptCommit",value:function(e,t,n){var r=this;if(this.updateCommandAckStatus(n),t.block_tokens){var o=function(e){if(t.block_tokens[e]){var n=r.sdk.spread.sheets.find((function(t){return t.blockId===e}));n&&n.setBlockToken(t.block_tokens[e])}else{var o=t.new_rev;o&&(r._updateBlockTokenRevisionSet.add(o),r.requestFetchMiss([o],!1,s.Hg0.genSpecTid(s.$UQ.ACK_BLOCK_IN_SHEET)))}};for(var i in t.block_tokens)o(i)}}},{key:"onNewChanges",value:function(e){var t=this;if(this._updateBlockTokenRevisionSet.size){var n=e.find((function(e){return t._updateBlockTokenRevisionSet.has(e.revision)}));n&&(n.content.forEach((function(e){if(e&&e.action===s.aOo.ADD_BLOCK){var n=e.value,r=n.block_id,o=n.block_token,i=t.sdk.spread.sheets.find((function(e){return e.blockId===r}));i&&o&&i.setBlockToken(o)}})),this._updateBlockTokenRevisionSet.delete(n.revision))}}},{key:"ignoreLogCommandExecuted",value:function(e){return S.mA.DRAG_FILL===e}},{key:"onCommandExecuted",value:function(e){var t,n=e.sheet,r=e.commandName,o=e.changesets,i=e.isFirstExecution,a=e.excutedResult,l=e.transId;if(n&&o){if((0,_.b4I)(n,o))return this.sdk.getService(k.Tl).record(k.FP.Plugin,k.NI.ClientError,k.jK.ERROR_MAX_CELL_LIMIT,null),void this.reporterService.eventReport({key:"client_sheet_colla_command_executed_fail_cell_imit",command:r,opLength:o?o.length:0,transId:l});this.tryAutoConvertLink(r,o,n,i)}r&&r.length>0&&!this.ignoreLogCommandExecuted(r)&&(this.reporterService.eventReport({key:"client_sheet_colla_command_executed",command:r,opLength:o?o.length:0,success:Number(a),transId:l}),r!==s.rvF.SET_COMMENTS&&(null===(t=s.Ps3.collectSheetEvent)||void 0===t||t.call(s.Ps3,"ccm_docs_edit_click",{click:"content_edit",target:"none",domain:"text"})));if(o&&o.length>0&&(!l&&this.reporterService.eventReport({key:"client_sheet_colla_transid_void",commandName:r}),l=l||s.Hg0.genStepTid(),this.logMessage("command executed, transId: ".concat(l," commandName: ").concat(r," action length: ").concat(o.length)),this.sdk.getService(y.FIP).watch(r,l),this.sdk.getService(y.AHm).collectUserChange(o,l),n)){var u=this.checkAckCommandMap.get(n.id());(null==u?void 0:u.has(r))&&this.pendingAckCommandMap.set(n.id(),{commandName:r,pendingChangesets:o})}}},{key:"tryAutoConvertLink",value:function(e,t,n,r){if(r&&(e===s.rvF.EDIT_CELL||e===s.rvF.CLIPBOARD_PASTE)){var o=t.map((function(e){return e.action===s.aOo.SET_CELL?(0,_.rDL)((0,_.V8g)(e),n):e}));this.deps.convertLink(n,o,e)}}},{key:"applyWithSheetDep",value:function(e){var t=this,n=e.actions,r=e.local;if(n.length){var o=this.actionAnalyzer.analysisActionSheetDep(n);o.length&&((0,s.fI5)(n)?this.loadSheets(o):(this.suspendCount++,this.spread.suspendActions(),this.reporterService.eventReport({key:"client_sheet_path_tracker_dev",trace_code:s.Y6H.applyWithSheetDep}),r||this.engineService.addPendingSheetActionsRefs(n),this.loadSheets(o,(function(){t.suspendCount--,0===t.suspendCount&&(t.uiNotifierService.Toast.remove(s.iPD.LOAD_SHEETS),t.spread.resumeActions()),r||t.engineService.removePendingSheetActionsRefs(n)})))),r&&this.checkSuspendAndToast()}}},{key:"checkSuspendAndToast",value:function(){this.sdk.getService(k.tb).resolve("showActionSuspendedTips",!0)&&(this.suspendCount>0?(this.uiNotifierService.Toast.show({key:s.iPD.LOAD_SHEETS,type:"loading",content:H("CreationDoc_Sheets_DataBeingUpdatredPleaseWaite"),duration:0}),this.reporterService.eventReport({key:"client_sheet_path_tracker_dev",trace_code:s.Y6H.applyWithToast})):(this.suspendCount=0,this.uiNotifierService.Toast.remove(s.iPD.LOAD_SHEETS)))}},{key:"handleSelectionChanged",value:function(e){var t=e.sheet;this.sendCursorInfo(t)}},{key:"handleActiveSheetChanged",value:function(e){(0,_.xhN)(e.newSheet)||this.sendCursorInfo(e.newSheet)}},{key:"loadSheets",value:function(e,t){var n=this;return this.dataLoader.loadSheets(e).then((function(){n.logMessage("loadSheets completed ".concat(e.join())),t&&t(e)}))}},{key:"getSpreadEditable",value:function(){var e;return!(null===(e=this.sdk.getPluginState("PermissionStore"))||void 0===e||!e.suiteEditable)}},{key:"logMessage",value:function(e){var t=this.sdk.getService(k.QX);if(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];t.log.apply(t,[this.name,e].concat(r))}}},{key:"getNetworkState",value:function(){return this.syncService.getConnectState().netState}},{key:"sendCursorInfo",value:function(e){var t;if(this.roomMemberService.hasOtherUsers()&&(!e||(0,_.A8G)(e))){var n=null,r=null===(t=this.pluginStore.getState("CellEditorStore"))||void 0===t?void 0:t.editorStatus;e&&e.getSelections().length&&(n={time:(new Date).valueOf(),sheet_id:e.id(),selection:{row:Math.max(0,e.getActiveRowIndex()),col:Math.max(0,e.getActiveColumnIndex())},editorStatus:r}),this.syncService.sendCursor(n)}}},{key:"subscribeCommentChanged",value:function(e){return this.syncService.subscribeExtractChangedEventDataMessage(y.uaV.NEW_COMMENT,e)}},{key:"subscribeTitleChanged",value:function(e){var t=this;return this.syncService.subscribeExtractChangedEventDataMessage(y.uaV.OBJ_TITLE_CHANGE,(function(n){if(n.timestamp>=t.lastTitleTimestamp)return t.lastTitleTimestamp=n.timestamp,e(n)}))}},{key:"subscribeISVChanged",value:function(e){return this.syncService.subscribeExtractChangedEventDataMessage(y.uaV.ISV_RELATIONSHIP,e)}},{key:"subscribeZonePermissionChanged",value:function(e){return this.syncService.subscribeExtractChangedEventDataMessage(y.uaV.ZONE_PERMISSION_CHANGE,e)}},{key:"subscribeDataMigrateChanged",value:function(e){return this.syncService.subscribeExtractChangedEventDataMessage(y.uaV.DATA_MIGRATE,e)}},{key:"suspendApplyAction",value:function(e){return this.logMessage("suspendApplyAction source: ".concat(e)),this.engineService.suspendApplyAction()}},{key:"resumeApplyAction",value:function(e){return this.logMessage("resumeApplyAction source: ".concat(e)),this.engineService.resumeApplyAction()}},{key:"waitForMissRev",value:function(e){return this.engineService.waitForMaxRev(e)}},{key:"requestFetchMiss",value:function(e,t,n){return this.fetchMissService.requireFetchMissVersion(e,t,n)}},{key:"sendCommentMessage",value:function(e){return this.syncService.sendCommentChange(e)}},{key:"resetMembers",value:function(e){return this.roomMemberService.resetMembers(e)}},{key:"startCollaboration",value:function(e){this.engineService.setEngineEnable(!0,e),this.syncService.resume(e),this.reconnectMonitor.start()}},{key:"stopCollaboration",value:function(e){this.engineService.setEngineEnable(!1,e),this.syncService.suspend(e),this.reconnectMonitor.stop()}},{key:"addCheckAckCommand",value:function(e,t){var n=this.checkAckCommandMap.get(e);n?n.add(t):this.checkAckCommandMap.set(e,new Set([t]))}},{key:"deleteCheckAckCommand",value:function(e,t){var n=this.checkAckCommandMap.get(e);n&&(n.delete(t),0===n.size&&this.checkAckCommandMap.delete(e))}},{key:"onChannelOnline",value:function(){}},{key:"onChannelOffline",value:function(){}},{key:"dataLoader",get:function(){var e=this.sdk.getPlugin("DataLoaderPlugin");if(!e)throw new Error("DataLoaderPlugin not found");return e}},{key:"syncService",get:function(){return this.sdk.getService(y.ClJ)}},{key:"engineService",get:function(){return this.sdk.getService(y.AHm)}},{key:"backupService",get:function(){return this.sdk.getService(y.AKO)}},{key:"reporterService",get:function(){return this.sdk.getService(k.zv)}},{key:"fetchMissService",get:function(){return this.sdk.getService(y.P_V)}},{key:"errorRecorderService",get:function(){return this.sdk.getService(k.Tl)}},{key:"roomMemberService",get:function(){return this.sdk.getService(y.e2Q)}},{key:"uiNotifierService",get:function(){return this.sdk.getService(E.OG)}},{key:"spread",get:function(){return this.sdk.spread}},{key:"pluginStore",get:function(){return this.sdk.pluginStore}}]),e}();U([(0,g.Bind)()],G.prototype,"canLeavePage",null),U([(0,g.Bind)()],G.prototype,"onRevInit",null),U([(0,g.Bind)()],G.prototype,"onReloadStart",null),U([(0,g.Bind)()],G.prototype,"onSheetToUsage",null),U([(0,g.Bind)()],G.prototype,"onPermissionsChanged",null),U([(0,g.Bind)()],G.prototype,"onEditingCellChanged",null),U([(0,g.Bind)()],G.prototype,"setEngagementCursorEnable",null),U([(0,g.Bind)()],G.prototype,"onChannelStateChange",null),U([(0,g.Bind)()],G.prototype,"onWatchDogEvent",null),U([(0,g.Bind)()],G.prototype,"onHandleError",null),U([(0,g.Bind)()],G.prototype,"applyActions",null),U([(0,g.Bind)()],G.prototype,"onAcceptCommit",null),U([(0,g.Bind)()],G.prototype,"onNewChanges",null),U([(0,g.Bind)()],G.prototype,"onCommandExecuted",null),U([(0,g.Bind)()],G.prototype,"applyWithSheetDep",null),U([(0,g.Bind)()],G.prototype,"handleSelectionChanged",null),U([(0,g.Bind)()],G.prototype,"handleActiveSheetChanged",null),G=U([(0,C.Mn)({required:[y.AKO,k.tb,k.UU,k.Tl,k.QX,k.zv,y.AHm,y.e2Q,y.ClJ,y.FIP,y.P_V,E.OG]})],G)},vsh_65778:function(e,t,n){n.d(t,{eF:function(){return d},ie:function(){return k}});var r=n("vsh_1139"),o=n("vsh_74561"),i=n("vsh_19264"),a=n("vsh_4175"),s=n("vsh_24627"),l=n("vsh_72834"),u=n("vsh_20327");function c(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return h(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return h(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var d="ConditionalFormatPlugin",f="CalculateConditionalFormatStatusStore/percentage",v="CalculateConditionalFormatStatusStore/setPercentage",p="CalculateConditionalFormatStatusStore/reset",g="CalculateConditionalFormatStatusStore/addTaskNum",m=function(){function e(){var t,n=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,i.Z)(this,e),this.name=d,this.handleCalculatePercentageChanged=function(e){(0,u.cm)({percentage:e})},this.handleWorksheetLoaded=function(e){if(n.initFormulaOnDemand){var t=n.sdk.spread.getSheetFromId(e);t?n.initModelFormula(t):console.log("[sheet log]: conditional-format-plugin, worksheetloaded, Can not found sheet",e)}},this.updateConditionalFormatStyles=function(e){return!!e.styles.length&&(n.syncConditionalFormatStyles(e,n.sdk),!0)},this.handleConditionalFormatRuleChanged=function(e){var t,r=e.affectedRanges;if(r){if(e.type===s.aOo.DEL_CONDITIONAL_FORMAT||e.type===s.aOo.SET_CONDITIONAL_FORMAT||e.type===s.aOo.MOVE_CONDITIONAL_FORMAT){var o={};r.forEach((function(e){var t=e.sheet();o[t.id()]||(o[t.id()]=[]);var r=t.conditionalFormatModel.getStylesByRange(e);r&&n.tryUpdateConditionalFormatStyles({sheetId:t.id(),styles:o[t.id()]},r)})),Object.keys(o).forEach((function(e){n.updateConditionalFormatStyles({sheetId:e,styles:o[e]})}))}if("RangeChange"===e.type&&(null===(t=e.rangeOp)||void 0===t?void 0:t.type())===l.AKq.MoveRangeOp){var i=r[0],a=r[1],u=i.sheet(),c=a.sheet();if(!u||!c)return;if(!n.sdk.spread.options.isWorker)return n.clearConditionalFormatStyles({rangeJSON:i.toJSON(),sheetId:u.id()},n.sdk),void n.clearConditionalFormatStyles({rangeJSON:a.toJSON(),sheetId:c.id()},n.sdk);(i instanceof l.lq$||i instanceof l.rvb||a instanceof l.lq$||a instanceof l.rvb)&&(a.rowFrom()>i.rowFrom()&&a.setRowFrom(a.rowFrom()-i.rowCount()),a.colFrom()>i.colFrom()&&a.setColFrom(a.colFrom()-i.colCount())),n.clearConditionalFormatStyles({rangeJSON:i.toJSON(),sheetId:u.id()},n.sdk),n.clearConditionalFormatStyles({rangeJSON:a.toJSON(),sheetId:c.id()},n.sdk)}}},this.handlerSort=function(e,t){var r=e.range;n.clearConditionalFormatStyles({rangeJSON:r.toJSON(),sheetId:t.id()},n.sdk)},this.initAllSheetsModelFormula=function(){n.sdk.spread.sheets.forEach((function(e){return n.initModelFormula(e)}))},this.sheetEventHandlers=(t={},(0,o.Z)(t,s.U_F.ConditionalFormatChanged,this.handleConditionalFormatRuleChanged),(0,o.Z)(t,s.HaZ.SheetAdded,(function(e){var t=e.sheet;n.initModelFormula(t)})),(0,o.Z)(t,s.U_F.Sort,this.handlerSort),(0,o.Z)(t,s.HaZ.CoverSnapshot,this.initAllSheetsModelFormula),(0,o.Z)(t,s.U_F.CoverSheet,(function(e,t){n.initModelFormula(t)})),(0,o.Z)(t,s.HaZ.ConditionalFormulaChanged,this.handleConditionalFormatFormulasChanged.bind(this)),t),this.initFormulaIfNotOnDemand=function(){n.initFormulaOnDemand||n.initAllSheetsModelFormula()},this.pluginEvents={"LoadStatusStore/WorksheetLoaded":this.handleWorksheetLoaded.bind(this),"LoadStatusStore/AfterApplySnapshot":this.initFormulaIfNotOnDemand},this.initModelFormula=function(e){e?e.blockType||(e.conditionalFormatModel.getAllRules().forEach((function(t){t.destroyFormulaVars(),t.initFormula(),e.conditionalFormatModel.setRuleFormulasSymbolAndIdsMap(t)})),0===e.conditionalFormatModel.formulasMap.size&&n.sdk.pluginStore.commit(v,100),n.sdk.pluginStore.commit(p),n.sdk.pluginStore.commit(g,e.conditionalFormatModel.formulasMap.size)):console.log("[sheet log]: conditional-format-plugin, sheetAdded, Sheet is Empty!")};var a=r.initFormulaOnDemand,c=void 0===a||a;this.initFormulaOnDemand=c}return(0,a.Z)(e,[{key:"init",value:function(e){this.sdk=e,this.bindSheetEvents(),this.bindPluginEvents()}},{key:"bindPluginEvents",value:function(){this.sdk.pluginStore.subscribeEventMap(this.pluginEvents),this.sdk.pluginStore.watch(f,this.handleCalculatePercentageChanged)}},{key:"bindSheetEvents",value:function(){this.sheetEventsSubscriber=this.sdk.spread.subscribe(this.sheetEventHandlers)}},{key:"updateCellRuleIdsMapByFormulas",value:function(e){var t,n=c(e);try{var r=function(){var e=t.value;if(!Boolean(e[l.yKb]))return"continue";var n=e.getRef().sheet();if(!n)return"continue";var r=n.conditionalFormatModel,o=r.getRangeByFormula(e),i=r.getRuleIdByFormula(e);if(void 0===i)return"continue";if(!o)return"continue";var a=o instanceof l.s3e?o.getRanges():o;(0,l.KST)(a,(function(e,t){r.setCellRuleIdsMap(e,t,i)}))};for(n.s();!(t=n.n()).done;)r()}catch(e){n.e(e)}finally{n.f()}}},{key:"notifyAsComputeConditionalFormatStyleByFormulas",value:function(e,t,n){var r,o=0,i=c(e);try{for(i.s();!(r=i.n()).done;){var a=r.value;if(Boolean(a[l.yKb])){var s=a.getRef().sheet(),u=(null==s?void 0:s.id())||"";if(!s)continue;t[u]||(t[u]=[]);var h=s.conditionalFormatModel,d=h.getRangeByFormula(a),f=h.getRuleIdByFormula(a),v=Date.now(),p=h.getStylesByRange(d);if(p){if(f){var g=n[u]||{};g[f]=Date.now()-v,n[u]=g}o++,this.tryUpdateConditionalFormatStyles({sheetId:u,styles:t[u]},p)}}o>=50&&(this.notifyConditionalFormulaCompelteIncrease(o),o=0)}}catch(e){i.e(e)}finally{i.f()}o&&this.notifyConditionalFormulaCompelteIncrease(o)}},{key:"handleConditionalFormatFormulasChanged",value:function(e){var t=this,n=(0,r.Z)(e,2),o=n[0],i=n[1],a={},s={};this.updateCellRuleIdsMapByFormulas(o),this.notifyAsComputeConditionalFormatStyleByFormulas(o,a,s),Object.keys(a).forEach((function(e){t.updateConditionalFormatStyles({sheetId:e,styles:a[e]})}));try{if(!this.sdk.spread.options.isWorker)return;this.collectionConditionCalcTime(i,s)}catch(e){}}},{key:"collectionConditionCalcTime",value:function(e,t){var n,r={};e.forEach((function(e,n){var o,i=n.getRef().sheet();if(i){var a=i.conditionalFormatModel.getRuleIdByFormula(n);if(a){var l=i.conditionalFormatModel.getRuleById(a);if(l){var u=i.id(),c=l.ruleType,h=l.toJSON(),d=h.ranges.length,f=0;h.ranges.forEach((function(e){switch(e.type){case s.xj7.ALL:f=1/0;break;case s.xj7.ROW:f+=e.rowCount;break;case s.xj7.COL:f+=e.colCount;break;case s.xj7.CELL:f++;break;default:f+=e.rowCount*e.colCount}}));var v=(null===(o=t[u])||void 0===o?void 0:o[a])||0;r[a]={rule_type:c,range_length:d,cf_id:a,cell_count:f,formula_time:e,style_time:v,time:e+v}}}}})),null===(n=this.collectConditionFormular)||void 0===n||n.call(this,r)}},{key:"notifyConditionalFormulaCompelteIncrease",value:function(e){this.sdk.pluginStore.commit("CalculateConditionalFormatStatusStore/completeTasks",e)}},{key:"tryUpdateConditionalFormatStyles",value:function(e,t){var n=this;return t.forEach((function(t,r,o){e.styles.push([r,o,t]),e.styles.length>=2e3&&(n.updateConditionalFormatStyles(e),e.styles.length=0)})),!0}},{key:"destroy",value:function(){this.sheetEventsSubscriber.unsubscribe(),this.sdk.pluginStore.unsubscribeEventMap(this.pluginEvents),this.sdk.pluginStore.unWatch(f,this.handleCalculatePercentageChanged)}}]),e}(),_=n("vsh_12064"),y=n("vsh_22462"),C=n("vsh_73455"),S=n("vsh_9160"),k=function(e){function t(){var e;return(0,i.Z)(this,t),(e=(0,_.Z)(this,(0,y.Z)(t).apply(this,arguments))).syncConditionalFormatStyles=S.Bl,e.clearConditionalFormatStyles=S.gU,e}return(0,C.Z)(t,e),t}(m)},vsh_9160:function(e,t,n){n.d(t,{Bl:function(){return a},gU:function(){return s},_s:function(){return l}});var r=n("vsh_1139"),o=n("vsh_30157"),i=n("vsh_24627");function a(e,t){var n=t.spread.getSheetFromId(e.sheetId);if(n){var i=(0,o.F)(t,n);e.styles.forEach((function(e){var t=(0,r.Z)(e,3),o=t[0],a=t[1],s=t[2];o=Number(o),a=Number(a),n.conditionalFormatModel.setCellStyle(o,a,s),i&&i.removeRangeCache(o,a,1,1)}));var a=t.spread.calcEngine;a.cfmStatistics.isFirstApplyResult||a.cfmStatistics.onFirstApplyResult(e.styles.length)}}function s(e,t){var n=e.rangeJSON,r=e.sheetId,o=t.spread.getSheetFromId(r);o&&(o.conditionalFormatModel.clearStylesByRange(n.row,n.col,n.rowCount,n.colCount),t.shellForEach((function(e){return e.sheetView().forceUpdate()})))}function l(e){Object.keys(e).forEach((function(t){i.Ps3.collectSuiteEvent("client_sheet_conditional_format_rule",e[t])}))}},vsh_94837:function(e,t,n){var r;n.d(t,{Sb:function(){return r},VT:function(){return o},VJ:function(){return i},oR:function(){return a},Ix:function(){return s},rQ:function(){return l}}),function(e){e.SHORTKEY="sheet_shortkey",e.CONTEXT_MENU="sheet_context_menu",e.FLOATING_BUTTON="sheet_floating_button",e.FILE_MENU="sheet_file_menu",e.COPY_FORMULA_IMAGE_BUTTON="sheet_copy_formula_image_button"}(r||(r={}));var o="CopyPlugin",i="PastePlugin",a=4,s=4,l="lark-paste-protect"},vsh_25789:function(e,t,n){var r,o;n.d(t,{z:function(){return o}}),function(e){e.SPAN="span",e.FONT="font",e.DIV="div",e.S="s",e.U="u"}(r||(r={})),function(e){e.Hidden="hidden",e.Visible="visible",e.Scroll="scroll",e.Auto="auto"}(o||(o={}))},vsh_12198:function(e,t,n){n.d(t,{gx:function(){return u},Mn:function(){return c},SM:function(){return h},al:function(){return r},AV:function(){return f},jB:function(){return v},Vk:function(){return p},tR:function(){return g},sr:function(){return m},OL:function(){return _},Fb:function(){return y},pQ:function(){return C}});var r,o=n("vsh_24627"),i=n("vsh_94837"),a=n("vsh_64991"),s=n("vsh_72834"),l=n("vsh_48116");function u(e){var t=(0,a.$1)(e,!1);return(!t||!t.trim())&&e.getElementsByTagName("img").length>0}function c(e){var t=e.match(/<byte-sheet-html-origin[^>]*>/),n=e.match(/<table[^>]*>/);if(t){if(t[0].indexOf('data-is-embed="true"')>-1)return o.Lu8.EMBED_SHEET;if(t[0].indexOf('data-is-embed="false"')>-1)return o.Lu8.ALONE_SHEET}var r=e.match(/<html[^>]*>/);if(r&&r[0].indexOf('xmlns:o="urn:schemas-microsoft-com:office:office"')>-1){if(r[0].indexOf('xmlns:x="urn:schemas-microsoft-com:office:excel"')>-1)return o.Lu8.EXCEL;if(r[0].indexOf('xmlns:w="urn:schemas-microsoft-com:office:word"')>-1)return o.Lu8.WORD}return/<google-sheets-html-origin[^>]*>/.test(e)?o.Lu8.GOOGLE_SHEET:n&&n[0].indexOf('data-type="sm-sheets"')>-1?o.Lu8.SHIMO_SHEET:e.indexOf("data-shimo-docs")>-1?o.Lu8.SHIMO_Doc:r&&r[0].indexOf('xmlns:x="tencent"')>-1?o.Lu8.TIM_SHEET:/<melo-data[^>]*>/.test(e)?o.Lu8.TIM_DOC:o.Lu8.OTHER}function h(e){if(0===e.length)return null;var t="",n=Array.from(e).map((function(e){var n=e.dataset.suite;if(n){var r=o.Ps3.imageHelper.decodeInfo(n),i=r.fileToken,a=r.originSrc;t||(t=r.objToken);var s=[{rowSpan:1,colSpan:1,value:[{type:"embed-image",width:0,height:0,text:"",link:a}]}];return i&&(s[0].value[0].fileToken=i),s}return[{rowSpan:1,colSpan:1,value:""}]})),r={onlyOneImage:!0,data:n,columns:[],rowCount:n.length,columnCount:1,isImageFromOtherSuiteType:!0};return t&&(r.suiteToken=t),r}function d(e){try{var t=function(e){return(new DOMParser).parseFromString(e,"text/html")}(e).body,n=t.getElementsByTagName("table");if(!_(n))return{result:r.FAIL_INVALID_TABLE,rowCount:0,columnCount:0};var a=n[0],s=t.querySelector("byte-sheet-html-origin");if(s){var l=Number(s.getAttribute("data-version")||0);if(o.Ps3.collectSuiteEvent("sheet_parse_paste_data",{dataType:"html",dataVersion:l,parserVertion:String(i.oR)}),!Number.isNaN(l)){if(l<i.oR)return{result:r.FAIL_LOWER_DATA_VERSION,rowCount:0,columnCount:0};if(l>i.oR)return{result:r.FAIL_LOWER_PARSER_VERSION,rowCount:0,columnCount:0}}}for(var u=Array.from(a.rows),c=u.length,h=0,d=0;d<c;++d){for(var f=u[d].cells,v=0,p=0;p<f.length;++p)v+=f[p].colSpan;h=Math.max(h,v)}return{result:r.SUCCESS,rowCount:c,columnCount:h}}catch(e){return{result:r.FAIL_INVALID_TABLE,rowCount:0,columnCount:0}}}function f(e){var t=d(e);return t.result===r.FAIL_LOWER_DATA_VERSION?o.Ps3.modalHelper.showCopyDataOutdatedModal():t.result===r.FAIL_LOWER_PARSER_VERSION&&o.Ps3.modalHelper.showPastePageOutdatedModal(),t}function v(e){for(var t=e.firstElementChild,n=null;t;){if("colgroup"===t.tagName.toLowerCase()){n=t;break}t=t.nextElementSibling}var r=[];for(t=n&&n.firstElementChild;t;){if("col"===t.tagName.toLowerCase()){var o=parseInt(t.width,10),i=t.span;for(o=isNaN(o)||!o?null:o;i--;)r.push(o)}t=t.nextElementSibling}return r}function p(e){var t=e.trim(),n=t?Number(t):NaN;return Number.isNaN(n)?e:t}function g(e){return" "===e?"":e}function m(e){var t=null,n=function(e){var t=e.getAttribute("data-condition-format")||"[]",n=[];try{n=JSON.parse(s.E6s._unescapeHtml(t))}catch(e){console.error("getConditionFormatFromByteSheetHtml error")}return n}(e),r=function(e){var t=e.getAttribute("data-pivot-tables");if(!t)return[];try{return JSON.parse(t)}catch(e){return[]}}(e),o=e.getAttribute("data-importRangeRawData-spreadSource"),i=e.getAttribute("data-importRangeRawData-range"),a=e.getAttribute("data-id"),l="true"===e.getAttribute("data-grid-line-hidden"),u=function(e){var t=e.getAttribute("data-sparkline-groups");if(t)try{return JSON.parse(t)}catch(e){return}}(e);return null!=o&&null!=i&&(t={spreadSource:o,range:i}),{importRangeRawData:t,conditionFormat:n,pivotTables:r,randomString:a,gridLineHidden:l,copyFullColumn:"col"===e.getAttribute("data-copy-type"),sparklineGroups:u}}function _(e){var t=e.length,n=1===t;if(t>1){for(var r=e[0],o=1;o<t;o++){var i=e[o];if(!r.contains(i))break}o===t&&(n=!0)}return n}function y(e,t){var n=(0,l.vH)(t);n&&(o.Ps3.collectSuiteEvent("sheet_opration",{action:"dropdown_menu_paste"}),e.dropdown=n);var r=(0,l.Gu)(t);r&&(e.dataValidationJSON=r);var i=(0,l.tu)(t);i?e.multipleValuesJSON=i:e.value=(0,l.nJ)(t)||(0,l.f)(t),t.hasAttribute("data-sheet-ischild")&&(e.proxyValue=e.value,e.value="");var a,s=(a=t.getAttribute("data-sheet-formula-data"))?JSON.parse(a):null;s&&(e.formulaData=s);var u=(0,l.c3)(t);u&&(e.reminderJSON=u);var c=(0,l.QC)(t);c&&(e.note=c),t.dataset.comments?e.comments=JSON.parse(t.dataset.comments):e.comments=[],t.hasAttribute("data-sparkline")&&(e.sparkline=JSON.parse(t.getAttribute("data-sparkline"))),t.hasAttribute("data-float-images")&&(e.floatImages=JSON.parse(t.getAttribute("data-float-images")||"[]"))}function C(e){var t=null;if(e.length){var n=Array.prototype.slice.call(e).filter((function(e){var t;return e.getAttribute("data-zone-id")||(null===(t=e.classList)||void 0===t?void 0:t.contains("ace-line"))}));n.length>0&&(t=n.length>1?n[0].parentElement:n[0])}return t}!function(e){e[e.SUCCESS=0]="SUCCESS",e[e.FAIL_INVALID_TABLE=1]="FAIL_INVALID_TABLE",e[e.FAIL_LOWER_DATA_VERSION=2]="FAIL_LOWER_DATA_VERSION",e[e.FAIL_LOWER_PARSER_VERSION=3]="FAIL_LOWER_PARSER_VERSION"}(r||(r={}))},vsh_64991:function(e,t,n){n.d(t,{Io:function(){return o},vk:function(){return i},$1:function(){return a}});var r={meta:"meta",script:"script",style:"style",title:"title",xml:"xml"};function o(e){return void 0!==r[e]}function i(e){return e.replace(/\s+/g," ")}function a(e,t){var n=e.nodeName.toLowerCase();if(o(n))return"";if(0===e.childNodes.length)return function(e,t,n){if(e.nodeType===Node.ELEMENT_NODE){if("br"===t)return"\n";var r=e.textContent;return r&&n&&(r=i(r)),r||""}if(e.nodeType===Node.TEXT_NODE){var o=e.textContent;return o&&n&&(o=i(o)),o||""}return""}(e,n,t);for(var r=e.childNodes,s=r.length,l="",u=0;u<s;++u){l+=a(r[u],t)}return l}},vsh_48116:function(e,t,n){n.d(t,{Ex:function(){return g},hH:function(){return m},Lp:function(){return _},tr:function(){return y},vH:function(){return C},Gu:function(){return S},tu:function(){return k},f:function(){return E},nJ:function(){return T},QC:function(){return b},Oh:function(){return I},v3:function(){return R},zK:function(){return w},c3:function(){return A},uE:function(){return F},jE:function(){return D}});var r=n("vsh_1139"),o=n("vsh_13867"),i=n("vsh_60505"),a=n("vsh_57524"),s=n.n(a),l=n("vsh_24627"),u=n("vsh_72834"),c=n("vsh_12198"),h=n("vsh_13484"),d=n("vsh_11725");function f(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return v(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function p(e){var t="";try{t=JSON.parse(e)}catch(e){console.error(e)}return t}function g(e,t){var n=e[e.length-1];return!n||n.type!==l.K6s.TEXT||t.type!==l.K6s.TEXT||n.style||t.style?e.push(t):n.text+=t.text,e}function m(e){if(1===e.nodeType){var t=e,n=t.getAttribute("data-sheet-mention"),o=t.getAttribute("data-lark-atuser")||"",i=t.getAttribute("data-inline-type"),a="user"===i;if("mention_doc"===i||a||n||o){var s=(0,d.Jc)(n),u=(0,d.Jc)(o);if(s){var c;if((0,d.ze)(s))return{category:"at-user-block",type:l.K6s.MENTION,link:s.link,mentionType:s.mentionType,token:s.token,text:(null===(c=t.textContent)||void 0===c?void 0:c.trim())||"@",name:s.name||s.cn_name,en_name:s.en_name,is_external:s.is_external,mentionNotify:!1,not_notify:s.not_notify,mentionId:s.mentionId}}else{if(a){var h,f,v,p,g,m;try{var _,y;m=null===(_=JSON.parse(t.getAttribute("data-meta-block-props")||""))||void 0===_||null===(y=_.props)||void 0===y?void 0:y.data}catch(e){}if(null===(h=m)||void 0===h||!h.user)return;var C=null===(f=m)||void 0===f?void 0:f.user;return{category:"at-user-block",type:l.K6s.MENTION,link:C.avatar_url,mentionType:l.UkI.USER,token:C.id,text:(null===(v=t.textContent)||void 0===v?void 0:v.trim())||(null===(p=t.nextElementSibling)||void 0===p||null===(g=p.textContent)||void 0===g?void 0:g.trim())||"@",name:C.name||C.cn_name,en_name:C.en_name,is_external:C.is_external,mentionNotify:!1,not_notify:C.not_notify,mentionId:C.mentionId}}if(u&&(0,d.zE)(u))return(0,d.ZM)(u)}var S=Array.from(t.classList),k=["mention-link_","mention-token_","mention-type_","mention-custom-icon-info_"].map((function(e){var t;return null===(t=S.find((function(t){return t.startsWith(e)})))||void 0===t?void 0:t.replace(e,"")})),E=(0,r.Z)(k,4),T=E[0],b=E[1],I=E[2],R=E[3],w=I?Number(I):NaN,A=t.textContent;if(T&&b&&!isNaN(w)&&A){var F={type:l.K6s.MENTION,link:T,mentionType:w,token:b,text:A};return R&&(F.iconInfo=decodeURIComponent(R)),F}}}}function _(e){if(1===e.nodeType){var t=(0,d.Jc)(e.getAttribute("data-meta-block-props"));if((null==t?void 0:t.blockType)===l.kHU.FILE_CARD_BLOCK){var n,r=null==t||null===(n=t.props)||void 0===n?void 0:n.data;if((0,d.Lz)(r)){var o=r.fileInfo;return{type:l.K6s.ATTACHMENT,text:o.name,mimeType:o.actualType,fileToken:o.driveKey,size:o.size}}}}}function y(e){if(Array.isArray(e)){var t=[];e.forEach((function(e){if(e.type===l.K6s.TEXT){var n=(0,c.Vk)(e.text),r=(0,l.Tcw)(n);if(Array.isArray(r)){var o,i=f(r);try{for(i.s();!(o=i.n()).done;){var a=o.value;e.style&&(a.style=e.style),t.push(a)}}catch(e){i.e(e)}finally{i.f()}}else{var s={type:l.K6s.TEXT,text:(0,c.Vk)(e.text)};e.style&&(s.style=e.style),t.push(s)}}else t.push(e)})),e=t}return(0,o.Z)(e)&&(e=(0,c.tR)(e),e=(0,c.Vk)(e),(0,u.GG9)(e)||(e=(0,l.Tcw)(e))),e}function C(e){var t=e.getAttribute("data-dropdown");if(t)return p(t)}function S(e){var t=e.getAttribute("data-data-validation");if(t)return p(t)}function k(e){var t=e.getAttribute("data-sheet-multiple-values");return t?p(t):null}function E(e){var t=e.getAttribute("data-sheet-value");return t?p(t):(0,h.vn)(e)}function T(e){var t=e.getAttribute("data-sheet-formula-image-value");return t?p(t):null}function b(e){var t=e.getAttribute("data-cell-note");return t?p(t):null}function I(e){var t=e.getAttribute("data-diagonal");return t?p(t):null}function R(e){return!!e.getAttribute("data-diagonal-up")}function w(e){return!!e.getAttribute("data-diagonal-down")}function A(e){var t=e.dataset.reminder;return t?p(t):null}function F(e){var t=s().parse(e);if(t.query){var n=(0,i.parse)(t.query);if(n.sheet&&(0,l.RkF)(window.location.href,e,"sheet"))return{sheetId:n.sheet,rangeId:n.range}}return null}function D(e){e[0].type===l.K6s.TEXT&&" "===e[0].text&&(e[0].text="");var t=e[e.length-1];return t.type===l.K6s.TEXT&&" "===t.text&&(t.text=""),e}},vsh_99024:function(e,t,n){n.d(t,{mx:function(){return i},YZ:function(){return a},sJ:function(){return s}});var r=n("vsh_98652"),o=n("vsh_24627");function i(e){for(var t={},n=e.length,i=[],a=function(n){var a=e[n];if(!a)return"continue";var s=a.length;t[n]={};for(var l=function(e){var s=a[e];if(!Array.isArray(null==s?void 0:s.value))return"continue";s.value.forEach((function(a){if((0,o.tMY)(a)){var s=a.token,l=a.link,u=a.en_name;if(l&&u)return;t[n][e]=[].concat((0,r.Z)(t[n][e]||[]),[s]),i.push(s)}}))},u=0;u<s;++u)l(u)},s=0;s<n;++s)a(s);return{userIds:(0,r.Z)(new Set(i)),userMentionInNode:t}}function a(e,t){null==e||e.forEach((function(e){if((0,o.tMY)(e)){var n=t[e.token];n&&(e.name=n.cn_name||e.name||"",e.en_name=n.en_name||e.en_name||"",e.text="@".concat(e.name),e.is_external=n.is_external||e.is_external||!1,e.link=n.avatar_url||e.link||"")}}))}function s(e,t,n){for(var r in n){var o=n[r];for(var i in o){a(e[r][i].value,t)}}}},vsh_68808:function(e,t,n){n.d(t,{Wi:function(){return C},Jc:function(){return T}});var r=n("vsh_1139"),o=n("vsh_65498"),i=n("vsh_19264"),a=n("vsh_4175"),s=n("vsh_91497"),l=n("vsh_69691"),u=n("vsh_24627"),c=n("vsh_72834"),h=n("vsh_94837"),d=n("vsh_25789"),f=n("vsh_13484"),v=n("vsh_6127"),p=n.n(v),g="border:0.5pt solid ".concat(u.QAv,";"),m=p().isMobile?"":"\x3c!--br {mso-data-placement:same-cell;}--\x3e "+"td {white-space:nowrap;".concat(g,"font-size:").concat(u.OSP,";font-style:normal;font-weight:normal;vertical-align:middle;word-break:normal;word-wrap:normal;}"),_="<style>".concat(m,"</style>");function y(e){return"\x3c!--StartFragment--\x3e".concat('<meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>').concat(e,"\x3c!--EndFragment--\x3e")}function C(e,t){return y("".concat(_)+'<byte-sheet-html-origin data-version="'.concat(h.oR,'"><table><tbody><tr>').concat(function(e,t){var n="";if(Array.isArray(e))n+='<td data-sheet-value="'.concat(E(e),'">'),n+=S(e,t);else{var r=e||"";r?(n+='<td data-sheet-value="'.concat(E(e),'">'),n+=r=(0,f.jY)(String(r))):n+="<td>"}return n+="</td>"}(e,t),"</tr></tbody></table></byte-sheet-html-origin>"))}function S(e,t){return e.reduce((function(e,n){var r="",o="";switch(n.type){case u.K6s.URL:r=(0,f.jY)(n.text),o=n.link?(0,f.r)(n.link):r,e+='<a href="'.concat(o,'" ').concat(n.cellPosition?'class="hyperlink_cellPosition"':"",">").concat(r,"</a>");break;case u.K6s.MENTION:if(""!==e&&(e+=" "),r=(0,f.jY)(n.text),(0,u.epN)(n.mentionType))o=(0,f.r)(decodeURIComponent(n.link)),e+='<a data-lark-doclink="'.concat(E({title:r,url:o}),'" href="').concat(o,'">').concat(r,"</a>");else if((0,u.tMY)(n)){var i={userid:n.token,username:n.name,avatar_url:n.link};e+='<a data-lark-atuser="'.concat(E(i),'" data-lark-user-id="').concat(n.token,'">').concat(r,"</a>")}else e+=r;break;case u.K6s.EMBED_IMAGE:var a=n.link;e+=k(n.fileToken,a,n.width,n.height,t);break;case u.K6s.TEXT:case u.K6s.ATTACHMENT:e+=r=(0,f.jY)(n.text)}return e}),"")}function k(e,t,n,r,o){var i=o.parent,a=u.Ps3.imageHelper,s=a.generatePublicUrl,l=a.encodeInfo,c=s?(0,f.r)(s({fileToken:e,originSrc:t})):"",h=i&&i._context.getToken(),d=Object.assign({objType:"sheet",objToken:h,originSrc:t},e&&{fileToken:e}),v=(0,f.r)(l(d));return'<img src="'.concat(c,'" width="').concat(n,'" height="').concat(r,'" data-suite="').concat(v,'">')}function E(e){return(0,f.r)(JSON.stringify(e))}var T=function(){function e(t,n){var r=this;(0,i.Z)(this,e),this.sheet=t,this.html="",this.styleHtml="",this.styleCache=new Map,this.start=function(e){var t=e.randomString,n=e.range,o=e.conditionFormat,i=e.pivotTable,a=e.columnsWidth,s=e.isEmbed,l=e.gridLineHidden,u=n.rowCount()===r.sheet.getRowCount();r.html+="<byte-sheet-html-origin";var c=t;if(r.html+=' data-id="'.concat(c,'" data-version="').concat(h.oR,'" data-is-embed="').concat(s,'" data-grid-line-hidden="').concat(l,'"'),u&&(r.html+=' data-copy-type="col"'),!s){var d=window.location,v=d.origin,p=d.pathname,g=(0,f.r)(v+p),m=(0,f.r)(n.toString({ref:n,isShowSheetName:!0}));r.html+=' data-importRangeRawData-spreadSource="'.concat(g,'" data-importRangeRawData-range="').concat(m,'"')}r.html+="".concat(r.serializeConditionFormat(o)),r.html+="".concat(r.serializePivotTable(i)),r.html+="".concat(r.serializeSparkline(n)),r.html+=">",r.html+='<table style="border-collapse: collapse;" >'+r.serializeColgroup(a)+"<tbody>"},this.end=function(){r.html+="</tbody></table></byte-sheet-html-origin>";var e=u.Ps3.imageHelper.makePulicUrlEffective;e&&e()},this.serializeRow=function(e,t){if(e){var n=r.sheet.getRowHeight(t);r.html+='<tr height="'.concat(n,'">')}else r.html+="</tr>"},this.rowStart=function(e,t){return r.serializeRow(!0,t)},this.rowEnd=function(e,t){return r.serializeRow(!1,t)},this.serializeCell=function(e,t,n,i,a,s,l,h,d,v,p,g,m,_,y,C,S,k,T,b,I,R,w,A,F,D,N,P,O){var M=[],L="";if(!0!==w){M.push("<td"),I>1&&M.push(' rowspan="'.concat(I,'"')),R>1&&M.push(' colspan="'.concat(R,'"')),Array.isArray(g)&&g.length&&M.push(" data-comments=".concat(JSON.stringify(g)));var x=r.serializeOptions;if(null!==S&&S!==b){var V=!!x.sheetValue;"object"===(0,o.Z)(x.sheetValue)&&(V=!x.sheetValue.string&&"string"!=typeof S),V&&(N?M.push(' data-sheet-formula-image-value="'.concat(E(S),'"')):M.push(' data-sheet-value="'.concat(E(S),'"')))}if(x.formula&&(T&&M.push(' data-sheet-formula-data="'.concat(E(T),'"')),C&&M.push(" data-sheet-ischild")),y){var Z=!!x.validation;if("object"===(0,o.Z)(x.validation)&&(Z=x.validation[y.type]),Z&&M.push(' data-data-validation="'.concat((0,f.r)(JSON.stringify(y.toJSON({needDeepClone:!1}))),'"')),(null==m||!m.foreColor)&&(0,c.NgA)(y)){var B=y.checkCellValid(l,h);(0,c.KpR)(B)&&(L+="color:".concat(u.vYI,";"))}}if(k&&M.push(' data-sheet-multiple-values="'.concat(E(k),'"')),x.reminder&&_&&(M.push(' data-reminder="'.concat(E(_),'"')),null!=m&&m.foreColor||(L+="color:".concat(u.nn5,";"))),u.Ps3.getAddNoteEnabled()&&O&&M.push(' data-cell-note="'.concat(E(O),'"')),F){var H=F.toJSON(),U=H.source,j=H.groupId;M.push(' data-sparkline="'.concat((0,f.r)(JSON.stringify({groupId:j,source:U,position:{row:e,col:t}})),'"'))}if(D&&D.length>0&&M.push(' data-float-images="'.concat((0,f.r)(JSON.stringify(D)),'"')),x.style&&m){var G=m.formatter,K=m.autoFormatter,W=G&&G.getFormatCode(),z=K&&K.getFormatCode();if(W){var Y=(0,f.r)(W);M.push(' data-formatter="'.concat(Y,'"')),"@"===W&&(L+="mso-number-format:'".concat(Y,"';"))}if(z&&M.push(' data-auto-formatter="'.concat((0,f.r)(z),'"')),m.hideLink&&M.push(' data-hide-link="true"'),u.Ps3.getAddDiagonalEnabled()&&m.diagonal&&(M.push(' data-diagonal="'.concat(E(m.diagonal),'"')),m.diagonalUp&&M.push(' data-diagonal-up="true"'),m.diagonalDown&&M.push(' data-diagonal-down="true"')),r.serializeOptions.inlineStyle)L+=r.getStyleStr(m,v);else{var J=r.styleCache.get(m);void 0===J&&(J=r.styleCache.size,r.styleCache.set(m,J),r.addClassStyle(m,J,v)),M.push(' class="s'.concat(J,'"'))}}L&&M.push(' style="'.concat(L,'"')),M.push(">"),M.push(r.getCellFragment(b,A,D)),M.push("</td>"),r.html+=M.join("")}},this.serializeOptions=Object.assign({sheetValue:!0,reminder:!0,formula:!0,style:!0,validation:!0,inlineStyle:!1},n)}return(0,a.Z)(e,[{key:"getSerializeContent",value:function(){return y("<style>"+m+this.styleHtml+"</style>"+this.html)}},{key:"getCellFragment",value:function(e,t,n){var r=this.sheet,o="";return t&&(o+=S(t,r)),n&&n.length>0&&(o+=function(e,t){var n=t.parent,r=u.Ps3.imageHelper.getDriveOriginalImageUrl;return e.reduce((function(e,o){var i=o.floatImageSetting,a=i.imageToken,s=i.width,l=i.height;return e+k(a,r(a,n&&n._context.getToken()),s,l,t)}),"")}(n,r)),!t&&e&&(o+=(0,f.jY)(String(e))),o}},{key:"serializeConditionFormat",value:function(e){if(null!=e&&e.length)try{return' data-condition-format="'.concat(E(e),'"')}catch(e){console.error("serializeConditionFormat error")}return""}},{key:"serializePivotTable",value:function(e){return e&&e.length>0?' data-pivot-tables="'.concat(E(e),'"'):""}},{key:"serializeSparkline",value:function(e){var t=this,n=e.toJSON(),o=n.row,i=n.col,a=n.rowCount,s=n.colCount,l={};return this.sheet.iterSparklineWithPos(o,i,a,s).forEach((function(e){var n=(0,r.Z)(e,1)[0].getGroupId();if(!l[n]){var o=t.sheet.getSparklineGroupByGroupId(n);o&&(l[n]=o.getRawConfig())}})),Object.keys(l).length?' data-sparkline-groups="'.concat(E(l),'"'):""}},{key:"serializeColgroup",value:function(e){return"<colgroup>".concat(e.map((function(e){return'<col width="'.concat(e,'">')})).join(""),"</colgroup>")}},{key:"getStyleStr",value:function(e,t){var n=[],r=e.backColor;r&&(r.startsWith("var(--")&&(r=(0,l.getThemeColorByToken)(r.slice(6,-1))),n.push("background-color:".concat(r,";")));var o=e.foreColor;if(o&&n.push("color:".concat(o,";")),t){var i,a;if(t.fontSize&&t.fontSize!==u.OvR&&(i=(0,c.gYd)(t.fontSize)),t.fontWeight===s.FontWeight.normal)a="normal";else if(t.fontWeight===s.FontWeight.bold)a="bold";else{var h;a=(null===(h=t.fontWeight)||void 0===h?void 0:h.toString())||"normal"}var v=t.fontStyle||"normal";i&&n.push("font-size:".concat(i,"pt;")),"normal"!==v&&n.push("font-style:".concat(t.fontStyle,";")),"normal"!==a&&n.push("font-weight:".concat(a,";"))}var p=e.vAlign;null!=p&&p!==u.g$I.Center&&n.push("vertical-align:".concat((0,f._$)(p),";"));var g=e.hAlign;if(null!=g){var m=(0,f.Av)(g);m&&n.push("text-align:".concat(m,";"))}var _=e.wordWrap;_===c.ngh.AUTOWRAP&&n.push("word-wrap:break-word;word-break:break-word;"),_===c.ngh.AUTOWRAP&&n.push("white-space:pre-wrap;"),_===c.ngh.WORDCLIP&&n.push("overflow-x:".concat(d.z.Hidden,";")),e.borderTop&&n.push("border-top:".concat((0,f.BD)(e.borderTop),";")),e.borderRight&&n.push("border-right:".concat((0,f.BD)(e.borderRight),";")),e.borderBottom&&n.push("border-bottom:".concat((0,f.BD)(e.borderBottom),";")),e.borderLeft&&n.push("border-left:".concat((0,f.BD)(e.borderLeft),";"));var y=e.diagonal;y&&(e.diagonalUp&&n.push("mso-diagonal-up:".concat((0,f.BD)(y),";")),e.diagonalDown&&n.push("mso-diagonal-down:".concat((0,f.BD)(y),";")));var C=e.textDecoration;return C&&n.push("text-decoration:".concat((0,f.I7)(C),";")),n.join("")}},{key:"addClassStyle",value:function(e,t,n){return this.styleHtml+=".s".concat(t,"{").concat(this.getStyleStr(e,n),"}"),t}}]),e}()},vsh_13484:function(e,t,n){n.d(t,{r:function(){return u},jY:function(){return c},vn:function(){return h},I7:function(){return d},Av:function(){return p},_$:function(){return g},BD:function(){return m},oh:function(){return _}});var r,o,i=n("vsh_74561"),a=n("vsh_91497"),s=n("vsh_24627");n("vsh_72834");function l(e,t){return e.replace(t,(function(e){switch(e){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";case"\0":return"&#0;";case"\n":return"<br>"}return e}))}function u(e){return l(e,/[\x00&<>"']/g)}function c(e){return l(e,/[\x00&<>"'\n]/g)}function h(e){var t=e.childNodes;if(t.length>1){for(var n="",r=0;r<t.length;r++){var o=t[r];o.nodeType===Node.TEXT_NODE?n+=o.textContent:"br"===o.nodeName.toLowerCase()&&(n+="\n")}return n}return e.textContent}function d(e){var t=[];return(e&s.aBM.overline)===s.aBM.overline&&t.push("overline"),(e&s.aBM.lineThrough)===s.aBM.lineThrough&&t.push("line-through"),(e&s.aBM.underline)===s.aBM.underline&&t.push("underline"),t.join(" ")}var f=(r={},(0,i.Z)(r,s.KqL.Left,"left"),(0,i.Z)(r,s.KqL.Center,"center"),(0,i.Z)(r,s.KqL.Right,"right"),r),v=(o={},(0,i.Z)(o,a.VerticalAlign.Top,"top"),(0,i.Z)(o,a.VerticalAlign.Center,"middle"),(0,i.Z)(o,a.VerticalAlign.Bottom,"bottom"),o);function p(e){return f[e]}function g(e){return v[e]}function m(e){return"0.5pt solid ".concat(e.color)}function _(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(n||/\r\n?|\n|\t/.test(e)){var r=new RegExp(t,"g");e=t+e.replace(r,t+t)+t}return e}},vsh_17811:function(e,t,n){n.d(t,{VT:function(){return _.VT},uz:function(){return ge},VJ:function(){return _.VJ},KD:function(){return pt},Sb:function(){return _.Sb},$v:function(){return ie},X_:function(){return se},Xz:function(){return oe}});var r,o=n("vsh_74561"),i=n("vsh_19264"),a=n("vsh_4175"),s=n("vsh_12064"),l=n("vsh_22462"),u=n("vsh_73455"),c=n("vsh_82905"),h=n("vsh_24627"),d=n("vsh_6127"),f=n.n(d),v=n("vsh_72834");!function(e){e.DoCopyCmd="DoCopyCmd",e.DoCutCmd="DoCutCmd",e.CutSheet="CutSheet"}(r||(r={}));var p,g={namespace:"CopyStore",state:{copyInfo:null,isCutting:!1,isCuttingDone:!1,copyId:null},commit:{setCopyInfo:function(e,t){e.copyInfo=t},setIsCutting:function(e,t){e.isCutting=t},setIsCuttingDone:function(e,t){e.isCuttingDone=t},setCopyId:function(e,t){e.copyId=t}}};!function(e){e.Pasted="Pasted",e.ToggleOptionalPasteIcon="ToggleOptionalPasteIcon",e.ShowInstallPasteExtensionModal="ShowInstallPasteExtensionModal"}(p||(p={}));var m={namespace:"PasteStore",state:{},commit:{}},_=n("vsh_94837"),y=function(){function e(){(0,i.Z)(this,e),this.savedFocusElement=null}return(0,a.Z)(e,[{key:"getActiveSheet",value:function(){return this._sdk?this._sdk.spread.getActiveSheet():null}},{key:"switchBackFocusCellAfterClipboard",value:function(){var e,t,n;this.savedFocusElement&&(null===(e=this.clipboardService)||void 0===e||e.blur(),null===(t=(n=this.savedFocusElement).focus)||void 0===t||t.call(n,{preventScroll:!0}),this.savedFocusElement=null)}},{key:"focusForClipboard",value:function(){var e;this.savedFocusElement=document.activeElement,null===(e=this.clipboardService)||void 0===e||e.focusForClipboard()}},{key:"setIsCutting",value:function(e){var t;null===(t=this.store)||void 0===t||t.commit("CopyStore/setIsCutting",e)}},{key:"dispatchClipboardEvent",value:function(e){var t;this.focusForClipboard(),null===(t=this.clipboardService)||void 0===t||t.dispatchClipboardEvent(e)}},{key:"getIsCutting",value:function(){var e,t;return(null===(e=this.store)||void 0===e||null===(t=e.getState("CopyStore"))||void 0===t?void 0:t.isCutting)||!1}},{key:"setIsCuttingDone",value:function(e){var t;null===(t=this.store)||void 0===t||t.commit("CopyStore/setIsCuttingDone",e)}},{key:"getIsCuttingDone",value:function(){var e,t;return(null===(e=this.store)||void 0===e||null===(t=e.getState("CopyStore"))||void 0===t?void 0:t.isCuttingDone)||!1}},{key:"setCopyInfo",value:function(e){var t;null===(t=this.store)||void 0===t||t.commit("CopyStore/setCopyInfo",e)}},{key:"getCopyInfo",value:function(){var e,t;return null===(e=this.store)||void 0===e||null===(t=e.getState("CopyStore"))||void 0===t?void 0:t.copyInfo}},{key:"setCopyId",value:function(e){var t;null===(t=this.store)||void 0===t||t.commit("CopyStore/setCopyId",e)}},{key:"getCopyId",value:function(){var e,t;return null===(e=this.store)||void 0===e||null===(t=e.getState("CopyStore"))||void 0===t?void 0:t.copyId}},{key:"registerDomEvent",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];null===(e=this.clipboardService)||void 0===e||e.register.apply(e,n)}},{key:"unregisterDomEvent",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];null===(e=this.clipboardService)||void 0===e||e.unregister.apply(e,n)}},{key:"commonDestroy",value:function(){this.savedFocusElement=null}},{key:"clipboardService",get:function(){var e;return null===(e=this._sdk)||void 0===e?void 0:e.getService(c.pV)}},{key:"store",get:function(){var e;return null===(e=this._sdk)||void 0===e?void 0:e.pluginStore}}]),e}(),C=n("vsh_48647"),S=function(){function e(){(0,i.Z)(this,e),this.performanceStartCache={},this.endPerformance=this.calcPerformance}return(0,a.Z)(e,[{key:"collectDataIndicators",value:function(e){this.dataIndicators=e}},{key:"collectInfoIndicators",value:function(e){this.infoIndicators=e}},{key:"startPerformance",value:function(e){this.performanceStartCache[e]=(0,h.D5c)()}},{key:"calcPerformance",value:function(e){this.performanceIndicators[e]+=(0,h.egz)(this.performanceStartCache[e])}},{key:"start",value:function(){this.performanceStartCache={},this.performanceIndicators={getCopyRangeDuration:0,serializeCopyDataDuration:0,getIgnoredRowsColsDuration:0,copyDuration:0},(0,h.vRF)(h.FHD.CLIPBOARD_COPY,h.G2P.START)}},{key:"error",value:function(){(0,h.vRF)(h.FHD.CLIPBOARD_COPY,h.G2P.ERROR)}},{key:"end",value:function(e){if(this.dataIndicators&&this.infoIndicators){var t=this.dataIndicators,n=t.rangeSize,r=t.rangeRowCount,o=t.ignoredRowsCount,i=t.rangeColCount,a=t.ignoredColsCount,s=t.copyCellCount,l=t.selections,u=this.infoIndicators.isCutting,c=this.performanceIndicators,d=c.getCopyRangeDuration,f=c.serializeCopyDataDuration,v=c.getIgnoredRowsColsDuration,p=c.copyDuration;n&&((0,h.vRF)(h.FHD.SERIALIZE_COPY_DATA,h.G2P.START,{parent_stage:h.FHD.CLIPBOARD_COPY}),(0,h.vRF)(h.FHD.SERIALIZE_COPY_DATA,h.G2P.END,{parent_stage:h.FHD.CLIPBOARD_COPY,size:n})),(0,h.vRF)(h.FHD.CLIPBOARD_COPY,h.G2P.END),this.collectImgContentEvent();var g=r-o,m=i-a;h.PxA.collectSheetEvent("sheet_copy_performance",{isCutting:u,copyRowCount:g,copyColCount:m,copyCellCount:s,copyRowCountIncludeIgnoredRows:r,copyColCountIncludeIngnoredCols:i,copyCellCountIncludeIgnoredRange:n,ignoredRowsCount:o,ignoredColsCount:a,selections:l,getCopyRangeDuration:d,serializeCopyDataDuration:f,getIgnoredRowsColsDuration:v,copyDuration:p},e),(0,h.RHc)({rangeTime:p,sheet:e,commandName:"clipboardCopy",changesets:[],executeType:(0,h.UFo)(!1,!0)})}}},{key:"collectImgContentEvent",value:function(){var e,t;if(this.dataIndicators&&this.infoIndicators){var n=this.infoIndicators,r=n.sheet_id,i=n.entry_type,a=n.isCutting,s=(e={},(0,o.Z)(e,_.Sb.SHORTKEY,"keyboard"),(0,o.Z)(e,_.Sb.CONTEXT_MENU,"context_menu"),(0,o.Z)(e,_.Sb.FILE_MENU,"file_menu"),e)[i],l=this.dataIndicators.existImgCount;if(l){var u=a?"embed_img_cut":"embed_img_copy";(0,C.Z)(l,(function(){h.Ps3.collectSuiteEvent("sheet_opration",{action:u,source:"body",eventType:"keydown",object_id:r,item_located_type:"in_cell"})})),null===(t=h.Ps3.collectSheetEvent)||void 0===t||t.call(h.Ps3,"ccm_sheet_content_page_click",{click:"edit_image",target:"none",sub_click:a?"cut":"copy",image_type:"in_cell",image_num:l,action_type:s})}}}}]),e}();var k=n("vsh_65498"),E=n("vsh_70098"),T=n("vsh_67017"),b=n.n(T),I=n("vsh_35067"),R=n("vsh_46544"),w=n("vsh_83836"),A=n("vsh_73043");function F(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return D(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return D(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var N=function(e){var t=[],n=e[0].rowFrom(),r=e.filter((function(e){return e.rowFrom()===n})).length,o=[];return e.forEach((function(e,n){var i=Math.floor(n/r),a=Math.floor(n%r);o[i]||(o[i]=[]),o[i][a]={range:e,rowOffset:i>0?o[i-1][a].rowOffset+o[i-1][a].range.rowCount():0,colOffset:a>0?o[i][a-1].colOffset+o[i][a-1].range.colCount():0};var s=function(e){var t=e.sheet();if(!t)return[];var n=e.toJSON(),r=n.row,o=n.col,i=t.inject(R.Cy),a=i.getPivotInfoMap(),s=[];return Array.from(a.keys()).forEach((function(t){var n=a.get(t);if(n){var l=n.pageRange,u=n.contentRange;if(!l&&!u)return;var c="";if(((!l||l&&e.contain(l))&&u&&e.contain(u)||!u&&l&&e.contain(l))&&(c=t),c){var h=i.getPositionCell(c);i.setPivotTableInfoField(t,"isCopy",!0),h&&s.push({name:c,pos:{row:h.row-r,col:h.col-o}})}}})),s}(e),l=s.map((function(e){return Object.assign({},e,{pos:{row:o[i][a].rowOffset+e.pos.row,col:o[i][a].colOffset+e.pos.col}})}));(0,h.hTd)(t,l)})),t},P=function(e,t){e.inject(R.Cy).resetPivotTableCopyInfo();var n=N(t);if(!e||0===(null==n?void 0:n.length))return[];var r=[];return null==n||n.forEach((function(t){var n=e.inject(R.Cy).getSyncModelByBlockToken(t.name),o=null==n?void 0:n.getSnapshot();o&&r.push({tableJSON:o,pos:t.pos,pivotName:t.name})})),r};function O(e,t,n,r){var o=n.tableJSON,i=n.pos,a=n.pivotName;if(e){var s=e.inject(R.Cy),l=s.getSourceRange(a);if(l){var u=t.parent.undoManager(),c=t.getSelections(),d=c[c.length-1].toJSON(),f=d.row,v=d.col,p=t.inject(R.Cy),g=s.getViewDataModelByName(a),m=0;if(r&&e===t)t.setEmbeddedBlock({blockType:w.kH.PIVOT_TABLE,blockToken:a,position:{row:f+i.row+m,col:v+i.col},blockSetting:{}});else{if(r){var _=s.getPivotInfoByName(a);_&&(_.isHidden=!0)}else{h.Ps3.ccmEventTracking("ccm_sheet_create_data_pivotd_pop_click",{create_method:"copy",click:"create_data_pivotd",target:"ccm_sheet_data_pivotd_home_view"});var y=t.filterModel.getFilterRange();if(y.row<=f&&f<=y.row+y.rowCount)for(var C=t.filterModel.getAllFilteredOutRows(),S=f,k=0;k<i.row||C.has(f+i.row+m);)C.has(S)?m++:k++,S++}var E;if(h.Ps3.Toast.show({key:h.iPD.PASTE_PIVOT_TABLE,type:"loading",content:A("sheet.pasting"),duration:0}),u._allowUndo=!1,p.addPivotTable({sourceRange:l,row:f+i.row+m,col:v+i.col,initSnapshot:o,dataViewModel:g,fromPaste:!0}).then((function(){r&&s.deletePivotTable(a,!0),t.parent.uiEvents.emit(h.zW2.RefreshPivotPanel,{visible:!0,ignoreConfig:!0})})).catch((function(e){if(h.Ps3.Toast.remove(h.iPD.PASTE_PIVOT_TABLE),u._allowUndo=!0,r){var t=s.getPivotInfoByName(a);t&&(t.isHidden=!1)}!function(e){var t="string"==typeof e?e:null==e?void 0:e.toastText;console.error("[PIVOT] paste pivot table error: ".concat(null==e?void 0:e.message)),setTimeout((function(){return h.Ps3.Toast.remove("toast-paste-in-pivot-area")})),h.Ps3.Toast.error({key:"pivot-table-pasting",content:t||A("CreationDoc_Sheets_PivotTable_RightClick_PastedFailed")})}(e)})),r)null===(E=h.Ps3.collectSheetEvent)||void 0===E||E.call(h.Ps3,"ccm_sheet_content_page_click",{click:"change_pivotd_position",target:"none",change_method:"cut_copy"})}}}}function M(e,t,n,r){return L.apply(this,arguments)}function L(){return(L=(0,I.Z)(b().mark((function e(t,n,r,o){var i,a,s;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=F(r),e.prev=1,i.s();case 3:if((a=i.n()).done){e.next=9;break}return s=a.value,e.next=7,O(t,n,s,o);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),i.e(e.t0);case 14:return e.prev=14,i.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[1,11,14,17]])})))).apply(this,arguments)}var x,V,Z,B=n("vsh_13484"),H=function(){function e(){var t=this;(0,i.Z)(this,e),this.text="",this.rowDelimiter=v.CSb.rowDelimiter,this.columnDelimiter=v.CSb.columnDelimiter,this.cellDelimiter=v.CSb.cellDelimiter,this.serializeCell=function(e,n,r,o,i,a,s,l,u,c,h,d,f,v,p,g,m,_,y,C,S,k,E,T,b,I){0!==o&&(t.text+=t.columnDelimiter),!0!==E&&(t.text+=(0,B.oh)(C,t.cellDelimiter))},this.rowStart=function(e){return t.serializeRow(!0,e)},this.rowEnd=function(e){return t.serializeRow(!1,e)}}return(0,a.Z)(e,[{key:"getSerializeContent",value:function(){return this.text}},{key:"serializeRow",value:function(e,t){e&&0!==t&&(this.text+=this.rowDelimiter)}}]),e}(),U=n("vsh_68808");!function(e){e.VALUES="optional-paste-values",e.FORMATTING="optional-paste-formatting",e.FORMULAS="optional-paste-formulas"}(x||(x={})),function(e){e.AUTO_CLEAR="auto_clear"}(V||(V={})),function(e){e.SHOW="show",e.CONFIRM="confirm",e.CANCEL="cancel"}(Z||(Z={}));var j=function(){function e(){(0,i.Z)(this,e),this.performanceStartCache={},this.endPerformance=this.calcPerformance}return(0,a.Z)(e,[{key:"collectDataIndicators",value:function(e){this.dataIndicators=Object.assign({},this.dataIndicators,{},e)}},{key:"collectInfoIndicators",value:function(e){this.infoIndicators=Object.assign({},this.infoIndicators,{},e)}},{key:"getDataIndicators",value:function(){return this.dataIndicators}},{key:"getInfoIndicators",value:function(){return this.infoIndicators}},{key:"getPerformanceIndicators",value:function(){return this.performanceIndicators}},{key:"startPerformance",value:function(e){this.performanceStartCache[e]=(0,h.D5c)()}},{key:"calcPerformance",value:function(e){this.performanceIndicators[e]+=(0,h.egz)(this.performanceStartCache[e])}},{key:"error",value:function(){(0,h.vRF)(h.FHD.CLIPBOARD_PASTE,h.G2P.ERROR),this.clearData()}},{key:"start",value:function(){this.clearData(),this.startPerformance("paste_duration"),(0,h.vRF)(h.FHD.CLIPBOARD_PASTE,h.G2P.START)}},{key:"end",value:function(){var e,t=this.dataIndicators,n=t.attachmentCount,r=t.formulaCount,o=t.hyperlinkCount,i=t.imageCount,a=t.reminderCount,s=t.checkboxCount,l=t.singleSelectCount,u=t.mulSelectCount,c=t.richTextCount,d=t.row_count,f=t.col_count,v=t.data_length,p=t.size,g=t.sheetRowCount,m=t.sheetColCount,_=t.rowCountToDelete,y=t.colCountToDelete,C=t.ignoredRowSize,S=t.spansSizeBefore,k=t.spansSizeAfter,E=t.selections,T=this.infoIndicators,b=T.is_internal,I=T.source,R=T.paste_option,w=T.isCutting,A={};I&&(A={isCutting:w,is_internal:b,row_count:d,col_count:f,source:I,data_length:v,sizeIncludeIgnoredRows:d*f,size:p,ignoredRowSize:C,spansSize:k,paste_option:R},(0,h.vRF)(h.FHD.GET_PASTE_INFO,h.G2P.START,{parent_stage:h.FHD.CLIPBOARD_PASTE}),(0,h.vRF)(h.FHD.GET_PASTE_INFO,h.G2P.END,{parent_stage:h.FHD.CLIPBOARD_PASTE,is_internal:b,row_count:d,col_count:f,sheetRowCount:g,sheetColCount:m,rowCountToDelete:_,colCountToDelete:y,content_type:I,length:v,sizeIncludeIgnoredRows:d*f,size:p,ignoredRowSize:C,spansSize:S,selections:E})),this.endPerformance("paste_duration"),this.collectSuiteEvent(),this.ccmEventTracking(),(0,h.vRF)(h.FHD.CLIPBOARD_PASTE,h.G2P.END,Object.assign({},A)),(e=Object.assign({},this.performanceIndicators,{attachmentCount:n,formulaCount:r,hyperlinkCount:o,imageCount:i,reminderCount:a,checkboxCount:s,singleSelectCount:l,mulSelectCount:u,richTextCount:c},A)).pure_paste_duration=e.paste_duration-e.request_duration-e.show_loading_duration-e.auto_clear_tip_duration-e.render_duration,h.Ps3.moirae.teaLog(Object.assign({key:"sheet_paste_performance"},e)),this.clearData()}},{key:"clearData",value:function(){this.performanceStartCache={};var e={performanceIndicators:{pure_paste_duration:0,paste_duration:0,get_data_duration:0,html_purify_duration:0,parse_duration:0,request_duration:0,calc_empty_cells_to_del_duration:0,auto_clear_tip_duration:0,command_execute_duration:0,resume_status_collect_duration:0,render_duration:0,show_loading_duration:0},dataIndicators:{attachmentCount:0,formulaCount:0,hyperlinkCount:0,imageCount:0,reminderCount:0,checkboxCount:0,singleSelectCount:0,mulSelectCount:0,richTextCount:0,attachmentTotalSize:0,dataValidationCount:0,rowCountToDelete:0,colCountToDelete:0,row_count:0,col_count:0,ignoredRowSize:0,validType:[]}},t=e.performanceIndicators,n=e.dataIndicators;this.performanceIndicators=t,this.dataIndicators=n}},{key:"collectOptionalPasteEvent",value:function(){var e="",t=this.infoIndicators,n=t.paste_option,r=t.paste_tea_source,o=t.sheet_id;switch(n){case h.Ve9.values:e=x.VALUES;break;case h.Ve9.formatting:e=x.FORMATTING;break;case h.Ve9.formulas:e=x.FORMULAS;break;default:return}var i="";switch(r){case _.Sb.SHORTKEY:i="keydown";break;case _.Sb.CONTEXT_MENU:case _.Sb.FLOATING_BUTTON:i="click";break;default:return}h.Ps3.collectSuiteEvent("sheet_opration",{action:e,source:r,eventType:i,object_id:o})}},{key:"collectExceedCellLimitTipEvent",value:function(){var e=this.infoIndicators.exceedCellTipsStage;e&&(h.Ps3.collectSuiteEvent("sheet_exceed_cell_limit_tip",{exceedCellLimitTipType:V.AUTO_CLEAR,stage:Z.SHOW}),h.Ps3.collectSuiteEvent("sheet_exceed_cell_limit_tip",{exceedCellLimitTipType:V.AUTO_CLEAR,stage:e}))}},{key:"ccmEventTracking",value:function(){if(h.Ps3.ccmEventTracking){var e=this.dataIndicators,t=e.attachmentTotalSize,n=e.attachmentCount,r=e.attachmentTypeMap,o=e.checkboxCount,i=e.singleSelectCount,a=e.mulSelectCount,s=e.hasSelectEnableColor,l=e.hasSelectDisableColor,u=e.dataValidationCount,c=e.validType,d=e.size,f=e.hyperlinkCount,p=e.imageCount,g=this.infoIndicators,m=g.paste_option,y=g.paste_tea_source;y===_.Sb.CONTEXT_MENU&&m===h.Ve9.all&&h.Ps3.ccmEventTracking("ccm_sheet_content_page_click",{click:"paste",target:"none",sub_click:"default",action_type:"context_menu",cell_num:d||1,link_num:f||0,img_num:p||0,file_num:n||0}),y===_.Sb.SHORTKEY&&m===h.Ve9.all&&h.Ps3.ccmEventTracking("ccm_sheet_content_page_click",{action_type:"hot_key",target:"none",click:"paste",cell_num:d||1,link_num:f||0,img_num:p||0,file_num:n||0,sub_click:"default"}),n>0&&h.Ps3.ccmEventTracking("ccm_sheet_content_page_click",Object.assign({},(0,h.dK5)(),{click:"upload_attachment",target:"none",action_method:"paste",attachment_size:t,attachment_type:n>1?"mult":r.keys[0],attachment_count:n,mult_attachment_type:Object.fromEntries(r)})),(0,v.OlV)(o>0,i>0,a>0,s,l,"paste",u,c.join("-"),m)}}},{key:"collectSuiteEvent",value:function(){if(h.Ps3.collectEvent){var e=this.dataIndicators,t=e.reminderCount,n=e.attachmentCount,r=this.infoIndicators,o=r.paste_source,i=r.showClipboardPermissionModal,a=r.paste_tea_source;r.usingPasteHelper&&h.Ps3.collectSuiteEvent("sheet_operation_dialog",{right_click:"right_click_paste",source:a,eventType:"click"}),i&&h.Ps3.collectSuiteEvent("sheet_operation_dialog",{action:"paste",dialog_type:"paste_dialog",source:a,eventType:"click"}),t>0&&h.Ps3.collectSuiteEvent("sheet_opration",{action:h.Fh1.ADD_REMINDER,source:"paste"}),n>0&&h.Ps3.collectSuiteEvent("sheet_opration",{action:"upload_attachment",source:"paste",object_count:n}),o&&h.Ps3.collectSuiteEvent("edit_cell_content",{action:"paste",paste_from:o}),this.collectExceedCellLimitTipEvent(),this.collectOptionalPasteEvent()}}}]),e}();function G(e,t){var n=e.sheetValue,r=e.formula,o=e.reminder,i=e.dataValidation,a=e.dropdown;if(i){switch(i.type){case h.h2P.Checkbox:++t.checkboxCount;break;case h.h2P.List:case h.h2P.ListFromRange:i.options.supportMultipleValues?++t.mulSelectCount:++t.singleSelectCount,i.options.shouldHighlightValidData?t.hasSelectEnableColor=!0:t.hasSelectDisableColor=!0;break;case h.h2P.Number:++t.numberSelectCount;break;case h.h2P.Date:++t.dateSelectCount;break;case h.h2P.TextLength:++t.textLengthSelectCount}++t.dataValidationCount}if(a&&(++t.singleSelectCount,a.isEnableOptionColor?t.hasSelectEnableColor=!0:t.hasSelectDisableColor=!0),o&&++t.reminderCount,r&&++t.formulaCount,Array.isArray(n))for(var s in n){var l=n[s];if(l.type===h.K6s.URL&&++t.hyperlinkCount,l.type===h.K6s.EMBED_IMAGE&&++t.imageCount,l.type===h.K6s.ATTACHMENT){var u,c,d;++t.attachmentCount,t.attachmentTotalSize+=l.size;var f=l.text.slice(l.text.lastIndexOf(".")+1),v=null===(u=t.attachmentTypeMap)||void 0===u?void 0:u.get(f);v?null===(c=t.attachmentTypeMap)||void 0===c||c.set(f,v+1):null===(d=t.attachmentTypeMap)||void 0===d||d.set(f,1)}l.style&&++t.richTextCount}return t}function K(){return{checkboxCount:0,hasSelectEnableColor:!1,hasSelectDisableColor:!1,dataValidationCount:0,formulaCount:0,hyperlinkCount:0,imageCount:0,reminderCount:0,attachmentCount:0,attachmentTotalSize:0,singleSelectCount:0,mulSelectCount:0,richTextCount:0,numberSelectCount:0,dateSelectCount:0,textLengthSelectCount:0,attachmentTypeMap:new Map}}function W(e,t,n){var r;if(n){var o=e.pastedRangeInfoArr;t||(t=function(e){for(var t=e.data,n=t.length,r=K(),o=0;o<n;++o){var i=t[o];if(i)for(var a=i.length,s=0;s<a;++s){var l=i[s];l&&G({sheetValue:l.value,formula:l.formulaData,reminder:l.reminderJSON,dataValidation:l.dataValidationJSON,dropdown:l.dropdown},r)}}return r}(e.tableData));var i=t,a=i.checkboxCount,s=i.hasSelectEnableColor,l=i.hasSelectDisableColor,u=i.dataValidationCount,c=i.formulaCount,h=i.hyperlinkCount,d=i.imageCount,f=i.reminderCount,p=i.attachmentCount,g=i.attachmentTotalSize,m=i.singleSelectCount,_=i.mulSelectCount,y=i.richTextCount,C=i.numberSelectCount,S=i.dateSelectCount,k=i.textLengthSelectCount,E=i.attachmentTypeMap,T=0;for(var b in o){var I=o[b],R=I.pastedRange,w=I.ignoredRows;T+=Math.floor(R.rowCount(!0)-w.size)*Math.floor(R.colCount(!0))}Object.keys(t).forEach((function(e){var n=t[e];"number"==typeof n&&(t[e]=T*n)}));var A=E.keys();for(var F in A){var D=A[F],N=E.get(D);N&&E.set(D,N*T)}var P=[];C&&P.push("number"),S&&P.push("date"),k&&P.push("text_length"),a&&P.push("checkbox"),m&&P.push("list_single"),_&&P.push("list_multiple");var O=e.rowCountToDelete,M=e.colCountToDelete,L=e.pastedRangeInfoArr[o.length-1],x=L.pastedRange,V=L.ignoredRows,Z=x?x.rowCount(!0):0,B=x?x.colCount(!0):0,H=V.size,U=null===(r=e.tableData)||void 0===r?void 0:r.conditionFormat;U&&(0,v.m9o)(U,"paste"),n.collectDataIndicators({row_count:Z,col_count:B,size:(Z-H)*B,rowCountToDelete:O,colCountToDelete:M,ignoredRowSize:H,formulaCount:c,hyperlinkCount:h,imageCount:d,reminderCount:f,checkboxCount:a,attachmentCount:p,attachmentTotalSize:g,attachmentTypeMap:E,singleSelectCount:m,mulSelectCount:_,richTextCount:y,hasSelectEnableColor:s,hasSelectDisableColor:l,validType:P,dataValidationCount:u})}}var z=n("vsh_89646"),Y=n("vsh_73043");function J(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return q(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return q(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function q(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function $(e,t,n,r){if(e.length<=1)return null;for(var o=[],i=t.rowFrom(),a=t.colFrom(),s=-1,l=0,u=n.filterModel.getAllFilteredOutRowsArray(),c=new Set,h=0;h<e.length;++h){var d=e[h];if(-1===s||d.rowFrom()!==e[s].rowFrom()){if(-1!==s){var f=o[s].pastedRange;i+=f.rowCount(!0),a=f.colFrom(),c=new Set}s=h}var p=new v.e6w(i,a,d.rowCount(),d.colCount(),n);if(r)if(0===c.size)for(;l<=u.length;++l){var g=u[l];if(g>p.rowTo(!0))break;p.rowFrom()<=g&&(c.add(g),p.setRowCount(p.rowCount(!0)+1))}else p.setRowCount(p.rowCount(!0)+c.size);o.push({pastedRange:p,ignoredRows:c}),a+=p.colCount(!0)}return o}function X(){return document.querySelector("#paste-helper-id")}function Q(e,t,n,r){var o=t+1,i=n+1,a=e.getRowCount(),s=e.getColumnCount();return Math.max(o,a)*Math.max(i,s)>r}function ee(e,t,n,r,o,i){var a=t+1,s=n+1,l=e.getRowCount(),u=e.getColumnCount(),c=s>u,h=-1,d=-1;if(a>l){if(!c){var f=e.getLastBlankColPos(o);-1!==f&&f*a<=i&&(d=u-f)}}else if(c){var v=e.getLastBlankRowPos(r);-1!==v&&v*s<=i&&(h=l-v)}else h=0,d=0;return{rowCountToDelete:h,colCountToDelete:d}}function te(e){var t;return{pastedRangeInfoArr:e.pastedRangeInfoArr,rowCountToDelete:e.rowCountToDelete,colCountToDelete:e.colCountToDelete,fromSheet:e.fromSheet,fromRanges:e.fromRanges,tableData:e.tableData,pasteOption:e.pasteOption,isCutting:e.isCutting,isPasteComment:e.isPasteComment,formulaValueMap:e.formulaValueMap,isFromText:e.isFromText,keepColumnWidth:e.keepColumnWidth,hasFloatImages:null==e||null===(t=e.insideInfo)||void 0===t?void 0:t.hasFloatImages}}function ne(e,t){var n=!1,r=!1,o={};if(t.insideInfo)n=!e._context.isEmbed()&&t.insideInfo.isAllImage,r=t.insideInfo.hasImportRange;else{var i=(0,z.Z)(t.tableData.data);if(n=!e._context.isEmbed()&&i.every((function(e){return!e.formulaData&&(0,v.uUo)(e.value)})),r=i.some((function(e){return function(e){return null!=e.formulaData&&null!=e.formulaData.externalDataReference}(e)})),t.tableData.importRangeRawData){var a=t.tableData.importRangeRawData,s=a.spreadSource;h.Ps3.getUrlToken(s)!==h.Ps3.getUrlToken(window.location.href)&&(o={importRangeRawData:a})}}var l=t.pastedRangeInfoArr,u=l[l.length-1].pastedRange,c=null;if(!t.isCutting&&!n&&!r){var d=t.fromRanges&&t.fromRanges.length>1||!1;c=Object.assign({},o,{isShowIcon:!0,pastedRange:u,forbidTranspose:d})}return c}function re(e,t,n,r){var o=[],i=n.fromRanges,a=n.isCutting;if(!(i&&i.length>1||a)&&t.length>1)for(var s=0,l=t.length;s<l;s++){var u=t[s],c=se(e,u,n,r);if(!ie(e,u,c,n))return null;var h=c.pastedRange;if(u.contain(h)&&!u.equal(h))return e._raiseInvalidOperation(1,Y("CreationDoc_Sheets_CopyPasteAreasNotSameSize")),null;o.push(c)}else{var d=t.length>0?t[0]:e._getSpanModel().get(e._activeRowIndex,e._activeColIndex),f=se(e,d,n,r);if(!ie(e,d,f,n))return null;o.push(f)}if(i&&1===i.length)for(var v=0;v<o.length;v++){var p=o[v],g=i[0];oe(e,g.rowCount(),g.colCount(),p.pastedRange)&&(p.pastedRange.setRowCount(1),p.pastedRange.setColCount(1),p.ignoredRows=new Set)}return o}function oe(e,t,n,r){if(1===t&&1===n){var o=e.getSpan(r.rowFrom(),r.colFrom(),h.A_Y.viewport);if(o&&o.equal(r))return!0}return!1}function ie(e,t,n,r){var o,i;if(!n)return!1;var a=n.pastedRange,s=n.ignoredRows,l=r.pasteOption===h.Ve9.transpose,u=a.rowFrom(),c=a.colFrom();if(u<0||c<0||u>e.getRowCount()||c>e.getColumnCount())return!1;var d=a.rowCount(),f=a.colCount();if(d<=0||f<=0)return!1;if((0,v.SrO)(e,u,c,d,f).length>0)return h.Ps3.Toast.warning({key:"toast-paste-in-pivot-area",content:Y("CreationDoc_Sheets_PivotTable_Failed_CanNotEditPivot")}),!1;var p=(0,v.B57)(a,s);if(e.checkRangesProtected(p))return e._raiseInvalidOperation(h.TiA.editProtectedRange,"do_paste"),!1;var g=(null===(o=r.tableData)||void 0===o?void 0:o.spans)||(null===(i=r.insideInfo)||void 0===i?void 0:i.spans)||[];if(!(null!==r.fromSheet))return function(e,t,n){var r=n.pastedRange,o=n.spans,i=n.ignoredRows,a=n.isTranspose;if(o&&o.length>0&&i.size>0){var s=r.rowCount(!0)-i.size,l=r.colCount(!0);if(ae(i,o,r,a,s,l))return e._raiseInvalidOperation(h.TiA.failToPasteModal,Y("sheet.paste_merges_over_filtered_rows")),!1}return!t.some((function(t){return e._hasPartSpans(t.rowFrom(),t.colFrom(),t.rowCount(!0),t.colCount(!0))}))||(e._raiseInvalidOperation(1,Y("CreationDoc_Sheets_CannotChangeMergedCellPaste")),!1)}(e,p,{pastedRange:a,spans:g,ignoredRows:s,isTranspose:l});var m=r.fromRanges,_=r.fromSheet,y=m.length;if(function(e,t,n,r){if(n&&e&&e===t)for(var o=r.rowFrom(),i=r.colFrom(),a=0;a<n.length;a++){var s=n[a],l=s.rowFrom(),u=s.colFrom(),c=s.rowCount(),h=s.colCount();if((o!==l||i!==u)&&r.isIntersect(s)){var d=e.getSpans(s),f=new v.Yv1;f.insertItems(d.map((function(e){return{ref:e}})));for(var p=0;p<d.length;p++){var g=d[p],m=g.colFrom(),_=g.rowFrom();if(l<=_&&_<l+c&&u<=m&&m<u+h){var y=new v.e6w(o+_-l,i+m-u,g.rowCount(),g.colCount(),e),C=f.search(y);if(C)for(var S=0;S<C.length;S++){var k=C[S].ref;if(!y.contain(k))return t._raiseInvalidOperation(1,Y("sheet.overlapping_spans")),!0}}}}}return!1}(_,e,m,a))return!1;if(1===y){var C=r.isCutting,S=m[0];if(C&&_.checkRangesProtected(S))return _._raiseInvalidOperation(h.TiA.editProtectedRange,"do_paste"),!1}return function(e,t,n,r,o,i){for(var a=i.spans,s=i.ignoredRows,l=i.isTranspose,u=0;u<n.length;u++){var c=n[u];if(e._hasPartSpans(c.rowFrom(),c.colFrom(),c.rowCount(),c.colCount()))return t._raiseInvalidOperation(1,Y("CreationDoc_Sheets_CannotChangeMergedCellPaste")),!1}if(o.some((function(e){return t._hasPartSpans(e.rowFrom(),e.colFrom(),e.rowCount(!0),e.colCount(!0))})))return t._raiseInvalidOperation(1,Y("CreationDoc_Sheets_CannotChangeMergedCellPaste")),!1;if(a.length>0&&s.size>0){var d=r.rowCount(!0)-s.size,f=r.colCount(!0);if(1!==n.length||oe(t,n[0].rowCount(),n[0].colCount(),r)||(d=n[0].rowCount(!0),f=n[0].colCount(!0)),ae(s,a,r,l,d,f))return t._raiseInvalidOperation(h.TiA.failToPasteModal,Y("sheet.paste_merges_over_filtered_rows")),!1}return!0}(_,e,m,a,p,{spans:g,ignoredRows:s,isTranspose:l})}function ae(e,t,n,r,o,i){for(var a=r?i:o,s=Array.from(e).sort((function(e,t){return e-t})),l=n.rowFrom(),u=e.size,c=t.length,h=0;h<u;h++){var d=s[h]-l,f=d-h,v=Math.floor(f/a)*a+h;if(v!==d)for(var p=0;p<c;p++){for(var g=t[p],m=r?g.col:g.row,_=r?g.colSpan:g.rowSpan,y=m+v,C=s[h]-l,S=0;y>=C&&h+S<u;)y++,h+ ++S<u&&(C=s[h+S]-l);if(y<C&&C<y+_)return!0}else for(;h<u&&s[h]+1===s[h+1];)h++}return!1}function se(e,t,n,r){var o=n.fromSheet,i=n.fromRanges,a=n.isCutting,s=n.pasteOption===h.Ve9.transpose;if(!(null!==o)){var l=n.tableData,u=l.rowCount,c=l.columnCount;oe(e,u,c,t)&&(u=t.rowCount(),c=t.colCount(),l.data[0][0].rowSpan=u,l.data[0][0].colSpan=c,l.spans&&l.spans.push({row:0,col:0,rowSpan:u,colSpan:c}));var d=t.rowFrom(),f=t.colFrom(),p=s?new v.e6w(d,f,c,u,e):new v.e6w(d,f,u,c,e),g=new Set;if(r){var m=(0,v.fnp)(p,!0);g=m.filteredRows,p=m.range}return{pastedRange:p,ignoredRows:g}}var _=i.length;if(1===_){var y=i[0],C=y.rowFrom(),S=y.colFrom(),k=y.rowCount(),E=y.colCount();if(!e._isValidRange(C,S,k,E,o.getRowCount(),o.getColumnCount()))return null;var T=t.clone(),b=T.rowCount(!0),I=T.colCount(!0);if(r)b-=(0,v.fnp)(T).filteredRows.size;a?(T.setRowCount(k),T.setColCount(E)):s?b%E==0&&1===I?T.setColCount(k):I%k==0&&1===b?T.setRowCount(E):b%E==0&&I%k==0||(T.setRowCount(E),T.setColCount(k)):b%k==0&&1===I?T.setColCount(E):1===b&&I%E==0?T.setRowCount(k):b%k==0&&I%E==0||(T.setRowCount(k),T.setColCount(E));var R=T.rowCount(!0)>(s?E:k)||T.colCount(!0)>(s?k:E),w=(0,v.fnp)(T,!R),A=w.filteredRows,F=w.range;return R||(T=F),{pastedRange:T,ignoredRows:A}}if(_>1){var D=$(i,t,e,r),N=D[0].pastedRange,P=D[D.length-1].pastedRange,O=N.union(P),M=new Set;for(var L in D){var x,V=J(D[L].ignoredRows);try{for(V.s();!(x=V.n()).done;){var Z=x.value;M.add(Z)}}catch(e){V.e(e)}finally{V.f()}}return{pastedRange:O,ignoredRows:M}}return null}function le(e){var t=0,n=0;for(var r in e){var o=e[r].pastedRange;t=Math.max(o.rowTo(!0),t),n=Math.max(o.colTo(!0),n)}return{pastedRowTo:t,pastedColTo:n}}var ue=function(){function e(){var t=this;(0,i.Z)(this,e),this.json="",this.isAllImage=!0,this.imageCount=0,this.hasImportRange=!1,this.hasFloatImages=!1,this.hasImportTableFomula=!1,this.hasImageFormula=!1,this.spans=[],this.teaDataInfo=K(),this.start=function(e){var n=e.randomString,r=e.isEmbed,o={randomString:n,version:_.Ix,isEmbed:r};t.json=JSON.stringify(o)},this.serializeCell=function(e,n,r,o,i,a,s,l,u,c,h,d,f,p,g,m,_,y,C,S,k,E,T,b,I,R,w,A){var F;if(!0!==T){var D=(0,v.uUo)(_);t.isAllImage=t.isAllImage&&D,D&&t.imageCount++,t.hasImportRange=t.hasImportRange||function(e){return null!=e&&null!=e.externalDataReference}(C),(k>1&&E>0||E>1&&k>0)&&t.spans.push({row:r-i,col:o-a,rowSpan:k,colSpan:E}),t.hasFloatImages=t.hasFloatImages||!!(R&&(null==R?void 0:R.length)>0),t.hasImageFormula=t.hasImageFormula||!!w,t.hasImportTableFomula=null!==(F=A)&&void 0!==F&&F,G({reminder:null==p?void 0:p.toJSON(),dataValidation:null==g?void 0:g.toJSON({needDeepClone:!1}),formula:C||void 0,sheetValue:_},t.teaDataInfo)}}}return(0,a.Z)(e,[{key:"dataInfo",value:function(){return{isAllImage:this.isAllImage,spans:this.spans,teaDataInfo:this.teaDataInfo,imageCount:this.imageCount,hasFloatImages:this.hasFloatImages,hasImportRange:this.hasImportRange,hasImportTableFomula:this.hasImportTableFomula,hasImageFormula:this.hasImageFormula}}},{key:"getSerializeContent",value:function(){return this.json}}]),e}();function ce(e,t,n){return he(e,t,{ranges:[t],serializeOptions:n},{html:!0}).serializeContent.html}function he(e,t){var n,r,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{json:!0,text:!0,html:!0},a=[],s=(null===(n=o.ignoredRowsCols)||void 0===n?void 0:n.rows.size)||0,l=(null===(r=o.ignoredRowsCols)||void 0===r?void 0:r.cols.size)||0,u=(t.rowCount()-s)*(t.colCount()-l),c=1e3,h=Object.assign({inlineStyle:u<c},o.serializeOptions),d=new U.Jc(e,h),f=new H,v=new ue;i.html&&a.push(d),i.text&&a.push(f),i.json&&a.push(v);var p=o.ranges||[t],g=new ve(e,t,{ranges:p,randomString:o.randomString||"",ignoredRowsCols:o.ignoredRowsCols,serializeListeners:a,entryType:o.entryType});return g.serialize(),{serializeContent:{json:v.getSerializeContent(),html:d.getSerializeContent(),text:f.getSerializeContent()},dataInfo:v.dataInfo()}}var de,fe,ve=function(){function e(t,n,r){(0,i.Z)(this,e),this.sheet=t,this.range=n,this.options=r,this.firstRowIndexInFilteredSpan=-1,this.rowsHasIgnoredCount=0,this.colsHasIgnoredCount=0}return(0,a.Z)(e,[{key:"serialize",value:function(){var e,t=this,n=this.options,r=n.randomString,o=n.ranges,i=n.serializeListeners,a=n.entryType,s=this.getColGroup(),l=this.getConditionalFormat(this.range),u=P(this.sheet,o),c=this.sheet.parent._context.isEmbed(),d=this.sheet.gridLineHidden.getGridLine(),f={randomString:r,range:this.range,conditionFormat:l,pivotTable:u,columnsWidth:s,isEmbed:c,gridLineHidden:d,entryType:a},p=a===_.Sb.COPY_FORMULA_IMAGE_BUTTON;i.forEach((function(e){var t;return null===(t=e.start)||void 0===t?void 0:t.call(e,f)}));var g=this.range,m=this.sheet,y=g.toJSON(),C=y.row,S=y.col,E=y.rowCount,T=y.colCount,b=(0,v.SyF)(g,m),I=(0,v.XYU)(b);null===(e=h.Ps3.ccmEventTracking)||void 0===e||e.call(h.Ps3,"ccm_sheet_content_page_click",{click:"copy",float_image_num:b.length||0});var R=new Set;this.rowsHasIgnoredCount=0;for(var w=function(e){var n,r=C+e;if(null!==(n=t.options.ignoredRowsCols)&&void 0!==n&&n.rows.has(r))return++t.rowsHasIgnoredCount,"continue";i.forEach((function(t){var n;return null===(n=t.rowStart)||void 0===n?void 0:n.call(t,e,r)})),t.colsHasIgnoredCount=0;for(var o=function(n){var o,a,s=S+n;if(null!==(o=t.options.ignoredRowsCols)&&void 0!==o&&o.cols.has(s))return++t.colsHasIgnoredCount,"continue";var l=m.getSpan(r,s),u=1,c=1,d=void 0;if(l)if(l.rowFrom()>t.firstRowIndexInFilteredSpan&&(t.firstRowIndexInFilteredSpan=r),R.has(l))d=!0;else{var f=l.intersect(t.range);f&&(u=f.rowCount()-t.getIgnoredRowCountInSpan(f),c=f.colCount()),R.add(l),d=!1}else d=void 0;var g=t.getCellInfoPos(r,s,l),_=g.row,y=g.col,C=m.getComments(_,y),E=m.getCellStyle(r,s);h.Ps3.getSheetCfCopyEnabled()||(E=m.updateConditionFormatStyle(_,y,E));var T=m.getSegmentArray(_,y);T&&(E=(0,v.qRm)(T,E,m));var w=null===(a=E)||void 0===a?void 0:a.rawFont,A=m.getReminder(_,y),F=m.getDataValidation(_,y),D=m.isProxyArrayFormula(_,y),N=m.getSparklineByCell(_,y),P=!1,O=null,M=null,L=null,x=!1,V=!1;if(D){var Z=m.getVar(_,y).getArrayRef();P=t.range.containCell(Z.rowFrom(),Z.colFrom());var B=t.processFormulaImage(m,_,y);B&&(T=B,O=B,x=!0,p&&(L=null))}else if(M=m.getMultipleValues(_,y)){var H,U=(null===(H=E)||void 0===H?void 0:H.formatter)||null,j=M.mergeToSingleValue({formatter:U}),G=j.segmentArray,K=j.variant;G?O=G:K&&(O=K.getValue())}else if(T)O=T;else{var W=m.getVar(_,y);null!=W&&W.isFormula()&&(L=t.serializeFormula(W));var z=null==W?void 0:W.getValue();if(null!=z&&""!==z){var Y=t.processFormulaImage(m,_,y);Y?(T=Y,O=Y,x=!0,p&&(L=null)):((0,v.mkm)(W)&&(V=!0),O=z)}}var J,q,$="";"object"!==(0,k.Z)(O)?$=m.formatSheetValue(_,y,O,(null===(J=E)||void 0===J?void 0:J.formatter)||(null===(q=E)||void 0===q?void 0:q.autoFormatter)):$=m.getText(_,y);var X=m.getCellNoteJSON(_,y),Q=void 0;b.length>0&&(Q=I.get((0,v.iw5)(r,s))),i.forEach((function(o){var i;return null===(i=o.serializeCell)||void 0===i?void 0:i.call(o,r,s,e,n,t.rowsHasIgnoredCount,t.colsHasIgnoredCount,_,y,t.options,w,l,C,E,A,F,P,O,M,L,$,u,c,d,T,N,Q,x,V,X)}))},a=0;a<T;a++)o(a);i.forEach((function(t){var n;return null===(n=t.rowEnd)||void 0===n?void 0:n.call(t,e,r)}))},A=0;A<E;A++)w(A);i.forEach((function(e){var t;return null===(t=e.end)||void 0===t?void 0:t.call(e,f)}))}},{key:"processFormulaImage",value:function(e,t,n){var r,o,i=(0,v.zhK)(e,t,n);if(!i)return null;var a=i.width,s=i.height,l=i.fileToken,u=i.link,c=i.mode,d=null!==(r=h.Ps3.imageHelper.getDriveImageUrl(null!==(o=l)&&void 0!==o?o:"",this.sheet.parent._context.getToken()))&&void 0!==r?r:"";d||l||!u||(d=u);var f={type:h.K6s.EMBED_IMAGE,width:a,height:s,fileToken:l,link:d,text:""};return(0,E.Z)(c)||(f.mode=c),[f]}},{key:"getIgnoredRowCountInSpan",value:function(e){for(var t=e.rowFrom(),n=e.rowTo(),r=this.firstRowIndexInFilteredSpan-t,o=this.firstRowIndexInFilteredSpan+1;o<=n;o++){var i;null!==(i=this.options.ignoredRowsCols)&&void 0!==i&&i.rows.has(o)&&r++}return r}},{key:"serializeFormula",value:function(e){var t={ref:e.getRef()},n=(0,v.dN9)(e,t,{refType:v.Gzt.Relative});return function(e,t){var n=t.refs;for(var r in n){var o=n[r];if(o.sheetId){var i=e.getSheetFromId(o.sheetId);i&&(delete o.sheetId,o.sheetName=i.name())}}}(this.sheet.getParent(),n),n}},{key:"getCellInfoPos",value:function(e,t,n){return{row:n&&e===this.firstRowIndexInFilteredSpan?n.rowFrom():e,col:t}}},{key:"getConditionalFormat",value:function(e){if(e){var t=(0,v.$pH)(e),n=this.sheet.conditionalFormatModel;return n&&(n.collectCFByCopy=t),t}return[]}},{key:"getColGroup",value:function(){for(var e=this.sheet,t=this.range,n=t.colFrom(),r=t.colCount(),o=[],i=0;i<r;i++){var a,s=n+i;if(null===(a=this.options.ignoredRowsCols)||void 0===a||!a.cols.has(s)){var l=e.getColumnWidth(s);o.push(l)}}return o}}]),e}(),pe=n("vsh_73043"),ge=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new S;return(0,i.Z)(this,t),(e=(0,s.Z)(this,(0,l.Z)(t).call(this))).name=_.VT,e._isUnderControl=!0,e.forbidInnerPaste=!1,e.copyCutHandler=function(t){try{var n,r,o,i=null===(n=e._sdk)||void 0===n?void 0:n.getService(c.tb),a=null==i?void 0:i.resolve("isIgnoreCopyableCheck",!1),s=e.getCopyConfig(),l=e._isUnderControl;if(e._isUnderControl=!0,l&&(!s||!a&&!h.Ps3.canCopy()))return t.preventDefault(),t.stopPropagation(),void(null===(o=e._copyTeaManager)||void 0===o||o.error());var u,d=s.clipboardContent,f=s.copyRangesToRender,v=d.html;if(!d.text&&!v)return void(null===(u=e._copyTeaManager)||void 0===u||u.error());t.preventDefault(),t.stopPropagation(),e.setEventClipboardData(t,d,l);var p=e.getActiveSheet();e.highlightCopyRange(p,f),null===(r=e._copyTeaManager)||void 0===r||r.end(p)}catch(e){console.error(e)}finally{e.resetCopyConfig(),e.switchBackFocusCellAfterClipboard()}},e._copyTeaManager=n,e}return(0,u.Z)(t,e),(0,a.Z)(t,[{key:"setForbidInnerPaste",value:function(e){this.forbidInnerPaste=e}},{key:"setSerializerOptions",value:function(e){this.serializeOptions=e}},{key:"resetSerializeOptions",value:function(){return this.serializeOptions=void 0}},{key:"init",value:function(e){this._sdk=e;var t=e.pluginStore;null==t||t.registerModule(g),this.registerDomEvent("copy",this.copyCutHandler),this.registerDomEvent("cut",this.copyCutHandler)}},{key:"destroy",value:function(){this.commonDestroy(),this._copyTeaManager=null,this._copyConfig=void 0,this.disposeWatchFunc=void 0,this.unregisterDomEvent("copy",this.copyCutHandler),this.unregisterDomEvent("cut",this.copyCutHandler)}},{key:"clipboardCopyCellPosition",value:function(e){var t={text:e,html:"",json:""};return this.setCopyConfig({clipboardContent:t,copyRangesToRender:void 0}),this.focusForClipboard(),this.setCopyInfo(null),this.setIsCutting(!1),this.setIsCuttingDone(!1),this._isUnderControl=!1,this.execCommand("copy")}},{key:"doCut",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_.Sb.SHORTKEY,n=this.clipboardCopy(!0,t);return null===(e=this.store)||void 0===e||e.dispatchEvent("CopyStore/DoCutCmd"),!1===n||(t!==_.Sb.SHORTKEY?(f().isMobile||f().isIPad)&&f().isLark?window.lark.biz.navigation.handleCutMenuClick():f().isSafari?this.execCommand("copy"):this.execCommand("cut"):f().isLark&&f().isIPad&&window.lark.biz.navigation.handleCutMenuClick()),n}},{key:"doCopy",value:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_.Sb.SHORTKEY,r=this.clipboardCopy(!1,n);return null===(e=this.store)||void 0===e||e.dispatchEvent("CopyStore/DoCopyCmd",{entryType:n}),n!==_.Sb.SHORTKEY?f().isMobile&&f().isLark?window.lark.biz.navigation.handleCopyMenuClick():this.execCommand("copy"):f().isLark&&f().isIPad&&null!==(t=this._sdk)&&void 0!==t&&t.spread._context.isEmbed()?window.lark.biz.navigation.handleCopyMenuClick():f().isIPad&&this.execCommand("copy"),r}},{key:"toHtml",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new v.e6w(0,0,e.getRowCount(),e.getColumnCount(),e);return ce(e,n,Object.assign({inlineStyle:!0},t))}},{key:"checkCopyRangeHasHiddenArea",value:function(e,t){var n,r,i=v.bAI.NONE,a=t?(n={},(0,o.Z)(n,v.bAI.NONE,null),(0,o.Z)(n,v.bAI.HAS_HIDDEN_ROWS,pe("sheet.copy_with_hidden_rows")),(0,o.Z)(n,v.bAI.HAS_HIDDEN_COLS,pe("sheet.copy_with_hidden_cols")),(0,o.Z)(n,v.bAI.HAS_HIDDEN_ROWS_AND_COLS,pe("sheet.copy_with_hidden_rows&cols")),n):(r={},(0,o.Z)(r,v.bAI.NONE,null),(0,o.Z)(r,v.bAI.HAS_HIDDEN_ROWS,pe("LarkCCM_Sheets_CellsCutIncludesHiddenRows_Toast")),(0,o.Z)(r,v.bAI.HAS_HIDDEN_COLS,pe("LarkCCM_Sheets_CellsCutIncludesHiddenColumns_Toast")),(0,o.Z)(r,v.bAI.HAS_HIDDEN_ROWS_AND_COLS,pe("LarkCCM_Sheets_CellsCutIncludesHiddenRowsAndColumns_Toast")),r),s=e.length>0?e[0].sheet():null;if(s){var l=t?s.getHiddenSeries(s._rowInfos):s.getHiddenRows(),u=s.getHiddenCols();i=(0,v.fJz)(e,l,u)}var c=a[i];c&&h.Ps3.Toast.show({type:"info",content:c,duration:3e3})}},{key:"clearRangeWatch",value:function(){var e;null===(e=this.disposeWatchFunc)||void 0===e||e.call(this),this.disposeWatchFunc=void 0}},{key:"watchRangeChange",value:function(e,t){var n,r=this;this.clearRangeWatch();var o=function(e){t.isValid()&&!t.intersect(e.range)||(r.clearRangeWatch(),r.setCopyInfo(null))},i=null===(n=this._sdk)||void 0===n?void 0:n.spread.calcEngine.depRefManager.watchRef(t,(function(){o({range:t})})),a=e.subscribe(h.U_F.StyleChanged,o);this.disposeWatchFunc=function(){null==i||i(),a.unsubscribe()}}},{key:"execCommand",value:function(e){var t;try{t=document.execCommand(e)}catch(e){t=!1,console.log(e)}return t}},{key:"highlightCopyRange",value:function(e,t){var n;e&&t&&(null===(n=this._sdk)||void 0===n||n.shellForEach((function(n){n.sheet===e&&n.sheetView().indicateRange(t)})))}},{key:"clipboardCopy",value:function(e,t){var n,r,o,i,a,s,l,u,c,d,f,p,g=this.getActiveSheet();if(g){null===(n=this._copyTeaManager)||void 0===n||n.start(),null===(r=this._copyTeaManager)||void 0===r||r.startPerformance("copyDuration"),null===(o=this._copyTeaManager)||void 0===o||o.startPerformance("getCopyRangeDuration");var m=g.getSelections(),_=!e,y=(0,v.hJs)(m,_);this.checkCopyRangeHasHiddenArea(y,_),null===(i=this._copyTeaManager)||void 0===i||i.calcPerformance("getCopyRangeDuration");var C,S=function(e){return e&&0!==e.length?1===e.length?e[0]:e[0].union(e[e.length-1]):null}(y);if(S){null===(a=this._copyTeaManager)||void 0===a||a.startPerformance("getIgnoredRowsColsDuration");var k=(0,v.JMv)(y);null===(s=this._copyTeaManager)||void 0===s||s.endPerformance("getIgnoredRowsColsDuration"),null===(l=this._copyTeaManager)||void 0===l||l.startPerformance("serializeCopyDataDuration");var E="".concat(Date.now()),T=he(g,S,{ranges:y,ignoredRowsCols:k,randomString:E,serializeOptions:this.serializeOptions,entryType:t}),b=T.serializeContent,I=T.dataInfo;null===(u=this._copyTeaManager)||void 0===u||u.endPerformance("serializeCopyDataDuration"),this.forbidInnerPaste||I.hasImageFormula&&!e?this.setCopyInfo(null):this.setCopyInfo({sheet:g,logicRanges:y,copyRange:S,dataInfo:I,copyFullColumn:S.rowCount()===g.getRowCount()}),this.setCopyId(E),this.watchRangeChange(g,S);var R,w=null===(c=this._sdk)||void 0===c?void 0:c.spread.options._ps;if(e&&w.embed&&0===S.rowFrom()&&0===S.colFrom()&&S.rowCount()===g.getRowCount()&&S.colCount()===g.getColumnCount())return null===(R=this.store)||void 0===R||R.dispatchEvent("CopyStore/CutSheet",Object.assign({sheetId:g.id()},b)),this.setIsCutting(!1),!1;this.setIsCutting(e),this.setIsCuttingDone(!1);try{var A,F;null===(A=this._copyTeaManager)||void 0===A||A.startPerformance("getCopyRangeDuration");var D=_?(0,v.hJs)(m,!1):y;null===(F=this._copyTeaManager)||void 0===F||F.endPerformance("getCopyRangeDuration"),this.setCopyConfig({clipboardContent:b,copyRangesToRender:D}),this.focusForClipboard()}catch(e){h.Ps3.moirae.ravenCatch(e)}var N=k.rows.size,P=k.cols.size,O=S.rowCount(),M=S.colCount();return null===(d=this._copyTeaManager)||void 0===d||d.collectDataIndicators({copyCellCount:y.reduce((function(e,t){return e+t.rowCount()*t.colCount()}),0),ignoredRowsCount:N,ignoredColsCount:P,rangeRowCount:O,rangeColCount:M,rangeSize:O*M,selections:JSON.stringify(m.slice(0,10).map((function(e){return e.toJSON()}))),existImgCount:I.imageCount}),null===(f=this._copyTeaManager)||void 0===f||f.collectInfoIndicators({entry_type:t,sheet_id:g.id(),isCutting:e}),null===(p=this._copyTeaManager)||void 0===p||p.endPerformance("copyDuration"),b}null===(C=this._copyTeaManager)||void 0===C||C.error()}}},{key:"setCopyConfig",value:function(e){this._copyConfig||(this._copyConfig={clipboardContent:{text:"",html:"",json:""},copyRangesToRender:void 0}),this._copyConfig=Object.assign({},this._copyConfig,{},e)}},{key:"getCopyConfig",value:function(){return this._copyConfig}},{key:"resetCopyConfig",value:function(){this._copyConfig=void 0}},{key:"setEventClipboardData",value:function(e,t,n){var r=t.text,o=t.html,i=t.json;f().isAndroid&&""===r&&""!==o&&(r=" ");var a,s={};if(s[h.Ps3.SheetClipboardDataType.TEXT]=r,s[h.Ps3.SheetClipboardDataType.HTML]=o,n)h.Ps3.clipboardManager.setDataWithEventPreventDefault(e,s);else{var l=e.clipboardData;Object.keys(s).forEach((function(e){l.setData(e,s[e])}))}f().isMobile||(null===(a=e.clipboardData)||void 0===a||a.setData("text/sheet",i))}}]),t}(y);!function(e){e[e.Success=0]="Success",e[e.Fail=1]="Fail"}(de||(de={})),function(e){e[e.DataEmpty=1e3]="DataEmpty",e[e.IllegalDataFormat=1001]="IllegalDataFormat",e[e.InvalidDataFormat=1002]="InvalidDataFormat",e[e.DataVersionOutdated=1003]="DataVersionOutdated",e[e.ParserVersionOutdated=1004]="ParserVersionOutdated"}(fe||(fe={}));var me=function(){function e(t){(0,i.Z)(this,e),this.type=de.Success,this.randomString=t.randomString,this.contentSource=t.contentSource}return(0,a.Z)(e,[{key:"isSuccess",get:function(){return this.type===de.Success}}]),e}(),_e=function(e){function t(){return(0,i.Z)(this,t),(0,s.Z)(this,(0,l.Z)(t).apply(this,arguments))}return(0,u.Z)(t,e),(0,a.Z)(t,[{key:"parse",value:function(){var e=this.contentSource;e?this.parseJson(e):(this.type=de.Fail,this.exception=fe.DataEmpty)}},{key:"parseJson",value:function(e){try{var t=JSON.parse(e);if(!t)return this.type=de.Fail,void(this.exception=fe.InvalidDataFormat);h.Ps3.collectSuiteEvent("sheet_parse_paste_data",{dataType:"json",dataVersion:t.version,parserVertion:String(_.Ix)});var n=Number(t.version||0);if(!Number.isNaN(n)){if(n<_.Ix)return this.type=de.Fail,void(this.exception=fe.DataVersionOutdated);if(n>_.Ix)return this.type=de.Fail,void(this.exception=fe.ParserVersionOutdated)}this.tableData=t}catch(e){console.error(e),this.type=de.Fail,this.exception=fe.IllegalDataFormat}}},{key:"getPasteSource",value:function(){return this.tableData.isEmbed?h.Lu8.EMBED_SHEET:h.Lu8.ALONE_SHEET}},{key:"sourceType",get:function(){return"json"}},{key:"pasteInternal",get:function(){return"string"==typeof this.randomString&&this.isSuccess&&this.randomString===this.tableData.randomString}}]),t}(me),ye=n("vsh_12198");var Ce,Se,ke=(Ce=h.QAv,(Se=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(Ce))?"rgb(".concat(parseInt(Se[1],16),", ").concat(parseInt(Se[2],16),", ").concat(parseInt(Se[3],16),")"):null);function Ee(e,t,n){return/[1-9]/.test(String(e))&&t&&"none"!==t&&"hidden"!==t&&!function(e,t,n){return("#ccc"===n||"rgb(204, 204, 204)"===n)&&"1px"===e&&"solid"===t}(e,t,n)&&!function(e){return e===h.QAv||e===ke}(n)?{width:1,color:n}:null}var Te,be,Ie,Re=n("vsh_25789"),we=n("vsh_48116");!function(e){e.Normal="normal",e.Nowrap="nowrap",e.Pre="pre",e.PreWrap="pre-wrap",e.PreLine="pre-line",e.BreakSpaces="break-spaces"}(be||(be={})),function(e){e.None="none",e.Underline="underline",e.LineThrough="line-through"}(Ie||(Ie={}));var Ae=(Te={},(0,o.Z)(Te,Ie.None,h.aBM.none),(0,o.Z)(Te,Ie.Underline,h.aBM.underline),(0,o.Z)(Te,Ie.LineThrough,h.aBM.lineThrough),Te),Fe={top:h.g$I.Top,middle:h.g$I.Center,bottom:h.g$I.Bottom},De={left:h.KqL.Left,center:h.KqL.Center,right:h.KqL.Right};function Ne(e){return window.getComputedStyle(e)}function Pe(e){return Ae[e]||h.aBM.none}function Oe(e,t){var n={},r=Ne(e),o=r.color,i=r.fontSize,a=r.fontStyle,s=r.fontWeight,l=r.textDecoration;if(o||i||a||s||l||t!==h.aBM.none){n.foreColor=(0,v.Lu3)(o);var u=Me(e);u&&(n.font=u);var c=r.webkitTextDecorationsInEffect||"none",d="none"===c?r.textDecorationLine:c;if(d){var f=d.split(" ").reduce((function(e,t){return e|Pe(t)}),h.aBM.none);"none"===c&&(f|=t),f!==h.aBM.none&&(n.textDecoration=f)}else n.textDecoration=t;return n}}function Me(e){var t=Ne(e),n=t.fontSize,r=t.fontStyle,o=t.fontWeight,i=t.lineHeight;return v.ZE6._buildFontString({fontVariant:v.vus,fontFamily:(0,h.M10)(),fontSize:n,fontStyle:r,fontWeight:o,lineHeight:i})}var Le=v.Nsj.map((function(e){return["border".concat(e,"Width"),"border".concat(e,"Style"),"border".concat(e,"Color")]})),xe=v.Nsj.map((function(e){return"border".concat(e)}));function Ve(e,t){var n={},r=Ne(e),o=r.color,i=r.backgroundColor,a=r.verticalAlign,s=r.textAlign,l=r.overflowX,u=r.whiteSpace,c=r.textDecorationLine;n.foreColor=(0,v.Lu3)(o),i&&!function(e){return"transparent"===e||e.startsWith("rgba")&&e.endsWith(", 0)")}(i)&&(n.backColor=i);var d=Me(e);for(var f in d&&(n.font=d),v.Nsj){var p=Le[f].map((function(e){return r[e]})),g=xe[f],m=Ee.apply(null,p);m&&(n[g]=m)}var _=(0,we.Oh)(e),y=(0,we.v3)(e),C=(0,we.zK)(e);if(h.Ps3.getAddDiagonalEnabled()&&_&&(y||C)&&(n.diagonal=_,y&&(n.diagonalUp=!0),C&&(n.diagonalDown=!0)),a&&(n.vAlign=Fe[a]),s){var S=De[s];null!=S&&(n.hAlign=S)}if(n.wordWrap=function(e,t){return[be.Nowrap,be.Pre].includes(t)?e===Re.z.Visible?v.ngh.OVERFLOW:v.ngh.WORDCLIP:v.ngh.AUTOWRAP}(l,u),c){var k=c.split(" ").reduce((function(e,t){return e|Pe(t)}),h.aBM.none);k!==h.aBM.none&&(n.textDecoration=k)}if(t){var E=e.getAttribute("data-formatter"),T=e.getAttribute("data-auto-formatter");E&&(n.formatter={formatCached:E}),T&&(n.autoFormatter={formatCached:T})}return n}function Ze(e,t){return"u"===e&&(t|=h.aBM.underline),"s"===e&&(t|=h.aBM.lineThrough),t}function Be(e){switch(e){case fe.DataVersionOutdated:throw h.Ps3.modalHelper.showCopyDataOutdatedModal(),new Error("[Sheet Clipboard]: Data Version Outdated");case fe.ParserVersionOutdated:throw h.Ps3.modalHelper.showPastePageOutdatedModal(),new Error("[Sheet Clipboard]: Parser Version Outdated")}}var He=n("vsh_64991"),Ue=function(){function e(){(0,i.Z)(this,e),this._cacheMap=new Map,this._tableString="table",this._tbodyString="tbody"}return(0,a.Z)(e,[{key:"generateKey",value:function(e,t){if(t){for(var n=e,r=[];n.nodeName.toLowerCase()!==this._tableString&&n.nodeName.toLowerCase()!==this._tbodyString;){if(r.push(this._getElementSelfStyleKey(n)),!n.parentElement)return null;n=n.parentElement}return r.join("")}return this._getElementSelfStyleKey(e)}},{key:"getCache",value:function(e){return this._cacheMap.get(e)}},{key:"setCache",value:function(e,t){this._cacheMap.set(e,t)}},{key:"_getElementSelfStyleKey",value:function(e){return"t".concat(e.tagName," c").concat(e.className," i").concat(e.id," s").concat(e.getAttribute("style")||""," f").concat(e.getAttribute("data-formatter")," af").concat(e.getAttribute("data-auto-formatter"))}}]),e}(),je=n("vsh_11725"),Ge=function(e){function t(e,n){var r;return(0,i.Z)(this,t),(r=(0,s.Z)(this,(0,l.Z)(t).call(this,e)))._container=n,r._isFromByteSheet=!1,r._tableEle=null,r._tableCellStyleCache=null,r.styleList=[],r._isFromByteSheet=!!r.contentSource.match(/<byte-sheet-html-origin[^>]*>/),r}return(0,u.Z)(t,e),(0,a.Z)(t,[{key:"parse",value:function(){try{var e=this.parseHtml();this.type=e.type,e.type!==de.Success?this.exception=e.exception:this.tableData=e.data,this.exception&&Be(this.exception)}finally{this._container.destroy()}}},{key:"getPasteSource",value:function(){return this._pasteSource||(this._pasteSource=(0,ye.Mn)(this.contentSource))}},{key:"validateByteSheetVersion",value:function(e){var t=Number(e.getAttribute("data-version")||0);if(h.Ps3.collectSuiteEvent("sheet_parse_paste_data",{dataType:"html",dataVersion:t,parserVertion:String(_.oR)}),!Number.isNaN(t)){if(t<_.oR)return{type:de.Fail,exception:fe.DataVersionOutdated};if(t>_.oR)return{type:de.Fail,exception:fe.ParserVersionOutdated}}return{type:de.Success}}},{key:"parseHtml",value:function(){var e=this;if(!this.contentSource)return{type:de.Fail,exception:fe.DataEmpty};var t,n=this._container.instance,r=n.getElementsByTagName("table");if((0,ye.OL)(r)&&(this._tableEle=r[0],this._tableCellStyleCache=new Ue),this.isFromByteSheet){var o=n.querySelector("byte-sheet-html-origin"),i=this.validateByteSheetVersion(o);if(i.type!==de.Success)return i;t=(0,ye.sr)(o)}var a=null;if(this._tableEle){var s=this._tableEle;a=this.getDataFromTable(s),t&&Object.assign(a,t)}else if(0===r.length)if((0,ye.gx)(n)){var l=n.getElementsByTagName("img");a=(0,ye.SM)(l)}else{var u=n.getElementsByTagName("div");if(u.length){var c=(0,ye.pQ)(u);if(c)a={data:[[this.getDataFromHtmlElement(c)]],rowCount:1,columnCount:1}}else{var d=Array.from(n.childNodes).filter((function(e){return"p"===e.nodeName.toLowerCase()}));if(d.length>0){var f=d.map((function(t){return[e.getDataFromHtmlElement(t)]}));a={data:f,rowCount:f.length,columnCount:1}}else{var v=n.getElementsByTagName("span");if(v.length>0&&!v[0].nextElementSibling)a={data:[[this.getDataFromHtmlElement(v[0])]],rowCount:1,columnCount:1}}}}if(!a)return{type:de.Fail,exception:fe.InvalidDataFormat};if(!a.suiteToken){var p=n.getElementsByTagName("img");if(p.length>0)for(var g in Array.from(p)){var m=p[g].dataset.suite;if(m){var _=h.Ps3.imageHelper.decodeInfo(m);_&&(a.suiteToken=_.objToken);break}}}return{type:de.Success,data:a}}},{key:"getDataFromTable",value:function(e){for(var t=[],n=[],r=(0,ye.jB)(e),o=[],i=Array.from(e.rows),a=i.length,s=!1,l=0,u=0;u<a;u++){var c=i[u];Number(c.getAttribute("height"))&&(n[u]=Number(c.getAttribute("height")));for(var h=c.cells,d=t[u]||(t[u]=[]),f=0,p=0,g=h.length;p<g;p++){for(;d[f];)f++;var m=h[p];n[u]||(n[u]=Number(m.getAttribute("height"))||null);var _=d[f]=this.getDataFromHtmlElement(m),y=m.rowSpan,C=m.colSpan;_.rowSpan=y,_.colSpan=C,_.dataSource=m.dataset.source,(y>1&&C>0||C>1&&y>0)&&o.push({row:u,col:p,rowSpan:y,colSpan:C}),s||_.formulaData&&(0,v.uUo)(_.value)&&(s=!0);for(var S=_.style,k=0;k<y;k++)for(var E=0;E<C;E++){if(0!==k||0!==E)(t[u+k]||(t[u+k]=[]))[f+E]={style:S,value:"",rowSpan:1,colSpan:1}}f+=C}l=Math.max(l,f)}return{styleList:this.styleList.map((function(e){return delete e.styleIndex,e})),onlyOneImage:1===t.length&&1===t[0].length&&e.getElementsByTagName("img").length>0,data:t,columns:r,spans:o,rowCount:a,columnCount:l,rows:n,type:e.className,headers:e.dataset.headers,hasImageFormula:s}}},{key:"getDataFromHtmlElement",value:function(e){var t,n={value:"",rowSpan:1,colSpan:1};if(this._tableEle){var r=this._tableCellStyleCache,o=r.generateKey(e,!this.isFromByteSheet);if(o){var i=r.getCache(o);if(i)t=i;else{t=Ve(e,!0);var a=this.styleList.length;t.styleIndex=a,this.styleList[a]=t,r.setCache(o,t)}if(n.styleIndex=t.styleIndex,this.isFromByteSheet)return(0,ye.Fb)(n,e),n}}else n.style=Ve(e);var s=this.getValueAndStyleFromCell(e,t),l=s.value;return s.style&&(n.style?n.style=Object.assign(n.style,s.style):n.style=s.style),n.value=(0,we.tr)(l),n}},{key:"getValueAndStyleFromCell",value:function(e,t){var n,r=t&&t.textDecoration||h.aBM.none;if(1===e.childNodes.length&&e.childNodes[0].nodeType===Node.TEXT_NODE){var o=e.childNodes[0].textContent||"";return{value:(0,He.vk)(o)}}e.hasChildNodes()&&v.BDP.includes(null===(n=e.textContent)||void 0===n?void 0:n[0])&&(e.textContent=e.textContent);var i,a=this.getSegmentsFromChildNodes(e,!1,r,t);return 0===a.length?{value:""}:1===a.length?a[0].type===h.K6s.TEXT?{value:a[0].text,style:a[0].style}:(a[0].style&&(i=a[0].style,delete a[0].style),{value:a,style:i}):{value:a=(0,we.jE)(a)}}},{key:"getSegmentsFromChildNodes",value:function(e,t,n,r){var o=e.nodeName.toLowerCase();if((0,He.Io)(o))return[];if(function(e){var t;return!(null==e||null===(t=e.classList)||void 0===t||!t.contains("ignore-collect"))}(e))return[];var i=(0,we.hH)(e);if(i)return[i];var a=(0,we.Lp)(e);if(a)return[a];for(var s=e.childNodes,l=s.length,u=[],c=0;c<l;++c){var d=s[c],f=d.nodeName.toLowerCase(),v=Ze(f,n);if("a"===f){var p=(0,je.Vw)(d);if(p){u.push(p);continue}var g=d.getAttribute("href");if(g){var m=this.getTextWithStyleArrFromChildNodes(d,v),_=m.reduce((function(e,t){return t.text?e+t.text:e}),"");if(_){var y={type:h.K6s.URL,link:g,text:_},C=Oe(d,v);C&&(y.style=C),m.length>1&&m.some((function(e){return e.style}))&&(y.texts=m.map((function(e){return e.type=h.K6s.TEXT,e})));var S=(0,we.uE)(g);S&&(y.cellPosition=S,y.link=""),u.push(y)}continue}var k=d.getAttribute("data-lark-atuser")||"",E=(0,je.Jc)(k);if((0,je.zE)(E)){var T=(0,je.ZM)(E);u.push(T);continue}}if(d.nodeType===Node.TEXT_NODE||0===d.childNodes.length){var b=this.getTextWithStyleFromLeafNode(d,t,v);if(b&&b.text){var I={type:h.K6s.TEXT,text:b.text};if(b.style)if(r){for(var R in b.style)if(b.style[R]!==r[R]){I.style=b.style;break}}else I.style=b.style;u=(0,we.Ex)(u,I);continue}}var w=this.getSegmentsFromChildNodes(d,!0,v,r);for(var A in w){var F=w[A];u=(0,we.Ex)(u,F)}}return u}},{key:"getTextWithStyleFromLeafNode",value:function(e,t,n){var r,o=e.nodeName.toLowerCase();if((0,He.Io)(o))return null;if(e.nodeType===Node.TEXT_NODE&&(r=e.textContent)&&(r=(0,He.vk)(r)),e.nodeType===Node.ELEMENT_NODE&&("br"===o?r="\n":(r=e.textContent)&&(r=(0,He.vk)(r))),r){var i=e.parentElement;if(t&&i){var a=Oe(i,n),s={text:r};return a&&(s.style=a),s}return{text:r}}return null}},{key:"getTextWithStyleArrFromChildNodes",value:function(e,t){var n=e.nodeName.toLowerCase();if((0,He.Io)(n))return[];for(var r=e.childNodes,o=r.length,i=[],a=0;a<o;++a){var s=r[a],l=Ze(s.nodeName.toLowerCase(),t);if(s.nodeType===Node.TEXT_NODE||0===s.childNodes.length){var u=this.getTextWithStyleFromLeafNode(s,!0,l);u&&i.push(u)}else{var c=this.getTextWithStyleArrFromChildNodes(s,l);for(var h in c){var d=c[h];i.push(d)}}}return i}},{key:"sourceType",get:function(){return"html"}},{key:"pasteInternal",get:function(){return!!this.randomString&&this.isSuccess&&this.randomString===this.tableData.randomString}},{key:"isFromByteSheet",get:function(){return this._isFromByteSheet}}]),t}(me),Ke=v.CSb.columnDelimiter,We=v.CSb.cellDelimiter;function ze(e){if(null==e||""===e)return{type:de.Fail,exception:fe.DataEmpty};for(var t,n="\r\n",r=[],o=We.length,i=n.length,a="\n".length,s=Ke.length,l=e.length,u=[],c="",d=!1,f=0;f<l;f++)t=(c+=e[f]).length,d?v.E6s._endsWith(c,We)&&(l>=f+1+o&&We===e.substr(f+1,o)?f+=o:(c=c.substr(0,t-o),d=!1)):v.E6s._endsWith(c,We)?c===We&&(c="",d=!0):v.E6s._endsWith(c,Ke)?(u.push(c.substr(0,t-s)),c=""):v.E6s._endsWith(c,n)?(u.push(c.substr(0,t-i)),c="",r.push(u),u=[]):v.E6s._endsWith(c,"\n")&&(u.push(c.substr(0,t-a)),c="",r.push(u),u=[]);c&&(v.E6s._endsWith(c,n)&&(c=c.substr(0,c.length-2)),u.push(c)),u.length&&r.push(u);var p=r.map((function(e){return e.map((function(e){return{value:(0,v.GG9)(e)?e:(0,h.Tcw)(e),rowSpan:1,colSpan:1}}))})),g=p.length,m=function(e){for(var t=0,n=0,r=e.length;n<r;n++)t=Math.max(e[n].length,t);return t}(p),_={data:p,rowCount:g,columnCount:m};return{type:de.Success,data:_}}var Ye=function(e){function t(){return(0,i.Z)(this,t),(0,s.Z)(this,(0,l.Z)(t).apply(this,arguments))}return(0,u.Z)(t,e),(0,a.Z)(t,[{key:"getPasteSource",value:function(){return h.Lu8.OTHER}},{key:"parse",value:function(){var e=ze(this.contentSource);this.type=e.type,e.type?this.exception=e.exception:this.tableData=e.data,this.exception&&Be(this.exception)}},{key:"sourceType",get:function(){return"text"}},{key:"pasteInternal",get:function(){return!1}}]),t}(me),Je=n("vsh_36290"),qe=n("vsh_98652"),$e=n("vsh_1139"),Xe=n("vsh_63738");function Qe(e,t){var n=t.refs;for(var r in n){var o=n[r];if(o.sheetName){var i=e.getSheetFromName(o.sheetName);i&&(delete o.sheetName,o.sheetId=i.id())}}}var et=function(){function e(t){(0,i.Z)(this,e),this.options=t,this.cache=new v.GfN}return(0,a.Z)(e,[{key:"getValueWhenPasteInside",value:function(e,t,n,r,o){if(!this.options.needCache)return this.getValueWhenPasteInsideCore(e,t,n,r,o);var i=this.cache.get(t,n);if(!i){var a=this.getValueWhenPasteInsideCore(e,t,n,r,o);return this.cache.set(t,n,a),a}return i}},{key:"getValueWhenPasteOutside",value:function(e,t,n,r,o){if(!this.options.needCache)return this.getValueWhenPasteOutsideCore(e,t,n,r,o);var i=this.cache.get(t,n);if(!i){var a=this.getValueWhenPasteOutsideCore(e,t,n,r,o);return this.cache.set(t,n,a),a}return i}},{key:"getValueWhenPasteOutsideCore",value:function(e,t,n,r,o){var i=e.getValue(t,n),a=i.value;if((this.options.pasteOptions===h.Ve9.all||this.options.pasteOptions===h.Ve9.transpose)&&i.formulaData)return Qe(this.options.toSheet.getParent(),i.formulaData),{formulaData:i.formulaData,value:null};if(this.options.pasteOptions===h.Ve9.values){var s=a=null==i.proxyValue?a:i.proxyValue;if(Array.isArray(i.value)&&(s=(0,v.C7s)(i.value)),Array.isArray(s))return{value:s=s.map((function(e){return e.type===h.K6s.URL?{type:h.K6s.TEXT,text:e.text}:e})),formulaData:null};a=s}if(this.options.pasteOptions===h.Ve9.conditionFormat){var l=i.proxyValue;if(l&&(0,v.uUo)(l))return{value:l,formulaData:null}}if("string"!=typeof a)return{value:a,formulaData:null};if(""===a)return{value:null,formulaData:null};var u=e.getCellStyle(t,n);if(!(null!==u&&void 0!==u.formatter&&(0,Xe.isTextFormatter)(u.formatter))&&v.BDP.includes(a[0])&&a.length>1)try{var c=this.options.toSheet.getParent(),d=(0,v.MYK)(this.options.toSheet,r,o,a,{skipFormulaCompile:!1,formulaCompileCtx:{refStyle:v.uPt.A1,ref:new v.e6w(t,n,1,1,this.options.toSheet),spread:c}});if(d&&d.isFormula()){var f,p=d,g=p.getExternalDataReferenceInfo();if((0,v.Unk)(p)){var m=c.importRangeManager,_=c.importRangeManagerV3;_.V3Enable?_.compileImportRange(p,!0,!0):g&&(f=m.generateAndCacheId(p,{range:g.range,url:g.url,sheetID:this.options.toSheet.id()}))}var y={ref:p.getRef()},C=(0,v.dN9)(p,y);if(f){var S=f,k=S.spreadToken,E=S.ref,T=S.isSyncStyle,b=S.importRangeId,I=S.spreadSource;C.externalDataReference={spreadToken:k,ref:E,isSyncStyle:T,importRangeId:b,spreadSource:I}}return{value:a.slice(1),formulaData:C}}}catch(e){h.Ps3.moirae.ravenCatch(e)}return{value:a,formulaData:null}}},{key:"getValueWhenPasteInsideCore",value:function(e,t,n,r,o){if(this.options.pasteOptions===h.Ve9.values){var i=o.get(t,n);if(void 0!==i)return{value:i,formulaData:null}}var a=e.getImmutableContent(t,n);if(!a)return{value:null,formulaData:null};var s=a.segmentArray?v.JG4.getSegmentArray4Changeset(a.segmentArray):null;if(this.options.pasteOptions===h.Ve9.all||this.options.pasteOptions===h.Ve9.transpose){if(Array.isArray(s))return{value:s,formulaData:null};var l=e.getVar(t,n);if(e.hasFormula(t,n)){o.set(t,n,l.getValue());var u={ref:l.getRef()};return{value:null,formulaData:(0,v.dN9)(l,u,{refType:v.Gzt.Relative})}}return e.isProxyArrayFormula(t,n)&&r.has(l.formula)?(o.set(t,n,l.getValue()),{value:null,formulaData:null}):{value:s||(a.variant?a.variant.getValue():null),formulaData:null}}return s=s&&(0,v.C7s)(s),Array.isArray(s)?{value:s=s.map((function(e){return e.type===h.K6s.URL?{type:h.K6s.TEXT,text:e.text}:e})),formulaData:null}:{value:s||(a.variant?a.variant.getValue():null),formulaData:null}}}]),e}(),tt=function(){function e(t){(0,i.Z)(this,e),this.options=t,this.cache=new v.GfN}return(0,a.Z)(e,[{key:"getFormulaDataWhenPasteInside",value:function(e,t,n){if(!this.options.needCache)return this.getFormulaDataWhenPasteInsideCore(e,t,n);var r=this.cache.get(t,n);if(void 0===r){var o=this.getFormulaDataWhenPasteInsideCore(e,t,n);return this.cache.set(t,n,o),o}return r}},{key:"getFormulaDataWhenPasteOutside",value:function(e,t,n,r,o){if(!this.options.needCache)return this.getFormulaDataWhenPasteOutsideCore(e,t,n,r,o);var i=this.cache.get(t,n);if(void 0===i){var a=this.getFormulaDataWhenPasteOutsideCore(e,t,n,r,o);return this.cache.set(t,n,a),a}return i}},{key:"getFormulaDataWhenPasteInsideCore",value:function(e,t,n){if(e.hasFormula(t,n)){var r=e.getVar(t,n),o={ref:r.getRef()};return(0,v.dN9)(r,o,{refType:v.Gzt.Relative})}return null}},{key:"getFormulaDataWhenPasteOutsideCore",value:function(e,t,n,r,o){var i=this.options.toSheet,a=e.getValue(t,n);if(a.formulaData)return Qe(i.getParent(),a.formulaData),a.formulaData;var s=a.proxyValue||a.value;if("string"==typeof s&&"="===s[0]&&s.length>1)try{var l=(0,v.MYK)(i,r,o,s,{skipFormulaCompile:!1,formulaCompileCtx:{refStyle:v.uPt.A1,ref:new v.e6w(t,n,1,1,i),spread:i.getParent()}});if(l&&l.isFormula()){var u=l,c={ref:u.getRef()};return(0,v.dN9)(u,c,{refType:v.Gzt.Relative})}}catch(e){h.Ps3.moirae.ravenCatch(e)}return null}}]),e}(),nt=function(){function e(t,n,r){(0,i.Z)(this,e),this.needCache=r,this.dataValidationCache=new Map,this.reminderCache=new Map,this.multipleValueCache=new Map,this.changesetValueCache=new et({needCache:r,pasteOptions:n,toSheet:t}),this.formulaDataCache=new tt({needCache:r,toSheet:t})}return(0,a.Z)(e,[{key:"getDataValidationJSON",value:function(e,t,n){if(this.needCache){var r=e.getDataValidation(t,n);if(!r)return null;var o=this.dataValidationCache.get(r);if(o)return o;var i=r.toJSON({needDeepClone:!0});return this.dataValidationCache.set(r,i),i}return e.getDataValidationJSON(t,n,{needDeepClone:!0})}},{key:"getReminder",value:function(e,t,n){if(this.needCache){var r=e.getReminder(t,n);if(!r)return null;var o=this.reminderCache.get(r);if(o)return o;var i=r.toChangeset();return this.reminderCache.set(r,i),i}return e.getReminderChangeset(t,n)}},{key:"getMultipleValues",value:function(e,t,n){if(this.needCache){var r=e.getMultipleValues(t,n);if(!r)return null;var o=this.multipleValueCache.get(r);if(o)return o;var i=r.toJSON();return this.multipleValueCache.set(r,i),i}return e.getMultipleValuesJSON(t,n)}},{key:"getValueWhenPasteInside",value:function(e,t,n,r,o){return this.changesetValueCache.getValueWhenPasteInside(e,t,n,r,o)}},{key:"getValueWhenPasteOutside",value:function(e,t,n,r,o){return this.changesetValueCache.getValueWhenPasteOutside(e,t,n,r,o)}},{key:"getFormulaDataWhenPasteInside",value:function(e,t,n){return this.formulaDataCache.getFormulaDataWhenPasteInside(e,t,n)}},{key:"getFormulaDataWhenPasteOutside",value:function(e,t,n,r,o){return this.formulaDataCache.getFormulaDataWhenPasteOutside(e,t,n,r,o)}}]),e}(),rt=n("vsh_59980"),ot=function(){function e(t,n,r,o){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];(0,i.Z)(this,e),this.sheet=t,this.cell=n,this.toRow=r,this.toCol=o,this.styleList=a,this.isFromText=s}return(0,a.Z)(e,[{key:"getRowCount",value:function(){return this.sheet.getColumnCount()||0}},{key:"getColumnCount",value:function(){return this.sheet.getRowCount()||0}},{key:"getPivotTableManager",value:function(){return this.sheet.getPivotTableManager()}},{key:"getDataValidationJSON",value:function(){var e=this.cell;return!e.dataValidationJSON&&e.dropdown&&(e.dataValidationJSON=(0,v.nMX)(e.dropdown)),e.dataValidationJSON||null}},{key:"getSegmentArray",value:function(){var e=this.cell;return Array.isArray(e.value)?v.JG4.convertSegmentArrayFromChangeset(this.sheet.getParent(),e.value):null}},{key:"hasFormatter",value:function(){var e=this.cell;if(!e.style&&"number"!=typeof e.styleIndex)return!1;if(this.styleList){var t=this.styleList[e.styleIndex];return!!t.autoFormatter||!!t.formatter}return!!e.style&&((0,rt.default)(e.style,"formatter.formatCached")||(0,rt.default)(e.style,"autoFormatter.formatCached"))}},{key:"getCellStyle",value:function(){var e=this.cell;if(!this.isFromText&&!e.style&&"number"!=typeof e.styleIndex)return null;var t=this.sheet,n=null;this.styleList&&(n=this.styleList[e.styleIndex]),e.style&&(n=n?v.bgS.withUpdateStyle(n,e.style,t.parent.formatterService):v.bgS.fromJSON(t.parent.formatterService,e.style,t.getDefaultStyle()));var r=t.getCellStyle(this.toRow,this.toCol);return this.isFromText?r:n=(0,v.EgI)(n,r)}},{key:"getMultipleValuesJSON",value:function(){return this.cell.multipleValuesJSON||null}},{key:"getReminderChangeset",value:function(){return this.cell.reminderJSON||null}},{key:"getValue",value:function(){return this.cell}},{key:"getComments",value:function(){return this.cell.comments||null}},{key:"getNoteByCell",value:function(){return this.cell.note||null}},{key:"getSparklineByCell",value:function(){if(!this.cell.sparkline)return null;var e=this.cell.sparkline,t=e.groupId,n=e.source,r=e.position,o=new v.bju(this.sheet,n,r,void 0,t);return o.getSource=function(){return n},o}}]),e}(),it=n("vsh_73043"),at=function(e){function t(e,n){var r;return(0,i.Z)(this,t),(r=(0,s.Z)(this,(0,l.Z)(t).call(this,e,n))).pasteInfos=[],r.isCombineMultipleSourceRange=!1,r.toSheetConditionalFormatRuleCount=0,r.addRowCount=0,r.addColCount=0,r.isTranspose=!1,r.pasteOptions=(0,v.Eiz)(n.pasteOption),r.sheetRowCount=e.getRowCount(),r.sheetColCount=e.getColumnCount(),r.toSheetOriginRowCount=r.sheetRowCount,r.toSheetOriginColCount=r.sheetColCount,r.toSheetConditionalFormatRuleCount=e.conditionalFormatModel&&e.conditionalFormatModel.getAllRules().length||0,r.isPasteInside=null!=n.fromSheet,r.cache=new nt(e,n.pasteOption,r.isPasteInside),r.isTranspose=n.pasteOption===h.Ve9.transpose,r}return(0,u.Z)(t,e),(0,a.Z)(t,[{key:"execute",value:function(){if(this._command.isFirstExecution){var e=!1;try{this._sheet.closeNotify(),e=this.doAction()}catch(e){throw console.error("paste failed",e),e}finally{this._sheet.resumeNotify(),this._sheet.notifyShell(v._16.ClipboardPasted),this._afterAction(this._sheet,!0)}return e}return this.redoAction()}},{key:"canExecute",value:function(){if(0===this.command.pastedRangeInfoArr.length)return!1;if(0===this.pasteInfos.length)return!1;var e=this._sheet.parent,t=e.importRangeManager,n=e.importRangeManagerV3,r=[],o=this.command.fromSheet;if(n.V3Enable)return!0;for(var i=0,a=0;a<this.pasteInfos.length;a++){var s=this.pasteInfos[a].fromRange;if(o&&s)if(o.cellModel.iterVisibleContent(s.rowFrom(),s.colFrom(),s.rowTo(),s.colTo()).forEach((function(e){var t=(0,$e.Z)(e,1)[0].variant;if(t&&(0,v.Unk)(t)){var n=t.getImportRangeMeta();n?r.push(n):i++}})),t.isImportRangeNumExceedLimitWithRangeCache(r,i))return h.Ps3.Toast.error({key:"crossTableError_num",closable:!0,content:it("CreationDoc_Sheets_ImportrangeToLimit",h.Ps3.getSheetImportRangeCountLimit())}),!1}return!0}},{key:"doAction",value:function(){var e=this._sheet,t=this.command.isCutting,n=this.deleteEmptyRowCol();if(!n)return!1;var r=this.sheetRowCount,o=this.sheetColCount;return this.preprocessPasteRange(),!!this.canExecute()&&(this.addRowCount=this.sheetRowCount-r,this.addColCount=this.sheetColCount-o,this.addRowCount>0&&(this.command._changesets.push(this._addRowsAction(r,this.addRowCount)),this.command._oldChangesets.unshift(this._delRowsAction(r,this.addRowCount))),this.addColCount>0&&(this.command._changesets.push(this._addColsAction(o,this.addColCount)),this.command._oldChangesets.unshift(this._delColsAction(o,this.addColCount))),t?this.doCutting():this.doPaste(),this.saveFilterAction(),this.pastePivotTables(e,t),(n=this.tryApplyActions(e.parent,this.command._changesets))&&this.updateSelectionAfterExecute(),n)}},{key:"pastePivotTables",value:function(e,t){if(this.isPasteInside&&this.pasteInfos.length)for(var n=0;n<this.pasteInfos.length;n++){var r=this.pasteInfos[n].fromRange,o=r.sheet(),i=this.isPasteInside&&o&&P(o,[r]);this.pasteOptions===h.b66.all&&i&&M(o,e,i,t)}}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this.command._oldChangesets,!0,"undo")}},{key:"redoAction",value:function(){return this.tryApplyActions(this._sheet.parent,this.command._changesets,void 0,void 0,"redo")}},{key:"updateSelectionAfterExecute",value:function(){if(this.pasteInfos){var e=this._sheet,t=this.pasteInfos.length;if(this.isCombineMultipleSourceRange){var n=this.command.pastedRangeInfoArr[0].pastedRange;e.setSelection(n)}else if(t>0){var r=this.pasteInfos[t-1].toRange,o=e.getActiveCellIndex(),i=o.row,a=o.column;e.setSelection(r,{row:i,col:a});for(var s=t-2;s>=0;--s){var l=this.pasteInfos[s].toRange;e.addSelection(l)}}}}},{key:"deleteEmptyRowCol",value:function(){var e=this._sheet,t=this.command,n=t.rowCountToDelete,r=t.colCountToDelete;if(n>0){var o=new v.aQD(e,{type:v.NHZ.ROW,method:v.Dx_.DEL,target:e.getRowCount()-n,count:n,sheetId:e.id()});if(!o.generateActions())return!1;this.addActionsToCommandStack(o.command._changesets,this.command._changesets),this.addActionsToCommandStack(o.command._oldChangesets,this.command._oldChangesets),this.sheetRowCount-=n}if(r>0){var i=new v.aQD(e,{type:v.NHZ.COL,method:v.Dx_.DEL,target:e.getColumnCount()-r,count:r,sheetId:e.id()});if(!i.generateActions())return!1;this.addActionsToCommandStack(i.command._changesets,this.command._changesets),this.addActionsToCommandStack(i.command._oldChangesets,this.command._oldChangesets),this.sheetColCount-=r}return!0}},{key:"preprocessPasteRange",value:function(){var e=this.command,t=e.isCutting,n=e.pastedRangeInfoArr,r=e.fromSheet,o=this.command.fromRanges||[],i=this._sheet,a=n[0].pastedRange,s=r&&$(o,a,i,!t),l=null;if(s){var u=s[0].pastedRange,c=s[s.length-1].pastedRange;l=u.union(c)}if(l&&a.equal(l)){for(var h=0;h<o.length;h++){var d=s[h],f=d.pastedRange,v=d.ignoredRows,p=o[h];this.pasteInfos.unshift({fromRange:p,toRange:f,ignoredRows:v}),this.sheetRowCount=Math.max(this.sheetRowCount,f.rowFrom()+f.rowCount(!0)),this.sheetColCount=Math.max(this.sheetColCount,f.colFrom()+f.colCount(!0))}this.isCombineMultipleSourceRange=!0}else for(var g=0;g<n.length;g++){var m=n[g],_=m.pastedRange,y=m.ignoredRows,C=o[0];this.pasteInfos.unshift({fromRange:C,toRange:_,ignoredRows:y}),this.sheetRowCount=Math.max(this.sheetRowCount,_.rowFrom()+_.rowCount(!0)),this.sheetColCount=Math.max(this.sheetColCount,_.colFrom()+_.colCount(!0))}}},{key:"saveConditionalDeleteFormatActionForCut",value:function(e){var t=this,n=e.sheet();if(n){var r=n.conditionalFormatModel;r.getAllRules().filter((function(t){var n=t.getBaseRanges();if(1===n.length){var r=n[0];return e.contain(r)}return!1})).forEach((function(e){var o=r.getRuleIndex(e.cfId),i=e.toJSON();t.command._changesets.push({action:h.aOo.DEL_CONDITIONAL_FORMAT,sheet_id:n.id(),value:{cfId:e.cfId,index:o}}),t.command._oldChangesets.push({action:h.aOo.ADD_CONDITIONAL_FORMAT,sheet_id:n.id(),value:Object.assign({},i,{index:o})})}))}}},{key:"saveOutlineAjustChangeSets",value:function(){var e=this.pasteInfos;if(e.length>1){var t=(0,v.oZ)(e);if(!t)return;e=t}var n=(0,v.hSW)(this._sheet,this._command.fromSheet,e,this._command.isCutting),r=n.newChangesets,o=n.oldChangesets;(0,h.hTd)(this._command._changesets,r),(0,h.VB2)(this._command._oldChangesets,o)}},{key:"saveConditionalFormatActionForCrossSheetClip",value:function(e,t){var n=this,r=this.command.fromSheet,o=this._sheet,i=r.conditionalFormatModel;i&&(i.getAllRules().length<=0||i.getAllRules().forEach((function(i,a){var s=[],l=[];if(i.getBaseRanges().forEach((function(n){if(e.contain(n)){var r=n.colFrom()-e.colFrom(),o=n.rowFrom()-e.rowFrom(),i=n.clone();i.setColFrom(t.colFrom()+r),i.setRowFrom(t.rowFrom()+o),l.push((0,v.z3T)(i,!0))}else s.push((0,v.z3T)(n,!0))})),l.length){var u=(0,v.EMG)(o),c=i.toJSON();l.length===i.getBaseRanges().length?(n.command._changesets.push({action:h.aOo.DEL_CONDITIONAL_FORMAT,sheet_id:r.id(),value:{cfId:i.cfId,index:a}},{action:h.aOo.ADD_CONDITIONAL_FORMAT,sheet_id:o.id(),value:Object.assign({},c,{ranges:l,cfId:u,index:n.toSheetConditionalFormatRuleCount})}),n.command._oldChangesets.push({action:h.aOo.DEL_CONDITIONAL_FORMAT,sheet_id:o.id(),value:{cfId:u,index:n.toSheetConditionalFormatRuleCount}},{action:h.aOo.ADD_CONDITIONAL_FORMAT,sheet_id:r.id(),value:Object.assign({},c,{index:a})})):(n.command._changesets.push({action:h.aOo.SET_CONDITIONAL_FORMAT,sheet_id:r.id(),value:Object.assign({},c,{ranges:s})},{action:h.aOo.ADD_CONDITIONAL_FORMAT,sheet_id:o.id(),value:Object.assign({},c,{ranges:l,cfId:u,index:n.toSheetConditionalFormatRuleCount})}),n.command._oldChangesets.push({action:h.aOo.DEL_CONDITIONAL_FORMAT,sheet_id:o.id(),value:{cfId:u,index:n.toSheetConditionalFormatRuleCount}},{action:h.aOo.SET_CONDITIONAL_FORMAT,sheet_id:r.id(),value:c}))}n.toSheetConditionalFormatRuleCount++})))}},{key:"saveSetFilterAction",value:function(e){var t=this,n=this.command.fromSheet,r=n.sheetFilterModel.getInfo();if(r){var o=r.range;e.contain(o)&&this.command._changesets.push({action:h.aOo.SET_FILTER,sheet_id:n.id(),target:(0,v.xD6)(o),value:null})}(0,v.LxP)(n).forEach((function(r){var o=r.range,i=r.id;e.contain(o)&&t.command._changesets.push((0,h.eRv)(n.id(),{range:(0,v.xD6)(o),view_id:i}))}))}},{key:"saveFilterAction",value:function(){var e=this._sheet,t=this._command,n=t.isCutting,r=t.fromSheet,o=this.pasteInfos.map((function(e){return e.toRange}));if(!this.pasteInfos.map((function(e){return e.fromRange})).some((function(t){return!!t&&(0,v.q_S)(r||e,t.rowFrom(),t.colFrom(),t.rowCount(),t.colCount())}))&&null!=o&&o.length){var i;n&&(null==r?void 0:r.id())===e.id()&&(i=this.pasteInfos.map((function(e){return e.fromRange})));var a=(0,v.buC)(e,o,i),s=a.actions,l=a.oldActions;(0,h.hTd)(this._command._changesets,s),(0,h.hTd)(this._command._oldChangesets,l)}}},{key:"doCutting",value:function(){var e=this._sheet;if(this._command.fromSheet){for(var t=0;t<this.pasteInfos.length;t++){var n=this.pasteInfos[t],r=n.fromRange,o=n.toRange,i=new v.dR4(e,{fromSheet:this._command.fromSheet,fromRow:r.rowFrom(),fromCol:r.colFrom(),toRow:o.rowFrom(),toCol:o.colFrom(),rowCount:r.rowCount(),colCount:r.colCount(),_changesets:[],_oldChangesets:[],_canUndo:!0,isFirstExecution:!0,hasFloatImages:this._command.hasFloatImages,isCutting:this._command.isCutting});!r.isValidBoundaryInsideSheet()&&h.Ps3.collectSuiteEvent("client_sheet_path_tracker_dev",{trace_code:h.Y6H.operationLog,info:"paste cutting range invalid ".concat(r.toGridJSON()," maxRowCount:").concat(this.sheetRowCount," maxColCount:").concat(this.sheetColCount)}),i.generateActions(),this.addActionsToCommandStack(i.command._changesets,this.command._changesets),this.addActionsToCommandStack(i.command._oldChangesets,this.command._oldChangesets,!1,!0),e!==this.command.fromSheet&&(this.saveConditionalFormatActionForCrossSheetClip(r,o),this.saveSetFilterAction(r),this.saveSparklineForCrossSheetCut(r,o)),this.saveConditionalDeleteFormatActionForCut(o)}this.saveOutlineAjustChangeSets()}}},{key:"doPaste",value:function(){this.isPasteInside?this.pasteInside():this.pasteOutside()}},{key:"pasteInside",value:function(){for(var e,t=this._sheet,n=this.command.fromSheet,r=this.isTranspose,o=this.getSparklineInitialDoAndUndoAction(t.id()),i=new Map,a=0;a<this.pasteInfos.length;a++){var s=this.pasteInfos[a],l=s.toRange,u=s.fromRange,c=s.ignoredRows;this.command.hasFloatImages&&(e=(0,v.XYU)((0,v.SyF)(u,n)));for(var h=u.rowFrom(),d=u.colFrom(),f=u.rowCount(),p=u.colCount(),g=l.rowCount(!0),m=l.colCount(!0),_=l.rowFrom(),y=l.colFrom(),C=!r&&0===_&&this.command.keepColumnWidth,S=this.getDoAndUndoInitialSetRangeValuesAction(_,y,g,m,t.id()),k=S.doSetRangeValuesAction,E=S.undoSetRangeValuesAction,T=(0,v.qRG)(n,h,d,t,_,y,g,m,void 0,f,p),b=0;b<m;b++){for(var I=y+b,R=0,w=0;w<g;w++){var A=_+w;if(c.has(A))R++;else{var F=this.isTranspose?d+(w-R)%p:d+b%p,D=this.isTranspose?h+b%f:h+(w-R)%f;if(this.saveUndoAction(t,A,I,E),this.saveDoAction(n,D,F,t,A,I,T,u,k),this.saveSparklineActionForInsidePaste(n,D,F,t,A,I,o,i),e){var N=e.get((0,v.iw5)(D,F));N&&this.saveFloatImgsAction(N,A,I,t)}}}if(C){var P=d+b%p;this.saveSetColWidthAction(n,P,t,I)}}E&&((0,v.ciS)(E),this._setRangeValuesActionToChangeset(E,!0)),(0,v.ciS)(k),this._setRangeValuesActionToChangeset(k),this.saveSetSpansAction(n,u,t,l,c)}var O=n.conditionalFormatModel;this.saveConditionalFormatActionForCopy(O.collectCFByCopy),this.saveOutlineAjustChangeSets(),this.setSparklineActionsToChangeset(o)}},{key:"pasteOutside",value:function(){for(var e,t=this,n=this._sheet,r=this.command.tableData,o=this.getSparklineInitialDoAndUndoAction(n.id()),i=new Map,a=null===(e=r.styleList)||void 0===e?void 0:e.map((function(e){return v.bgS.fromJSON(n.parent.formatterService,e,n.getDefaultStyle())})),s=function(e){var s=t.pasteInfos[e],l=s.toRange,u=s.fromRange,c=s.ignoredRows,d=l.rowFrom(),f=l.colFrom(),p=0,g=0,m=0,_=[],y=r.data;g=y.length;for(var C=t.command.tableData.columns||[],S=!t.isTranspose&&0===d&&t.command.keepColumnWidth&&C&&C.length,k=l.rowCount(!0),E=l.colCount(!0),T=t.getDoAndUndoInitialSetRangeValuesAction(d,f,k,E,n.id()),b=T.doSetRangeValuesAction,I=T.undoSetRangeValuesAction,R=0;R<y.length;R++){for(var w=y[R];c.has(d+R+m);)++m;p=Math.max(w.length,p);for(var A=d+R+m,F=0;F<w.length;F++){var D=w[F];if(D){var N=f+F,P=new ot(n,D,A,N,a,t.command.isFromText);if(t.isTranspose){for(var O=0;c.has(d+F+O);)O++;N=f+R,A=d+F+O}t.saveUndoAction(n,A,N,I),t.saveDoAction(P,R,F,n,A,N,new Set,u,b);var M=P.getComments();t.command.isPasteComment&&Array.isArray(M)&&M.length>0&&t.command._changesets.push(t._cellCommentsAction(A,N,M)),(D.rowSpan>1||D.colSpan>1)&&(p=Math.max(F+D.colSpan,p),g=Math.max(R+D.rowSpan,g),_.push(new v.e6w(R,F,D.rowSpan,D.colSpan,n))),t.saveSparklineActionForOutsidePaste(r,P,R,F,n,A,N,o,i),null!=D&&D.floatImages&&!h.Ps3.getIsDocx()&&t.saveFloatImgsAction(D.floatImages,A,N,n)}}}S&&C.forEach((function(e,r){if(e){var o=f+r;t.saveSetColWidthAction({getColumnWidth:function(){return e}},r,n,o)}})),I&&((0,v.ciS)(I),t._setRangeValuesActionToChangeset(I,!0)),(0,v.ciS)(b),t._setRangeValuesActionToChangeset(b),t.saveSetSpansAction({getSpans:function(){return _},getPivotTableManager:function(){return n.getPivotTableManager()}},new v.e6w(0,0,g,p,n),n,l,c)},l=0;l<this.pasteInfos.length;l++)s(l);var u=(null==r?void 0:r.conditionFormat)||[];this.saveConditionalFormatActionForCopy(u,!1),this.setSparklineActionsToChangeset(o)}},{key:"getDoAndUndoInitialSetRangeValuesAction",value:function(e,t,n,r,o){var i=null,a=e+n<=this.toSheetOriginRowCount?n:this.toSheetOriginRowCount-e,s=t+r<=this.toSheetOriginColCount?r:this.toSheetOriginColCount-t,l=(0,v.n1H)(o,{row:e,col:t,rowCount:n,colCount:r});return a>0&&s>0&&(i=(0,v.n1H)(o,{row:e,col:t,rowCount:a,colCount:s})),{undoSetRangeValuesAction:i,doSetRangeValuesAction:l}}},{key:"isNeedPasteFromPivotTable",value:function(e,t,n){var r=e.getPivotTableManager(),o=r.getPivotTableNameByCell(t,n);if(!o)return!0;var i=r.getPivotInfoByName(o);return!Boolean(null==i?void 0:i.isCopy)}},{key:"saveUndoAction",value:function(e,t,n,r){if(t<this.toSheetOriginRowCount&&n<this.toSheetOriginColCount)if(r){var o=e.getCellStyle(t,n),i=o?r.styleRefMgr.getStyleId(o):null;(0,v.x5g)(t,n,e,r,{styleId:i,needNote:!0})}else{var a=this.getSetCellAction(e,t,n);this.command._oldChangesets.unshift(a)}}},{key:"saveDoAction",value:function(e,t,n,r,o,i,a,s,l){var u,c=this.isNeedPasteFromPivotTable(e,t,n),d={};if(!this.isTranspose&&this.pasteOptions===h.b66.all&&!c)return this.setStyle(d,e,t,n,r,o,i,!0),void this._cellValueToChangeset(o,i,d);if(this.pasteOptions&h.b66.style&&(u=this.setStyle(d,e,t,n,r,o,i,void 0,l)),this.pasteOptions&h.b66.dataValidation&&this.setDataValidation(d,e,t,n,o,i),this.pasteOptions&h.b66.value)this.setValue(d,e,t,n,o,i,a,s)&&(u=void 0);else if(this.pasteOptions&h.b66.formula){if(!c)return;this.setFormulaOnly(d,a,e,t,n,o,i)}this.pasteOptions===h.b66.all&&this.setNote(d,e,t,n),this.fixCellValue(d,r,o,i),(0,v.x5g)(o,i,r,l,{cellValue:d,ignoreValue:!(this.pasteOptions&h.b66.value||this.pasteOptions&h.b66.formula),ignoreStyle:!(this.pasteOptions&h.b66.style||d.style),ignoreDataValidation:!(this.pasteOptions&h.b66.dataValidation),needNote:!0,styleId:u})}},{key:"setStyle",value:function(e,t,n,r,o,i,a,s,l){var u,c=t.getCellStyle(n,r,void 0,s);if(l){var d=c?l.styleRefMgr.getStyleRefAndId(c):void 0;e.style=(null==d?void 0:d.ref)||null,u=void 0!==d?d.id:null}else e.style=(null==c?void 0:c.toJSON())||null;return 0==(this.pasteOptions&h.b66.value)&&c&&(0,v.UcG)(e,o,i,a,c),u}},{key:"setDataValidation",value:function(e,t,n,r,o,i){var a=this.cache.getDataValidationJSON(t,n,r);if(a)e.dataValidation=a;else if(this.isPasteInside)e.dataValidation=null;else{var s=this._sheet.getDataValidationJSON(o,i,{needDeepClone:!0});s&&(e.dataValidation=s)}}},{key:"setReminder",value:function(e,t,n,r){var o=this.cache.getReminder(t,n,r);if(null!==o){var i=(0,v.RcK)((0,v.V8g)(o));e.reminder=i}else e.reminder=null}},{key:"setNote",value:function(e,t,n,r){var o=this.isPasteInside?t.getCellNoteJSON(n,r):t.getNoteByCell();e.note=o?(0,v.V8g)(o):null}},{key:"setMultipleValues",value:function(e,t,n,r){var o=this.cache.getMultipleValues(t,n,r);if(null!==o)return e.multipleValues=o,void(e.value=null);e.multipleValues=null}},{key:"setValue",value:function(e,t,n,r,o,i,a,s){return this.setReminder(e,t,n,r),this.setMultipleValues(e,t,n,r),this.isPasteInside?this.setValueWhenPasteInside(e,t,n,r,o,i,a,s):this.setValueWhenPasteOutside(e,t,n,r,o,i,a,s)}},{key:"setValueWhenPasteInside",value:function(e,t,n,r,o,i,a,s){var l=this._sheet,u=this.cache.getValueWhenPasteInside(t,n,r,a,this.command.formulaValueMap);if(u.formulaData){var c=new v.e6w(o,i,1,1,l),h=u.formulaData;return this.isTranspose&&(h=(0,v.mLp)((0,v.V8g)(u.formulaData),c,this.isTranspose,new v.e6w(n,r,1,1,t),s).formulaData),e.formulaData=(0,v.S6s)(l,h,c),void(e.value=null)}e.value=u.value}},{key:"setValueWhenPasteOutside",value:function(e,t,n,r,o,i,a,s){var l=this._sheet,u=this.cache.getValueWhenPasteOutside(t,n,r,o,i);if(u.formulaData)if(null===u.value){var c=new v.e6w(o,i,1,1,l),d=u.formulaData;this.isTranspose&&(d=(0,v.mLp)((0,v.V8g)(u.formulaData),c,this.isTranspose,new v.e6w(n,r,1,1,t),s).formulaData),e.formulaData=(0,v.S6s)(l,d,c),e.value=null}else e.value=null,e.formulaData=u.formulaData;else{if("string"!=typeof u.value)return void(e.value=u.value);var f=t.hasFormatter();if(!(this.command.pasteOption===h.Ve9.all&&f)){var p,g=null===(p=l.getCellStyle(o,i))||void 0===p?void 0:p.formatter,m=g?{formatter:g}:null,_=(0,v.r90)(l.formatterService,m,u.value,!0),y=_&&_.value,C=_&&_.autoFormatter,S=!1;return C&&!(0,Xe.isDefaultFormatter)(C)&&(e.style||(e.style=l.getStyle(o,i).toJSON(!0)),e.style=Object.assign({},e.style,{autoFormatter:{formatCached:C.getFormatCode()}}),S=!0),e.value=y,S}e.value=u.value}}},{key:"setFormulaOnly",value:function(e,t,n,r,o,i,a){e.reminder=null,e.multipleValues=null;var s=null;if(this.isPasteInside?(s=this.cache.getFormulaDataWhenPasteInside(n,r,o),e.value=this.cache.getValueWhenPasteInside(n,r,o,t,this.command.formulaValueMap).value):(s=this.cache.getFormulaDataWhenPasteOutside(n,r,o,i,a),e.value=this.cache.getValueWhenPasteOutside(n,r,o,i,a).value),s){var l=new v.e6w(i,a,1,1,this._sheet),u=this._sheet;e.formulaData=(0,v.S6s)(u,s,l)}}},{key:"saveSetSpansAction",value:function(e,t,n,r,o){var i=this;if(this.pasteOptions&h.b66.span){var a=e.getSpans(t).filter((function(t){return i.isNeedPasteFromPivotTable(e,t.rowFrom(),t.colFrom())}));if(a.length){var s=n.getSpans(r),l=Array.from(o).sort((function(e,t){return e-t})),u=l.length,c=[],d=r.rowFrom(),f=r.colFrom(),v=t.rowFrom(),p=t.colFrom(),g=t.rowCount(!0),m=t.colCount(!0);if(this.isTranspose){var _=[m,g];g=_[0],m=_[1]}s.forEach((function(e){var t=e.rowFrom(),n=e.rowTo();o.has(n)&&o.has(t)&&c.push(e.clone())}));for(var y=r.rowCount(!0)-u,C=r.colCount(!0),S=Math.floor(y/g),k=Math.floor(C/m),E=0,T=function(e){for(var t=d+e*g+E;E<u&&t===l[E];)E++,t++;for(var n=function(e){var n=f+e*m;a.forEach((function(e){var r=e.colFrom()-p,o=e.rowFrom()-v;if(i.isTranspose){var a=[o,r];r=a[0],o=a[1]}for(var s=t+o,h=n+r,d=E;d<u&&s>=l[d];)d++,s++;var f=e.clone();if(f.setRowFrom(s),f.setColFrom(h),i.isTranspose){var g=e.rowCount(!0),m=e.colCount(!0);f.setRowCount(m),f.setColCount(g)}c.push(f)}))},r=0;r<k;r++)n(r)},b=0;b<S;b++)T(b);c.length&&(this.command._changesets.push(this._setSpansAction(r,c,!0)),this.command._oldChangesets.unshift(this._setSpansAction(r,s,!0)))}else this.clearTargetSpansAction()}}},{key:"clearTargetSpansAction",value:function(){var e=this,t=this.command.pastedRangeInfoArr;for(var n in t){var r=t[n],o=r.pastedRange,i=r.ignoredRows;(0,v.B57)(o,i).forEach((function(t){e.removeTargetSpan(t)}))}}},{key:"saveSetColWidthAction",value:function(e,t,n,r){var o=e.getColumnWidth(t);this.command._changesets.push(this._colWidthAction(r,o));var i=n.getColumnWidth(r);this.command._oldChangesets.unshift(this._colWidthAction(r,i))}},{key:"fixCellValue",value:function(e,t,n,r){var o=!1,i=null;if(this.pasteOptions&h.b66.value&&!(this.pasteOptions&h.b66.dataValidation)){if(e.multipleValues){var a=t.getDataValidation(n,r);a&&(0,v.Xfg)(a)||(i=new v.b5y(t.getParent()).fromJSON(e.multipleValues),o=!0)}}else if(!(this.pasteOptions&h.b66.value)&&this.pasteOptions&h.b66.dataValidation){var s=t.getMultipleValues(n,r);if(s){if(void 0===e.dataValidation){var l=t.getDataValidation(n,r);l&&(0,v.Xfg)(l)||(o=!0)}e.dataValidation&&!(0,v.fuV)(e.dataValidation)&&(o=!0),i=s}}if(i&&o){var u=t.getUserFormatter(n,r)||null,c=i.mergeToSingleValue({formatter:u}),d=c.segmentArray,f=c.variant,p=null;d?p=v.JG4.getSegmentArray4Changeset(d):f&&(p=f.getValue()),e.multipleValues=null,e.value=p}(0,h.Nsj)(e.value,!0)}},{key:"removeTargetSpan",value:function(e){var t=this._sheet,n=this._sheet.getSpans(e);if(n.length){var r=e.rowFrom(),o=e.colFrom(),i=e.rowCount(),a=e.colCount();1===i&&1===a||(this.command._changesets.unshift(this._setSpansAction(new v.e6w(r,o,i,a,t),[])),this.command._oldChangesets.unshift(this._setSpansAction(new v.e6w(r,o,i,a,t),n)))}}},{key:"addActionsToCommandStack",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=n?Array.prototype.push:Array.prototype.unshift;if(r)for(var i=e.length-1;i>=0;i--)o.call(t,e[i]);else e.forEach((function(e){o.call(t,e)}))}},{key:"saveConditionalFormatActionForCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.length){var n=this._command,r=n.pasteOption,o=n.pastedRangeInfoArr,i=o.map((function(e){return e.pastedRange})),a=(0,v.Tnr)(this._sheet,e,r,{toRanges:i,isInside:t}),s=a.changeset,l=a.undoChangeset,u=a.isOverLimit;u&&this._sheet.parent.trigger(h.zW2.conditionalFormatOverLimit),(0,h.hTd)(this.command._changesets,s),(0,h.VB2)(this.command._oldChangesets,l)}}},{key:"saveSparklineForCrossSheetCut",value:function(e,t){var n=this.command.fromSheet,r=t.sheet();if(null!=n&&n.id()&&r){var i={action:h.aOo.UPDATE_SPARKLINE_GROUP,sheet_id:n.id(),value:{}},a={action:h.aOo.UPDATE_SPARKLINE_GROUP,sheet_id:r.id(),value:{}},s=e.toJSON(),l=s.row,u=s.col,c=s.rowCount,d=s.colCount,f=t.toJSON(),p=f.row,g=f.col,m=!1;n.iterSparklineWithPos(l,u,c,d).forEach((function(e){var t,r,s=(0,$e.Z)(e,2),c=s[0],h=s[1];m=!0;var d=c.getGroupId(),f=c.getId(),_=c.getSource();null!==(t=i.value[d])&&void 0!==t&&t.sparklines?i.value[d].sparklines[f]={source:_}:i.value[d]={sparklines:(0,o.Z)({},f,{source:_})};var y={row:p+h.row-l,col:g+h.col-u},C={source:(0,v.uVG)(n.parent,_,h,y)};null!==(r=a.value[d])&&void 0!==r&&r.sparklines?a.value[d].sparklines[f]=C:a.value[d]={sparklines:(0,o.Z)({},f,C)}})),m&&(this._command._changesets.push(a),this._command._oldChangesets.push(i))}}},{key:"saveSparklineActionForInsidePaste",value:function(e,t,n,r,o,i,a,s){var l=e.getSparklineByCell(t,n);if(l){var u=e.getSparklineModel().getSparklineRawConfig(l.getGroupId());this.saveSparklineActionForPaste(r,o,i,a,l,u,s)}}},{key:"saveSparklineActionForOutsidePaste",value:function(e,t,n,r,o,i,a,s,l){var u,c=t.getSparklineByCell(n,r);if(c){var h=(null===(u=e.sparklineGroups)||void 0===u?void 0:u[c.getGroupId()])||null;this.saveSparklineActionForPaste(o,i,a,s,c,h,l)}}},{key:"saveSparklineActionForPaste",value:function(e,t,n,r,o,i,a){if(this.pasteOptions&h.b66.sparkline){var s=r.doActions,l=r.undoActions,u=o.getGroupId(),c=a.get(u);c||(c=(0,v.mhf)(),a.set(u,c)),s[0].value[c]||(s[0].value[c]={sparklines:{}},i&&(s[0].value[c].config=i));var d=o.getPosition(),f=o.getSource(),p={row:t,col:n},g=(0,v.uVG)(e.parent,f,d,p);s[0].value[c].sparklines[(0,v.Z7n)()]={source:g,position:p},l[1].value||(l[1].value=[]),l[1].value.push(c);var m=e.getSparklineByCell(t,n);if(m){s[1].value[m.getGroupId()]||(s[1].value[m.getGroupId()]={sparklines:{}}),s[1].value[m.getGroupId()].sparklines[m.getId()]=null,l[0].value[m.getGroupId()]||(l[0].value[m.getGroupId()]={sparklines:{}});var _=m.toJSON(),y=_.source,C=_.position;l[0].value[m.getGroupId()].sparklines[m.getId()]={source:y,position:C}}}}},{key:"setSparklineActionsToChangeset",value:function(e){for(var t=this._sheet,n=(0,$e.Z)(e.doActions,2),r=n[0],o=n[1],i=[],a=[],s=0,l=Object.entries(o.value);s<l.length;s++){var u=(0,$e.Z)(l[s],2),c=u[0],d=u[1];d.sparklines&&t.getSparklinesByGroupId(c).length===Object.keys(d.sparklines).length&&(delete o.value[c],a.push(c))}Object.keys(r.value).length&&i.push(r),Object.keys(o.value).length&&i.push(o),a.length&&i.push({action:h.aOo.DELETE_SPARKLINE_GROUP,sheet_id:this._sheetId,value:a}),(0,h.hTd)(this._command._changesets,i);var f=(0,$e.Z)(e.undoActions,2),v=f[0],p=f[1];p.value=(0,qe.Z)(new Set(p.value));var g=[];p.value.length&&g.push(p);for(var m={action:h.aOo.ADD_SPARKLINE_GROUP,sheet_id:this._sheetId,value:{}},_=0,y=a;_<y.length;_++){var C=y[_],S=v.value[C];S&&(m.value[C]=S,m.value[C].config=t.getSparklineConfigByGroupId(C)||void 0,delete v.value[C])}a.length&&g.push(m),Object.keys(v.value).length&&g.push(v),(0,h.hTd)(this._command._oldChangesets,g)}},{key:"saveFloatImgsAction",value:function(e,t,n,r){var o=this,i=r.id();e.forEach((function(e){var a=(0,v.gNO)(e,t,n,r);o._command._changesets.push((0,v.B0I)(i,a)),o._command._oldChangesets.push((0,v.hLk)(a.floatImageId,i))}))}},{key:"commandName",get:function(){return h.rvF.CLIPBOARD_PASTE}}]),t}(v.T_g);function st(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return lt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return lt(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function lt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ut(e){return ct.apply(this,arguments)}function ct(){return(ct=(0,I.Z)(b().mark((function e(t){var n,r,o,i,a,s,l,u,c,h,d,f,p,g,m,_,y,C,S,k,E,T,I,R,w,A;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],r=new Map,o=t.length,i=0;case 4:if(!(i<o)){e.next=26;break}if(a=t[i]){e.next=8;break}return e.abrupt("continue",23);case 8:s=a.length,r.set(i,new Map),l=r.get(i),u=0;case 12:if(!(u<s)){e.next=23;break}if(c=a[u]){e.next=16;break}return e.abrupt("continue",20);case 16:if(h=c.value,Array.isArray(h)&&1===h.length){e.next=19;break}return e.abrupt("continue",20);case 19:"embed-image"===h[0].type&&(d=h[0],f=d.width,p=d.height,0===f&&0===p&&(g=h[0].link,l.set(u,g),n.push((0,v.AdU)(g))));case 20:++u,e.next=12;break;case 23:++i,e.next=4;break;case 26:return e.next=28,Promise.all(n);case 28:m=e.sent,_=new Map(m),y=st(r.keys());try{for(y.s();!(C=y.n()).done;){S=C.value,k=r.get(S),E=st(k.keys());try{for(E.s();!(T=E.n()).done;)I=T.value,R=t[S][I].value[0],w=k.get(I),A=_.get(w),R.width=A.width,R.height=A.height}catch(e){E.e(e)}finally{E.f()}}}catch(e){y.e(e)}finally{y.f()}case 32:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ht(e,t){for(var n={},r=[],o=[],i=e.length,a=function(i){var a=e[i];if(!a)return"continue";var s=a.length;n[i]={};for(var l=function(e){var s=a[e];if(!s||!Array.isArray(s.value)&&!Array.isArray(s.floatImages)&&!Array.isArray(s.proxyValue))return"continue";if(s.formulaData&&![h.Ve9.values,h.Ve9.formulas,h.Ve9.conditionFormat].includes(t))return"continue";var l=function(e,t,i){e.forEach((function(e){if([h.K6s.ATTACHMENT,h.K6s.EMBED_IMAGE].includes(null==e?void 0:e.type)){var a=e.fileToken;if(!a)return;n[t][i]=[].concat((0,qe.Z)(n[t][i]||[]),[a]),h.K6s.EMBED_IMAGE===e.type&&r.push(a),h.K6s.ATTACHMENT===e.type&&o.push(a)}}))};Array.isArray(s.value)&&l(s.value,i,e),Array.isArray(s.proxyValue)&&l(s.proxyValue,i,e),Array.isArray(s.floatImages)&&s.floatImages.forEach((function(t){var o=t.floatImageSetting.imageToken;o&&(n[i][e]=[].concat((0,qe.Z)(n[i][e]||[]),[o]),r.push(o))}))},u=0;u<s;++u)l(u)},s=0;s<i;++s)a(s);return{imageTokens:r,attachTokens:o,driveImageInNode:n}}var dt=n("vsh_99024"),ft=function(){function e(t){(0,i.Z)(this,e),this._host=document.body,this._initContainer(),this.instance.innerHTML=t}return(0,a.Z)(e,[{key:"destroy",value:function(){this._host.removeChild(this._iframe)}},{key:"_initContainer",value:function(){this._iframe=document.createElement("iframe"),this._iframe.setAttribute("sandbox","allow-same-origin"),this._iframe.style.position="fixed",this._iframe.style.display="none",this._iframe.style.top="99999px",this._iframe.style.left="99999px",this._host.appendChild(this._iframe);var e=document.createElement("meta"),t=this._iframe.contentWindow.document,n=t.getElementsByTagName("head")[0];e.setAttribute("http-equiv","Content-Security-Policy"),e.setAttribute("content","script-src 'none'; child-src 'none';"),n.appendChild(e);var r=t.createElement("style");r.innerHTML="table { font-size: inherit; }",n.appendChild(r),t.body.style.font="initial",t.body.style.fontSize=h.OSP}},{key:"instance",get:function(){return this._iframe.contentWindow.document.body}}]),e}(),vt=n("vsh_73043"),pt=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new j;return(0,i.Z)(this,t),(e=(0,s.Z)(this,(0,l.Z)(t).call(this))).name=_.VJ,e._customPasteMap={},e.getOptionIconArgs=ne,e.pasteHandler=function(){var t=(0,I.Z)(b().mark((function t(n){var r,o,i,a,s,l,u,c,d;return b().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.preventDefault(),n.stopPropagation(),t.prev=2,clearTimeout(e.removeToastTimer),(i=e.getActiveSheet())&&e.validateDataBeforePaste()&&!i.options.isProtected){t.next=7;break}return t.abrupt("return");case 7:if(null===(r=e._teaManager)||void 0===r||r.start(),n.clipboardData){t.next=12;break}return null===(a=e._teaManager)||void 0===a||a.error(),t.abrupt("return");case 12:return t.next=14,e.parseContentFromClipboard(n);case 14:if(s=t.sent,l=s.success,u=s.useCustomPlugin,c=s.parser,l&&!u){t.next=20;break}return t.abrupt("return");case 20:return e.updatePasteConfig({parser:c,pasteInternal:!!e.getCopyInfo()&&c.pasteInternal}),t.next=23,e.doPasteImp();case 23:return t.next=25,e.calcRenderDuration();case 25:null===(o=e._teaManager)||void 0===o||o.end(),t.next=31;break;case 28:t.prev=28,t.t0=t.catch(2),console.error(t.t0);case 31:return t.prev=31,null===(d=e.uiNotifierService)||void 0===d||d.DomToast.remove(h.iPD.PASTING),e.switchBackFocusCellAfterClipboard(),t.finish(31);case 35:case"end":return t.stop()}}),t,null,[[2,28,31,35]])})));return function(e){return t.apply(this,arguments)}}(),e.transferImages=function(){var t=(0,I.Z)(b().mark((function t(n){var r,o,i,a,s,l,u,d,f,v,p,g,m,_,y,C,S,k,E;return b().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n.suiteToken,s=n.isImageFromOtherSuiteType,l=null===(r=e._sdk)||void 0===r?void 0:r.spread._context.getToken(),u=e.getPasteConfig(),d=u.pastedPlaceType,f=u.sheet,v="Doc"===d,p=Boolean(null===(o=e._sdk)||void 0===o?void 0:o.getService(c.tb).resolve("isUseExcelMountPoint",!1)),g=!1,null===(i=e._teaManager)||void 0===i||i.startPerformance("request_duration"),t.prev=7,l&&a&&a===l){t.next=19;break}if(m=ht(n.data,e.getPasteConfig().pasteOption),_=m.imageTokens,y=m.attachTokens,C=m.driveImageInNode,![_.length,y.length].some(Boolean)){t.next=19;break}return v||(h.Ps3.freezeSheetToggle(!0),g=!0),t.next=14,h.Ps3.imageHelper.copyDriveImages(f,n.data,_,y,C,l,!v,p);case 14:if(S=t.sent){t.next=18;break}throw null===(k=e.store)||void 0===k||k.dispatchEvent("PasteStore/ToggleOptionalPasteIcon",{isShowIcon:!1}),Error("Fail to copyDriveImage");case 18:n.data=S;case 19:if(!s){t.next=23;break}return v||g||(h.Ps3.freezeSheetToggle(!0),g=!0),t.next=23,ut(n.data);case 23:t.next=28;break;case 25:throw t.prev=25,t.t0=t.catch(7),t.t0;case 28:return t.prev=28,g&&(h.Ps3.freezeSheetToggle(!1),g=!1),null===(E=e._teaManager)||void 0===E||E.endPerformance("request_duration"),t.finish(28);case 32:case"end":return t.stop()}}),t,null,[[7,25,28,32]])})));return function(e){return t.apply(this,arguments)}}(),e.transferMentions=function(){var t=(0,I.Z)(b().mark((function t(n){var r,o,i,a,s,l,u,c,d,f,v,p,g,m;return b().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=n.suiteToken,i=null===(r=e._sdk)||void 0===r?void 0:r.spread._context.getToken(),a=e.getPasteConfig(),s=a.pastedPlaceType,l="Doc"===s,u=!1,t.prev=5,i&&o&&o===i){t.next=15;break}if(d=(0,dt.mx)(n.data),null===(c=d.userIds)||void 0===c||!c.length){t.next=15;break}return l||(h.Ps3.freezeSheetToggle(!0),u=!0),t.next=12,null===(f=e._sdk)||void 0===f||null===(v=f.spread.getUserPermissionManager())||void 0===v?void 0:v.fetchUsers(d.userIds);case 12:g=t.sent,(m=null==g||null===(p=g.payload)||void 0===p?void 0:p.entities)&&(0,dt.sJ)(n.data,m,d.userMentionInNode);case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(5),console.error("transfer user mention error: ",t.t0);case 20:return t.prev=20,u&&(h.Ps3.freezeSheetToggle(!1),u=!1),t.finish(20);case 23:case"end":return t.stop()}}),t,null,[[5,17,20,23]])})));return function(e){return t.apply(this,arguments)}}(),e._teaManager=n,e}var n,r,o,d,p,g,y,C,S,k,E,T,R;return(0,u.Z)(t,e),(0,a.Z)(t,[{key:"addCustomPaste",value:function(e,t){this._customPasteMap[e]=t}},{key:"removeCustomPaste",value:function(e){delete this._customPasteMap[e]}},{key:"init",value:function(e){this._sdk=e;var t=e.pluginStore;e.spread.commandManager().register(h.rvF.CLIPBOARD_PASTE,{canUndo:!0,execute:function(e,t,n,r){return(0,v.P0c)(e,at,t,n,r)}}),null==t||t.registerModule(m),this.registerDomEvent("paste",this.pasteHandler)}},{key:"destroy",value:function(){this.commonDestroy(),this._teaManager=null,this._customPasteMap={},this.pasteFinished(),this.unregisterDomEvent("paste",this.pasteHandler),clearTimeout(this.removeToastTimer)}},{key:"doClipboardPaste",value:function(){var e,t,n=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h.Ve9.all,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_.Sb.SHORTKEY,i=this.getActiveSheet();i&&(this.setPasteConfig({selections:(0,v.y02)(i.getSelections()),sheet:i,pastedPlaceType:"Sheet",pasteOption:r,entryActionType:o,pasteInternal:!1,isCutting:this.getIsCutting(),isCuttingDone:this.getIsCuttingDone()}),this.focusForClipboard(),null===(e=this.uiNotifierService)||void 0===e||e.DomToast.remove(h.iPD.PASTING),null===(t=this.uiNotifierService)||void 0===t||t.DomToast.remove(h.iPD.FLOAT_IMAGE_PASTING),this.showPasteToast(),clearTimeout(this.removeToastTimer),this.removeToastTimer=setTimeout((function(){var e;null===(e=n.uiNotifierService)||void 0===e||e.DomToast.remove(h.iPD.PASTING)}),50),(f().isLark&&f().isIPad||f().isMobile)&&window.lark.biz.navigation.handlePasteMenuClick())}},{key:"doCustomPaste",value:(R=(0,I.Z)(b().mark((function e(t,n,r){var o,i,a,s,l,u,c,d;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.getActiveSheet()){e.next=3;break}return e.abrupt("return");case 3:if(this.setPasteConfig({selections:(0,v.y02)(i.getSelections()),sheet:i,pasteOption:t,pastedPlaceType:"Sheet",pasteInternal:!(t===h.Ve9.values&&null!==(o=this.getCopyInfo())&&void 0!==o&&o.dataInfo.hasImageFormula),entryActionType:n,isCutting:this.getIsCutting(),isCuttingDone:this.getIsCuttingDone()}),!r){e.next=7;break}return this.doMenuInsidePaste(),e.abrupt("return");case 7:return a=!0,s=!1,l=!0,e.prev=10,e.next=13,this.getCustomPasteEvent();case 13:if(!(u=e.sent)){e.next=17;break}return this.dispatchClipboardEvent(u),e.abrupt("return");case 17:l=!1,e.next=23;break;case 20:e.prev=20,e.t0=e.catch(10),"NotAllowedError"===e.t0.name?a=!1:s=!0;case 23:if(!this.triggerPasteUsingPasteExtension()){e.next=25;break}return e.abrupt("return");case 25:if(c=!l||!a||s,d=!!this.getCopyInfo(),!c||d){e.next=30;break}return this.showClipboardPermissionModal({notSupportContent:s,supportNavigatorClipboard:l}),e.abrupt("return");case 30:this.doMenuInsidePaste();case 31:case"end":return e.stop()}}),e,this,[[10,20]])}))),function(e,t,n){return R.apply(this,arguments)})},{key:"doContentPaste",value:(T=(0,I.Z)(b().mark((function e(t,n){var r,o,i,a,s,l,u;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.setPasteConfig({selections:(0,v.y02)(n.sheet.getSelections()),sheet:n.sheet,pasteOption:h.Ve9.all,pastedPlaceType:n.pastedPlace,pasteInternal:!1,entryActionType:n.entryType||_.Sb.SHORTKEY,isPasteComment:n.isPasteComment,isCutting:this.getIsCutting(),isCuttingDone:!1}),null===(r=this._teaManager)||void 0===r||r.start(),i={getData:function(){var e=(0,I.Z)(b().mark((function e(n){return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t[n]);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),isHtmlSafe:n.isHtmlSafe},e.next=6,this.parseContentAsync(i);case 6:if(a=e.sent,s=a.success,l=a.parser,s){e.next=11;break}return e.abrupt("return");case 11:return this.updatePasteConfig({parser:l,pasteInternal:!!this.getCopyInfo()&&l.pasteInternal}),null!=l&&l.tableData.gridLineHidden&&n.sheet.gridLineHidden.setGridLine(l.tableData.gridLineHidden),e.next=15,this.doPasteImp();case 15:return u=e.sent,null===(o=this._teaManager)||void 0===o||o.end(),e.abrupt("return",u);case 20:return e.prev=20,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",void 0);case 24:case"end":return e.stop()}}),e,this,[[0,20]])}))),function(e,t){return T.apply(this,arguments)})},{key:"optionalPasteAfterPasted",value:function(){var e,t,n,r=this,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h.Ve9.all;if(this._pasteConfig){var i,a=this.getPasteConfig(),s=a.sheet,l=a.parser,u=this._cachedInfo,c=null===(e=this._sdk)||void 0===e?void 0:e.spread._undoManager.getUndoStackTop();if("convertLink"===(null==c?void 0:c.cmd))null===(i=this._sdk)||void 0===i||i.spread._undoManager.undo();null===(t=this._sdk)||void 0===t||t.spread._undoManager.undo();var d=function(e){var t,n=Object.assign({cmd:h.rvF.CLIPBOARD_PASTE},e,{sheetId:s.id()});n.pasteOption=o,null===(t=r._sdk)||void 0===t||t.spread.commandManager().execute(n),r.emitPasteEvent(e)},f=function(){return r.updatePasteConfig({entryActionType:_.Sb.FLOATING_BUTTON,pasteOption:o}),r.doPasteImp()},v=null==l||null===(n=l.tableData)||void 0===n?void 0:n.hasImageFormula,p=(null==u?void 0:u.pasteOption)===h.Ve9.transpose,g=o===h.Ve9.transpose;u&&!v&&(g&&p||!g&&!p)?d(u):f()}}},{key:"showClipboardPermissionModal",value:function(e){var t,n;null===(t=this.store)||void 0===t||t.dispatchEvent("PasteStore/ShowClipboardPermissionModal",e),null===(n=this._teaManager)||void 0===n||n.collectInfoIndicators({showClipboardPermissionModal:!0})}},{key:"triggerPasteUsingPasteExtension",value:function(){if(f().isChrome&&!f().isLark){var e,t=X();if(console.log("[Sheet Plugin]: extension 存在结果: ",t),t){var n,r=this.getPasteConfig(),o=r.pasteOption,i=r.entryActionType;this.doClipboardPaste(o,i),(e=X())&&e.click(),null===(n=this._teaManager)||void 0===n||n.collectInfoIndicators({usingPasteHelper:!0})}return t}}},{key:"doMenuInsidePaste",value:(E=(0,I.Z)(b().mark((function e(){var t,n,r,o,i,a;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.getActiveSheet()&&this.validateDataBeforePaste()){e.next=3;break}return e.abrupt("return");case 3:if(null===(t=this._teaManager)||void 0===t||t.start(),e.prev=4,r=this.getPasteConfig(),o=r.pasteOption,i=r.isCutting,!(this.cannotPasteInPage||o!==h.Ve9.all&&i)){e.next=9;break}return null===(a=this._teaManager)||void 0===a||a.error(),e.abrupt("return");case 9:return e.next=11,this.doPasteImp();case 11:return e.next=13,this.calcRenderDuration();case 13:null===(n=this._teaManager)||void 0===n||n.end(),e.next=20;break;case 16:throw e.prev=16,e.t0=e.catch(4),console.info(e.t0),e.t0;case 20:case"end":return e.stop()}}),e,this,[[4,16]])}))),function(){return E.apply(this,arguments)})},{key:"pasteFinished",value:function(){var e;"Doc"!==(null===(e=this._pasteConfig)||void 0===e?void 0:e.pastedPlaceType)&&(this._copyInfo=void 0,this._cachedInfo=void 0,this._pasteConfig=void 0)}},{key:"validateDataBeforePaste",value:function(){var e,t=null===(e=this._sdk)||void 0===e?void 0:e.spread.hookManager(),n=this.getIsCutting(),r=this.getCopyInfo();if(!r)return!0;var o=r.sheet,i=r.logicRanges;return!(t&&!t.executeBeforeHooks(h.rvF.CLIPBOARD_PASTE,{fromSheet:o,isCutting:n,fromRanges:i}))}},{key:"setPasteConfig",value:function(e){this._pasteConfig=e}},{key:"updatePasteConfig",value:function(e){this._pasteConfig=Object.assign({},this._pasteConfig,{},e)}},{key:"getPasteConfig",value:function(){return this._pasteConfig}},{key:"emitPasteEvent",value:function(e){var t,n;if(e){null===(t=this.store)||void 0===t||t.dispatchEvent("PasteStore/Pasted",e);var r=ne(null===(n=this._sdk)||void 0===n?void 0:n.spread,e);this.toggleOptionalPasteIcon(r)}}},{key:"toggleOptionalPasteIcon",value:function(e){var t;e?null===(t=this.store)||void 0===t||t.dispatchEvent("PasteStore/ToggleOptionalPasteIcon",e):this.pasteFinished()}},{key:"clipboardContentGetterAsync",value:function(e){var t,n;return{getData:(n=(0,I.Z)(b().mark((function n(r){var o,i;return b().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t){n.next=10;break}return(o=new Array).push(h.Ps3.SheetClipboardDataType.HTML),o.push(h.Ps3.SheetClipboardDataType.TEXT),o.push(h.Ps3.SheetClipboardDataType.TEXT_URI_LIST),n.next=7,h.Ps3.clipboardManager.getData(e,o);case 7:i=n.sent,t={},i.success&&i.data&&(t={text:i.data[h.Ps3.SheetClipboardDataType.TEXT]||i.data[h.Ps3.SheetClipboardDataType.TEXT_URI_LIST]||"",html:i.data[h.Ps3.SheetClipboardDataType.HTML]||""});case 10:return n.abrupt("return",t[r]);case 11:case"end":return n.stop()}}),n)}))),function(e){return n.apply(this,arguments)})}}},{key:"getCustomPasteEvent",value:(k=(0,I.Z)(b().mark((function e(){var t,n,r,o;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(window&&navigator&&navigator.clipboard)){e.next=10;break}return t=new DataTransfer,n=["text/html","text/plain"],e.next=5,navigator.clipboard.read();case 5:return r=e.sent,e.next=8,Promise.all(r.map(function(){var e=(0,I.Z)(b().mark((function e(r){return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(r.types.map(function(){var e=(0,I.Z)(b().mark((function e(o){var i,a,s,l;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.getType(o);case 2:if(i=e.sent,!o.includes("image")){e.next=9;break}a=o.replace("/","."),s=new File([i],a,{type:o}),t.items.add(s),e.next=14;break;case 9:if(!n.includes(o)){e.next=14;break}return e.next=12,i.text();case 12:l=e.sent,t.items.add(l,o);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 8:return o=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:t}),e.abrupt("return",o);case 10:return e.abrupt("return",null);case 11:case"end":return e.stop()}}),e)}))),function(){return k.apply(this,arguments)})},{key:"useCustomPlugin",value:(S=(0,I.Z)(b().mark((function e(t,n,r){var o,i;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n||!n.pasteInternal){e.next=2;break}return e.abrupt("return",!1);case 2:return o=Object.values(this._customPasteMap).map(function(){var e=(0,I.Z)(b().mark((function e(o){return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!o.isCustomPlugin(t,{tableData:null==n?void 0:n.tableData,html:(null==r?void 0:r.html)||""})){e.next=5;break}return e.next=4,o.handlePaste(t);case 4:return e.abrupt("return",!0);case 5:return e.abrupt("return",!1);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=5,Promise.all(o);case 5:return i=e.sent,e.abrupt("return",i.some((function(e){return e})));case 7:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return S.apply(this,arguments)})},{key:"showPasteToast",value:function(){var e;null===(e=this.uiNotifierService)||void 0===e||e.DomToast.show({key:h.iPD.PASTING,type:"loading",content:vt("sheet.pasting"),duration:0})}},{key:"calcRenderDuration",value:(C=(0,I.Z)(b().mark((function e(){var t=this;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){var n;null===(n=t._teaManager)||void 0===n||n.startPerformance("render_duration"),setTimeout((function(){var n;null===(n=t._teaManager)||void 0===n||n.endPerformance("render_duration"),e(null)}),0)}));case 2:case"end":return e.stop()}}),e)}))),function(){return C.apply(this,arguments)})},{key:"getHTMLParser",value:function(e,t){return new Ge({contentSource:e,randomString:t},new ft(e))}},{key:"getParserFromContentGetterAsync",value:(y=(0,I.Z)(b().mark((function e(t){var n,r,o,i,a,s,l,u,c,h,d,f,v;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.getCopyId()||"",null===(n=this._teaManager)||void 0===n||n.startPerformance("get_data_duration"),e.next=4,t.getData("html");case 4:if(s=e.sent,null===(r=this._teaManager)||void 0===r||r.calcPerformance("get_data_duration"),!s){e.next=13;break}if(null===(l=this._teaManager)||void 0===l||l.startPerformance("parse_duration"),(c=this.getHTMLParser(s,a)).parse(),null===(u=this._teaManager)||void 0===u||u.calcPerformance("parse_duration"),!c.isSuccess){e.next=13;break}return e.abrupt("return",{parser:c,success:!0,html:s});case 13:return null===(o=this._teaManager)||void 0===o||o.startPerformance("get_data_duration"),e.next=16,t.getData("text");case 16:if(h=e.sent,null===(i=this._teaManager)||void 0===i||i.endPerformance("get_data_duration"),"string"!=typeof h){e.next=25;break}if(v=new Ye({contentSource:h}),null===(d=this._teaManager)||void 0===d||d.startPerformance("parse_duration"),v.parse(),null===(f=this._teaManager)||void 0===f||f.calcPerformance("parse_duration"),!v.isSuccess){e.next=25;break}return e.abrupt("return",{parser:v,success:!0});case 25:return e.abrupt("return",{parser:void 0,success:!1});case 26:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"getPasteInfo",value:(g=(0,I.Z)(b().mark((function e(){var t,n;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getPasteInfoCore();case 2:if(null==(t=e.sent)||!t.rework){e.next=8;break}return e.next=6,this.getPasteInfoCore(!0);case 6:return n=e.sent,e.abrupt("return",n);case 8:return e.abrupt("return",t);case 9:case"end":return e.stop()}}),e,this)}))),function(){return g.apply(this,arguments)})},{key:"parseContentFromClipboard",value:(p=(0,I.Z)(b().mark((function e(t){var n,r,o,i,a,s,l,u,c,h,d,v,p,g,m,y,C,S,k,E,T,I,R;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.clipboardData,r=this.getCopyId()||"",!this.getCopyInfo()){e.next=14;break}if(null===(o=this._teaManager)||void 0===o||o.startPerformance("get_data_duration"),!(i=n.getData("text/sheet"))){e.next=14;break}if(null===(a=this._teaManager)||void 0===a||a.calcPerformance("get_data_duration"),u=new _e({contentSource:i,randomString:r}),null===(s=this._teaManager)||void 0===s||s.startPerformance("parse_duration"),u.parse(),null===(l=this._teaManager)||void 0===l||l.calcPerformance("parse_duration"),!u.pasteInternal){e.next=14;break}return e.abrupt("return",{parser:u,success:!0});case 14:if(c=!1,f().isMobile||f().isIPad&&f().isLark){e.next=39;break}if(null===(h=this._teaManager)||void 0===h||h.startPerformance("get_data_duration"),v=n.getData("text/html"),p=n.getData("text/plain"),null===(d=this._teaManager)||void 0===d||d.calcPerformance("get_data_duration"),v.includes(_.rQ)){e.next=38;break}return null===(g=this._teaManager)||void 0===g||g.startPerformance("parse_duration"),(S=this.getHTMLParser(v,r)).parse(),null===(m=this._teaManager)||void 0===m||m.calcPerformance("parse_duration"),e.next=27,this.useCustomPlugin(t,S,{html:v});case 27:if(k=e.sent,!S.isSuccess&&!k){e.next=30;break}return e.abrupt("return",{parser:S,success:!0,useCustomPlugin:k});case 30:if(E=new Ye({contentSource:p}),null===(y=this._teaManager)||void 0===y||y.startPerformance("parse_duration"),E.parse(),null===(C=this._teaManager)||void 0===C||C.calcPerformance("parse_duration"),!E.isSuccess){e.next=36;break}return e.abrupt("return",{parser:E,success:!0});case 36:e.next=39;break;case 38:c=!0;case 39:return(T=this.clipboardContentGetterAsync(n)).isHtmlSafe=c,e.next=43,this.parseContentAsync(T);case 43:return I=e.sent,e.next=46,this.useCustomPlugin(t,I.parser,{html:I.html||""});case 46:return R=e.sent,e.abrupt("return",Object.assign({},I,{useCustomPlugin:R}));case 48:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"parseContentAsync",value:(d=(0,I.Z)(b().mark((function e(t){var n;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getParserFromContentGetterAsync(t);case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"collectTeaInfoIndicators",value:function(){var e,t=this.getPasteConfig(),n=t.sheet,r=t.pasteOption,o=t.isCutting,i=t.parser,a=t.pasteInternal,s=t.entryActionType,l=(null==i?void 0:i.getPasteSource())||(this._sdk.spread._context.isEmbed()?h.Lu8.EMBED_SHEET:h.Lu8.ALONE_SHEET),u="html"===(null==i?void 0:i.sourceType)&&i.isFromByteSheet?"json":null==i?void 0:i.sourceType;null===(e=this._teaManager)||void 0===e||e.collectInfoIndicators({paste_tea_source:s,is_internal:a,isCutting:o,paste_option:r,sheet_id:n.id(),source:u,paste_source:l})}},{key:"doPasteImp",value:(o=(0,I.Z)(b().mark((function e(){var t,n,r,o,i,a,s,l,u,c,d,f,v,p,g,m,_,y,C,S,k,E,T,I;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=this.getCopyInfo(),i=this.getPasteConfig(),null!=o&&o.dataInfo.hasImageFormula&&i.pasteOption===h.Ve9.values&&this.updatePasteConfig({pasteInternal:!1}),this.collectTeaInfoIndicators(),o&&(this._copyInfo=Object.assign({},o)),a=this.getPasteConfig(),s=a.sheet,l=a.pasteOption,u=a.isCuttingDone,c=a.isCutting,d=a.parser,f=a.pastedPlaceType,v=a.selections,!u){e.next=12;break}if(null==d||!d.pasteInternal){e.next=9;break}return e.abrupt("return");case 9:this.setIsCuttingDone(!1),e.next=14;break;case 12:if(l===h.Ve9.all||!c||null==d||!d.pasteInternal){e.next=14;break}return e.abrupt("return");case 14:return null===(t=this._teaManager)||void 0===t||t.startPerformance("parse_duration"),e.next=17,this.getPasteInfo();case 17:if(p=e.sent){e.next=21;break}return null===(g=this._teaManager)||void 0===g||g.error(),e.abrupt("return");case 21:if("html"!==(null==d?void 0:d.sourceType)||null!=d&&d.pasteInternal){e.next=26;break}return e.next=24,this.transferImages(d.tableData);case 24:return e.next=26,this.transferMentions(d.tableData);case 26:if(!(l===h.Ve9.transpose&&p.fromRanges&&p.fromRanges.length>1)){e.next=30;break}return s._raiseInvalidOperation(h.TiA.copyPaste,vt("CreationDoc_Sheets_Transpose_CannotTranspose")),null===(m=this._teaManager)||void 0===m||m.error(),e.abrupt("return");case 30:null===(n=this._teaManager)||void 0===n||n.calcPerformance("parse_duration"),!("Doc"===f)&&c&&(this.setIsCutting(!1),this.setIsCuttingDone(!0)),_=s._getSpanModel().length,y=s.getRowCount(),C=s.getColumnCount(),e.prev=36,null===(S=this._teaManager)||void 0===S||S.startPerformance("command_execute_duration"),T=te(p),null===(k=this._sdk)||void 0===k||k.spread.commandManager().execute(Object.assign({cmd:h.rvF.CLIPBOARD_PASTE},T,{sheetId:s.id()})),null===(E=this._teaManager)||void 0===E||E.endPerformance("command_execute_duration"),e.next=46;break;case 43:throw e.prev=43,e.t0=e.catch(36),e.t0;case 46:return I=s._getSpanModel(),null===(r=this._teaManager)||void 0===r||r.collectDataIndicators({sheetRowCount:y,sheetColCount:C,data_length:(null==d?void 0:d.contentSource.length)||0,spansSizeBefore:_,spansSizeAfter:I.length,selections:JSON.stringify(null==v?void 0:v.slice(0,10).map((function(e){return e.toJSON()})))}),this._cachedInfo=p,this.emitPasteEvent(p),e.abrupt("return",p);case 51:case"end":return e.stop()}}),e,this,[[36,43]])}))),function(){return o.apply(this,arguments)})},{key:"getPasteInfoCore",value:(r=(0,I.Z)(b().mark((function e(){var t,n,r,o,i,a,s,l,u,c,h,d,f,p,g,m,_,y,C,S,k,E,T,I,R,w,A,F=arguments;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=F.length>0&&void 0!==F[0]&&F[0],r=this.getPasteConfig(),o=r.pasteOption,i=r.sheet,a=r.parser,s=r.pasteInternal,l=r.isCutting,u=r.selections,c=r.isPasteComment,h=this._copyInfo,d=null,f=null,g=!1,s&&h&&(d=h.sheet,f=h.logicRanges,p=h.dataInfo,g=h.copyFullColumn),m=null,!s&&a&&(m=a.tableData,g=!(null===(_=m)||void 0===_||!_.copyFullColumn)),y={tableData:m,fromSheet:d,fromRanges:f,isCutting:l&&s,rowCountToDelete:0,colCountToDelete:0,pasteOption:o,pastedRangeInfoArr:[],insideInfo:p,isPasteComment:c,formulaValueMap:new v.GfN,isFromText:"text"===(null==a?void 0:a.sourceType),keepColumnWidth:g},C=re(i,u,y,!l)){e.next=14;break}return null===(S=this._teaManager)||void 0===S||S.error(),e.abrupt("return");case 14:if(0!==C.length){e.next=16;break}return e.abrupt("return");case 16:return y.pastedRangeInfoArr=C,k=le(C),E=k.pastedRowTo,T=k.pastedColTo,e.next=20,this.handleCellLimitExceed(E,T,n);case 20:if(I=e.sent,R=I.rowCountToDelete,w=I.colCountToDelete,A=I.shouldDelEmptyRowAndCol,y.rowCountToDelete=R,y.colCountToDelete=w,"boolean"!=typeof A){e.next=33;break}if(!A){e.next=32;break}return y.rework=!0,e.abrupt("return",y);case 32:return e.abrupt("return");case 33:return W(y,(null==h||null===(t=h.dataInfo)||void 0===t?void 0:t.teaDataInfo)||null,this._teaManager),e.abrupt("return",y);case 35:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"handleCellLimitExceed",value:(n=(0,I.Z)(b().mark((function e(t,n){var r,o,i,a,s,l,u,c,d,f,v,p,g,m,_,y,C,S,k,E,T,I,R=arguments;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=R.length>2&&void 0!==R[2]&&R[2],a={rowCountToDelete:0,colCountToDelete:0,shouldDelEmptyRowAndCol:void 0},s=this.getPasteConfig(),l=s.sheet,u=s.pasteInternal,Q(l,t,n,(0,h.$$w)())){e.next=5;break}return e.abrupt("return",a);case 5:if(c=null===(r=this._copyInfo)||void 0===r?void 0:r.copyRange,i||null===(d=this._teaManager)||void 0===d||d.startPerformance("calc_empty_cells_to_del_duration"),f=u&&c?Math.max(t+1,c.rowTo()+1):t+1,v=u&&c?Math.max(n+1,c.colTo()+1):n+1,p=ee(l,t,n,f,v,(0,h.$$w)()),g=p.rowCountToDelete,m=p.colCountToDelete,a.rowCountToDelete=g,a.colCountToDelete=m,null===(o=this._teaManager)||void 0===o||o.endPerformance("calc_empty_cells_to_del_duration"),-1!==g||-1!==m){e.next=16;break}return l._raiseInvalidOperation(6,vt("sheet.cell_limit_exceed")),e.abrupt("return",a);case 16:if(i||!(g>0||m>0)){e.next=44;break}return null===(_=this._teaManager)||void 0===_||_.startPerformance("auto_clear_tip_duration"),C=null===(y=this._sdk)||void 0===y?void 0:y.spread.keyboardEventSuspendHelper,e.prev=19,h.Ps3.freezeSheetToggle(!0),C&&C.suspendEvent(),null===(S=this.uiNotifierService)||void 0===S||S.DomToast.remove(h.iPD.PASTING),E=Object.assign({},this.getPasteConfig()),e.next=26,h.Ps3.modalHelper.askUserShouldDelEmptyCellsAndContinuePaste(g>0?"row":"col");case 26:if(T=e.sent,this.setPasteConfig(E),null===(k=this._teaManager)||void 0===k||k.collectInfoIndicators({exceedCellTipsStage:T?Z.CONFIRM:Z.CANCEL}),!T){e.next=33;break}return this.showPasteToast(),e.next=33,new Promise((function(e){setTimeout((function(){e(null)}))}));case 33:a.shouldDelEmptyRowAndCol=T,e.next=39;break;case 36:throw e.prev=36,e.t0=e.catch(19),e.t0;case 39:return e.prev=39,C&&C.resumeEvent(),h.Ps3.freezeSheetToggle(!1),null===(I=this._teaManager)||void 0===I||I.endPerformance("auto_clear_tip_duration"),e.finish(39);case 44:return e.abrupt("return",a);case 45:case"end":return e.stop()}}),e,this,[[19,36,39,44]])}))),function(e,t){return n.apply(this,arguments)})},{key:"uiNotifierService",get:function(){var e;return null===(e=this._sdk)||void 0===e?void 0:e.getService(Je.OG)}},{key:"cannotPasteInPage",get:function(){return!this.getCopyInfo()||this.getIsCuttingDone()}}]),t}(y)},vsh_87882:function(e,t,n){n.d(t,{T:function(){return h},C:function(){return d}});var r=n("vsh_19264"),o=n("vsh_4175"),i=n("vsh_65498"),a=n("vsh_4561"),s=n("vsh_21955"),l=n("vsh_82905"),u=n("vsh_36290"),c=function(e,t,n,r){var o,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":(0,i.Z)(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(s=(a<3?o(s):a>3?o(t,n,s):o(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s},h="ErrorNoticePlugin",d=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.default;(0,r.Z)(this,e),this.noticeHandlerMap=t,this.onErrorReceived=n,this.name=h}return(0,o.Z)(e,[{key:"init",value:function(e){this.sdk=e}},{key:"destroy",value:function(){this.onErrorReceived=a.default,this.noticeHandlerMap={}}},{key:"noticeError",value:function(e){this.onErrorReceived(e);var t=this.noticeHandlerMap[e.code]||this.noticeHandlerMap.defaultHandler;t&&t(e,this.sdk.getService(u.OG),this.sdk.getService(l.Jv))}},{key:"addNoticeHandler",value:function(e){Object.assign(this.noticeHandlerMap,e)}}]),e}();d=c([(0,s.Mn)({required:[u.OG,l.Jv]})],d)},vsh_98986:function(e,t,n){n.d(t,{$L:function(){return r},wP:function(){return o},WW:function(){return i}});var r="FocusPlugin",o="do-not-blur-on-sheet-when-clicked",i=["block-editbar","common-color-picker__more","gpf-biz-anonymous-login-share-in-wx-dialog","share-in-wx-dialog","ai-nature-editor-popover-content"]},vsh_8892:function(e,t,n){n.d(t,{$L:function(){return c.$L},FK:function(){return d},wP:function(){return c.wP},fW:function(){return h}});var r=n("vsh_74561"),o=n("vsh_19264"),i=n("vsh_4175"),a=n("vsh_24627"),s=n("vsh_72834"),l={namespace:"FocusStore",state:{focusedSheetId:null,needClearSelection:!0,hostMap:{}},commit:{setFocusedSheet:function(e,t){var n=t.needClearSelection,r=void 0===n||n,o=t.sheetId;e.focusedSheetId=o,e.needClearSelection=r},setSheetHost:function(e,t){var n=t.host,r=t.sheetId;e.hostMap[r]=n},clearHosts:function(e){e.hostMap={}}}},u=n("vsh_98652"),c=n("vsh_98986");function h(e){if(!(e instanceof Element))return!1;for(var t=e;t&&"BODY"!==t.tagName;){if(t.dataset.sheetElement||[c.wP].concat((0,u.Z)(c.WW)).some((function(e){return t.classList.contains(e)})))return!0;t=t.parentElement}return!1}var d=function(){function e(){var t=this;(0,o.Z)(this,e),this.name=c.$L,this.subscriber=null,this.suspended=!1,this.setFocus=function(){var e,n,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null===(e=t.sdk.spread)||void 0===e?void 0:e.getActiveSheet().id();if(!t.sdk.isSuspended()&&!t.isSuspended()){var o=r&&t.sdk.spread.getSheetFromId(r);if(o)if(o.blockType)t.resetFocus();else if(t.getHost(r)){var i=null===(n=t.store.getState("FocusStore"))||void 0===n?void 0:n.focusedSheetId;i!==r&&t.store.commit("FocusStore/setFocusedSheet",{sheetId:r})}}},this.resetFocus=function(e){t.sdk.isSuspended()||t.isSuspended()||t.store.commit("FocusStore/setFocusedSheet",{sheetId:null,needClearSelection:e})},this.getHost=function(e){var n;return(null===(n=t.store.getState("FocusStore"))||void 0===n?void 0:n.hostMap[e])||null},this.processDocumentMouseDown=function(e){var n;t.sdk.isSuspended()||(null===(n=t.store.getState("FocusStore"))||void 0===n?void 0:n.focusedSheetId)&&(h(e.target)||t.resetFocus())},this.handleActiveSheetChanged=function(e){var n=e.newSheet;t.isNeedFocus(n)&&t.setFocus(n.id())},this.handleSetSelection=function(e,n){var r=n.sheet;return t.setFocus(r.id()),!0}}return(0,i.Z)(e,[{key:"init",value:function(e){this.sdk=e,this.store=e.pluginStore,this.store.registerModule(l),this.bindEvents(),this.sdk.spread.apiHookManager.setHook(s.vms.setSelection,this.handleSetSelection)}},{key:"onSheetMount",value:function(e,t,n){var r;!n&&null!==(r=this.store.getState("FocusStore"))&&void 0!==r&&r.hostMap[e.id()]||this.store.commit("FocusStore/setSheetHost",{sheetId:e.id(),host:n||t.container()})}},{key:"bindEvents",value:function(){this.subscriber=this.sdk.spread.subscribe(this.getDepends()),a.Ps3.browser.isIPad||a.Ps3.browser.ios?(document.addEventListener("touchstart",this.processDocumentMouseDown),document.addEventListener("mousedown",this.processDocumentMouseDown)):(document.addEventListener("pointerdown",this.processDocumentMouseDown),document.addEventListener("mousedown",this.processDocumentMouseDown))}},{key:"getDepends",value:function(){return(0,r.Z)({},a.HaZ.ActiveSheetChanged,this.handleActiveSheetChanged)}},{key:"suspend",value:function(){this.suspended=!0}},{key:"resume",value:function(){this.suspended=!1}},{key:"isSuspended",value:function(){return this.suspended}},{key:"destroy",value:function(){var e;this.resetFocus(!1),this.store.commit("FocusStore/clearHosts"),null===(e=this.subscriber)||void 0===e||e.unsubscribe(),a.Ps3.browser.isIPad||a.Ps3.browser.ios?(document.removeEventListener("touchstart",this.processDocumentMouseDown),document.removeEventListener("mousedown",this.processDocumentMouseDown)):(document.removeEventListener("pointerdown",this.processDocumentMouseDown),document.removeEventListener("mousedown",this.processDocumentMouseDown)),this.subscriber=null,this.sdk.spread.apiHookManager.removeHook(s.vms.setSelection,this.handleSetSelection)}},{key:"setHost",value:function(e,t){t&&(t.dataset.sheetElement="sheetHost"),this.store.commit("FocusStore/setSheetHost",{sheetId:e,host:t})}},{key:"isNeedFocus",value:function(e){var t,n=this.sdk.getPlugin("CellEditorPlugin");return(null==n||!n.isEditing(e))&&(null===(t=this.store.getState("FocusStore"))||void 0===t?void 0:t.focusedSheetId)!==e.id()}}]),e}()},vsh_70938:function(e,t,n){n.r(t),n.d(t,{FormulaBar:function(){return S},FormulaBarPlugin:function(){return _},FormulaBarStatus:function(){return d.R},FormulaBarStore:function(){return d.k}});var r=n("vsh_19264"),o=n("vsh_12064"),i=n("vsh_22462"),a=n("vsh_73455"),s=n("vsh_74561"),l=n("vsh_4175"),u=n("vsh_65498"),c=n("vsh_24627"),h=n("vsh_9812"),d=n("vsh_90036"),f=n("vsh_88177"),v=n("vsh_11725"),p=function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":(0,u.Z)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};var g,m={lineHeight:1.3,paddingLeft:3,paddingTop:2.5,paddingBottom:2.5,paddingRight:3,fontSize:13.3,fontColor:"--text-title",minWidth:window.screen.width,textAlign:"left"},_="FormulaBarPlugin",y=function(){function e(t){var n=this;(0,r.Z)(this,e),this.options=t,this.name=_,this.container=null,this.editorErrorTimes=0,this.handleEditorStatusChange=function(e){switch(e){case f.I9.EDIT:n.onStartEdit();break;case f.I9.IDLE:n.onEndEdit()}},this.onStartEdit=function(){n.sdk.pluginStore.commit("FormulaBarPlugin/updateStatus",d.R.Edit,_)},this.onEndEdit=function(){var e,t,r;null!==(e=n.formulaLanguageServicePlugin)&&void 0!==e&&e.isAcrossSheet||(null===(t=n.editor)||void 0===t||null===(r=t.editorCommand)||void 0===r||r.reset(),n.sdk.pluginStore.commit("FormulaBarPlugin/updateStatus",d.R.Idle,_))},this.onEditorContentChangedFromOtherEditor=function(e){var t,r,o,i;n.isActiveEditor||(null===(t=n.getEditor())||void 0===t||null===(r=t.editorCommand)||void 0===r||r.applyContentState(e.deltaSet,e.options),null===(o=n.getEditor())||void 0===o||null===(i=o.editorCommand)||void 0===i||i.clearAllStack())},this.onEditorKeydown=function(e){var t;null===(t=n.formulaLanguageServicePlugin)||void 0===t||t.handleKeydown(e),e.keyCode===c.VDZ.Ime&&e.stopPropagation()},this.handleEditorContentChanged=function(e){var t;n.isActiveEditor&&(null===(t=n.sdk.getPlugin("CellEditorPlugin"))||void 0===t||t.onEditorContentChangedFromOtherEditor(e),n.sdk.pluginStore.commit("FormulaLanguageServicePlugin/updateEditorContent",e.current,_))},this.handleEditorFocus=function(){n.sdk.pluginStore.commit("FormulaLanguageServicePlugin/updateActiveEditor",n.getEditor(),_),n.sdk.pluginStore.commit("FormulaLanguageServicePlugin/updateEditorStoreAttributes",{})},this.handleEditorSelectionChanged=function(e){if(n.isActiveEditor){var t=e.current;n.sdk.pluginStore.commit("FormulaLanguageServicePlugin/updateEditorSelection",t)}},this.handleEditorEditorError=function(e){if(n.editorErrorTimes++,(0,v.tz)(e),n.editorErrorTimes<10){n.createEditor();var t,r,o=n.sdk.pluginStore.getState("FormulaLanguageServicePlugin"),i=null==o?void 0:o.editorContent;if(i)null===(t=n.getEditor())||void 0===t||null===(r=t.editorCommand)||void 0===r||r.setContent(i.getActiveZone().getContent())}else setTimeout((function(){n.editorErrorTimes=0}))},this.handleSetStoreAttributes=function(e,t){n.sdk.pluginStore.commit("FormulaLanguageServicePlugin/updateEditorStoreAttributes",(0,s.Z)({},e,t))},this.handleEditorClick=function(e){var t,r;null===(t=n.sdk)||void 0===t||null===(r=t.getPlugin("FormulaLanguageServicePlugin"))||void 0===r||r.handleEditorClick()}}return(0,l.Z)(e,[{key:"init",value:function(e){this.sdk=e,this.initStore(),this.bindEvents()}},{key:"destroy",value:function(){this.unbindEvents(),this.reset()}},{key:"setContainer",value:function(e){this.container=e}},{key:"initStore",value:function(){this.sdk.pluginStore.registerModule(d.k)}},{key:"bindEvents",value:function(){this.unbindEvents(),this.sdk.pluginStore.watch("CellEditorStore/editorStatus",this.handleEditorStatusChange)}},{key:"unbindEvents",value:function(){this.sdk.pluginStore.unWatch("CellEditorStore/editorStatus",this.handleEditorStatusChange)}},{key:"getEditor",value:function(){return this.editor||this.createEditor(),this.editor}},{key:"createEditor",value:function(e,t){var n=this;if(this.options=Object.assign({},this.options,{},e),t&&this.setContainer(t),!this.container){var r=document.querySelector(".formulabar .rich-text-editor");if(!r)return;this.setContainer(r)}if(this.canCreateEditor()){this.editor&&this.editor.destroy();var o=this.sdk.spread,i=o.getActiveSheet();null!==i&&(this.editor=this.createCellEditor(Object.assign({source:"formula_bar",container:this.container,enableVirtualScroll:!1,sheetId:i.id(),spread:o,style:m,onEditorContentChange:this.handleEditorContentChanged,onEditorFocus:this.handleEditorFocus,onEditorKeydown:this.onEditorKeydown,onSelectionChange:this.handleEditorSelectionChanged,onEditorError:this.handleEditorEditorError,onSetStoreAttributes:this.handleSetStoreAttributes,onEditorClick:this.handleEditorClick,onInit:function(e){var t;if((null===(t=n.sdk.pluginStore.getState("CellEditorStore"))||void 0===t?void 0:t.editorStatus)===f.I9.EDIT){var r,o,i=null===(r=n.sdk.pluginStore.getState("FormulaLanguageServicePlugin"))||void 0===r?void 0:r.editorContent;if(i)null===(o=n.editor.editorCommand)||void 0===o||o.setContent(i.getActiveZone().getContent())}n.setCopyablePermission(e)},fixedFunctionHelperPosition:{top:0,left:42},disabledPlugins:[h.p.FontSize,h.p.Highlight]},this.options,{sdk:this.sdk})))}}},{key:"resizeEditor",value:function(){var e,t,n=document.querySelector(".formulabar .rich-text-editor"),r=null==n||null===(e=n.firstChild)||void 0===e?void 0:e.clientWidth;0!==r&&(null===(t=this.editor)||void 0===t||t.resizeEditor({maxContentWidth:r}))}},{key:"focusEditorEnd",value:function(){var e,t,n=this.getEditor();null===(e=n.editorCommand)||void 0===e||e.focus(),null===(t=n.editorCommand)||void 0===t||t.setSelectionToLastCharacter()}},{key:"focusOnEditor",value:function(e){var t,n,r,o=this.getEditor();(null===(t=o.editorCommand)||void 0===t||t.focus(),e)&&(null===(r=o.editorCommand)||void 0===r||r.setSelectionByOffset(e.start,e.end,!0));null===(n=o.editorCommand)||void 0===n||n.updateBrowserSelectionFromRep(),this.setCopyablePermission()}},{key:"setCopyablePermission",value:function(e){var t,n,r,o=e||this.editor.getEditor();if(o){var i=null===(t=null===(n=this.sdk)||void 0===n||null===(r=n.getPlugin("PermissionPlugin"))||void 0===r?void 0:r.getCopyable())||void 0===t||t;o.copyable=i}}},{key:"initContent",value:function(e){var t,n,r,o,i=this.editor;e?(null===(t=i.editorCommand)||void 0===t||t.setContent(e),null===(n=i.editorCommand)||void 0===n||n.clearAllStack()):null!==(r=i.editorCommand)&&void 0!==r&&r.checkEditorEmpty()||null===(o=i.editorCommand)||void 0===o||o.clearEditorContent()}},{key:"forceUpdateCopyablePermission",value:function(){this.setCopyablePermission()}},{key:"startEdit",value:function(e){var t=this;this.sdk.pluginStore.commit("FormulaLanguageServicePlugin/updateActiveEditor",this.getEditor(),_),this.initContent(e.content),setTimeout((function(){t.focusOnEditor(e.selection)}))}},{key:"refreshEditor",value:function(){this.editor.refresh()}},{key:"reset",value:function(){var e;this.setContainer(null),null===(e=this.editor)||void 0===e||e.destroy(),this.editor=null}},{key:"isActiveEditor",get:function(){return this.activeEditor===this.getEditor()}},{key:"activeEditor",get:function(){var e;return null===(e=this.sdk.pluginStore.getState("FormulaLanguageServicePlugin"))||void 0===e?void 0:e.activeEditor}},{key:"formulaLanguageServicePlugin",get:function(){return this.sdk.getPlugin("FormulaLanguageServicePlugin")}}]),e}();p([function(e,t,n){var r=n.value;return n.value=function(){var e=this;if(null==e.getEditor())return g;for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return r.apply(e,n)},n}],y.prototype,"startEdit",null);var C=n("vsh_82358"),S=function(e){function t(){var e;return(0,r.Z)(this,t),(e=(0,o.Z)(this,(0,i.Z)(t).apply(this,arguments))).createCellEditor=function(e){return new C.aZ(e)},e.canCreateEditor=function(){return C.aZ.canCreateEditor()},e}return(0,a.Z)(t,e),t}(y)},vsh_90036:function(e,t,n){var r;n.d(t,{R:function(){return r},k:function(){return o}}),function(e){e[e.Edit=0]="Edit",e[e.Idle=1]="Idle"}(r||(r={}));var o={namespace:"FormulaBarPlugin",state:{status:r.Idle},commit:{updateStatus:function(e,t){e.status=t}}}},vsh_26571:function(e,t,n){n.d(t,{BA:function(){return m},F7:function(){return r},$_:function(){return _}});var r,o=n("vsh_74561"),i=n("vsh_19264"),a=n("vsh_4175"),s=n("vsh_40285"),l=n("vsh_24627"),u=n("vsh_72834"),c=n("vsh_98617"),h=n("vsh_70257"),d=n("vsh_22485"),f=n("vsh_20680"),v=u.w99.Top|u.w99.Bottom|u.w99.Left|u.w99.Right,p=u.w99.Top|u.w99.Bottom,g=u.w99.Left|u.w99.Right,m="ARRAYFORMULA(";!function(e){e[e.Append=0]="Append",e[e.Modify=1]="Modify",e[e.Set=2]="Set",e[e.Clear=3]="Clear"}(r||(r={}));var _=function(){function e(t){(0,i.Z)(this,e),this.options=t,this.appendingRangeStartPoint=null,this.appendingRange=null,this.isAppending=!1,this.appendingContentStartPoint=-1}return(0,a.Z)(e,[{key:"getAppendingRange",value:function(){return this.appendingRange}},{key:"switchRefType",value:function(){var t=this.options.getSelection(),n=t.start-1,r=t.end-1;if(!(n<0||r<0)){for(var i,a=this.options.getText(),c=a,h=0,d=0,f=0,v=0,p=new s.I,g=this.options.getActiveCellStyle(),m=this.options.getRangeInfos(),_=0;_<m.length;_++){var y=m[_];if(!(y.start-1>r||y.stop<n)){var C=(0,u.h0Q)(this.options.getSheet(),y.text);if(!C)continue;if(void 0===i){var S=C.refStatus();i=e.getNextRefStatus(S),d=y.start}C.setRefStatus(i);var k=c.length,E=this.rangeToString(C);p=p.compose((new s.I).retain(y.start+h).delete(y.stop-y.start+1).insert(E,Object.assign((0,o.Z)({},l.Psm.FormulaColor,y.color),g))),h+=(c=c.substr(0,y.start+h)+E+c.substr(y.stop+1+h)).length-k,f=y.stop+h+1,v++}}c!==a&&(this.options.applyContentState(p),v>1?this.options.setCaret(d,f-d):this.options.setCaret(f),l.Ps3.collectSuiteEvent("sheet_opration",{action:"F4",eventType:"keydown",source:"body",object_id:this.options.getSheet().id()}))}}},{key:"handleKeydown",value:function(e){var t,n,r=e.keyCode;if(((0,h.O)(e.nativeEvent,null===(t=this.options.sdk)||void 0===t?void 0:t.getPlugin(f.B_))||r===l.VDZ.BackSpace)&&this.stopAppendingRange(),this.canAppendRangeByKeyboard(e.keyCode)){var o=e.ctrlKey,i=e.shiftKey,a=e.metaKey;return this.appendRangeByKeyBoard(r,o,a,i),!0}if(r===l.VDZ.F4)return this.switchRefType(),!0;var s=null===(n=this.options.sdk)||void 0===n?void 0:n.getPlugin("CellEditorPlugin"),u=l.Ps3.browser;return!!(function(e,t,n){var r=e.keyCode,o=e.ctrlKey,i=e.shiftKey,a=e.metaKey;if(t)return a&&i&&r===l.VDZ.Enter&&!o;if(n)return o&&i&&r===l.VDZ.Enter&&!a;return!1}(e,u.isMac,u.isWindows)&&null!=s&&s.isEditing(this.options.getSheet())&&c.kC.isFormula(this.options.getText()))&&(this.handleCSEKeyInArrayFormula(),!0)}},{key:"handleClick",value:function(e){this.stopAppendingRange()}},{key:"reset",value:function(){this.stopAppendingRange()}},{key:"handleCSEKeyInArrayFormula",value:function(){var e=this.options.getTokens();this.options.setText(function(e){for(var t="",n=0;n<e.length;n++){var r=e[n].image;if(r.toUpperCase()===m)break;t+=r}return"=".concat(m).concat(t,")")}(e))}},{key:"stopAppendingRange",value:function(){var e,t;this.isAppending&&(this.isAppending=!1,this.appendingContentStartPoint=-1,this.appendingRange=null,null===(e=(t=this.options).updateRangeInfosWhenStopAppending)||void 0===e||e.call(t),this.options.getSheet().notifyShell(u._16.FormulaTextBoxCaretChanged,{}))}},{key:"appendRangeByKeyBoard",value:function(e,t,n,o){var i,a=this.options.getSheet(),s=this.appendingRange||a._getActiveSelectedRange(),c=s.rowFrom(),h=s.colFrom(),d=l.Ps3.browser.isMac;if(!d&&t||d&&n)if(o)c=this.appendingRangeStartPoint?this.appendingRangeStartPoint.rowFrom():c,h=this.appendingRangeStartPoint?this.appendingRangeStartPoint.colFrom():h,i=a._getKeyboardSelectedRange(s,e,!0,c,h)||s;else{var f;switch(e){case l.VDZ.Left:f=l.Nmp.Left;break;case l.VDZ.Right:f=l.Nmp.Right;break;case l.VDZ.Down:f=l.Nmp.Down;break;case l.VDZ.Up:f=l.Nmp.Up;break;default:f=l.Nmp.Right}var v=(0,u.t3y)(a,c,h,f),p=v.row,g=v.col;f===l.Nmp.Left||f===l.Nmp.Right?a._scrollToCol(g):a._scrollToRow(p),i=new u.e6w(p,g,1,1,a),this.appendingRangeStartPoint=i}else if(o)c=this.appendingRangeStartPoint?this.appendingRangeStartPoint.rowFrom():c,h=this.appendingRangeStartPoint?this.appendingRangeStartPoint.colFrom():h,i=a._getKeyboardSelectedRange(s,e,!1,c,h)||s;else{var m={row:0,col:0};switch(e){case l.VDZ.Left:m=a._getMoveLeftCell(c,h,!1,c);break;case l.VDZ.Right:m=a._getMoveRightCell(c,h,!1,c);break;case l.VDZ.Down:m=a._getMoveDownCell(c,h,!1,h);break;case l.VDZ.Up:m=a._getMoveUpCell(c,h,!1,h)}null==m&&(m={row:c,col:h}),[l.VDZ.Left,l.VDZ.Right].includes(e)?a._scrollToCol(m.col):a._scrollToRow(m.row),i=new u.e6w(m.row,m.col,1,1,a),this.appendingRangeStartPoint=i}this.appendRange(i,r.Set)}},{key:"appendRange",value:function(e,t){var n=this.options.getText(),o=n;if(c.kC.isFormula(o)){var i=this.options.getSelection().end;if(!this.isAppending){if(!this.options.canAppendRange(i))return;this.isAppending=!0,this.appendingContentStartPoint=i}this.appendingRange=e,e&&1===e.rowCount()&&1===e.colCount()&&(e=new u.luK(e.rowFrom(),e.colFrom(),e.sheet()));var a=this.appendingContentStartPoint,l=i,h=e?this.rangeToString(e):"",d=new s.I,f=this.options.getActiveCellStyle();switch(t){case r.Set:case r.Clear:d.retain(a).delete(i-a).insert(h,f),o=o.substr(0,a)+h+o.substr(i),l=a+h.length;break;case r.Modify:var v=c.kC.getRangeInfo(this.options.getRangeInfos(),i);if(v){var p=v.start,g=v.stop+1;d.retain(p).delete(g-p).insert(h,f),o=o.substr(0,p)+h+o.substr(g),l=p+h.length}break;case r.Append:default:var m=h;i!==a&&(m=",".concat(h)),d.retain(i).insert(m,f),o=o.substr(0,i)+m+o.substr(i),l=i+m.length}n!==o&&(this.options.applyContentState(d),this.options.setCaret(l))}}},{key:"getActiveToken",value:function(){var e=this.options.getSelection().end,t=this.options.getTokens();return c.kC.getToken(t,e)}},{key:"isAppendingRange",value:function(e){if(!e||!this.isAppending)return!1;var t=this.appendingContentStartPoint,n=this.options.getSelection().end,r=e.stop;return t<=r&&r<n}},{key:"isActiveRange",value:function(e){var t=this.options.getSelection().end;return e.start<=t&&t<=e.stop+1}},{key:"getHighlightFormulaDelta",value:function(e,t){if(!e.length)return null;var n=new s.I;if(0===t.length)return n.retain(e.length,(0,o.Z)({},l.Psm.FormulaColor,""));for(var r=0,i=0;i<t.length;i++){var a=t[i];if(null!=a.hex){var u=a.range.start.character,c=a.range.end.character,h=u-r;h&&n.retain(h),n.retain(c-u+1,(0,o.Z)({},l.Psm.FormulaColor,a.hex)),r=c+1}}return r!==e.length&&n.retain(e.length-r,(0,o.Z)({},l.Psm.FormulaColor,"")),0===n.ops.length?null:n}},{key:"getFormulaBracketMatchingDelta",value:function(e,t){if(!e.length)return null;for(var n=(new s.I).retain(e.length,(0,o.Z)({},l.Psm.FormulaHighlight,"")),r=0;r<t.length;r++){var i=t[r],a=i.range;i.highlightType===d.LSPDocumentHighlightType.BracketMatching&&(n=n.compose((new s.I).retain(a.start.character).retain(1,(0,o.Z)({},l.Psm.FormulaHighlight,"true"))))}return 0===n.ops.length?null:n}},{key:"canAppendRangeByKeyboard",value:function(e){if(!l.t$k.includes(e))return!1;var t=this.options.getSelection();return!(null===this.appendingRange&&!this.options.canAppendRange(t.end))&&this.options.getText().length===t.end}},{key:"rangeToString",value:function(e){var t=e.sheet(),n=this.options.getSheet(),r=!1,o=this.options.isAcrossSheet(),i=t&&n&&t.name()!==n.name();return(o||i)&&(r=!0),e.toString({ref:this.options.getRef(),isShowSheetName:r})}}],[{key:"getNextRefStatus",value:function(e){return(e&u.w99.Left)!==u.w99.Left&&(e&u.w99.Top)!==u.w99.Top?v:(e&u.w99.Left)===u.w99.Left&&(e&u.w99.Top)===u.w99.Top?p:(e&u.w99.Left)!==u.w99.Left&&(e&u.w99.Top)===u.w99.Top?g:((e&u.w99.Left)===u.w99.Left&&(u.w99.Top,u.w99.Top),0)}}]),e}()},vsh_98617:function(e,t,n){n.d(t,{DQ:function(){return I},kC:function(){return R}});var r,o=n("vsh_67017"),i=n.n(o),a=n("vsh_35067"),s=n("vsh_19264"),l=n("vsh_4175"),u=n("vsh_74561"),c=n("vsh_78400"),h=n("vsh_22485"),d=n("vsh_24627"),f=n("vsh_72834"),v=n("vsh_22906"),p=[],g=new Set(["(",")","（","）"]),m=function(){function e(t){(0,s.Z)(this,e),this.options=t,this.highlightInfos=p}var t;return(0,l.Z)(e,[{key:"handleDocumentHighlight",value:(t=(0,a.Z)(i().mark((function e(t,n){var r,o,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Math.max(n-1,0),g.has(t[r])){e.next=5;break}return this.options.cancelRequest(h.LSPMethods.documentHighlight),this.setHighlightInfos([]),e.abrupt("return");case 5:return o={method:h.LSPMethods.documentHighlight,params:{textDocument:{uri:"",formula:t.slice(1)},position:{character:Math.max(0,n-1)}}},e.next=8,this.options.sendRequest(o,p);case 8:if(a=e.sent){e.next=11;break}return e.abrupt("return");case 11:this.setHighlightInfos(a);case 12:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"setHighlightInfos",value:function(e){this.highlightInfos=e.map((function(e){return e.range.start.character=e.range.start.character+1,e})),this.options.updateDocumentHighlightInfos(e)}},{key:"getHighlightInfos",value:function(){return this.highlightInfos}}]),e}(),_=n("vsh_85784"),y=n("vsh_43014"),C=n("vsh_96879"),S=n("vsh_26571"),k=n("vsh_49218"),E=function(){function e(t){(0,s.Z)(this,e),this.options=t}return(0,l.Z)(e,[{key:"initRecommendArrayFormulaStatus",value:function(){this.options.getRecommendArrayFormulaStatus()===k.JD.Process&&this.options.updateRecommendArrayFormulaStatus(k.JD.Init)}},{key:"processRecommendArrayFormulaStatus",value:function(){this.options.getRecommendArrayFormulaStatus()===k.JD.Init&&(this.options.updateRecommendArrayFormulaStatus(k.JD.Process),this.options.dispatchEvent("onProcessRecommendArrayFormula"))}},{key:"completeRecommendArrayFormulaStatus",value:function(){this.options.getRecommendArrayFormulaStatus()===k.JD.Process&&this.options.updateRecommendArrayFormulaStatus(k.JD.Complete)}},{key:"handleNeedRecommendArrayFormula",value:function(t,n,r){return n.reduce((function(e,t){return e+t.image}),"=")===r&&(!(this.options.getRecommendArrayFormulaStatus()!==k.JD.Init||!e.handleRecommendArrayFormulaToken(t,n))&&(this.processRecommendArrayFormulaStatus(),!0))}}],[{key:"handleRecommendArrayFormulaToken",value:function(e,t){for(var n=0,r=0,o=!1,i=0;i<t.length;i++){var a=t[i],s=a.tokenType.name;if(s===f.jo8.FUNCTION_NAME)break;if(a.image.toUpperCase()===S.BA){r++;break}if(n>1)break;if(f.X1$.includes(s)){var l=e.rangeStringToRange(a.image);if(!l)continue;(l.rowCount()>1||l.colCount()>1)&&(o=!0)}else f.JTP.includes(s)&&n++}return!!(o&&n<=1&&0===r)}}]),e}(),T=n("vsh_46544"),b="sheet.formula.language_server_error",I=(r={},(0,u.Z)(r,c.O500,"var(--O500)"),(0,u.Z)(r,c.P500,"var(--P500)"),(0,u.Z)(r,c.Y500,"var(--Y500)"),(0,u.Z)(r,c.W500,"var(--W500)"),(0,u.Z)(r,c.R500,"var(--R500)"),(0,u.Z)(r,c.T500,"var(--T500)"),(0,u.Z)(r,c.C500,"var(--C500)"),(0,u.Z)(r,c.B500,"var(--B500)"),(0,u.Z)(r,c.G500,"var(--G500)"),r),R=function(){function e(t,n){(0,s.Z)(this,e),this.options=n,this.tokens=[],this.rangeInfos=[],this.cursor=0,this.text="";var r=(0,v.Je)({getTokenTypes:function(){return f.nzm},getTokenText:function(e){return e.image},getStartOffset:function(e){return e.startOffset},getEndOffset:function(e){return e.endOffset},getTokenType:function(e){return e.tokenType},compileTokens:function(e){return(0,f.MOM)(e).lexingResult},getFormulaService:function(){return t.getCalcEngine().formulaService}}).client;this.client=r,this.workbook=t;var o=this.sendRequest.bind(this),i=r.cancelRequest.bind(r);this.documentColor=new _.p({sendRequest:o,cancelRequest:i,updateColorInfos:this.updateColorInfos.bind(this),isRefToken:e.isRefToken,isNumberToken:e.isNumberToken,isStringToken:e.isStringToken,isBooleanToken:e.isBooleanToken,isFormula:e.isFormula}),this.documentHighlight=new m({sendRequest:o,cancelRequest:i,updateDocumentHighlightInfos:this.updateDocumentHighlightInfos.bind(this)}),this.completion=new y.I({sendRequest:o,updateCompletionInfos:this.updateCompletionInfos.bind(this)}),this.signatureHelp=new C.v({sendRequest:o,updateSignatureHelp:this.updateSignatureHelp.bind(this)}),this.recommendArrayFormula=new E({dispatchEvent:this.dispatchEvent.bind(this),getRecommendArrayFormulaStatus:this.getRecommendArrayFormulaStatus.bind(this),updateRecommendArrayFormulaStatus:this.updateRecommendArrayFormulaStatus.bind(this)})}var t;return(0,l.Z)(e,[{key:"sendRequest",value:(t=(0,a.Z)(i().mark((function e(t,n){var r,o,a,s,l;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=window.performance.now(),void 0!==(s=null===(r=this.client.sendRequest(t))||void 0===r?void 0:r.promise)){e.next=4;break}return e.abrupt("return",n);case 4:return e.next=6,s.catch((function(e){return null}));case 6:if(l=e.sent,Math.random()<=.1&&this.report(Object.assign({},t,{cost:window.performance.now()-a})),l){e.next=11;break}return e.abrupt("return",null);case 11:return l.error&&l.error.code!==h.LSPErrorCodes.ParseError&&this.handleErrorLog(t,l.error),null!==(o=l.metaData)&&void 0!==o&&o.tokens&&this.setTokens(l.metaData.tokens),e.abrupt("return",l.result||n);case 14:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"handleErrorLog",value:function(e,t){d.Ps3.moirae.ravenCatch(b,{tags:Object.assign({key:b,method:e.method},t)})}},{key:"report",value:function(e){var t,n=null===(t=e.params)||void 0===t?void 0:t.textDocument.formula.length;n&&d.Ps3.collectSuiteEvent("sheet_formula_language_service_performance",{method:e.method,cost_time:e.cost,formula_length:n})}},{key:"getTokens",value:function(){return this.tokens}},{key:"getRef",value:function(){return this._ref}},{key:"getText",value:function(){return this.text}},{key:"getRangeInfos",value:function(){return this.rangeInfos}},{key:"getColorInfos",value:function(){return this.documentColor.getColorInfos()}},{key:"getFormulaHighlightInfos",value:function(){return this.documentHighlight.getHighlightInfos()}},{key:"getFormulaCompletionInfos",value:function(){return this.completion.getCompletion()}},{key:"getSignatureHelp",value:function(){return this.signatureHelp.getSignatureHelp()}},{key:"setRangeInfos",value:function(e){var t,n;this.rangeInfos=e,null===(t=(n=this.options).onUpdateRangeInfos)||void 0===t||t.call(n,e);var r=this._ref;if(r){var o=r.sheet();if(o){o.notifyShell(f._16.FormulaTextBoxCaretChanged,{});var i=this.workbook.getActiveSheet();o!==i&&i.notifyShell(f._16.FormulaTextBoxCaretChanged,{})}}}},{key:"setTokens",value:function(e){this.tokens=e}},{key:"setRef",value:function(e){this._ref=e}},{key:"setSelection",value:function(e){this.cursor=e,this.handleCursorChange(e)}},{key:"setText",value:function(t){var n=this.text;n!==t&&(this.text=t,e.isFormula(t)||e.isFormula(n)?this.handleTextUpdate(t):this.updateColorInfos([]))}},{key:"handleTextUpdate",value:function(e){this.documentColor.handleSyntaxHighlight(e),this.handleCursorChange(this.cursor)}},{key:"handleCursorChange",value:function(t){e.isFormula(this.text)&&(this.documentHighlight.handleDocumentHighlight(this.text,t),this.completion.handleCompletion(this.text,t),this.signatureHelp.handleSignatureHelp(this.text,t))}},{key:"updateColorInfos",value:function(e){var t,n;this.generateRangeInfos(e),null===(t=(n=this.options).onUpdateColorInfos)||void 0===t||t.call(n,e)}},{key:"updateDocumentHighlightInfos",value:function(e){var t,n;null===(t=(n=this.options).onUpdateDocumentHighlightInfos)||void 0===t||t.call(n,e)}},{key:"updateCompletionInfos",value:function(e){var t,n;null===(t=(n=this.options).onUpdateCompletionInfos)||void 0===t||t.call(n,e)}},{key:"updateSignatureHelp",value:function(e){var t,n;null===(t=(n=this.options).onUpdateSignatureHelp)||void 0===t||t.call(n,e)}},{key:"generateRangeInfos",value:function(e){if(0!==e.length){for(var t=[],n={ref:this._ref,spread:this.workbook},r=0;r<e.length;r++){var o=e[r];if(o.tokenType&&[f.nzm.LocalReferenceR1C1,f.nzm.ExternalReferenceR1C1,f.nzm.LocalReferenceA1,f.nzm.ExternalReferenceA1].includes(o.tokenType)){var i=o.range.start.character,a=o.range.end.character,s=this.text.slice(i,a+1),l=(0,f.gxr)(s,n);l&&!l.isError()&&t.push({range:l,text:s,color:o.hex,token:o.token,start:i,stop:a})}}this.setRangeInfos(t)}else this.setRangeInfos([])}},{key:"canAppendRange",value:function(t){return!!e.isFormula(this.text)&&(!(t<=0)&&(1===t||this.hasAppendRangeOperator(t)))}},{key:"hasAppendRangeOperator",value:function(e){var t,n=this.getToken(e);if(null==n)return!1;var r=n.tokenType,o=null!==(t=n.endOffset)&&void 0!==t?t:0;return!(r===f.nzm.FunctionName&&e-1<=o)&&[f.nzm.OpenBrace,f.nzm.OpenParen,f.nzm.FunctionName,f.nzm.SemiColon,f.nzm.Comma,f.nzm.ExclamationMark,f.nzm.Plus,f.nzm.Minus,f.nzm.Multiply,f.nzm.Divide,f.nzm.Power,f.nzm.LessThan,f.nzm.GreaterThan,f.nzm.LessThanEquals,f.nzm.GreaterThanEquals,f.nzm.Equals,f.nzm.NotEquals,f.nzm.Concatenate,f.nzm.Colon,f.nzm.WhiteSpace].includes(r)}},{key:"getToken",value:function(t){return e.getToken(this.getTokens(),t)}},{key:"getRecommendArrayFormulaStatus",value:function(){var e,t;return null===(e=(t=this.options).getRecommendArrayFormulaStatus)||void 0===e?void 0:e.call(t)}},{key:"updateRecommendArrayFormulaStatus",value:function(e){var t,n;return null===(t=(n=this.options).onUpdateRecommendArrayFormulaStatus)||void 0===t?void 0:t.call(n,e)}},{key:"dispatchEvent",value:function(e){var t,n;return null===(t=(n=this.options).dispatchEvent)||void 0===t?void 0:t.call(n,e)}},{key:"initRecommendArrayFormulaStatus",value:function(){return this.recommendArrayFormula.initRecommendArrayFormulaStatus()}},{key:"processRecommendArrayFormulaStatus",value:function(){return this.recommendArrayFormula.processRecommendArrayFormulaStatus()}},{key:"completeRecommendArrayFormulaStatus",value:function(){return this.recommendArrayFormula.completeRecommendArrayFormulaStatus()}},{key:"handleNeedRecommendArrayFormula",value:function(e){return this.recommendArrayFormula.handleNeedRecommendArrayFormula(e,this.getTokens(),this.getText())}}],[{key:"getEditText",value:function(e,t,n){if(!e)return"";if(!(0,f.A8G)(e,t,n))return"";var r=e.inject(T.Cy),o=r.getPivotTableNameByCell(t,n);if(r.isEmptyPivotTable(o))return"";var i=e.getFormula(t,n,{spread:e.parent,ref:new f.luK(t,n,e)});if(i)return"=".concat(i);var a=e.getActualStyle(t,n);e.getReminder(t,n)&&(a=f.bgS.withFormatter(a,e.getReminderFormatter(t,n)));var s=e.getValue(t,n);return(0,d.ali)(s)?"":(0,f.Kq2)(a,s,e).value||""}},{key:"isFormula",value:function(e){if(0===e.length)return!1;var t=e[0];return"="===t||"+"===t}},{key:"getToken",value:function(e,t){if(t<=0)return null;for(var n=t-2,r=0,o=e.length;r<o;r++){var i=e[r];if(i.startOffset<=n&&n<=i.endOffset)return i}return null}},{key:"getRangeInfo",value:function(e,t){if(t<=0)return null;for(var n=t-2,r=0,o=e.length;r<o;r++){var i=e[r],a=e[r],s=a.start,l=a.stop;if(s<=n&&n<=l)return i}return null}},{key:"isNameNode",value:function(e){return e.tokenType===f.nzm.Name}},{key:"isRefToken",value:function(e){return[f.nzm.LocalReferenceR1C1,f.nzm.ExternalReferenceR1C1,f.nzm.LocalReferenceA1,f.nzm.ExternalReferenceA1].includes(e)}},{key:"isStringToken",value:function(e){return e===f.nzm.StringConstant}},{key:"isNumberToken",value:function(e){return e===f.nzm.NumericalConstant}},{key:"isBooleanToken",value:function(e){return[f.nzm.LogicalFalse,f.nzm.LogicalTrue].includes(e)}}]),e}()},vsh_43014:function(e,t,n){n.d(t,{I:function(){return c}});var r=n("vsh_67017"),o=n.n(r),i=n("vsh_35067"),a=n("vsh_19264"),s=n("vsh_4175"),l=n("vsh_22485"),u=[],c=function(){function e(t){(0,a.Z)(this,e),this.options=t,this.infos=u}var t;return(0,s.Z)(e,[{key:"handleCompletion",value:(t=(0,i.Z)(o().mark((function e(t,n){var r,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={method:l.LSPMethods.completion,params:{textDocument:{uri:"",formula:t.slice(1)},position:{character:Math.max(0,n-1)}}},e.next=3,this.options.sendRequest(r,u);case 3:if(i=e.sent){e.next=6;break}return e.abrupt("return");case 6:this.setCompletionResult(i);case 7:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"setCompletionResult",value:function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n].label;r.startsWith("PRIVATE_")||t.push(r)}this.infos=t,this.options.sortCompletionInfos&&(this.infos=this.options.sortCompletionInfos(this.infos)),this.options.updateCompletionInfos(this.infos)}},{key:"getCompletion",value:function(){return this.infos}}]),e}()},vsh_85784:function(e,t,n){n.d(t,{c:function(){return c},p:function(){return h}});var r=n("vsh_67017"),o=n.n(r),i=n("vsh_35067"),a=n("vsh_19264"),s=n("vsh_4175"),l=n("vsh_22485"),u=n("vsh_7959"),c=[u.hCs,u.Stn,u.QSY,u.Uo,u.Nn3,u.B_c,u.NBN],h=function(){function e(t){(0,a.Z)(this,e),this.options=t,this.colorInfos=[]}var t;return(0,s.Z)(e,[{key:"handleSyntaxHighlight",value:(t=(0,i.Z)(o().mark((function e(t){var n,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.options.isFormula(t)){e.next=4;break}return this.options.cancelRequest(l.LSPMethods.documentColor),this.setColorInfos([]),e.abrupt("return");case 4:return n={method:l.LSPMethods.documentColor,params:{textDocument:{uri:"",formula:t.slice(1)}}},e.next=7,this.options.sendRequest(n,[]);case 7:if(r=e.sent){e.next=10;break}return e.abrupt("return");case 10:this.setColorInfos(r);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"setColorInfos",value:function(e){var t=this;e.forEach((function(e){e.range.start.character+=1,e.range.end.character+=1;var n=e.tokenType;if(void 0!==n){if(t.options.isRefToken(n)){var r=c[e.refId%c.length];e.token=r,e.hex=(0,u.wOx)(r)}(t.options.isNumberToken(n)||t.options.isBooleanToken(n))&&(e.token=u.L91,e.hex=(0,u.wOx)(u.L91)),t.options.isStringToken(n)&&(e.token=u.wwp,e.hex=(0,u.wOx)(u.wwp))}})),this.colorInfos=e,this.options.updateColorInfos(e)}},{key:"getColorInfos",value:function(){return this.colorInfos}}]),e}()},vsh_96879:function(e,t,n){n.d(t,{v:function(){return c}});var r=n("vsh_67017"),o=n.n(r),i=n("vsh_35067"),a=n("vsh_19264"),s=n("vsh_4175"),l=n("vsh_22485"),u={signatures:[]},c=function(){function e(t){(0,a.Z)(this,e),this.options=t,this.signatures=[]}var t;return(0,s.Z)(e,[{key:"handleSignatureHelp",value:(t=(0,i.Z)(o().mark((function e(t,n){var r,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={method:l.LSPMethods.signatureHelp,params:{textDocument:{uri:"",formula:t.slice(1)},position:{character:Math.max(0,n-1)}}},e.next=3,this.options.sendRequest(r,u);case 3:if(i=e.sent){e.next=6;break}return e.abrupt("return");case 6:this.setSignatures(i.signatures);case 7:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"setSignatures",value:function(e){for(var t=e.length,n=0;n<t;n++){var r=e[n];switch(r.label){case"LAMBDA":for(var o,i,a=null!==(o=null===(i=r.parameters)||void 0===i?void 0:i.length)&&void 0!==o?o:0,s=0;s<a;s++){if(s===a-1){r.parameters[s].type=l.ArgumentTypes.Required;break}r.parameters[s].type=l.ArgumentTypes.OptionalRepeated}break;case"LET":for(var u,c,h=null!==(u=null===(c=r.parameters)||void 0===c?void 0:c.length)&&void 0!==u?u:0,d=[l.ArgumentTypes.OptionalRepeated,l.ArgumentTypes.OptionalRepeated,l.ArgumentTypes.Required],f=0;f<h;f++)r.parameters[f].type=d[f];break;case"AI_DEEPSEEK_WRITE":case"AI_ASK":case"AI_WRITE":var v=r.parameters;v&&v.length&&(r.parameters=[v[0]])}}this.signatures=e,this.options.updateSignatureHelp(e)}},{key:"getSignatureHelp",value:function(){return this.signatures}}]),e}()},vsh_49218:function(e,t,n){n.d(t,{JD:function(){return o},u_:function(){return a}});var r="sheet_complete_recommend_arrayformula_time_stamp";var o;!function(e){e[e.Init=0]="Init",e[e.Process=1]="Process",e[e.Complete=2]="Complete"}(o||(o={}));var i,a={namespace:"FormulaLanguageServicePlugin",state:{activeEditor:null,editorContent:null,editorSelection:null,editorStoreAttributes:{},formulaColorInfos:[],recommendArrayFormulaStatus:(i=localStorage.getItem(r))&&Number(i)?o.Complete:o.Init},commit:{updateActiveEditor:function(e,t){e.activeEditor=t},updateEditorContent:function(e,t){e.editorContent=t},updateEditorSelection:function(e,t){e.editorSelection=t},updateEditorStoreAttributes:function(e,t){e.editorStoreAttributes=t},updateFormulaColorInfos:function(e,t){e.formulaColorInfos=t},updateRecommendedArrayFormulaStatus:function(e,t){t===o.Complete&&function(e){try{localStorage.setItem(r,e)}catch(e){console.error(e)}}(String(Date.now())),e.recommendArrayFormulaStatus=t}}}},vsh_22906:function(e,t,n){n.d(t,{Je:function(){return f}});var r=n("vsh_19264"),o=n("vsh_4175"),i=n("vsh_12064"),a=n("vsh_56589"),s=n("vsh_22462"),l=n("vsh_73455"),u=n("vsh_81611"),c=n("vsh_72834"),h={completion:!0,signatureHelp:!0,documentHighlight:!0,colorProvider:!0},d=function(e){function t(){var e;return(0,r.Z)(this,t),(e=(0,i.Z)(this,(0,s.Z)(t).apply(this,arguments))).pendingMap=new Map,e}return(0,l.Z)(t,e),(0,o.Z)(t,[{key:"sendRequest",value:function(e){this.cancelRequest(e.method);var n=(0,a.Z)((0,s.Z)(t.prototype),"sendRequest",this).call(this,e);return n?(this.pendingMap.set(e.method,n.cancel),n):null}},{key:"cancelRequest",value:function(e){var t=this.pendingMap.get(e);t&&(t(),this.pendingMap.delete(e))}}]),t}(u.TractorLSPClient);function f(e){var t=new d,n=new u.TractorLSPServer,r=new u.LocalLSPConnection(t,n);return t.initialize({textDocument:h},Object.assign({},e,{getFunctionOperator:function(e){return c.ty_.get(e)},getFunctionNameList:function(){return Array.from(c.ty_.keys())}})),{client:t,server:n,connection:r}}},vsh_74075:function(e,t,n){n.d(t,{XT:function(){return E},MC:function(){return w},Wc:function(){return T}});var r=n("vsh_1139"),o=n("vsh_74561"),i=n("vsh_19264"),a=n("vsh_4175"),s=n("vsh_65498"),l=n("vsh_92292"),u=n("vsh_24627"),c=n("vsh_74340"),h=n("vsh_21955"),d=n("vsh_82905"),f=n("vsh_67017"),v=n.n(f),p=n("vsh_35067"),g=n("vsh_72834"),m=function(){function e(){(0,i.Z)(this,e),this.metaRequestProvider=u.Ps3.serverApi.importRange.requestImportRangeMetas,this.blockRequestProvider=u.Ps3.serverApi.importRange.requestSubBlock,this.heartBeatProvider=u.Ps3.serverApi.importRange.requestHeartBeat,this.addImportRangeProvider=u.Ps3.serverApi.importRange.requestAddImportRange,this.batchDocsTitleProvider=u.Ps3.batchFetchDocsTitles}return(0,a.Z)(e,[{key:"handleFetchData",value:function(e){var t=this;return this.requestQueue||(this.requestQueue=new g.ZDm((0,o.Z)({},g.xdz.ImportRangeDatasV3,this.requestDatas.bind(this)))),new Promise((function(n,r){t.requestQueue.push({type:g.xdz.ImportRangeDatasV3,params:e,resolve:n,reject:r})}))}},{key:"requestDatas",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=function(e){var r,o=e[0].spreadToken,i=null!==(r=e[0].options.version)&&void 0!==r?r:u.waj.V2;return t.metaRequestProvider({token:o,version:i,importrange_ids:e.map((function(e){return e.importRangeId}))}).then((function(r){if(!r)throw r;var a=function(a){var s=r[a],l=s.importrangeMetaToken,c=e.find((function(e){return e.importRangeId===a}));if(s.dataType===u.njA.IRDataTypeNotExist)return null==c||c.reject(u.DZv[u.O6N.REFERENCE_NOT_EXIST_V3]),"continue";var h=(0,u.rR3)(s.dataType);if(h)return null==c||c.reject(h),"continue";if(s.dataType===u.njA.IRDataTypeNoChange)return null==c||c.resolve({isNoChange:!0,updateTime:Date.now()}),"continue";var d=n[l];if(d&&d.hash===s.importrangeMeta.hash)return null==c||c.resolve(d),"continue";t.requestBlockDatas(o,i,s).then((function(e){n[l]=e,null==c||c.resolve(e)})).catch((function(e){return null==c?void 0:c.reject(e)}))};for(var s in r)a(s)})).catch((function(t){e.forEach((function(e){var n;return(0,e.reject)(null!==(n=t)&&void 0!==n?n:u.rBk[u.O6N.REQUEST_FAIL])}))}))},o=[],i=[];e.forEach((function(e){e.options.version===u.waj.V3?i.push(e):o.push(e)})),_(o,r),_(i,r)}},{key:"requestBlockDatas",value:function(e,t,n){var r=this,o=n.importrangeMeta,i=o.rowCounts,a=o.rowStarts,s=o.range,l=o.hash,u=o.dataBlockTokens,c=o.snapshotBlockTokens,h={};return _(Array.prototype.concat.call(u,c),(function(o){return r.blockRequestProvider({token:e,access_key:n.accessKey,version:t,block_tokens:o}).then((function(e){Object.assign(h,e)}))})).then((function(){return{metaToken:n.importrangeMetaToken,accessKey:n.accessKey,hash:l,rowCount:s.RowCount,colCount:s.ColCount,updateTime:Date.now(),blocks:C({rowCounts:i,rowStarts:a,gzipMap:h,tokens:u}),snapshotBlocks:C({rowCounts:i,rowStarts:a,gzipMap:h,tokens:c})}}))}},{key:"requestAddImportRange",value:function(e,t){var n=this,r={};return _(t,(function(t){return n.addImportRangeProvider({token:e,add:t}).then((function(e){Object.assign(r,e)}))})).then((function(){return r}))}},{key:"requestHeartBeat",value:function(e,t){var n=this,r={};return _(e,(function(e){return n.heartBeatProvider({token:t,importrange_meta_tokens:e}).then((function(e){Object.assign(r,e)}))})).then((function(){return r}))}},{key:"requestDocsTitle",value:function(e){return this.batchDocsTitleProvider||(this.batchDocsTitleProvider=u.Ps3.batchFetchDocsTitles),this.batchDocsTitleProvider(e)}},{key:"dispose",value:function(){var e;null===(e=this.requestQueue)||void 0===e||e.dispose()}}]),e}();function _(e,t){return y.apply(this,arguments)}function y(){return y=(0,p.Z)(v().mark((function e(t,n){var r,o,i,a=arguments;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=a.length>2&&void 0!==a[2]?a[2]:g.bP6,o=[],i=0;case 3:if(!(i<t.length)){e.next=12;break}if(o.push(t[i]),!(o.length>=r)){e.next=9;break}return e.next=8,n(o);case 8:o=[];case 9:i++,e.next=3;break;case 12:if(!o.length){e.next=15;break}return e.next=15,n(o);case 15:case"end":return e.stop()}}),e)}))),y.apply(this,arguments)}function C(e){for(var t=e.rowCounts,n=e.rowStarts,r=e.tokens,o=e.gzipMap,i=[],a=0;a<r.length;a++)i.push({block_token:r[a],gzip_datatable:o[r[a]],startRowIndex:n[a],rowsCount:t[a]});return i}var S=n("vsh_46110"),k=function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":(0,s.Z)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},E="ImportRangePlugin",T=function(){function e(){var t=this;(0,i.Z)(this,e),this.name=E,this.netWorkController=new m,this.labelInfos={},this.referenceNotExistIds=new Set,this.importRangeHeartBeat={enable:!0,intervalTime:g.hRV,interval:null},this.importRangeCreatePromise=null,this.onDeleteFormula=function(e){var n=t.sdk.spread.importRangeManagerV3,r=(0,g.WhP)(e),o=n.formula2ImportRange.get(r);null==o||o.forEach((function(e){var o=t.labelInfos[e];if(o&&o.formulas){var i,a=null!==(i=o.formulas.indexOf(r))&&void 0!==i?i:-1;-1!==a&&o.formulas.splice(a,1),o.formulas&&o.formulas.length||delete t.labelInfos[e]}n.removeFormula2ImportRangeRelationship(r,e)}))}}return(0,a.Z)(e,[{key:"init",value:function(e){var t=this;this.sdk=e;var n=this.sdk.spread.importRangeManagerV3;n.setThreadEnv(g.n$r.main),n.setRequestMethod((function(e){return function(e,t){t.fetchImportRangeData(e).then((function(t){if(t instanceof u.rBk)throw t;e.resolve(t)})).catch((function(t){t instanceof u.rBk==!1&&console.error("unknown error in importrange fetch",t),e.reject(t)}))}(e,t)})),n.setCalcFinishedCallback(b.bind(n,this.sdk)),this.autoCreateSubscription=this.sdk.spread.subscribe((0,o.Z)({},u.Fsj.AfterApply,this.handleAutoCreateImportRange.bind(this))),this.importRangeMessageSubscription=this.subscribeImportRangesChanged(this.onChangedEventDataMessage),n.addListener(g.fOM.onDeleteFormulaV3,this.onDeleteFormula)}},{key:"destroy",value:function(){var e;null===(e=this.importRangeMessageSubscription)||void 0===e||e.unsubscribe(),this.autoCreateSubscription.unsubscribe(),this.sdk.spread.importRangeManagerV3.removeListener(g.fOM.onDeleteFormulaV3,this.onDeleteFormula),this.sdk={},this.closeHeartBeat()}},{key:"subscribeImportRangesChanged",value:function(e){var t;return null===(t=this.sdk.getService(c.ClJ))||void 0===t?void 0:t.subscribeExtractChangedEventDataMessage(c.uaV.IMPORT_RANGE,e)}},{key:"onChangedEventDataMessage",value:function(e){var t=e.importRangeId,n=e.dataType,r=e.version,o=this.sdk.getPlugin(S.Pj);o?o.syncImportRange(e):r===u.waj.V3?this.sdk.spread.importRangeManagerV3.onImportRangeStatusChange(t,n):this.sdk.spread.importRangeManager.onImportRangeChange(t,n)}},{key:"fetchImportRangeData",value:function(e){var t=this;return this.startHeartBeat(this.handleImportRangeHeartBeat.bind(this)),new Promise((function(n,r){var o=Object.assign({},e,{resolve:n,reject:r});t.importRangeCreatePromise?t.importRangeCreatePromise.then((function(){t.netWorkController.handleFetchData(o)})):t.netWorkController.handleFetchData(o)})).then((function(n){return n instanceof u.rBk||(0,g.oFn)(n)||t.updateImportRangeLabelInfo(e.importRangeId,e.extraInfo,n),n})).finally((function(){var n;null===(n=t.sdk.spread)||void 0===n||n.importRangeManagerV3.emit(g.fOM.onAfterRequest,e.importRangeId)}))}},{key:"updateImportRangeLabelInfo",value:function(e,t,n){var r=this,o=t.spreadSource,i=t.rangeStr,a=n.metaToken,s=n.hash,l=this.labelInfos[e];l?(l.updateTime=Date.now(),l.hash=s):this.labelInfos[e]={metaToken:a,hash:s,spreadSource:o,rangeStr:i,updateTime:Date.now()},this.updateSpreadSourceName(e.split("_")[0]).then((function(t){return r.labelInfos[e].spreadName=t})).catch((function(t){console.error(t),r.labelInfos[e].spreadName=""}))}},{key:"updateSpreadSourceName",value:function(e){return this.netWorkController.requestDocsTitle([{token:e,typeNum:3}]).then((function(t){return t[e]?t[e].title:""}))}},{key:"fetchImportRangeCreate",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.sdk.spread.importRangeManagerV3,o=this.netWorkController.requestAddImportRange(r.getCurrentSpreadToken(),e).then((function(){if(n){var r=t.sdk.spread.importRangeManagerV3,o=t.sdk.getPlugin(S.Pj);o?o.receiveImportRangeRefreshV3(e):r.refreshImportRangeData(e)}})).finally((function(){return t.importRangeCreatePromise=null}));return this.importRangeCreatePromise=o,o}},{key:"handleAutoCreateImportRange",value:function(){var e=this,t=this.sdk.spread.importRangeManagerV3;if(t.V3Enable&&t.importRangeAutoCreateSet.size){var n=[];t.importRangeAutoCreateSet.forEach((function(t){e.labelInfos[t]||n.push(t)})),t.importRangeAutoCreateSet.clear(),this.fetchImportRangeCreate(n)}}},{key:"getImportRangeIdsBySheetId",value:function(e){var t=this.sdk.spread.importRangeManagerV3.formula2ImportRange,n=new Set;return t.forEach((function(t,r){r.includes(e)&&t.forEach((function(e){return n.add(e)}))})),Array.from(n)}},{key:"handleImportRangeHeartBeat",value:function(){var e=this,t=[],n=this.sdk.spread.importRangeManagerV3,o=n.getCurrentSpreadToken();Object.values(this.labelInfos).forEach((function(e){var n=e.metaToken;return t.push(n)})),t.length?this.netWorkController.requestHeartBeat(t,o).then((function(t){var n=new Set;Object.entries(e.labelInfos).forEach((function(o){var i=(0,r.Z)(o,2),a=i[0],s=i[1],l=s.hash,c=s.metaToken;t[c]&&l!==t[c]?e.onChangedEventDataMessage({importRangeId:a,dataType:u.njA.IRDataTypeNormal,version:u.waj.V3}):n.add(a)})),n.forEach((function(t){return e.labelInfos[t].updateTime=Date.now()}))})).catch((function(e){n.collectImportRangeFrontError("heartbeat error: ".concat(null==e?void 0:e.message))})):this.closeHeartBeat()}},{key:"startHeartBeat",value:function(e){this.importRangeHeartBeat.enable&&!this.importRangeHeartBeat.interval&&(this.importRangeHeartBeat.interval=setInterval(e,this.importRangeHeartBeat.intervalTime))}},{key:"closeHeartBeat",value:function(){this.importRangeHeartBeat.interval&&(clearInterval(this.importRangeHeartBeat.interval),this.importRangeHeartBeat.interval=null)}}]),e}();function b(e){var t=e.spread.importRangeManagerV3,n=e.getPlugin(E),r=null==n?void 0:n.labelInfos,o=[];r&&(Object.keys(r).forEach((function(e){var n,i=null===(n=t.importRangeContentMap.get(e))||void 0===n?void 0:n.formulas;i?r[e].formulas=Array.from(i):o.push(e)})),o.forEach((function(e){return delete r[e]})));var i=[];t.importRangeContentMap.forEach((function(e,t){e.importRangeData instanceof u.rBk&&e.importRangeData.code===u.O6N.REFERENCE_NOT_EXIST_V3&&i.push(t)})),n&&(n.referenceNotExistIds=new Set(i))}k([(0,l.Bind)()],T.prototype,"onChangedEventDataMessage",null),T=k([(0,h.Mn)({required:[d.tb],optional:[c.ClJ]})],T);var I=n("vsh_22485"),R=function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":(0,s.Z)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},w=function(){function e(){(0,i.Z)(this,e),this.authorized=!1,this.name="ImportFormulaPlugin"}var t,n;return(0,a.Z)(e,[{key:"init",value:function(e){this.sdk=e,this.subscription=this.sdk.getService(c.ClJ).subscribeExtractChangedEventDataMessage(c.uaV.IMPORT_FORMULA,this.onImportFormulaChangedEventDataMessage),this.subscription.add(this.sdk.getService(c.ClJ).subscribeExtractChangedEventDataMessage(c.uaV.AUTHORIZATION,this.onAuthorizationChangedEventDataMessage)),this.subscription.add(this.sdk.subscribePluginEventMap((0,o.Z)({},"LoadStatusStore/ContentMetaApply",this.onClientVarsLoaded.bind(this))))}},{key:"destroy",value:function(){var e;null===(e=this.subscription)||void 0===e||e.unsubscribe(),this.subscription=void 0,this.sdk={}}},{key:"onImportFormulaChangedEventDataMessage",value:function(e){var t=e.formulaUniqueKey,n=e.status,r=this.sdk.getPlugin(S.Pj);return r?r.syncImportFormula(e):this.sdk.spread.importFormulaManager.handleServerMessage(t,n)}},{key:"onAuthorizationChangedEventDataMessage",value:function(e){this.onAuthorizedChanged(e.authorized)&&this.afterEventDataMessage&&this.afterEventDataMessage()}},{key:"onClientVarsLoaded",value:function(e){var t=e.authorized;this.authorized=void 0!==t&&Boolean(t>>u.Qd5.Network&1),this.sdk.spread.importFormulaManager.netWorkController.setMetaProvider(this.requestImportFormulaMetaWithAuthorizedCheck.bind(this))}},{key:"onAuthorizedChanged",value:function(e){var t=Boolean(e>>u.Qd5.Network&1);if(this.authorized===t)return!1;this.authorized=t;var n=this.sdk.getPlugin(S.Pj);return n?n.receiveImportFormulaRefresh():this.sdk.spread.importFormulaManager.reCalcImportFormulas(),!0}},{key:"onAllowAuthorizedForNetWork",value:(n=(0,p.Z)(v().mark((function e(){var t;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.Ps3.serverApi.importFormula.requestAuthorized({token:this.sdk.spread._context.getToken(),authorizationCode:u.Qd5.Network,authorize:!0});case 3:if(0!==(t=e.sent)){e.next=6;break}throw Error("authorized fail");case 6:return this.onAuthorizedChanged(t),e.abrupt("return",!!t);case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",!1);case 13:case"end":return e.stop()}}),e,this,[[0,10]])}))),function(){return n.apply(this,arguments)})},{key:"requestImportFormulaMetaWithAuthorizedCheck",value:(t=(0,p.Z)(v().mark((function e(t){return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u.Ps3.getImportFormulaEnable()){e.next=2;break}throw I.NAME_ERR_VAR;case 2:if(this.authorized){e.next=4;break}return e.abrupt("return",t.formulas.map((function(e){return Object.assign({},e,{formulaData:"",crawlTimestamp:0,status:u.R7l.NetworkAuthorizedDeny})})));case 4:return e.abrupt("return",u.Ps3.serverApi.importFormula.requestImportFormulaMeta(t));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getAuthorized",value:function(){return this.authorized}},{key:"setAfterEventDataMessage",value:function(e){this.afterEventDataMessage=e}}]),e}();R([(0,l.Bind)()],w.prototype,"onImportFormulaChangedEventDataMessage",null),R([(0,l.Bind)()],w.prototype,"onAuthorizationChangedEventDataMessage",null),w=R([(0,h.Mn)({required:[c.ClJ]})],w)},vsh_97580:function(e,t,n){n.d(t,{z7:function(){return tt},PO:function(){return l},fl:function(){return u.fl},He:function(){return u.He},eF:function(){return c.eF},VT:function(){return h.VT},Hy:function(){return ot.Hy},Fw:function(){return u.Fw},EP:function(){return u.EP},Aw:function(){return d.Aw},ie:function(){return c.ie},uz:function(){return h.uz},IE:function(){return d.IE},l$:function(){return d.l$},OO:function(){return f},TV:function(){return v.T},C4:function(){return v.C},$L:function(){return U.$L},FK:function(){return U.FK},RJ:function(){return He.R},Vk:function(){return re},p4:function(){return ee},U2:function(){return rt},Dv:function(){return ae},kC:function(){return K.kC},Fm:function(){return he},M_:function(){return d.M_},XT:function(){return de.XT},YM:function(){return pe},MC:function(){return de.MC},Wc:function(){return de.Wc},ke:function(){return d.ke},VJ:function(){return h.VJ},Bz:function(){return ot.Wc},KD:function(){return h.KD},Vn:function(){return Ce},PJ:function(){return ot.PJ},XK:function(){return ot.XK},iK:function(){return Se.i},Cm:function(){return Se.C},x:function(){return xe},wt:function(){return d.wt},hM:function(){return J.hM},B_:function(){return J.B_},Qr:function(){return ot.Qr},Jz:function(){return Ue},Sb:function(){return h.Sb},iD:function(){return T},Gg:function(){return B},fS:function(){return Ie},jm:function(){return J.jm},dN:function(){return Ye},WA:function(){return Ve},dR:function(){return Ze},AM:function(){return Oe},q:function(){return Ge},c3:function(){return je.c},tx:function(){return ot.tx},$v:function(){return h.$v},wP:function(){return U.wP},fW:function(){return U.fW},sG:function(){return d.sG},vP:function(){return d.vP},_D:function(){return J._D},Sq:function(){return oe},X_:function(){return h.X_},F6:function(){return Be.F},Xz:function(){return h.Xz},YT:function(){return d.YT}});var r=n("vsh_19264"),o=n("vsh_4175"),i=n("vsh_24627"),a="longtask",s="sheet_performance_anr_dev",l=function(){function e(){(0,r.Z)(this,e),this.name="ANRWatch",this.observer=null,this.records=[],this.intervalId=1,this.intervalStartTime=0}return(0,o.Z)(e,[{key:"init",value:function(){var e=this;try{this.observer=new PerformanceObserver((function(t){var n=t.getEntries()[0];(null==n?void 0:n.entryType)===a&&(n.duration<500||(n.duration>=5e3&&e.reportSingleRecord(n),e.records.push(n.duration)))})),this.observer.observe({entryTypes:[a]}),this.timer=setInterval((function(){return e.reportMultipleRecords()}),15e3),this.intervalStartTime=performance.now()}catch(e){this.destroy()}}},{key:"reportMultipleRecords",value:function(){if(0!==this.records.length){for(var e=0,t=0,n=performance.now()-this.intervalStartTime,r=0;r<this.records.length;r++){var o=this.records[r];t+=o,e=Math.max(e,o)}i.PxA.collectSheetEvent(s,{max_anr_time:e,total_anr_time:t,interval_id:this.intervalId,interval_time:n,anr_times:this.records.length,stutter:t/n}),this.records=[],this.intervalId+=1,this.intervalStartTime=performance.now()}}},{key:"reportSingleRecord",value:function(e){i.PxA.collectSheetEvent(s,{max_anr_time:e.duration,total_anr_time:e.duration,interval_id:-1,interval_time:e.duration,anr_times:1,stutter:1})}},{key:"destroy",value:function(){var e;this.reportMultipleRecords(),clearInterval(this.timer),null===(e=this.observer)||void 0===e||e.disconnect(),this.observer=null}}]),e}(),u=n("vsh_25469"),c=n("vsh_65778"),h=n("vsh_17811"),d=n("vsh_35911"),f=function(){function e(t){(0,r.Z)(this,e),this.name="DateTimePickerPlugin",this._dateTimePickerManager=null==t?void 0:t.dateTimePickerManager}return(0,o.Z)(e,[{key:"init",value:function(e){}},{key:"destroy",value:function(){var e;null===(e=this._dateTimePickerManager)||void 0===e||e.dispose()}},{key:"isEditing",value:function(){var e;return null===(e=this._dateTimePickerManager)||void 0===e?void 0:e.isEditing()}},{key:"getEditor",value:function(){var e;return null===(e=this._dateTimePickerManager)||void 0===e?void 0:e.getDatePickerEditor()}},{key:"dateTimePickerManager",set:function(e){this._dateTimePickerManager=e},get:function(){return this._dateTimePickerManager}}]),e}(),v=n("vsh_87882"),p=n("vsh_74561"),g=n("vsh_65498"),m=n("vsh_92292"),_=n("vsh_46544"),y=n("vsh_72834"),C=n("vsh_7959"),S=[{type:"zh-fullWeeks",cycle:["星期一","星期二","星期三","星期四","星期五","星期六","星期日"]},{type:"zh-shortWeeks",cycle:["周一","周二","周三","周四","周五","周六","周日"]},{type:"en-fullWeeks",cycle:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"]},{type:"en-shortWeeks",cycle:["Mon","Tues","Wed","Thur","Fri","Sat","Sun"]},{type:"ja-fullWeeks",cycle:["日曜日","月曜日","火曜日","水曜日","木曜日","金曜日","土曜日"]},{type:"ja-shortWeeks",cycle:["日曜","月曜","火曜","水曜","木曜","金曜","土曜"]},{type:"zh-fullMonths",cycle:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"]},{type:"zh-shortMonths",cycle:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"]},{type:"en-fullMonths",cycle:["January","February","March","April","May","June","July","August","September","October","November","December"]},{type:"en-shortMonths",cycle:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}],k=n("vsh_73043"),E=function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":(0,g.Z)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},T=function(){function e(){(0,r.Z)(this,e),this.name="SheetFillPlugin",this._fillSelRangeController=null}return(0,o.Z)(e,[{key:"onSheetMount",value:function(e,t){this.registerFillDepend(e),this.initFillDataViewModel(e)}},{key:"onShellRegistered",value:function(e){e.sheetView().registerRendererFactories([C.Y6L,C.J$l])}},{key:"bindEvents",value:function(){var e,t;this._subscriber=this._sdk.spread.subscribe((0,p.Z)({},i.Fsj.AfterApply,this.handleMarkDirty)),this._subscriber.add(null===(e=this._sdk.shellManager)||void 0===e?void 0:e.subscribe((t={},(0,p.Z)(t,i.jy$.CornerMouseDown,this.handleCornerMouseDown),(0,p.Z)(t,i.jy$.CornerMouseMove,this.handleCornerMouseMove),(0,p.Z)(t,i.jy$.CornerMouseUp,this.handleCornerMouseUp),(0,p.Z)(t,i.jy$.CornerDbClick,this.handleCornerDbClick),t)))}},{key:"init",value:function(e){this._sdk=e,this.bindEvents(),this.registerCommand()}},{key:"registerCommand",value:function(){var e=this._sdk.spread;(0,_.yz)(e)}},{key:"registerFillDepend",value:function(e){var t=e.inject(y.Aog);t.registerCycleCalendars(S),t.registerCycleCalendars([{type:"fullWeeks",cycle:[k("history.date.monday"),k("history.date.tuesday"),k("history.date.wednesday"),k("history.date.thursday"),k("history.date.friday"),k("history.date.saturday"),k("history.date.sunday")]},{type:"shortWeeks",cycle:[k("LarkCCM_Common_WeekDayShort_Mon"),k("LarkCCM_Common_WeekDayShort_Tue"),k("LarkCCM_Common_WeekDayShort_Wed"),k("LarkCCM_Common_WeekDayShort_Thu"),k("LarkCCM_Common_WeekDayShort_Fri"),k("LarkCCM_Common_WeekDayShort_Sat"),k("LarkCCM_Common_WeekDayShort_Sun")]},{type:"fullMonths",cycle:[k("LarkCCM_Sheets_MonthFull_Jan"),k("LarkCCM_Sheets_MonthFull_Feb"),k("LarkCCM_Sheets_MonthFull_Mar"),k("LarkCCM_Sheets_MonthFull_Apr"),k("LarkCCM_Sheets_MonthFull_May"),k("LarkCCM_Sheets_MonthFull_Jun"),k("LarkCCM_Sheets_MonthFull_Jul"),k("LarkCCM_Sheets_MonthFull_Aug"),k("LarkCCM_Sheets_MonthFull_Sep"),k("LarkCCM_Sheets_MonthFull_Oct"),k("LarkCCM_Sheets_MonthFull_Nov"),k("LarkCCM_Sheets_MonthFull_Dec")]},{type:"shortMonths",cycle:[k("LarkCCM_Common_MonthShort_Jan"),k("LarkCCM_Common_MonthShort_Feb"),k("LarkCCM_Common_MonthShort_Mar"),k("LarkCCM_Common_MonthShort_Apr"),k("LarkCCM_Common_MonthShort_May"),k("LarkCCM_Common_MonthShort_Jun"),k("LarkCCM_Common_MonthShort_Jul"),k("LarkCCM_Common_MonthShort_Aug"),k("LarkCCM_Common_MonthShort_Sep"),k("LarkCCM_Common_MonthShort_Oct"),k("LarkCCM_Common_MonthShort_Nov"),k("LarkCCM_Common_MonthShort_Dec")]}])}},{key:"initFillDataViewModel",value:function(e){var t=e.inject(y.waE);t.setCanSkipFilterRow(!0),t.setCanSkipHiddenRow(!1)}},{key:"checkSourceRangePermission",value:function(e){var t=e.sheet();if(!t)return!0;for(var n=t.iterContent(e.rowFrom(),e.colFrom(),e.rowCount(),e.colCount(),!0),r=n.next();null!==r;r=n.next()){var o=r.formulaVar,i=null==o?void 0:o.getRefMap();if(i)for(var a=0,s=Object.values(i);a<s.length;a++){var l,u=(null===(l=s[a].sheet())||void 0===l?void 0:l.id())||"";if(!t.parent.permissionManager.hasSheetVisiblePermission(u))return!1}}return!0}},{key:"handleCornerMouseDown",value:function(e){var t=e.shell,n=e.props.glbPt,r=t.sheetView().detectTable(n);r&&(this._fillSelRangeController=new _.Re(r,this.activeSheet),this._fillSelRangeController.start(n.x,n.y))}},{key:"handleCornerMouseMove",value:function(e){e.shell;var t=e.props,n=t.glbPt,r=t.reverseAutoFill;if(this._fillSelRangeController){var o=this._fillSelRangeController.continueSel(n.x,n.y),i=this._fillSelRangeController.direction();if(null!=o&&null!=i){var a=this.activeSheet._getActiveSelectedRange();this.executeDragFill(a,o,i,r,!1)}}}},{key:"handleCornerMouseUp",value:function(e){e.shell;var t=e.props,n=t.glbPt,r=t.reverseAutoFill;if(this._fillSelRangeController){var o=this._fillSelRangeController;o.clearContinueSelTimer();var a=this.activeSheet._getActiveSelectedRange(),s=o.direction(),l=o.end(n.x,n.y);if(!l||null==s)return this.executeDragFill(a,a,y._8N.Down,r,!0),void(this._fillSelRangeController=null);this.executeDragFill(a,l,s,r,!0);var u=(0,_.WH)(a,l,s);u&&(l.rowCount()===a.rowCount()&&l.colCount()===a.colCount()||(this.checkSourceRangePermission(a)?(0,_.nT)(this.activeSheet,u,a)&&(this.executeAutoFill(a,u,s,r),this.showFillBtn(a,u,l,s),this._fillSelRangeController=null):i.Ps3.Toast.warning({content:k("LarkCCM_Sheets_Protect_SourceContainsProtected_Text")})))}}},{key:"handleCornerDbClick",value:function(){var e=new _.V$(this.activeSheet).getAutoFillRange(),t=e.type,n=e.result;switch(t){case _.lL.Range:if(!n)return;var r=n.fillRange,o=n.fillRangeType,a=this.activeSheet._getActiveSelectedRange();if(!(0,_.nT)(this.activeSheet,r,a))return;this.executeDbClickFill(a,r,o);var s=a.union(r);return void this.showFillBtn(a,r,s,y._8N.Down);case _.lL.Fail:return void i.Ps3.Toast.info({content:k("LarkCCM_Sheets_AutoFillUpgraded_EmptyFillSource_Toast")});case _.lL.Empty:var l;null===(l=i.Ps3.collectSheetEvent)||void 0===l||l.call(i.Ps3,"ccm_sheet_content_page_click",{click:"cannot_judje_fill_range_toast_view",target:"none"});var u=i.Ps3.browser.isLark?k("LarkCCM_Sheets_AutoFillUpgraded_OnboardingLink_Lark"):k("LarkCCM_Sheets_AutoFillUpgraded_OnboardingLink_Feishu");return void i.Ps3.Toast.info({content:k("LarkCCM_Sheets_CannotDetechFillRange_Toast"),actionText:k("LarkCCM_Sheets_CannotDetechFillRange_LearnMore_Button"),onActionClick:function(){var e;null===(e=i.Ps3.collectSheetEvent)||void 0===e||e.call(i.Ps3,"ccm_sheet_content_page_click",{click:"cannot_judje_fill_range_toast_click",target:"none",sub_click:"learn_more "}),i.Ps3.openSafeLink(u)}})}}},{key:"handleMarkDirty",value:function(){this.fillDataViewModel.markDirty()}},{key:"executeDragFill",value:function(e,t,n,r,o){(0,_.wM)(this.activeSheet,{sourceRange:e,dragRange:t,direction:n,dragFilled:o,reverseAutoFill:r})}},{key:"executeDbClickFill",value:function(e,t,n){(0,_.dx)(this.activeSheet,{sourceRange:e,fillRange:t,fillRangeType:n})}},{key:"executeAutoFill",value:function(e,t,n,r){(0,_.C1)(this.activeSheet,{sourceRange:e,fillRange:t,fillDirection:n,reverseAutoFill:r})}},{key:"showFillBtn",value:function(e,t,n,r){var o,a=this.fillDataViewModel.getAutoFillCalcTypeList();this.activeSheet.dispatch(i.U_F.ShowFillOptionsBtn,{calcTypeList:a,sourceRange:e,fillRange:t,entireRange:n,fillDirection:r}),null===(o=i.Ps3.collectSheetEvent)||void 0===o||o.call(i.Ps3,"ccm_sheet_content_page_click",{click:"fill_set_panel_view",target:"none"})}},{key:"destroy",value:function(){this._subscriber.unsubscribe()}},{key:"activeSheet",get:function(){return this._sdk.spread.getActiveSheet()}},{key:"fillDataViewModel",get:function(){return this.activeSheet.inject(y.waE)}}]),e}();E([(0,m.Bind)()],T.prototype,"handleCornerMouseDown",null),E([(0,m.Bind)()],T.prototype,"handleCornerMouseMove",null),E([(0,m.Bind)()],T.prototype,"handleCornerMouseUp",null),E([(0,m.Bind)()],T.prototype,"handleCornerDbClick",null),E([(0,m.Bind)()],T.prototype,"handleMarkDirty",null);var b=n("vsh_12064"),I=n("vsh_56589"),R=n("vsh_22462"),w=n("vsh_73455"),A=n("vsh_70098"),F=n("vsh_6127"),D=n.n(F),N=n("vsh_33916"),P=n("vsh_74340"),O=n("vsh_73043"),M=function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":(0,g.Z)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},L=function(e){var t;null!==(t=e.target)&&void 0!==t&&t.classList.contains("faster-single-canvas")&&e.preventDefault()},x=function(){window.addEventListener("touchmove",L,{passive:!1})},V=function(){window.removeEventListener("touchmove",L)},Z=function(e){var t,n;e.addEventFilter((function(e){var r,o;return e.type===N.FEventType.MouseDown&&(t=e.globalPoint(),n=void 0),e.type===N.FEventType.MouseUp&&(n=e.globalPoint()),e.type===N.FEventType.Click&&!!(t&&n&&(r=t,o=n,Math.sqrt(Math.pow(r.x-o.x,2)+Math.pow(r.y-o.y,2))>20))}))},B=function(e){function t(){var e;return(0,r.Z)(this,t),(e=(0,b.Z)(this,(0,R.Z)(t).apply(this,arguments))).inDragProgress=!1,e.name="SheetMobileFillPlugin",e.existDragFill=function(){if(e.fillCornerModel.mobileFilling){var t=e.activeSheet._getActiveSelectedRange();e.executeDragFill(t,t,y._8N.Down,!1,!0),e._fillSelRangeController=null,e.recoverCornerWidgetType()}},e}return(0,w.Z)(t,e),(0,o.Z)(t,[{key:"onShellRegistered",value:function(e){(0,I.Z)((0,R.Z)(t.prototype),"onShellRegistered",this).call(this,e);var n=e.sheetView();n.isEmbed||function(e){var t=Date.now();e.addEventFilter((function(e){return e.type!==N.FEventType.Tap&&e.type!==N.FEventType.PressUp&&e.type!==N.FEventType.PanEnd||(t=Date.now()),!1})),e.addListener(N.FEventType.Tap,(function(t){return e.shellWatcher.dispatch(i.jy$.ChangeToNormalCorner,{touch:!0}),!1})),e.addListener(N.FEventType.Click,(function(n){return Date.now()-t>=500&&e.shellWatcher.dispatch(i.jy$.ChangeToNormalCorner,{touch:!1}),!1}))}(n),(D().isBytedanceApp||D().isH5)&&Z(n)}},{key:"bindEvents",value:function(){var e,n,r,o,a,s,l;((0,I.Z)((0,R.Z)(t.prototype),"bindEvents",this).call(this),this._subscriber.add(null===(e=this._sdk.shellManager)||void 0===e?void 0:e.subscribe((n={},(0,p.Z)(n,i.jy$.MobileFillCornerDragStart,this.handleCornerDragStart),(0,p.Z)(n,i.jy$.MobileFillCornerDragMove,this.handleCornerDragMove),(0,p.Z)(n,i.jy$.MobileFillCornerDragEnd,this.handleCornerDragEnd),(0,p.Z)(n,i.jy$.MobileFillCornerDragCancel,this.handleCornerDragCancel),(0,p.Z)(n,i.jy$.MobileCornerDbTouch,this.handleCornerDbTouch),(0,p.Z)(n,i.jy$.ChangeToNormalCorner,this.handleChangeToNormalCorner),(0,p.Z)(n,i.jy$.ChangeToFillCorner,this.handleChangeToFillCorner),n))),this._subscriber.add(null===(r=this._sdk)||void 0===r?void 0:r.spread.subscribe((o={},(0,p.Z)(o,i.U_F.SelectionChanged,this.handleActiveStatusChange),(0,p.Z)(o,i.U_F.ActiveCellChanged,this.handleActiveStatusChange),(0,p.Z)(o,i.HaZ.ActiveSheetChanged,this.handleActiveStatusChange),o))),D().isPcWeb)&&(null===(a=this._sdk)||void 0===a||a.spread._context.bind(P.YVA.ENTER_FULL_SCREEN_MODE,x),null===(s=this._sdk)||void 0===s||s.spread._context.bind(P.YVA.EXIT_FULL_SCREEN_MODE,V),(null===(l=this._sdk)||void 0===l?void 0:l.spread._context.isEmbed())||x())}},{key:"destroy",value:function(){var e,n;(0,I.Z)((0,R.Z)(t.prototype),"destroy",this).call(this),null===(e=this._sdk)||void 0===e||e.spread.unbind(P.YVA.ENTER_FULL_SCREEN_MODE,x),null===(n=this._sdk)||void 0===n||n.spread.unbind(P.YVA.EXIT_FULL_SCREEN_MODE,V),V()}},{key:"handleCornerDragStart",value:function(e){this.inDragProgress=!0,(0,I.Z)((0,R.Z)(t.prototype),"handleCornerMouseDown",this).call(this,e)}},{key:"handleCornerDragMove",value:function(e){this.inDragProgress&&(0,I.Z)((0,R.Z)(t.prototype),"handleCornerMouseMove",this).call(this,e)}},{key:"handleCornerDragEnd",value:function(e){this.inDragProgress=!1,this.fillSelRangeModel.selRange!==this.activeSheet._getActiveSelectedRange()&&(this.handleCornerMouseUp(e),this.recoverCornerWidgetType())}},{key:"handleCornerDragCancel",value:function(){this.inDragProgress=!1,this.existDragFill()}},{key:"handleCornerDbTouch",value:function(){var e=new _.V$(this.activeSheet).getAutoFillRange(),t=e.type,n=e.result;switch(t){case _.lL.Range:if(!n)return;var r=n.fillRange,o=n.fillRangeType,a=this.activeSheet._getActiveSelectedRange();if(!(0,_.nT)(this.activeSheet,r,a))return;this.executeDbClickFill(a,r,o);var s=a.union(r);this.showFillBtn(a,r,s,y._8N.Down);break;case _.lL.Fail:i.Ps3.Toast.info({content:O("LarkCCM_Sheets_AutoFillUpgraded_EmptyFillSource_Toast")});break;case _.lL.Empty:var l;null===(l=i.Ps3.collectSheetEvent)||void 0===l||l.call(i.Ps3,"ccm_sheet_content_page_click",{click:"cannot_judje_fill_range_toast_view",target:"none"})}this.existDragFill()}},{key:"handleChangeToNormalCorner",value:function(e){this.changeToNormalCorner(e.props.touch)}},{key:"handleChangeToFillCorner",value:function(){this.changeToFillCorner()}},{key:"handleActiveStatusChange",value:function(){this.existDragFill()}},{key:"changeCornerWidgetType",value:function(e){if(this.fillCornerModel.setCornerType(e),this.fillCornerModel.mobileFilling){var t=this.activeSheet._getActiveSelectedRange();this.executeDragFill(t,t,y._8N.Down,!1,!1)}else if(this.fillSelRangeModel.selRange){var n=this.fillSelRangeModel.selRange;this.executeDragFill(n,n,y._8N.Down,!1,!0)}}},{key:"recoverCornerWidgetType",value:function(){var e=this.fillCornerModel.mobileFilling,t=this.fillCornerModel.preCornerType;e&&((0,A.Z)(t)?this.changeToNormalCorner(e):this.changeCornerWidgetType(t))}},{key:"changeToNormalCorner",value:function(e){var t;t=e?i.LN0.CIRCLE_CORNER_V2:i.LN0.NORMAL_CORNER_V2,this.changeCornerWidgetType(t)}},{key:"changeToFillCorner",value:function(){this.changeCornerWidgetType(i.LN0.MOBILE_FILL_CORNER)}},{key:"fillSelRangeModel",get:function(){return this.activeSheet.inject(y.Wph)}},{key:"fillCornerModel",get:function(){return this.activeSheet.inject(y.uTF)}}]),t}(T);M([(0,m.Bind)()],B.prototype,"handleCornerDragStart",null),M([(0,m.Bind)()],B.prototype,"handleCornerDragMove",null),M([(0,m.Bind)()],B.prototype,"handleCornerDragEnd",null),M([(0,m.Bind)()],B.prototype,"handleCornerDragCancel",null),M([(0,m.Bind)()],B.prototype,"handleCornerDbTouch",null),M([(0,m.Bind)()],B.prototype,"handleChangeToNormalCorner",null),M([(0,m.Bind)()],B.prototype,"handleChangeToFillCorner",null),M([(0,m.Bind)()],B.prototype,"handleActiveStatusChange",null);var H,U=n("vsh_8892"),j=n("vsh_49218"),G=n("vsh_26571"),K=n("vsh_98617"),W=n("vsh_40285"),z=function(){function e(t){(0,r.Z)(this,e),this.options=t}return(0,o.Z)(e,[{key:"funcsNavigateUp",value:function(){var e=this.functionHelper;e&&e.funcsNavigateUp()}},{key:"funcsNavigateDown",value:function(){var e=this.functionHelper;e&&e.funcsNavigateDown()}},{key:"openFunctionList",value:function(){var e=this.functionHelper;if(e){var t=this.options.getTokens();if(0===t.length||this.options.isAppending())this.closeFunctionList();else{var n=this.options.getSelection().end,r=K.kC.getToken(t,n);if(r){var o=this.options.getCompletionInfos();K.kC.isNameNode(r)?(e.showFunctionList(o,r.image),this.position()):this.closeFunctionList()}else this.closeFunctionList()}}}},{key:"closeFunctionList",value:function(){var e=this.functionHelper;if(e){var t=this.options.getText(),n=K.kC.isFormula(t);this.position(),n?e.showFunctionList([],""):e.close(!1)}}},{key:"closeFunctionHelper",value:function(e){var t;null===(t=this.functionHelper)||void 0===t||t.close(e)}},{key:"getPosition",value:function(){var e=this.options.getFixedFunctionHelperPosition();if(e)return e;var t=this.options.getHost();if(!t)return{top:0,left:0};var n,r=parseFloat(t.style.top),o=parseFloat(t.style.left),i=t.offsetHeight,a=t.getBoundingClientRect();(isNaN(r)||isNaN(o))&&(isNaN(r)&&(r=a.top),isNaN(o)&&(o=a.left,n=!0));var s=r+i,l=this.functionHelper.getContainer(),u=l.offsetHeight,c=document.body.offsetHeight;if(a.top+i+u>c){var h=r-u;if(h>=0)s=h;else{var d=t.firstChild;s=r+i/2+((null==d?void 0:d.offsetHeight)||0)/2}}var f=l.offsetWidth;if(o+f>document.body.offsetWidth){var v=o+t.offsetWidth-f;v>=0&&(o=v)}return{top:s,left:o,isRectValueAsLeft:n}}},{key:"position",value:function(){if(this.options.isAIRangeSelecting()||this.options.canShowFunctionHelper()){var e=this.functionHelper;if(e){var t=this.options.getHost();if(t){var n=this.getPosition(),r=n.top,o=n.left,i=n.isRectValueAsLeft;e.position(r,o,{cellHeight:t.offsetHeight},i)}}}else this.closeFunctionHelper()}},{key:"completeFunc",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.functionHelper;if(null===e&&(e=r&&r.getActiveFunc()),e){this.collectEvent();var o=K.kC.getToken(this.options.getTokens(),this.options.getSelection().end),i=o?o.startOffset:0,a=o?o.endOffset:0,s=this.options.getActiveCellStyle(),l=0,u=new W.I;if(t)l=a+e.name.length+3,u.retain(a+2).insert(e.name+"(",s);else{var c;l=i+1+e.name.length+1;var h=e.name+(n?"":"(");u.retain(i+1).delete(null!==(c=null==o?void 0:o.image.length)&&void 0!==c?c:0).insert(h,s)}this.options.applyContentState(u),this.options.setCaret(l),this.closeFunctionList(),this.options.focusEditor(),this.openFunctionDeclaration()}}},{key:"completeFormulaText",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!(e.length<=0)||null!=n&&K.kC.isNameNode(n)){var r=this.options.getActiveCellStyle(),o=n?n.startOffset:0,i=0,a=new W.I;a.retain(o+1).delete(null!==(t=null==n?void 0:n.image.length)&&void 0!==t?t:0).insert(e,r),i=o+e.length+2,this.options.applyContentState(a),this.options.setCaret(i),this.closeFunctionList(),this.options.focusEditor(),this.openFunctionDeclaration()}}},{key:"isFuncsShown",value:function(){var e=this.functionHelper;return!!e&&e.isFuncsShown()}},{key:"handleKeydown",value:function(e){var t=e.ctrlKey,n=e.shiftKey,r=e.altKey,o=e.metaKey,a=t||n||r||o,s=e.keyCode;if(!a&&this.isFuncsShown()){if(s===i.VDZ.Down)return this.funcsNavigateDown(),!0;if(s===i.VDZ.Up)return this.funcsNavigateUp(),!0;if(s===i.VDZ.Tab||s===i.VDZ.Enter)return this.completeFunc(),!0}return s===i.VDZ.Esc&&this.closeFunctionList(),!1}},{key:"openFunctionDeclaration",value:function(){var e=this.functionHelper;if(e)if(this.options.isAppending())this.closeFunctionDeclaration();else{var t=this.options.getSignatureHelp();if(t.length){var n=t[0],r=this.options.getText();e.showFunctionDeclaration(r,n),this.position()}else this.closeFunctionDeclaration()}}},{key:"closeFunctionDeclaration",value:function(){var e=this.functionHelper;e&&e.showFunctionDeclaration(this.options.getText(),null)}},{key:"collectEvent",value:function(){var e=this.functionHelper,t=this.options.getSheet();if(e&&e.isFuncsShown()){var n=e&&e.getCurrentActiveInfo();n&&(i.Ps3.collectSuiteEvent("Function_prompt",{action:"click_function_result",source:"body",eventType:"click",result_rank:n.index+1,object_id:t&&t.id()}),n.isCorrectResult&&n.func&&i.Ps3.collectSuiteEvent("sheet_opration_for_AI",{action:"collect_formula",source:"body",error_keyword:n.keyword,correct_keyword:n.func.name,result_rank:n.index+1,object_id:t&&t.id()}))}}},{key:"functionHelper",get:function(){return this.options.getFunctionHelper()}}]),e}(),Y=n("vsh_88177"),J=n("vsh_20680"),q=n("vsh_85784"),$=[y.nzm.LocalReferenceR1C1,y.nzm.ExternalReferenceR1C1,y.nzm.LocalReferenceA1,y.nzm.ExternalReferenceA1],X=function(){function e(){(0,r.Z)(this,e),this.isAiFuncEditorFocus=!1,this.colorInfos=[],this.activeRangeIndex=0,this.isRangeSelecting=!1,this.shouldShowTips=!1,this.getText=function(){return""}}return(0,o.Z)(e,[{key:"setAiFuncEditorStatus",value:function(e){this.isAiFuncEditorFocus=e}},{key:"generateAiRangeInfos",value:function(e,t,n){for(var r,o=[],i={ref:n.getRef()||(null===(r=n.workbook.getActiveSheet())||void 0===r?void 0:r.getSelections()[0]),spread:n.workbook},a=0;a<e.length;a++){var s=e[a];if(s.tokenType&&$.includes(s.tokenType)){var l=s.range.start.character,u=s.range.end.character,c=t.slice(l,u+1),h=(0,y.gxr)(c,i);h&&!h.isError()&&o.push({range:h,text:c,color:s.hex,start:l,stop:u,token:s.token})}}return o}},{key:"isActiveRange",value:function(e){return e===this.activeRangeIndex}},{key:"setActiveRange",value:function(e){this.activeRangeIndex=e}},{key:"reset",value:function(){this.activeRangeIndex=0,this.isRangeSelecting=!1,this.colorInfos=[],this.isAiFuncEditorFocus=!1,this.shouldShowTips=!1}}]),e}(),Q=function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":(0,g.Z)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},ee="FormulaLanguageServicePlugin";!function(e){e.Show="show",e.Hidden="hidden"}(H||(H={}));var te=[J.hM.NAVIGATION_BOTTOM,J.hM.NAVIGATION_DOWN,J.hM.NAVIGATION_END,J.hM.NAVIGATION_END_2,J.hM.NAVIGATION_HOME,J.hM.NAVIGATION_HOME_2,J.hM.NAVIGATION_LEFT,J.hM.NAVIGATION_RIGHT,J.hM.NAVIGATION_TOP,J.hM.NAVIGATION_UP,J.hM.CANCEL_INPUT];function ne(e){return function(t,n,r){var o=r.value;return r.value=function(){var t=this;if(null==t.activeEditor)return e;for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return o.apply(t,r)},r}}var re=function(){function e(){var t=this;(0,r.Z)(this,e),this.isFocusOnFormulaBar=!1,this.name=ee,this.subscriber=null,this.shellSubscriber=null,this.editorStatus=Y.I9.IDLE,this.acrossSheet=null,this.editorSelection={start:0,end:0},this.editorContent="",this.onEndEdit=function(){t.reset()},this.onActiveSheetChanged=function(e){var n=e.newSheet;if(t.acrossSheet){var r,o;if(null===(r=e.oldSheet)||void 0===r||r._loadAndSetSheetSelections(),n===t.acrossSheet)t.acrossSheet=null,null===(o=t.sdk.getPlugin("CellEditorPlugin"))||void 0===o||o.setEditorStatus(e.newSheet,{status:Y.I9.EDIT});else n._saveAndClearSheetSelections();var i=t.sdk.getPlugin("FormulaBarPlugin");if(i){var a,s=(null===(a=t.sdk.pluginStore.getState("FormulaLanguageServicePlugin"))||void 0===a?void 0:a.editorSelection)||null;t.sdk.pluginStore.commit("FormulaLanguageServicePlugin/updateActiveEditor",i.getEditor()),s&&setTimeout((function(){i.focusOnEditor(s.toPosition()),t.isFocusOnFormulaBar=!0}))}t.handleRangeInfosUpdated(t.formulaText.getRangeInfos()),t.spread.getActiveSheet().notifyShell(y._16.FormulaTextBoxCaretChanged,{})}else t.onActiveCellChanged({sheetId:n.id(),row:n._activeRowIndex,col:n._activeColIndex})},this.onActiveCellChanged=function(e){var n=e.row,r=e.col,o=e.sheetId,i=t.sdk.spread.getSheetFromId(o),a=t.sdk.spread.getActiveSheet();if(a&&!t.aiFunctionHelper.isRangeSelecting&&o===a.id()){t.formulaText.setRef(new y.e6w(n,r,1,1,i));var s=K.kC.getEditText(i,n,r);t.formulaText.setText(s)}},this.onBeforeActiveSheetChange=function(e){var n,r=t.sdk.getPlugin("DataLoaderPlugin");if(null===t.acrossSheet&&t.canAppendRange()&&null!=r&&r.isSheetLoaded(e.newSheet.id()))return t.isFocusOnFormulaBar=!1,t.closeFunctionHelper(),t.acrossSheet=e.oldSheet,void(null===(n=t.sdk.getPlugin("CellEditorPlugin"))||void 0===n||n.setEditorStatus(e.oldSheet,{status:Y.I9.HIDDEN}))},this.onContentChange=function(){if(t.editorStatus===Y.I9.IDLE){var e=t.sdk.spread.getActiveSheet();if(!e)return;var n=e._activeRowIndex,r=e._activeColIndex;if(void 0===n||void 0===r)return;var o=K.kC.getEditText(e,n,r);t.formulaText.setText(o)}},this.handleEditorRectChanged=function(){t.formulaFunctionHelper.position()},this.handleEditorStatusChange=function(e){if(t.editorStatus=e,e===Y.I9.IDLE&&(t.editorContent="",t.onEndEdit()),[Y.I9.EDIT,Y.I9.SUMMARY].includes(e)){if(e===Y.I9.EDIT){var n=t.formulaText.getRangeInfos();n.length&&(t.handleRangeInfosUpdated(n),t.spread.getActiveSheet().notifyShell(y._16.FormulaTextBoxCaretChanged,{}));var r=t.formulaText.getFormulaHighlightInfos();r.length&&t.handleFormulaBracketMatching(r)}var o=t.formulaText.getColorInfos();o.length&&t.handleFormulaColor(o)}},this.handleActiveEditorChanged=function(e,n){var r,o;e!==n&&(null==e||null===(r=e.editorCommand)||void 0===r||r.clearEditorContentHighlight(),null==n||null===(o=n.editorCommand)||void 0===o||o.clearEditorContentHighlight(),t.closeFunctionHelper())},this.closeFunctionHelper=function(){t.aiFunctionHelper.isRangeSelecting||t.formulaFunctionHelper.closeFunctionHelper()},this.handleEditorContentChange=function(){var e,n=t.activeEditor;if(n){var r=null===(e=n.editorCommand)||void 0===e?void 0:e.getEditorText();if(r){if(t.formulaText.setText(r),t.editorContent===r)return;t.editorContent=r}}},this.handleEditorSelectionChange=function(e){var n=t.activeEditor;if(n){var r,o=null===(r=n.editor)||void 0===r?void 0:r.getContentState().getActiveZone();if(o){var i,a,s=null!==(i=o.pointToOffset(e.start))&&void 0!==i?i:0,l=null!==(a=o.pointToOffset(e.end))&&void 0!==a?a:0;t.editorSelection.start===s&&t.editorSelection.end===l||t.formulaText.setSelection(s),t.editorSelection={start:s,end:l}}}},this.handleEditorClick=function(){t.formulaCommand.reset()},this.handleKeydown=function(e){if(t.formulaCommand.handleKeydown(e))return e.stopPropagation(),e.stopEvent(),e.preventDefault(),!0;if(t.formulaFunctionHelper.handleKeydown(e))return e.keyCode!==i.VDZ.Tab&&e.keyCode!==i.VDZ.Enter||(t.aiFunctionHelper.shouldShowTips=!0),e.stopEvent(),e.stopPropagation(),e.preventDefault(),!0;if(t.acrossSheet){var n,r,o=(0,J.aK)(e.nativeEvent,null===(n=t.sdk)||void 0===n?void 0:n.getPlugin(J.B_));if(o&&te.includes(null==o?void 0:o.fnName))return t.switchBackToOriginSheet(t.acrossSheet),null===(r=t.sdk.getPlugin(J.B_))||void 0===r||r.handleKeydown(e.nativeEvent),!0}return!1},this.handleClick=function(e){t.formulaCommand.handleClick(e)},this.onUpdateFormularSelectionModel=function(e){var n=e.props,r=t.sdk.spread.getActiveSheet(),o=n.formulaSelectionModel;t.handleFormularSelectionModelUpdated(r,o,t.formulaText.getRangeInfos())},this.setSelectionByOffset=function(e,n){var r,o;null===(r=t.activeEditor)||void 0===r||null===(o=r.getEditor())||void 0===o||o.once("paint",(function(){var r,o;null===(r=t.activeEditor)||void 0===r||null===(o=r.editorCommand)||void 0===o||o.setSelectionByOffset(e,n)}))},this.setText=function(e,n){var r,o;null===(r=t.activeEditor)||void 0===r||null===(o=r.editorCommand)||void 0===o||o.replaceAllText(e)},this.focus=function(){var e,n;null===(e=t.activeEditor)||void 0===e||null===(n=e.editorCommand)||void 0===n||n.focus()},this.applyContentState=function(e,n){var r,o;null===(r=t.activeEditor)||void 0===r||null===(o=r.editorCommand)||void 0===o||o.applyContentState(e,n)},this.getActiveCellStyle=function(){var e=t.acrossSheet||t.sdk.spread.getActiveSheet();if(e){var n=e.getActiveCellStyle();return(0,y.$go)(n)}return{}},this.getFixedFunctionHelperPosition=function(){var e=t.activeEditor;return"formula_bar"===(null==e?void 0:e.source)?{top:0,left:42}:null},this.getEditorHost=function(){var e,n;return null!==(e=null===(n=t.activeEditor)||void 0===n?void 0:n.container)&&void 0!==e?e:null},this.canShowFunctionHelper=function(){if(null!==t.acrossSheet)return!1;if(t.editorStatus!==Y.I9.EDIT)return!1;var e=t.formulaText.getText();return!!K.kC.isFormula(e)&&null===t.formulaCommand.getAppendingRange()},this.getFunctionHelper=function(){var e=t.sdk.spread;return e.getActiveSheet()._functionHelper||e._functionHelper||null},this.setSelectionHook=function(e,n){var r=n.sheet,o=n.endCell;n.editMode===C.djl.extend&&o&&t.formulaCommand.appendingRangeStartPoint?e=t.formulaCommand.appendingRangeStartPoint.union(new y.e6w(o.row,o.col,1,1,r)):1===e.rowCount()&&1===e.colCount()&&(t.formulaCommand.appendingRangeStartPoint=e);return t.tryAppendRange(e,G.F7.Set)},this.addSelectionHook=function(e){return t.tryAppendRange(e,G.F7.Append)},this.setActiveCellHook=function(){return!t.canAppendRange()},this.clearSelectionHook=function(){return t.tryAppendRange(null,G.F7.Clear)},this.setExpandSelectedRangeHook=function(e){return t.tryAppendRange(e,G.F7.Modify)},this.setCellSelection=function(e){if(e){var n=t.sdk.spread.getActiveSheet().getSpans(e);if(n&&1===n.length&&n[0].contain(e)){var r=n[0];e=new y.luK(r.rowFrom(),r.colFrom(),r.sheet())}}return e}}return(0,o.Z)(e,[{key:"getAcrossSheet",value:function(){return this.acrossSheet}},{key:"init",value:function(e){this.sdk=e,this.initComponent(),this.initStore(),this.bindEvents(),this.setHooks()}},{key:"destroy",value:function(){this.unbindEvents(),this.removeHooks()}},{key:"initComponent",value:function(){var e=this;this.formulaText=new K.kC(this.sdk.spread,{onUpdateRangeInfos:this.handleRangeInfosUpdated.bind(this),onUpdateColorInfos:this.handleFormulaColor.bind(this),onUpdateDocumentHighlightInfos:this.handleFormulaBracketMatching.bind(this),onUpdateCompletionInfos:this.handleCompletionInfosUpdated.bind(this),onUpdateSignatureHelp:this.handleFormulaSignatureHelp.bind(this),onUpdateRecommendArrayFormulaStatus:this.handleUpdateRecommendArrayFormulaStatus.bind(this),getRecommendArrayFormulaStatus:this.getRecommendArrayFormulaStatus.bind(this),dispatchEvent:this.dispatchEvent.bind(this)}),this.formulaCommand=new G.$_({getSelection:function(){return e.editorSelection},setCaret:this.setSelectionByOffset,setText:this.setText,applyContentState:this.applyContentState,getTokens:this.formulaText.getTokens.bind(this.formulaText),getRef:this.formulaText.getRef.bind(this.formulaText),canAppendRange:this.formulaText.canAppendRange.bind(this.formulaText),getText:this.formulaText.getText.bind(this.formulaText),getRangeInfos:this.formulaText.getRangeInfos.bind(this.formulaText),getFormulaTextColorInfos:this.formulaText.getColorInfos.bind(this.formulaText),getFormulaTextHighlightInfos:this.formulaText.getFormulaHighlightInfos.bind(this.formulaText),isFuncsShown:function(){return!1},isAcrossSheet:function(){return null!==e.acrossSheet},getSheet:function(){return e.sdk.spread.getActiveSheet()},updateRangeInfosWhenStopAppending:this.handleRangeInfosUpdated.bind(this),getActiveCellStyle:this.getActiveCellStyle,sdk:this.sdk}),this.aiFunctionHelper=new X,this.formulaFunctionHelper=new z({getText:this.formulaText.getText.bind(this.formulaText),getTokens:this.formulaText.getTokens.bind(this.formulaText),getCompletionInfos:this.formulaText.getFormulaCompletionInfos.bind(this.formulaText),getSignatureHelp:this.formulaText.getSignatureHelp.bind(this.formulaText),getSelection:function(){return e.editorSelection},setText:this.setText,setCaret:this.setSelectionByOffset,focusEditor:this.focus,getFixedFunctionHelperPosition:this.getFixedFunctionHelperPosition,getSheet:function(){return e.sdk.spread.getActiveSheet()},getHost:this.getEditorHost,getFunctionHelper:this.getFunctionHelper,canShowFunctionHelper:this.canShowFunctionHelper,applyContentState:this.applyContentState,getActiveCellStyle:this.getActiveCellStyle,isAIRangeSelecting:function(){return e.aiFunctionHelper.isRangeSelecting},isAppending:function(){return e.formulaCommand.isAppending}})}},{key:"initStore",value:function(){this.sdk.pluginStore.registerModule(j.u_)}},{key:"getDepends",value:function(){var e;return e={},(0,p.Z)(e,i.HaZ.ActiveSheetChanged,this.onActiveSheetChanged),(0,p.Z)(e,i.Fsj.AfterApply,this.onContentChange),(0,p.Z)(e,i.HaZ.BeforeActiveSheetChange,this.onBeforeActiveSheetChange),(0,p.Z)(e,i.U_F.ActiveCellChanged,this.onActiveCellChanged),(0,p.Z)(e,i.HaZ.PivotTableRerender,this.onContentChange),(0,p.Z)(e,i.U_F.PermissionChanged,this.onContentChange),e}},{key:"getShellDepends",value:function(){return(0,p.Z)({},i.jy$.ActiveSheetViewChange,this.onUpdateFormularSelectionModel)}},{key:"setHooks",value:function(){var e=this.spread;e.apiHookManager.setHook(y.vms.setSelection,this.setSelectionHook,10),e.apiHookManager.setHook(y.vms.addSelection,this.addSelectionHook,10),e.apiHookManager.setHook(y.vms.setActiveCell,this.setActiveCellHook,10),e.apiHookManager.setHook(y.vms.expandSelectedRange,this.setExpandSelectedRangeHook,10),e.apiHookManager.setHook(y.vms.clearSelection,this.clearSelectionHook,10)}},{key:"removeHooks",value:function(){var e=this.spread;e.apiHookManager.removeHook(y.vms.setSelection,this.setSelectionHook),e.apiHookManager.removeHook(y.vms.addSelection,this.addSelectionHook),e.apiHookManager.removeHook(y.vms.setActiveCell,this.setActiveCellHook),e.apiHookManager.removeHook(y.vms.expandSelectedRange,this.setExpandSelectedRangeHook),e.apiHookManager.removeHook(y.vms.clearSelection,this.clearSelectionHook)}},{key:"bindEvents",value:function(){var e;this.unbindEvents(),this.subscriber=this.sdk.spread.subscribe(this.getDepends()),this.shellSubscriber=null===(e=this.sdk.shellManager)||void 0===e?void 0:e.subscribe(this.getShellDepends()),this.sdk.pluginStore.watch("CellEditorStore/editorStatus",this.handleEditorStatusChange),this.sdk.pluginStore.watch("CellEditorStore/editorRect",this.handleEditorRectChanged),this.sdk.pluginStore.watch("FormulaLanguageServicePlugin/editorSelection",this.handleEditorSelectionChange),this.sdk.pluginStore.watch("FormulaLanguageServicePlugin/editorContent",this.handleEditorContentChange),this.sdk.pluginStore.watch("FormulaLanguageServicePlugin/activeEditor",this.handleActiveEditorChanged)}},{key:"unbindEvents",value:function(){var e,t;null===(e=this.subscriber)||void 0===e||e.unsubscribe(),null===(t=this.shellSubscriber)||void 0===t||t.unsubscribe(),this.sdk.pluginStore.unWatch("CellEditorStore/editorStatus",this.handleEditorStatusChange),this.sdk.pluginStore.unWatch("CellEditorStore/editorRect",this.handleEditorRectChanged),this.sdk.pluginStore.unWatch("FormulaLanguageServicePlugin/editorSelection",this.handleEditorSelectionChange),this.sdk.pluginStore.unWatch("FormulaLanguageServicePlugin/editorContent",this.handleEditorContentChange),this.sdk.pluginStore.unWatch("FormulaLanguageServicePlugin/activeEditor",this.handleActiveEditorChanged)}},{key:"switchBackToOriginSheet",value:function(e){var t=this.sdk.spread,n=t.getSheetIndex(e.name());n!==t.getActiveSheetIndex()&&t._setActiveSheetIndexImp(n)}},{key:"shouldBreakEndEditBeforeActiveSheetChange",value:function(){return!!this.aiFunctionHelper.isRangeSelecting||(null!==this.acrossSheet||!!this.canAppendRange())}},{key:"shouldBreakStartEdit",value:function(){return null!==this.acrossSheet}},{key:"canAppendRange",value:function(){var e,t=this.sdk.spread.getActiveSheet();if(!(null===(e=this.sdk.getPlugin("CellEditorPlugin"))||void 0===e?void 0:e.isEditing(t))&&!this.acrossSheet)return!1;var n=this.formulaCommand,r=this.formulaText,o=this.editorSelection.end;return!(null===n.getAppendingRange()&&!r.canAppendRange(o)&&!this.aiFunctionHelper.isRangeSelecting)}},{key:"setFormulaText",value:function(e){this.formulaText.setText(e)}},{key:"reset",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.acrossSheet=null,this.isFocusOnFormulaBar=!1,this.closeFunctionHelper(),this.formulaCommand.reset(),e&&this.aiFunctionHelper.reset()}},{key:"handleCompletionInfosUpdated",value:function(){this.formulaFunctionHelper.openFunctionList()}},{key:"handleFormulaSignatureHelp",value:function(){this.formulaFunctionHelper.openFunctionDeclaration()}},{key:"handleRangeInfosUpdated",value:function(e){var t=this;e||(e=this.formulaText.getRangeInfos()),this.sdk.shellForEach((function(n){var r=n.sheetView().sheet(),o=n.sheetView().getFormularSelectionModel();t.handleFormularSelectionModelUpdated(r,o,e)}))}},{key:"handleFormularSelectionModelUpdated",value:function(e,t,n){if(n||(n=this.formulaText.getRangeInfos()),t){var r=[];if(0===n.length)return t.updateFormular(r),void(null==e||e.notifyShell(y._16.FormulaTextBoxCaretChanged,{}));for(var o=this.formulaCommand,i=n.length,a=o.getAppendingRange(),s=null!==a&&a.sheet()===e,l=([Y.I9.EDIT,Y.I9.HIDDEN].includes(this.editorStatus)||!1)&&!this.aiFunctionHelper.isAiFuncEditorFocus,u=0;u<i;u++){var c=n[u],h=c.range;h.sheet()===e&&(r.push({rg:h,color:c.color,token:c.token,isAppending:!l||o.isAppendingRange(c),isActive:l?o.isActiveRange(c):this.aiFunctionHelper.isActiveRange(u),idx:u}),s&&h.equal(a)&&(s=!1))}s&&r.push({rg:a,color:(0,C.wOx)(q.c[i%q.c.length]),token:q.c[i%q.c.length],isAppending:!0,isActive:!0,idx:i}),t.updateFormular(r),null==e||e.notifyShell(y._16.FormulaTextBoxCaretChanged,{})}}},{key:"handleFormulaColor",value:function(e){var t=this.activeEditor;if(t){var n,r=this.formulaText.getText(),o=null===(n=t.editorCommand)||void 0===n?void 0:n.getEditorText();if(r!==o)return;if(K.kC.isFormula(o)){var i=this.formulaCommand.getHighlightFormulaDelta(r,e);i&&this.applyContentState(i,{nonundoable:!0})}}this.sdk.pluginStore.commit("FormulaLanguageServicePlugin/updateFormulaColorInfos",e)}},{key:"handleFormulaBracketMatching",value:function(e){var t,n=this.activeEditor,r=this.formulaText.getText(),o=null===(t=n.editorCommand)||void 0===t?void 0:t.getEditorText();if(r===o&&K.kC.isFormula(o)){var i=this.formulaCommand.getFormulaBracketMatchingDelta(r,e);i&&this.applyContentState(i,{nonundoable:!0})}}},{key:"tryAppendRange",value:function(e,t){var n,r,o,a=this;if(this.aiFunctionHelper.isRangeSelecting)return!0;var s=this.formulaCommand;if(null!==(n=this.activeEditor)&&void 0!==n&&null!==(r=n.editor)&&void 0!==r&&null!==(o=r.isFocus)&&void 0!==o&&o.call(r)&&this.aiFunctionHelper.setAiFuncEditorStatus(!1),this.aiFunctionHelper.isAiFuncEditorFocus){e=this.setCellSelection(e);var l=s.rangeToString(e);return l=(0,i.gAR)(l),this.aiFunctionHelper.addRange(l),!1}if(this.canAppendRange())return e=this.setCellSelection(e),s.appendRange(e,t),setTimeout((function(){a.focusOnEditor()})),!1;if(this.isAcrossSheet){var u,c=this.acrossSheet;return this.switchBackToOriginSheet(c),null===(u=this.sdk.getPlugin("CellEditorPlugin"))||void 0===u||u.endEdit({sheet:c}),!1}return!0}},{key:"focusOnEditor",value:function(){var e,t,n=this.activeEditor;n&&(null===(e=n.editorCommand)||void 0===e||e.focus(),null===(t=n.editorCommand)||void 0===t||t.updateBrowserSelectionFromRep())}},{key:"formulaHighlightHtml",value:function(e){var t=this.formulaText.getColorInfos();if(0===t.length)return this.normalText(e);for(var n=0,r=this.normalText(e.substring(0,1)),o=0;o<t.length;o++){var i=t[o],a=i.hex,s=i.range.start.character;s>n+1&&(r+=this.normalText(e.substring(n+1,s)));var l=i.range.end.character;n=l;var u=e.slice(s,l+1);a?r+=this.colorText(u,a):r+=this.normalText(u)}return n!==e.length-1&&(r+=this.normalText(e.slice(n+1))),r}},{key:"normalText",value:function(e){return'<span class="gcsj-func-normal-text">'.concat(y.E6s._escapeHtml(e),"</span>")}},{key:"colorText",value:function(e,t){var n=K.DQ[t]||t;return'<span class="gcsj-func-color-text" style="color: '.concat(n,'">').concat(y.E6s._escapeHtml(e),"</span>")}},{key:"updateActiveEditor",value:function(e){this.sdk.pluginStore.commit("FormulaLanguageServicePlugin/updateActiveEditor",e)}},{key:"getRecommendArrayFormulaStatus",value:function(){var e;return null===(e=this.sdk.pluginStore.getState("FormulaLanguageServicePlugin"))||void 0===e?void 0:e.recommendArrayFormulaStatus}},{key:"handleUpdateRecommendArrayFormulaStatus",value:function(e){this.sdk.pluginStore.commit("FormulaLanguageServicePlugin/updateRecommendedArrayFormulaStatus",e)}},{key:"dispatchEvent",value:function(e){var t="FormulaLanguageServicePlugin/".concat(e);this.sdk.pluginStore.dispatchEvent(t)}},{key:"handleNeedRecommendArrayFormula",value:function(){return this.formulaText.handleNeedRecommendArrayFormula(this.sdk.spread.getActiveSheet())}},{key:"initRecommendArrayFormulaStatus",value:function(){return this.formulaText.initRecommendArrayFormulaStatus()}},{key:"processRecommendArrayFormulaStatus",value:function(){return this.formulaText.processRecommendArrayFormulaStatus()}},{key:"completeRecommendArrayFormulaStatus",value:function(){return this.formulaText.completeRecommendArrayFormulaStatus()}},{key:"handleCSEKeyInArrayFormula",value:function(){return this.formulaCommand.handleCSEKeyInArrayFormula()}},{key:"activeEditor",get:function(){var e;return null===(e=this.sdk.pluginStore.getState("FormulaLanguageServicePlugin"))||void 0===e?void 0:e.activeEditor}},{key:"spread",get:function(){return this.sdk.spread}},{key:"isAcrossSheet",get:function(){return null!==this.acrossSheet}}]),e}();Q([ne(!1)],re.prototype,"canAppendRange",null),Q([(0,m.Debounce)(50,{trailing:!0})],re.prototype,"handleFormulaColor",null),Q([(0,m.Debounce)(50,{trailing:!0}),ne()],re.prototype,"handleFormulaBracketMatching",null);var oe=function(e){return e.getPlugin("FormulaLanguageServicePlugin")},ie="FormulaSSCPlugin",ae=function(){function e(){(0,r.Z)(this,e),this.name=ie,this.subscriber=null,this.spreadEventHandlers=(0,p.Z)({},i.Fsj.BeforeApply,this.handleBeforeActionsApply.bind(this))}return(0,o.Z)(e,[{key:"init",value:function(e){this.sdk=e,this.subscriber=e.spread.subscribe(this.spreadEventHandlers)}},{key:"handleBeforeActionsApply",value:function(){var e;null===(e=this.sdk.spread.formulaCacheManager)||void 0===e||e.disableFormulaCache(),this.sdk.unregisterPlugin(ie)}},{key:"destroy",value:function(){var e;null===(e=this.subscriber)||void 0===e||e.unsubscribe(),this.subscriber=null}}]),e}(),se=n("vsh_47253"),le=n("vsh_7121"),ue=n("vsh_52690"),ce="SheetGroupPlugin",he=function(){function e(t){var n=this;(0,r.Z)(this,e),this.subscription=new ue.w,this.name=ce,this.handleClickOutline=function(e){var t=e.props.id,r=n.activeSheet;if(r){var o=(0,C.MUF)(t),i=o.isRow,a=o.start,s=o.count,l=i?new y.lq$(a,s,r):new y.rvb(a,s,r);r.setSelections([l])}},this.handleClickOutlineButton=function(e){var t=e.props,r=n.activeModel,o=n.controller;if(r&&o){n.endEdit();var i=t.id,a=(0,C.MUF)(i),s=a.isRow,l=a.start,u=a.count,c=(0,y.oYo)(l,u,s),h=r.getEntireMatchOutlines(c);0!==h.length&&o.toggleOutline(c,h[0].state===y.w2y.Expand?y.w2y.Fold:y.w2y.Expand,"group_icon")}},this.handleHoverLevelButton=function(e){var t,r=e.props,o=r.level,i=r.isRow,a=r.hover;null===(t=n.activeViewModel)||void 0===t||t.onHoverLevelButton(i,o,a)},this.handleClickLevelButton=(0,se.default)((function(e){var t=e.props,r=t.level,o=t.isRow,a=n.activeModel,s=n.controller;if(a&&s){n.endEdit();var l=(o?a.rowOutlineTree:a.colOutlineTree).filter((function(e){return e.level===r})).every((function(e){return e.state===y.w2y.Fold})),u=o?i.xj7.ROW:i.xj7.COL,c=l?y.w2y.Expand:y.w2y.Fold;s.toggleLevel(u,r,c,"group_icon")}}),300),this.handleContextMenuOnGroupBar=function(e){var t,r,o,a=e.props.isRow;null===(t=n.activeViewModel)||void 0===t||t.setMenuState({type:a?C.pG9.RowGroupBar:C.pG9.ColGroupBar}),null===(r=n.collector)||void 0===r||null===(o=r.collectEventOnViewMenu)||void 0===o||o.call(r,a?i.xj7.ROW:i.xj7.COL,"multi_group_menu")},this.handleContextMenuGroupCorner=function(){var e,t,r;null===(e=n.activeViewModel)||void 0===e||e.setMenuState({type:C.pG9.Corner}),null===(t=n.collector)||void 0===t||null===(r=t.collectEventOnViewMenu)||void 0===r||r.call(t,"null","whole_group_menu")},this.handleContextMenuOnOutline=function(e){var t,r,o,a=e.props.id;null===(t=n.activeViewModel)||void 0===t||t.setMenuState({type:C.pG9.Outline,id:a});var s=(0,C.MUF)(a).isRow;null===(r=n.collector)||void 0===r||null===(o=r.collectEventOnViewMenu)||void 0===o||o.call(r,s?i.xj7.ROW:i.xj7.COL,"single_group_menu")},this.handleHoverOutline=function(e){var t,r=e.props,o=r.id,i=r.hover;null===(t=n.activeViewModel)||void 0===t||t.onHoverOutline(o,i)},this.options=t}return(0,o.Z)(e,[{key:"bindEvents",value:function(){var e,t,n,r=this;null!==(e=this.options)&&void 0!==e&&e.disableGridLayout||(this.subscription=new ue.w,this.subscription.add((0,le.onUIStateChange)((function(){var e;null===(e=r.activeViewModel)||void 0===e||e.onUIStateChange()}))),this.subscription.add(null===(t=this.sdk.shellManager)||void 0===t?void 0:t.subscribe((n={},(0,p.Z)(n,i.jy$.ClickOutline,this.handleClickOutline),(0,p.Z)(n,i.jy$.ClickOutlineButton,this.handleClickOutlineButton),(0,p.Z)(n,i.jy$.ClickLevelButton,this.handleClickLevelButton),(0,p.Z)(n,i.jy$.ContextMenuOnGroupBar,this.handleContextMenuOnGroupBar),(0,p.Z)(n,i.jy$.ContextMenuOnOutline,this.handleContextMenuOnOutline),(0,p.Z)(n,i.jy$.ContextMenuGroupCorner,this.handleContextMenuGroupCorner),(0,p.Z)(n,i.jy$.HoverOutline,this.handleHoverOutline),(0,p.Z)(n,i.jy$.HoverLevelButton,this.handleHoverLevelButton),n))))}},{key:"endEdit",value:function(){var e=this.activeSheet;if(e){var t=this.sdk.getPlugin("CellEditorPlugin");null!=t&&t.isEditing(e)&&t.endEdit({sheet:e})}}},{key:"init",value:function(e){this.sdk=e,this.bindEvents()}},{key:"onShellRegistered",value:function(e){var t;null!==(t=this.options)&&void 0!==t&&t.disableShowGroup?e.sheetView().registerRendererFactories([C.rB7]):e.sheetView().registerRendererFactories([C.LUx])}},{key:"setIsInHistory",value:function(e){this.viewModels.forEach((function(t){return t.setIsInHistory(e)}))}},{key:"setReadOnly",value:function(e){this.viewModels.forEach((function(t){return t.setReadOnly(e)}))}},{key:"setCollector",value:function(e){var t;this.collector=e,null===(t=this.controller)||void 0===t||t.setCollector(e)}},{key:"destroy",value:function(){this.subscription.unsubscribe(),this.handleClickLevelButton.cancel()}},{key:"activeSheet",get:function(){return this.sdk.spread.getActiveSheet()||void 0}},{key:"activeModel",get:function(){var e;return null===(e=this.activeSheet)||void 0===e?void 0:e.inject(y.Gdm)}},{key:"activeViewModel",get:function(){var e;return null===(e=this.activeSheet)||void 0===e?void 0:e.inject(C.WPM)}},{key:"viewModels",get:function(){return this.sdk.spread.sheets.map((function(e){return e.inject(C.WPM)}))}},{key:"controller",get:function(){var e;return null===(e=this.activeSheet)||void 0===e?void 0:e.inject(_.zA)}}]),e}();he.pluginName=ce;var de=n("vsh_74075"),fe=n("vsh_21955"),ve=function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":(0,g.Z)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},pe=function(){function e(){(0,r.Z)(this,e),this.name="ISVRelationShipPlugin"}return(0,o.Z)(e,[{key:"init",value:function(e){this.sdk=e,this.sdk.pluginStore.subscribeEventMap((0,p.Z)({},"LoadStatusStore/SheetToUsage",this.onSheetToUsage)),this.isvMessageSubscription=this.sdk.getService(P.ClJ).subscribeExtractChangedEventDataMessage(P.uaV.ISV_RELATIONSHIP,this.onChangedEventDataMessage)}},{key:"destroy",value:function(){this.isvMessageSubscription.unsubscribe(),this.sdk.pluginStore.unsubscribeEventMap((0,p.Z)({},"LoadStatusStore/SheetToUsage",this.onSheetToUsage)),this.sdk={}}},{key:"onChangedEventDataMessage",value:function(e){var t=this.sdk.spread.getISVRelationshipManager();t&&t.setISVRelationshipData(e)}},{key:"onSheetToUsage",value:function(e){if(e&&e.link_ISV_sheets){var t=this.sdk.spread.getISVRelationshipManager();t&&t.initISVRelationshipMap(e.link_ISV_sheets)}}}]),e}();ve([(0,m.Bind)()],pe.prototype,"onChangedEventDataMessage",null),ve([(0,m.Bind)()],pe.prototype,"onSheetToUsage",null),pe=ve([(0,fe.Mn)({required:[P.ClJ]})],pe);var ge,me=n("vsh_29033"),_e=n("vsh_82898"),ye={namespace:"PermissionStore",state:{editable:!1,commentable:!1,suiteEditable:!1},commit:{setEditable:function(e,t){e.editable=t},setCommentable:function(e,t){e.commentable=t},setSuiteEditable:function(e,t){e.suiteEditable=t}}},Ce=function(){function e(t){var n=t.canCopy,o=t.getCopyable,i=t.initialState;(0,r.Z)(this,e),this.name="PermissionPlugin",this.canCopy=n||this.getCopyableFromStore,this.getCopyable=o||this.getCopyableFromStore,this.initialState=i||{editable:!1,suiteEditable:!1},this.initialState&&(0,me.default)(this.initialState.suiteEditable)&&(this.initialState.suiteEditable=!1)}return(0,o.Z)(e,[{key:"init",value:function(e){this.store=e.pluginStore;var t=(0,_e.Z)({},ye,{state:this.initialState});this.store.registerModule(t)}},{key:"destroy",value:function(){}},{key:"setEditable",value:function(e){this.store.commit("PermissionStore/setEditable",e)}},{key:"setCommentable",value:function(e){this.store.commit("PermissionStore/setCommentable",e)}},{key:"setSuiteEditable",value:function(e){this.store.commit("PermissionStore/setSuiteEditable",e)}},{key:"getCopyableFromStore",value:function(){var e;return(null===(e=this.store.getState("PermissionStore"))||void 0===e?void 0:e.editable)||!1}}]),e}(),Se=n("vsh_80049"),ke=n("vsh_82905"),Ee=n("vsh_86217"),Te=n("vsh_30856"),be=function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":(0,g.Z)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Ie=ge=function(){function e(t){var n=this;(0,r.Z)(this,e),this.name="SheetRendererPlugin",this.subscriptions=[],this.hostShell=null,this.handleCursorChange=(0,se.default)((function(e){if(n.options.showCollaborators()){var t=n.cursorsSelector(e);n.sdk.shellForEach((function(e){e.sheetView().updateDistrictCursor(t)}))}}),ge.CURSOR_CHANGE_THROTTLE_TIME),this.options=t;var o=(0,C.MWT)(),i=o.length;this.getColorByMember=t.getColorByMember||function(e){return o[e.color_id%i]}}return(0,o.Z)(e,[{key:"init",value:function(e){this.sdk=e,this.bindEvents()}},{key:"onSheetMount",value:function(e,t){this.subscriptions.push(t.subscribe(i.jy$.FloatImageMultipleSelectStart,this.suspendApplyAction.bind(this)),t.subscribe(i.jy$.FloatImageMultipleSelectEnd,this.resumeApplyAction.bind(this)))}},{key:"destroy",value:function(){this.subscriptions.forEach((function(e){return e.unsubscribe()})),this.subscriptions.length=0,this.hostShell=null}},{key:"bindEvents",value:function(){this.subscriptions=[this.sdk.getService(P.e2Q).subscribeUserListChange(this.handleCursorChange),this.sdk.spread.subscribe((0,p.Z)({},i.HaZ.PermissionReady,this.handleFirstTick.bind(this)))]}},{key:"suspendApplyAction",value:function(){var e;null===(e=this.sdk.getPlugin("CollaborationPlugin"))||void 0===e||e.suspendApplyAction("FloatImageMultipleSelectStart")}},{key:"resumeApplyAction",value:function(){var e;null===(e=this.sdk.getPlugin("CollaborationPlugin"))||void 0===e||e.resumeApplyAction("FloatImageMultipleSelectEnd")}},{key:"handleFirstTick",value:function(){if(this.options.shouldTickAfterContentMeta){var e=this.sdk.getService(ke.zv),t=this.sdk.getService(ke.kM),n=this.sdk.spread.getActiveSheet(),r=Boolean(n&&n.blockId);n&&!r&&this.hostShell&&(this.sdk.mountSheet(n,this.hostShell),this.hostShell._doResize()),t.collect(i.FHD.STAGE_PENDING,{status:i.G2P.END,start_stage:i.FHD.APPLY_SNAPSHOT,next_stage:i.FHD.FASTER_FIRST_TICK}),t.collect(i.FHD.FASTER_FIRST_TICK,{status:i.G2P.START});var o=this.hostShell;o?(o.onAfterTick((function(){e.eventReportWithTemplate(Ee.n.SheetPathTracker,{trace_code:i.Y6H.shellTick,info:"shellTick_end"}),t.collect(Te.A6.SHEET_FASTER_RENDER_SUCCESS)})),o.sheetView().addFPSLog(i.EEh.LOAD_ALONE),e.eventReportWithTemplate(Ee.n.SheetPathTracker,{trace_code:i.Y6H.shellTick,info:"shellTick_start"})):e.eventReportWithTemplate(Ee.n.SheetPathTracker,{trace_code:i.Y6H.shellNotExisted,info:"onClientVars_shell_tick"}),t.collect(i.FHD.FASTER_FIRST_TICK,{status:i.G2P.END}),t.collect(i.FHD.STAGE_PENDING,{status:i.G2P.START,start_stage:i.FHD.FASTER_FIRST_TICK,next_stage:i.FHD.FETCH_SUB_BLOCK})}}},{key:"cursorsSelector",value:function(e){var t=this;return e.filter((function(e){return e.cursor_info&&void 0!==e.cursor_info.sheet_id})).map((function(e){return Object.assign({},e,{color:t.getColorByMember(e)})}))}},{key:"setActiveHostShell",value:function(e){this.hostShell=e}}]),e}();Ie.CURSOR_CHANGE_THROTTLE_TIME=800,be([(0,m.Bind)()],Ie.prototype,"handleFirstTick",null),Ie=ge=be([(0,fe.Mn)({required:[P.e2Q,ke.zv,ke.kM]})],Ie);var Re=n("vsh_67017"),we=n.n(Re),Ae=n("vsh_35067"),Fe=n("vsh_59980"),De=n("vsh_69691"),Ne=n("vsh_22485"),Pe=n("vsh_916"),Oe=function(){function e(){var t=this;(0,r.Z)(this,e),this.name="ThumbnailPlugin",this.shortcutRenderDoneLog=function(){var e=Date.now(),n=window.shortcutRenderStart||0,r=Date.now()-n;n&&i.Ps3.reportSheetRenderStageDuration("TOTAL_DURATION",{duration:r,sub_name:t.rangeId?"range":"default",render_time:e}),console.log("[sheet] shortcut done, duration: ".concat(r))},this.handleBitableShortcut=function(e){var n,r,o=e,i=null==o||null===(n=o.detail)||void 0===n?void 0:n.width,a=null==o||null===(r=o.detail)||void 0===r?void 0:r.height;t.handleScreenshotAndLog(i,a)},this.sendDidRender4Shortcut=function(){var e=(0,Ae.Z)(we().mark((function e(n,r,o,a){var s,l,u,c,h,d,f,v;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=t.sdk.spread&&t.sdk.spread.getActiveSheet(),n?l=n:t.sdk.shellForEach((function(e){l=e})),u=function(e,n,a){void 0===n&&(n=function(){t.handleScreenshotAndLog(r,o)}),null==a&&(a=1e4),Promise.race([new Promise((function(t){setTimeout((function(){var n;t({key:"timeout"}),null===(n=i.Ps3.shortcutLog)||void 0===n||n.call(i.Ps3,"sheet timeout",void 0,e)}),a)})),new Promise((function(t){window.addEventListener(e,(function n(r){t({key:e,event:r}),window.removeEventListener(e,n)}))}))]).then((function(e){console.log("[sheet shortcut dispatcher]",e.key),"function"==typeof n&&n(e.event)})).catch((function(e){console.error("[sheet shortcut dispatcher",e)}))},c=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;requestAnimationFrame((function(){return r<n?e(t,n,r+1):t()}))},h=function(){t.handleScreenshotAndLog(r,o)},!(s&&s instanceof y.isD)){e.next=16;break}e.t0=s.blockType,e.next=e.t0===i.kHU.BITABLE_BLOCK?9:e.t0===i.kHU.DOCX_BLOCK?11:13;break;case 9:return u("bitableDidRender",t.handleBitableShortcut),e.abrupt("break",14);case 11:return console.log("".concat(i.kHU.DOCX_BLOCK," not sendDidRender4Shortcut")),e.abrupt("break",14);case 13:t.handleScreenshotAndLog(r,o);case 14:e.next=20;break;case 16:d=(null==s?void 0:s.embeddedBlocksModel.getBlocksMap())||{},f=Object.keys(d).length,v=function(){var e=(0,Ae.Z)(we().mark((function e(){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.sheetView().waitSourceReady();case 2:return e.next=4,l.sheetView().waitFloatImageReady();case 4:c(h,6);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),f&&!a?u("pivotDidRender",v,7e3):v();case 20:case"end":return e.stop()}}),e)})));return function(t,n,r,o){return e.apply(this,arguments)}}(),this.onContentMetaApply=function(e){if(!t.isPDFAccess){var n=t.sdk.spread.getActiveSheet(),r=t.sdk.spread.getCalcEngine();if(r.conditionalDirtyFormulas.size>0&&!e.isCustomDataForShortcut){var o=new Map;r.conditionalDirtyFormulas.forEach((function(e){if(e.getRef().sheet()===n)if(e[y.yKb]){var t=Date.now();e.getValue({executeMode:Ne.ExecuteMode.FORCE});var r=Date.now();o.set(e,r-t)}else;})),t.sdk.spread.dispatch(i.HaZ.ConditionalFormulaChanged,[r.conditionalDirtyFormulas,o])}if(t.sdk.spread.getCalcEngine().formulaSpace.formulas.forEach((function(e){var t;if(e.getRef().sheet()===n){var r=null===(t=e.getRef())||void 0===t?void 0:t.sheet();r&&(0,y.sMb)(e)&&!y.XhZ.checkArrayFormulaExpandStateInModel(r._dataModel,e)&&y.XhZ.handleValueChanged(e)}})),t.rangeId){var a=n.rangeModel.getRangeFromId(t.rangeId);if(!a)return;var s=(0,y.jJ3)(a,t.sdk.spread);s&&s.isValidRefInSheet()&&(window.range=s,t.resetPCViewport(Pe.aM),setTimeout((function(){n.clearSelection(),n.addSelection(s,void 0,void 0,!1),n.dispatch(i.U_F.ShortcutRangeChanged,s),n.frozenRowCount(0),n.frozenColumnCount(0),t.sdk.shellForEach((function(r){r.sheet===n&&(r.sheetView().forceUpdate(),requestAnimationFrame((function(){t.scrollRangeToCenterWithOverlay(s,n),requestAnimationFrame((function(){t.sendDidRender4Shortcut(void 0,Pe.lP,Pe.Q/Pe.aM,e.isCustomDataForShortcut)}))})))}))})))}else t.resetDefaultViewPort()}},this.onSpreadLoaded=function(){t.isPDFAccess&&t.getAllFormulaValue(),t.sdk.spread.getActiveSheet().clearSelection()},this.getAllFormulaValue=function(){var e=t.sdk.spread.getCalcEngine();if(e.formulaSpace.formulas.forEach((function(e){e.getValue({executeMode:Ne.ExecuteMode.FORCE})})),e.conditionalDirtyFormulas.size>0){var n=new Map;e.conditionalDirtyFormulas.forEach((function(e){var t=Date.now();e.getValue({executeMode:Ne.ExecuteMode.FORCE});var r=Date.now();n.set(e,r-t)})),t.sdk.spread.dispatch(i.HaZ.ConditionalFormulaChanged,[e.conditionalDirtyFormulas,n])}}}return(0,o.Z)(e,[{key:"init",value:function(e){var t;(0,De.isShortCut)()&&(this.sdk=e,this.sdk.spread.getCalcEngine().formulaService.suspend(),this.bindIOEvents(),this.isPDFAccess=(0,Fe.default)(window,"User.isPDF",!1),this.rangeId=(null===(t=/[?&]rangeId=([^&]+)/.exec(location.search))||void 0===t?void 0:t[1])||"",this.initMobileShortcut())}},{key:"initMobileShortcut",value:function(){var e=this;window.changeShortcutWidthForSheet=function(){console.log("changeShortcutWidthForSheet"),window.mobileShortcutRenderStart=Date.now(),window.isMobileViewport=!0,e.adaptMobileViewport(Pe.aM);var t=e.sdk.spread.getActiveSheet();e.sdk.shellForEach((function(e){e.sheet===t&&e.sheetView().forceUpdate()})),setTimeout((function(){requestAnimationFrame((function(){window.range&&(e.removeOverlayCanvas(),e.scrollRangeToCenterWithOverlay(window.range,t)),requestAnimationFrame((function(){window.range=void 0,e.sendShortcutSignal(Pe.AA,Pe.Nd/Pe.aM)}))}))}),1e3)}}},{key:"adaptMobileViewport",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;document.documentElement.style.width="".concat(Pe.AA+C.C2X,"px"),document.documentElement.style.height="".concat(Pe.Nd/e+C.C2X,"px")}},{key:"resetPCViewport",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;document.documentElement.style.width="".concat(Pe.lP+C.C2X,"px"),document.documentElement.style.height="".concat(Pe.Q/e+C.C2X,"px")}},{key:"resetDefaultViewPort",value:function(){document.documentElement.style.width="",document.documentElement.style.height=""}},{key:"sendShortcutSignal",value:function(e,t){var n=Date.now(),r=e&&t?"&width=".concat(e,"&height=").concat(t):"",o="//localhost/signal/loaded/?t=".concat(n).concat(r),i=new Image;i.src=o,i.onload=function(){console.log("[sheet] send shortcut signal success")},i.onerror=function(){console.log("[sheet] send shortcut signal failed")}}},{key:"handleScreenshotAndLog",value:function(e,t){this.sendShortcutSignal(e,t),this.shortcutRenderDoneLog()}},{key:"bindIOEvents",value:function(){this.sdk.pluginStore.subscribeEventMap({"LoadStatusStore/ContentMetaApply":this.onContentMetaApply,"LoadStatusStore/SpreadLoaded":this.onSpreadLoaded})}},{key:"unbindIOEvents",value:function(){this.sdk.pluginStore.unsubscribeEventMap({"LoadStatusStore/ContentMetaApply":this.onContentMetaApply,"LoadStatusStore/SpreadLoaded":this.onSpreadLoaded})}},{key:"scrollRangeToCenterWithOverlay",value:function(e,t){var n=this;this.sdk.shellForEach((function(r){if(r.sheet===t){var o=r.sheetView();o.scrollRangeToCenter(e,t);var i=n.calcRangeRect(o,e,t);n.addOverlayCanvas(o,i)}}))}},{key:"calcRangeRect",value:function(e,t,n){var r=t.rowFrom(),o=t.colFrom(),i=n._getRowInfos(),a=n._getColInfos(),s=a.getDistance(0,o),l=i.getDistance(0,r),u=a.getDistance(o,o+t.colCount()),c=i.getDistance(r,r+t.rowCount()),h=e.getScrollPos();return{x:s-2-h.offsetX,y:l-2-h.offsetY,width:u+2+1,height:c+2+1}}},{key:"addOverlayCanvas",value:function(e,t){var n=e.getSheetColHeaderHeight(),r=e.getSheetRowHeaderWidth(),o=document.querySelector(".faster-single-canvas");if(o){var i=document.createElement("canvas");i.id="RangeOverlayCanvas",i.width=o.width,i.height=o.height,i.style.position="absolute",i.style.left="".concat(r,"px"),i.style.top="".concat(n,"px");var a,s=i.getContext("2d");if(s)s.globalAlpha=.8,s.fillStyle="white",s.fillRect(0,0,i.width,i.height),s.clearRect(t.x,t.y,t.width,t.height),null===(a=o.parentElement)||void 0===a||a.appendChild(i)}}},{key:"removeOverlayCanvas",value:function(){var e=document.getElementById("RangeOverlayCanvas");e&&e.remove()}},{key:"destroy",value:function(){(0,De.isShortCut)()&&this.unbindIOEvents()}}]),e}(),Me=n("vsh_58342"),Le=function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":(0,g.Z)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},xe=1,Ve="ThumbnailGeneratePlugin",Ze=function(){function e(t){var n=this;(0,r.Z)(this,e),this.name=Ve,this.subscriber=null,this.cmdExecutedSub=null,this.waitDataRangeACK=function(){var e=(0,Ae.Z)(we().mark((function e(t){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var r=n.sdk.getService(P.AHm).subscribeEvent(P.NLr.ACCEPT_COMMIT,function(){var n=(0,Ae.Z)(we().mark((function n(o,a,s){var l;return we().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:l=s.content.filter((function(e){return e.action===i.aOo.SET_DATA_RANGE&&e.value.range_id===t})),0===a.code&&l.length>0&&(r.unsubscribe(),e(void 0));case 2:case"end":return n.stop()}}),n)})));return function(e,t,r){return n.apply(this,arguments)}}())})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getRangeIdForSelectionLink=function(e){var t=n.sdk.spread,r=(0,Me.V)(t,e.sheet().id(),e);if(!r)return"";var o=n.sdk.spread.getService(ke.UU).token;return(0,i.vRF)(i.FHD.GENERATE_THUMBNAIL,i.G2P.START),n.postThumbnailDataAsync(o,r,e).then((function(){var t=e.sheet().id();n.createThumbnailAsync(o,t,r)})),(0,i.vRF)(i.FHD.GENERATE_THUMBNAIL,i.G2P.END),r},this.postThumbnailDataAsync=function(){var e=(0,Ae.Z)(we().mark((function e(t,r,o){var i,a;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.generateRangeSnapshot(o),e.next=3,n.requestProvider.postRequest("".concat(n.requestProvider.apiUrls.THUMBNAIL_DATA_GENERATE,"/").concat(t),{rangeId:r,snapshot:i},{headers:{"Content-Type":"application/json"}}).promise;case 3:return a=e.sent,e.abrupt("return",a.data);case 5:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),this.createThumbnailAsync=function(){var e=(0,Ae.Z)(we().mark((function e(t,r,o){var i,a;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(i=new FormData).append("obj_token",t),i.append("obj_type","".concat(De.NUM_SUITE_TYPE.SHEET)),i.append("scene","4"),i.append("is_async","true"),i.append("sheet_id",r),o&&(i.append("range_id",o),i.append("range_ver",String(xe))),e.next=9,n.requestProvider.postRequest(n.requestProvider.apiUrls.THUMBNAIL_GENERATE,i,{headers:{"Content-Type":"multipart/form-data"}}).promise;case 9:return a=e.sent,e.abrupt("return",a.data);case 11:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),this.handleMoveRange=function(e,t){var r=e.fromRange,o=e.toRange,a=o.rowFrom()-r.rowFrom(),s=o.colFrom()-r.colFrom();if(r.rgType===i.xj7.ROW&&a>0?a-=r.rowCount():r.rgType===i.xj7.COL&&s>0&&(s-=r.colCount()),t){var l=[];t.rangeModel.forEach((function(e){if(e.usageType===i.m2A.COPY_LINK){var n=(0,y.lDu)(e),o=n.col,u=n.row,c=n.colEnd,h=n.rowEnd-u+1,d=c-o+1;if(r.contain(new y.e6w(u,o,h,d,t))){var f=Object.assign({},e,{row:u+a,col:o+s});l.push(f)}}})),l.length>0&&(n.cmdExecutedSub=n.sdk.spread.subscribe(i.HaZ.CommandExecuted,(function(e){var t;e.changesets.some((function(e){return e.action===i.aOo.MOVE_RANGE&&e.sheet_id===l[0].sheetId}))&&(n.sdk.spread.setDataRange(l,!0),null===(t=n.cmdExecutedSub)||void 0===t||t.unsubscribe(),n.cmdExecutedSub=null)})))}},this.requestProvider=t.requestProvider}return(0,o.Z)(e,[{key:"init",value:function(e){this.sdk=e,this.bindEvents()}},{key:"generateRangeSnapshot",value:function(e){var t=this.sdk.spread,n=e.sheet().id(),r=(0,p.Z)({},n,{cellBlockMetas:[],formulaBlockMeta:{revision:0,schemaVersion:9,hasFormula:!1,hasDirtyFormula:!1,maxFormulaId:0,blockMetas:[]}}),o=(0,De.gzip)(JSON.stringify(r)),a=this.serializeForShortcut(e)||{},s=t.encodeCommandsMap(a);return{gzipTopSnapshot:s[i.B2l.CommandType.CommandType_TOP_SNAPSHOT],gzipResource:s[i.B2l.CommandType.CommandType_RESOURCE_SNAPSHOT],gzipBlockMeta:o,blocks:(0,p.Z)({},Pe.S5,s[i.B2l.CommandType.CommandType_TABLE_SNAPSHOT])}}},{key:"serializeForShortcut",value:function(e){var t,n=(null===(t=e)||void 0===t?void 0:t.sheet())||this.sdk.spread.getActiveSheet();e=e||n.getSelections()[0];var r=(0,Me.$)(e);return this.sdk.spread.serialize(void 0,r,!0)}},{key:"bindEvents",value:function(){var e;this.subscriber=null===(e=this.sdk)||void 0===e?void 0:e.spread.subscribe(this.getDepends())}},{key:"getDepends",value:function(){return(0,p.Z)({},i.U_F.MoveRange,this.handleMoveRange)}},{key:"destroy",value:function(){var e,t;null===(e=this.subscriber)||void 0===e||e.unsubscribe(),this.subscriber=null,null===(t=this.cmdExecutedSub)||void 0===t||t.unsubscribe(),this.cmdExecutedSub=null}}]),e}();Ze=Le([(0,fe.Mn)({required:[P.AHm]})],Ze);var Be=n("vsh_30157"),He=n("vsh_90036"),Ue=function(){function e(){(0,r.Z)(this,e),this.name="SheetDataCleanPlugin"}return(0,o.Z)(e,[{key:"init",value:function(){}},{key:"destroy",value:function(){}},{key:"onShellRegistered",value:function(e){e.sheetView().registerRendererFactories([C.rMb,C.oaX])}}]),e}(),je=n("vsh_49352"),Ge=function(){function e(t){var n=this;(0,r.Z)(this,e),this.isWorker=t,this.name=je.c,this.subscription=null,this.onSheetLoaded=function(e,t){if(t){var r=n.sdk.spread.getActiveSheet(),o=n.viewModelManager.getViewModel(r);o&&(o.fitRowCalc.addDirtyRows(0,r.getRowCount()),o.notifyChange())}}}return(0,o.Z)(e,[{key:"init",value:function(e){this.sdk=e,this.viewModelManager=new C.SnY(e.spread),this.subscription=(0,C.A6x)(this.viewModelManager,e.spread),this.subscription.add(e.pluginStore.subscribeEvent("LoadStatusStore/WorksheetLoaded",this.onSheetLoaded)),this.isWorker||this.subscription.add((0,C.uoB)(this.viewModelManager,e.spread)),this.subscription.add((0,C.oai)(this.viewModelManager,e.spread))}},{key:"destroy",value:function(){this.subscription&&(this.subscription.unsubscribe(),this.subscription=null),this.manager.destroy()}},{key:"manager",get:function(){return this.viewModelManager}}]),e}();function Ke(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return We(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return We(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function We(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var ze=function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":(0,g.Z)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Ye=function(){function e(){(0,r.Z)(this,e),this.name="SparklinePlugin",this.subscriber=null,this.subscription=null}return(0,o.Z)(e,[{key:"init",value:function(e){this.sdk=e,this.bindEvents()}},{key:"destroy",value:function(){var e,t;null===(e=this.subscriber)||void 0===e||e.unsubscribe(),null===(t=this.subscription)||void 0===t||t.unsubscribe(),this.sdk.spread.unbind(P.YVA.ENTER_FULL_SCREEN_MODE,this.handleEnterFullScreen),this.debounceUpdateSparklineHighlight.cancel&&this.debounceUpdateSparklineHighlight.cancel()}},{key:"onShellRegistered",value:function(e){e.sheetView().registerRendererFactories([C.Y_t])}},{key:"onSheetMount",value:function(e){var t=e.inject(y.hms);e.getSparklineModel().getDataManager().markDirtyCallback=t.setDirtyRect}},{key:"bindEvents",value:function(){var e;this.subscriber=this.sdk.spread.subscribe((e={},(0,p.Z)(e,i.U_F.SparklineAdd,this.handleSparklineAdd),(0,p.Z)(e,i.U_F.SparklineDelete,this.handleSparklineDelete),(0,p.Z)(e,i.U_F.SparklineDelRowCol,this.handleSparklineDelRowCol),(0,p.Z)(e,i.U_F.SparklineSourceRangeChanged,this.handleSparklineSourceRangeChange),(0,p.Z)(e,i.U_F.SparklineGroupConfigChanged,this.handleSparklineGroupConfigChanged),(0,p.Z)(e,i.U_F.SelectionChanged,this.handleSelectionChange),(0,p.Z)(e,i.HaZ.ActiveSheetChanged,this.handleActiveSheetChange),(0,p.Z)(e,i.HaZ.FormulaCacheApplied,this.handleFormulaCacheApplyed),e)),this.sdk.spread._context.bind(P.YVA.ENTER_FULL_SCREEN_MODE,this.handleEnterFullScreen),this.subscription=this.sdk.pluginStore.subscribeEvent("LoadStatusStore/WorksheetLoaded",this.handleSheetLoaded)}},{key:"getDataManagerBySheetId",value:function(e){var t=this.sdk.spread.getSheetFromId(e);return t?t.getSparklineModel().getDataManager():null}},{key:"handleFormulaCacheApplyed",value:function(){var e=this.sdk.spread.getActiveSheet();if(e){var t=this.getDataManagerBySheetId(e.id());t&&t.clearCache()}}},{key:"handleEnterFullScreen",value:function(){this.debounceUpdateSparklineHighlight()}},{key:"handleSheetLoaded",value:function(e){var t=this.getDataManagerBySheetId(e);t&&t.clearCache()}},{key:"handleSparklineAdd",value:function(e){var t=e.sheetId,n=e.id,r=this.getDataManagerBySheetId(t);if(r){var o=r.sheet,i=o.getSparklineById(n);if(i){var a=i.getPosition(),s=a.row,l=a.col;o.inject(y.hms).setDirtyCell(s,l),this.debounceUpdateSparklineHighlight()}}}},{key:"handleSparklineDelete",value:function(e){var t=e.sheetId,n=e.id,r=e.cell,o=e.groupId,i=this.getDataManagerBySheetId(t);i&&(i.sheet.inject(y.hms).setDirtyCell(r.row,r.col),i.removeCache(n,o),this.debounceUpdateSparklineHighlight())}},{key:"handleSparklineDelRowCol",value:function(){this.updateSparklineHighlight()}},{key:"handleSparklineSourceRangeChange",value:function(e){var t=e.sheetId,n=e.id,r=this.getDataManagerBySheetId(t);if(r){var o=r.sheet.getSparklineById(n);r.removeCache(n,(null==o?void 0:o.getGroupId())||""),this.updateSparklineHighlight()}}},{key:"handleSparklineGroupConfigChanged",value:function(e){var t=e.sheetId,n=e.groupId,r=this.getDataManagerBySheetId(t);if(r){var o,i,a=r.sheet,s=Ke(a.getSparklinesByGroupId(n));try{for(s.s();!(i=s.n()).done;){var l=i.value,u=l.getPosition(),c=u.row,h=u.col;o?o.union(new N.FRect(h,c,1,1)):o=new N.FRect(h,c,1,1),r.markSourceRangeDirtyById(l.getId()),r.removeCache(n,l.getGroupId())}}catch(e){s.e(e)}finally{s.f()}a.inject(y.hms).setDirtyRect(o),this.debounceUpdateSparklineHighlight()}}},{key:"handleSelectionChange",value:function(){this.updateSparklineHighlight()}},{key:"handleActiveSheetChange",value:function(e){var t=e.newSheet,n=e.oldSheet;this.removeSparklineHighlight(n),this.debounceUpdateSparklineHighlight(t)}},{key:"debounceUpdateSparklineHighlight",value:function(e){this.updateSparklineHighlight(e)}},{key:"removeSparklineHighlight",value:function(e){if(e){var t=e.inject(y.hms);t.removeGroupHighlightRange(),t.removeSourceHighlightRange()}}},{key:"updateSparklineHighlight",value:function(e){var t=e||this.sdk.spread.getActiveSheet();if(t){var n=t.getActiveCellIndex(),r=n.row,o=n.column,i=t.getSparklineByCell(r,o),a=t.inject(y.hms);if(!i)return a.removeGroupHighlightRange(),void a.removeSourceHighlightRange();var s=i.getGroupId(),l=t.getSparklinesByGroupId(s);if(!l.length)return a.removeGroupHighlightRange(),void a.removeSourceHighlightRange();var u,c=[],h=Ke(l);try{for(h.s();!(u=h.n()).done;){var d=u.value.getPosition(),f=d.row,v=d.col,p=t.getSpan(f,v);c.push(p||new y.luK(f,v,t))}}catch(e){h.e(e)}finally{h.f()}c.sort((function(e,t){return e.rowFrom()>t.rowFrom()?1:e.rowFrom()===t.rowFrom()?e.colFrom()>t.colFrom()?1:e.colFrom()===t.colFrom()?0:-1:-1}));var g,m=t.getSelections(),_=[],C=Ke(m);try{for(C.s();!(g=C.n()).done;){var S=g.value;(0,y.KST)(S,(function(e,n){var r=t.getSparklineByCell(e,n);if(r&&r.getGroupId()===s){var o=r.getSourceRange();o&&_.push(o)}}))}}catch(e){C.e(e)}finally{C.f()}_.length?a.setSourceHighlightRange(_):a.removeSourceHighlightRange(),a.setGroupHighlightRange((0,y.qBP)(c))}}}]),e}();ze([(0,m.Bind)()],Ye.prototype,"handleFormulaCacheApplyed",null),ze([(0,m.Bind)()],Ye.prototype,"handleEnterFullScreen",null),ze([(0,m.Bind)()],Ye.prototype,"handleSheetLoaded",null),ze([(0,m.Bind)()],Ye.prototype,"handleSparklineAdd",null),ze([(0,m.Bind)()],Ye.prototype,"handleSparklineDelete",null),ze([(0,m.Bind)()],Ye.prototype,"handleSparklineDelRowCol",null),ze([(0,m.Bind)()],Ye.prototype,"handleSparklineSourceRangeChange",null),ze([(0,m.Bind)()],Ye.prototype,"handleSparklineGroupConfigChanged",null),ze([(0,m.Bind)()],Ye.prototype,"handleSelectionChange",null),ze([(0,m.Bind)()],Ye.prototype,"handleActiveSheetChange",null),ze([(0,m.Bind)(),(0,m.Debounce)(50)],Ye.prototype,"debounceUpdateSparklineHighlight",null),ze([(0,m.Bind)()],Ye.prototype,"removeSparklineHighlight",null),ze([(0,m.Bind)()],Ye.prototype,"updateSparklineHighlight",null);var Je=n("vsh_1139"),qe=n("vsh_2902"),$e=n("vsh_52656"),Xe=n("vsh_20327"),Qe=function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":(0,g.Z)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};function et(e,t,n){var r,o=[],i=null===(r=e.taskToCellMap)||void 0===r?void 0:r.get(n);i&&i.forEach((function(e){var t,n=null===(t=e.sheet())||void 0===t?void 0:t.getVar(e.rowFrom(),e.colFrom());null!=n&&n.isFormula()&&o.push(n.getRef())})),t.getCalcEngine().markDirty(o,y.hkV)}var tt=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(0,r.Z)(this,e),this.isWorker=n,this.name="AIFormulaPlugin",this.requestTime=0,this.updateAiRequestManagerCalculateStatus=(0,se.default)((function(){var e=t.sdk.pluginStore.getState($e.T7);e&&(0,Xe.l3)(e),100===(null==e?void 0:e.percentage)&&(t.startTime=void 0,t.requestTime=0)}),5e3)}return(0,o.Z)(e,[{key:"init",value:function(e){if(this.sdk=e,this.aiManager=this.sdk.spread.aiManager,this.isWorker)this.sdk.pluginStore.watch($e.u7,this.updateAiRequestManagerCalculateStatus),this.sdk.pluginStore.watch($e.t2,this.updateAiRequestManagerCalculateStatus),this.sdk.pluginStore.watch($e.nN,this.updateAiRequestManagerCalculateStatus),this.sdk.pluginStore.watch($e.Vx,this.updateAiRequestManagerCalculateStatus);else{var t=this.sdk.getService(P.ClJ);this.aiFormulaSubscription=null==t?void 0:t.subscribeExtractChangedEventDataMessage(P.uaV.AI_FORMULA,this.onAIFormulaMessageReceive),this.aiFormulaReferDataChangeSubscription=null==t?void 0:t.subscribeExtractChangedEventDataMessage(P.uaV.AI_REFER_DATA_CHANGE,this.onAIFormulaReferDataChangeMessageReceive)}}},{key:"destroy",value:function(){var e,t;null===(e=this.aiFormulaSubscription)||void 0===e||e.unsubscribe(),null===(t=this.aiFormulaReferDataChangeSubscription)||void 0===t||t.unsubscribe(),this.isWorker&&(this.sdk.pluginStore.unWatch($e.u7,this.updateAiRequestManagerCalculateStatus),this.sdk.pluginStore.unWatch($e.t2,this.updateAiRequestManagerCalculateStatus),this.sdk.pluginStore.unWatch($e.nN,this.updateAiRequestManagerCalculateStatus),this.sdk.pluginStore.unWatch($e.Vx,this.updateAiRequestManagerCalculateStatus))}},{key:"handleAiRequestManagerAddTask",value:function(){this.startTime||(this.startTime=Date.now()),this.sdk.pluginStore.commit($e.GY,1)}},{key:"handleAiRequestManagerRemoveTask",value:function(){this.sdk.pluginStore.commit($e.or,1)}},{key:"handleAiRequestManagerFinishTask",value:function(){var e=this.sdk.pluginStore.getState($e.T7);if(!this.startTime||100===(null==e?void 0:e.percentage)||null==e||!e.finishedTaskNums)return this.startTime=void 0,void(this.requestTime=0);this.requestTime++;var t=(Date.now()-this.startTime)/this.requestTime;this.sdk.pluginStore.commit($e.I2,t)}},{key:"refreshAiLongTimeTask",value:function(e){var t=this,n=e.result_map;e.cache_keys.forEach((function(e){if(n&&n[e]&&n[e].status===i.crM.Success&&void 0!==n[e].text){var r,o=t.aiManager.cache.get(e);if(o&&!o.isError())return;t.aiManager.resultMapFromServer||(t.aiManager.resultMapFromServer=new Map),t.aiManager.resultMapFromServer.set(e,n[e]),et(t.aiManager,t.sdk.spread,e),null===(r=t.aiManager.taskToCellMap)||void 0===r||r.delete(e),t.aiManager.cache.delete(e),t.aiManager.removeTask(e)}else t.aiManager.longTimeTaskSet.has(e)&&(et(t.aiManager,t.sdk.spread,e),t.aiManager.longTimeTaskSet.delete(e),t.aiManager.cache.delete(e),t.aiManager.removeTask(e))})),this.handleAiRequestManagerFinishTask()}},{key:"refreshAIFormulaReferData",value:function(e){var t=e.range_id,n=e.range_type,r=this.sdk.spread;if(t&&n)if("range"===n){var o=t.split("!"),i=(0,Je.Z)(o,2),a=i[0],s=i[1],l=r.getSheetFromId(a);if(!l)return;var u=l.rangeStringToRange(s);if(!u)return;r.calcEngine.markDirty([u])}else if("import_range"===n){var c,h;null===(c=(h=r.importRangeManager).markDirtyFormulasById)||void 0===c||c.call(h,t)}}},{key:"onAIFormulaMessageReceive",value:function(e){var t=this.sdk.getPlugin(qe.Pj);t&&t.receiveAiLongTimeTaskRefresh(e)}},{key:"onAIFormulaReferDataChangeMessageReceive",value:function(e){var t=this.sdk.getPlugin(qe.Pj);t&&t.receiveAIFormulaReferDataChange(e)}}]),e}();Qe([(0,m.Bind)()],tt.prototype,"onAIFormulaMessageReceive",null),Qe([(0,m.Bind)()],tt.prototype,"onAIFormulaReferDataChangeMessageReceive",null);var nt=function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":(0,g.Z)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},rt=function(){function e(){var t=this;(0,r.Z)(this,e),this.name="FormulaMergeService",this.subscriber=null,this.handleSheetLoaded=function(e,n){var r,o;null===(r=t.trackerService)||void 0===r||r.collect(i.FHD.BUILD_SHEET_FORMULA_TREE,{status:i.G2P.START}),t.sdk.spread.calcEngine.buildSheetFormulaReferences(e),null===(o=t.trackerService)||void 0===o||o.collect(i.FHD.BUILD_SHEET_FORMULA_TREE,{status:i.G2P.END,sheetId:e,formula_count:t.sdk.spread.calcEngine.getSheetFormulaCount(e),aggregate_count:t.sdk.spread.calcEngine.formulaRefManager.getNodeCount(e)})}}return(0,o.Z)(e,[{key:"init",value:function(e){this.sdk=e,this.trackerService=this.sdk.getService(ke.kM),this.sdk.pluginStore.subscribeEvent("LoadStatusStore/WorksheetLoaded",this.handleSheetLoaded)}},{key:"destroy",value:function(){this.sdk.pluginStore.unsubscribeEvent("LoadStatusStore/WorksheetLoaded",this.handleSheetLoaded),this.subscriber&&this.subscriber.unsubscribe()}}]),e}();rt=nt([(0,fe.Mn)({required:[],optional:[ke.kM]})],rt);var ot=n("vsh_18914")},vsh_64365:function(e,t,n){n.d(t,{O:function(){return a}});var r=n("vsh_35911"),o=n("vsh_25469"),i=n("vsh_74340");function a(e){var t=function(e){return{isSheetLoaded:function(t){var n;return!(null===(n=e.getPlugin(r.IE))||void 0===n||!n.isSheetLoaded(t))},loadSheets:function(t){var n=e.getPlugin(r.IE);return n?n.loadSheets(t):new Promise((function(){console.error("no dataLoader found but call loadSheets")}))}}}(e);return e.getPlugin(o.He)?Object.assign(t,{subscribeChannelState:function(t){return e.getService(i.ClJ).subscribeChannelState(t)},subscribeProduceChangesetEvent:function(t){return e.getService(i.AHm).subscribeEvent(i.NLr.PRODUCE_CHANGESET,t)},startTrackChangesetAccept:function(t){return e.getService(i.AHm).startTrackChangesetAccept(t)}}):t}},vsh_1084:function(e,t,n){n.d(t,{e0:function(){return c.e0},Hy:function(){return p},by:function(){return c.by}});var r=n("vsh_74561"),o=n("vsh_19264"),i=n("vsh_4175"),a=n("vsh_65498"),s=n("vsh_24627"),l=n("vsh_35911"),u=n("vsh_72834"),c=n("vsh_88021"),h=n("vsh_64365"),d=n("vsh_46544"),f=n("vsh_92292"),v=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":(0,a.Z)(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=function(){function e(){(0,o.Z)(this,e),this.name="CollaBlockPlugin"}return(0,i.Z)(e,[{key:"init",value:function(e){this._sdk=e,this._store=e.pluginStore,this._store.registerModule((0,c.m8)()),this._dataDeps=(0,h.O)(e),this._bindEvents(),this._bindPluginsEvents(),this._initEmbeddedBlock()}},{key:"_bindEvents",value:function(){var e;this._subscriber=this._sdk.spread.subscribe((e={},(0,r.Z)(e,s.HaZ.ActiveSheetChanged,this._handleActiveSheetChange),(0,r.Z)(e,s.HaZ.SheetAdded,this._handleSheetAdded),(0,r.Z)(e,s.U_F.CoverSheet,this._handleCoverSheet),e))}},{key:"_bindPluginsEvents",value:function(){this._sdk.pluginStore.subscribeEventMap((0,r.Z)({},"".concat(l.qq,"/").concat(l.ke.WorksheetLoaded),this._handleWorksheetLoaded))}},{key:"_initEmbeddedBlock",value:function(){var e=this,t=this._sdk.spread,n=this.activeSheet.id();t.sheets.forEach((function(t){var r=t.id();r&&(e._dataDeps.isSheetLoaded(r)||n===r)&&e._handleWorksheetLoaded(r)}))}},{key:"_unbindPluginsEvents",value:function(){this._sdk.pluginStore.unsubscribeEventMap((0,r.Z)({},"".concat(l.qq,"/").concat(l.ke.WorksheetLoaded),this._handleWorksheetLoaded))}},{key:"_handleWorksheetLoaded",value:function(e){var t=this._sdk.spread.getSheetFromId(e);t&&(t.inject(d.gJ).init({dataDeps:this._dataDeps}),this._connectEmbeddedBlockAndRaise(t))}},{key:"_handleBlockChanged",value:function(e,t){if(e){var n=t.changeType,r=t.embeddedBlock,o=e.id();switch(this._store.commit("".concat(c.by,"/").concat(c.t2.setEmbeddedBlockStatus),n),this._store.commit("".concat(c.by,"/").concat(c.t2.setEmbeddedBlockSheetId),o),this._store.commit("".concat(c.by,"/").concat(c.t2.setEmbeddedBlock),r),n){case u.MLY.Add:case u.MLY.Set:this._store.dispatchEvent("".concat(c.by,"/").concat(c.e0.Set),o,r);break;case u.MLY.Del:this._store.commit("".concat(c.by,"/").concat(c.t2.delEmbeddedBlock),r.blockToken),this._store.dispatchEvent("".concat(c.by,"/").concat(c.e0.Delete),o,r);break;case u.MLY.Refresh:this._store.commit("".concat(c.by,"/").concat(c.t2.resetState)),this._store.dispatchEvent("".concat(c.by,"/").concat(c.e0.Refresh),o,r)}}}},{key:"_connectEmbeddedBlock",value:function(e){var t=this;e.embeddedBlocksModel.registerEmbeddedBlockChangeHandler((function(n){t._handleBlockChanged(e,n)}))}},{key:"_raiseAllBlocksSetBySheet",value:function(e){var t;null===(t=e.embeddedBlocksModel)||void 0===t||t.raiseAllBlocksSet(),e.dispatch(s.U_F.AllEmbeddedBlockSet,{sheetId:e.id()})}},{key:"_connectEmbeddedBlockAndRaise",value:function(e){this._connectEmbeddedBlock(e),this._raiseAllBlocksSetBySheet(e)}},{key:"_handleActiveSheetChange",value:function(e){var t,n=e.newSheet,r=null===(t=n.embeddedBlocksModel)||void 0===t?void 0:t.getChangeManager().hasChangeHandler();this._dataDeps.isSheetLoaded(n.id())&&r||this._connectEmbeddedBlockAndRaise(n)}},{key:"_handleSheetAdded",value:function(e){var t=e.sheet;t&&this._connectEmbeddedBlockAndRaise(t)}},{key:"_handleCoverSheet",value:function(e,t){this._connectEmbeddedBlockAndRaise(t)}},{key:"destroy",value:function(){this._subscriber.unsubscribe(),this._unbindPluginsEvents()}},{key:"activeSheet",get:function(){return this._sdk.spread.getActiveSheet()}}]),e}();v([(0,f.Bind)()],p.prototype,"_bindPluginsEvents",null),v([(0,f.Bind)()],p.prototype,"_initEmbeddedBlock",null),v([(0,f.Bind)()],p.prototype,"_unbindPluginsEvents",null),v([(0,f.Bind)()],p.prototype,"_handleWorksheetLoaded",null),v([(0,f.Bind)()],p.prototype,"_handleBlockChanged",null),v([(0,f.Bind)()],p.prototype,"_connectEmbeddedBlock",null),v([(0,f.Bind)()],p.prototype,"_raiseAllBlocksSetBySheet",null),v([(0,f.Bind)()],p.prototype,"_connectEmbeddedBlockAndRaise",null),v([(0,f.Bind)()],p.prototype,"_handleActiveSheetChange",null),v([(0,f.Bind)()],p.prototype,"_handleSheetAdded",null),v([(0,f.Bind)()],p.prototype,"_handleCoverSheet",null)},vsh_88021:function(e,t,n){n.d(t,{e0:function(){return r},by:function(){return a},t2:function(){return s},m8:function(){return l}});var r,o=n("vsh_47246");!function(e){e.Set="Set",e.Delete="Delete",e.Refresh="Refresh"}(r||(r={}));var i={blocks:{}},a="CollaEmbeddedBlockStore",s={setEmbeddedBlock:"setEmbeddedBlock",delEmbeddedBlock:"delEmbeddedBlock",resetState:"resetState",setEmbeddedBlockStatus:"setEmbeddedBlockStatus",setEmbeddedBlockSheetId:"setEmbeddedBlockSheetId"};function l(){return{namespace:a,state:(0,o.default)(i),commit:{setEmbeddedBlock:function(e,t){var n=t.blockToken;e.blocks[n]=t},delEmbeddedBlock:function(e,t){delete e.blocks[t]},resetState:function(e){Object.assign(e,(0,o.default)(i))}}}}},vsh_77233:function(e,t,n){n.d(t,{Pt:function(){return a},le:function(){return s},tx:function(){return l}});var r=n("vsh_21469"),o=n("vsh_24627"),i=n("vsh_69691"),a=(0,r.Z)((function(){return"function"==typeof window.Worker&&""===(0,o.eYO)("disable_worker")&&o.Ps3.isSheetWorkerEnabled()&&!(0,i.isShortCut)()}));function s(){return a()}var l=function(){return"undefined"!=typeof localStorage&&"true"===localStorage.getItem("pivot_boe_server_calc")||"true"===(0,o.eYO)("use_server_calc")}},vsh_18914:function(e,t,n){n.d(t,{Hy:function(){return r.Hy},Wc:function(){return o.Wc},PJ:function(){return o.PJ},XK:function(){return k.XK},Qr:function(){return C},tx:function(){return S.tx},Pt:function(){return S.Pt}});var r=n("vsh_1084"),o=n("vsh_24325"),i=n("vsh_74561"),a=n("vsh_67017"),s=n.n(a),l=n("vsh_35067"),u=n("vsh_19264"),c=n("vsh_4175"),h=n("vsh_65498"),d=n("vsh_72834"),f=n("vsh_26246"),v=n("vsh_55478"),p=n("vsh_92292"),g=n("vsh_46544"),m=n("vsh_24627"),_=function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":(0,h.Z)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},y=function(e,t){return e.sheets.find((function(e){return e.embeddedBlocksModel.getBlock(t)}))},C=function(){function e(t){var n=this;(0,u.Z)(this,e),this._depend=t,this.name="ServiceCalculateBlockPlugin",this._msgBoxSubscriptionMap=new Map,this._requesterMap=new Map,this._handleMsgBox=function(){var e=(0,l.Z)(s().mark((function e(t,r){var o,i,a,l,u,c,h,d;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[PIVOT] received msgBox data @".concat(t)),o=n._requesterMap.get(t),i=y(n._sdk.spread,t),o&&i){e.next=5;break}return e.abrupt("return");case 5:return o.markNotWaitingRefetchMeta(),e.next=8,o.handleMessageFromServer(r);case 8:a=e.sent,(l=new v.b$).fromJSON(a),u=i.embeddedBlocksModel.getBlock(t),c=u.position,h=c.row,d=c.col,i.inject(g.gJ).renderPivotTableWithPosition(t,h,d,l);case 14:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),this._handleEmbeddedBlockDelete=function(e,t){var r=t.blockToken,o=n._msgBoxSubscriptionMap.get(r);o&&(o(),n._msgBoxSubscriptionMap.delete(r)),n._sdk.spread.pivotService.unregisterRequester(t.blockToken)},this._createPivotServiceRequester=function(e){var t=n._sdk.spread,r=n._sdk.spread.pivotService,o=new d.PpF(e,t.sheetBlocksManager.modelManager.getRequest(),f.lb,t),i=n.syncModelManager.getSyncModel(e);i&&(o.bindSyncModel(i),r.registerRequester(e,o))}}return(0,c.Z)(e,[{key:"init",value:function(e){this._sdk=e,this.syncModelManager=e.spread.getPivotSyncModelManager(),this.bindEvents(),this._sdk.spread.pivotService.useServerCalc=!0,this._sdk.spread.calcEngine.pivotCalculateEngine.suspend()}},{key:"bindEvents",value:function(){this.syncModelManager.subscribe(this.getPivotSyncModelEvents()),this._bindCollaBlockPluginEvent()}},{key:"unbindEvents",value:function(){this.syncModelManager.subscribe(this.getPivotSyncModelEvents()),this._unbindCollaBlockPluginEvent()}},{key:"_bindCollaBlockPluginEvent",value:function(){var e;this._sdk.pluginStore.subscribeEventMap((e={},(0,i.Z)(e,"CollaEmbeddedBlockStore/".concat(r.e0.Set),this._handleEmbeddedBlockSet),(0,i.Z)(e,"CollaEmbeddedBlockStore/".concat(r.e0.Delete),this._handleEmbeddedBlockDelete),e))}},{key:"_unbindCollaBlockPluginEvent",value:function(){var e;this._sdk.pluginStore.unsubscribeEventMap((e={},(0,i.Z)(e,"CollaEmbeddedBlockStore/".concat(r.e0.Set),this._handleEmbeddedBlockSet),(0,i.Z)(e,"CollaEmbeddedBlockStore/".concat(r.e0.Delete),this._handleEmbeddedBlockDelete),e))}},{key:"getPivotSyncModelEvents",value:function(){var e;return e={},(0,i.Z)(e,d.Zqx.SnapshotChanged,this.handlePivotSnapshotChanged),(0,i.Z)(e,d.Zqx.SnapshotSet,this.initRequsetAndMsgBox),e}},{key:"_handleEmbeddedBlockSet",value:function(e,t){this.initRequsetAndMsgBox({blockToken:t.blockToken})}},{key:"initRequsetAndMsgBox",value:function(e){var t=e.blockToken;this._sdk.spread.pivotService.getRequesterByName(t)||this._createPivotServiceRequester(t),this._msgBoxSubscriptionMap.get(t)||this._registerMsgBox(t)}},{key:"handlePivotSnapshotChanged",value:function(e){var t=e.blockToken,n=(e.data,this._sdk.spread.pivotService.getRequesterByName(t)),r=y(this._sdk.spread,t);if(r){n||(this.initRequsetAndMsgBox({blockToken:t}),n=this._sdk.spread.pivotService.getRequesterByName(t));var o=r.embeddedBlocksModel.getBlock(t).position,i=o.row,a=o.col,s=new v.b$;n.updateVersion().fetchView().then((function(e){s.fromJSON(e),r.inject(g.gJ).renderPivotTableWithPosition(t,i,a,s),"undefined"!=typeof window&&window.dispatchEvent((0,m.t35)("pivotDidRender"))}))}}},{key:"_registerMsgBox",value:function(e){var t=this,n=this._depend.MsgBox;if(void 0!==n){if(!this._msgBoxSubscriptionMap.get(e)){var r=this._getTagOptions(e),o=function(n){t._handleMsgBox(e,n)},i=function(t){console.log("[PIVOT] msgbox error @".concat(e),t)};n.register(r,o),n.onError(r,i),this._msgBoxSubscriptionMap.set(e,(function(){n.deregister(r,o),n.removeErrorListener(r,i)}))}}else console.error("[PIVOT] MsgBox not loaded")}},{key:"_getTagOptions",value:function(e){return{token:"PIVOT_TABLE_".concat(e),resourceType:"PIVOT_TABLE",routeType:"token",routeKey:e,subtype:"PIVOT_VIEW_UPDATE"}}},{key:"destroy",value:function(){this._msgBoxSubscriptionMap.forEach((function(e){return e()})),this._msgBoxSubscriptionMap.clear()}}]),e}();_([(0,p.Bind)()],C.prototype,"_handleEmbeddedBlockSet",null),_([(0,p.Bind)()],C.prototype,"initRequsetAndMsgBox",null),_([(0,p.Bind)()],C.prototype,"handlePivotSnapshotChanged",null);var S=n("vsh_77233"),k=(n("vsh_64365"),n("vsh_32728"))},vsh_24325:function(e,t,n){n.d(t,{Wc:function(){return O},PJ:function(){return M}});var r=n("vsh_1139"),o=n("vsh_74561"),i=n("vsh_19264"),a=n("vsh_4175"),s=n("vsh_65498"),l=n("vsh_24627"),u=n("vsh_88021"),c=n("vsh_72834"),h=n("vsh_83836"),d=n("vsh_55478"),f=n("vsh_67017"),v=n.n(f),p=n("vsh_35067"),g=n("vsh_98652"),m=n("vsh_22023"),_=n("vsh_72429"),y=n("vsh_46544"),C=n("vsh_73043"),S="syncModel",k=function(){function e(t){var n=this;(0,i.Z)(this,e),this.config=t,this._handlePivotTableConfigChange=function(e){e.some((function(e){return e.type===d.ju.SET_AUTO_FIT_COL}))&&n.sheet.dispatch(l.U_F.PivotTableConfigChanged,{pivotTableToken:n.blockToken})},this._checkModalAfterBroadcaster=function(e){e.some((function(e){return e.type===d.ju.FROM_JSON&&e.data.source===S}))&&(y.lY.closeModal()&&l.Ps3.Toast.warning({key:"edit_by_other",content:C("LarkCCM_Sheets_PivotTable_Edited_Toast")}))},this._handleOpAfterBroadcaster=function(e){var t=n.syncModel,r=n.pivotTable.getName();if(t){l.QYs.collectSuiteEvent("sheet_opration",{action:"pivot_table_edit",source:"pivot_edit",action_msg_list:e.map((function(e){return e.type})).join(","),pivot_name:r});var o=(0,c.yzJ)(e),i=o.fromJSONMsg,a=o.validMsgList,s=function(e){return e.data.source!==S};i&&s(i)&&t.setSnapshot(i.data.json);var u=!(!i||!s(i))||a.length>0?[].concat((0,g.Z)(n._collectPreprocessCacheFieldInfoMsgList(e)),(0,g.Z)(a),(0,g.Z)(n._collectCacheFieldInfoMsgList())):a,h=t.getSnapshot(),d=[];try{d=(0,y.Ux)(h,u)}catch(e){console.error("[PIVOT] create ops error! token: ".concat(r),e);var f=u.map((function(e){return e.type}));n.handleSyncError({askToReload:!0,errorType:"create op",error:e,actionNames:f})}if(!(d.length<1)){n.sheet.notifyShell(c._16.RecordFPSLog,"".concat(l.fkS,":").concat(e.map((function(e){return e.type})).join(",")));var v=u.every((function(e){return e.data&&e.data.ignoreUndo})),p=(0,c.QaK)(u);t.opsApply(d,p,{undoable:!Boolean(v)})}}},this._collectPreprocessCacheFieldInfoMsgList=function(e){var t,r=n.pivotTable.getBroadcaster(),o=e.filter((function(e){return e.type===d.ju.REMOVE_CACHE_FIELD_ITEM}));if(0===o.length)return[];var i=n.blockToken,a=null===(t=n.sheet.parent.getPivotSyncModelManager().getSyncModel(i))||void 0===t?void 0:t.getSnapshot();if(!a)return[];var s=a.cacheFieldInfo;return(0,d.iT)(r,(function(){return null==r||r.clearBroadcastList(),o.forEach((function(e){var t=e.data,n=t.sourceInfo,o=t.index,i=s[o];(0,m.default)(n,i)||null==r||r.broadcast({type:d.ju.UPDATE_CACHE_FIELD_ITEM,data:{index:o,oldCacheFieldItem:i,newCacheFieldItem:n}})})),(null==r?void 0:r.getBroadcastMsgList())||[]}))},this._collectCacheFieldInfoMsgList=function(){var e,t=n.pivotTable,r=n.blockToken,o=t.getBroadcaster(),i=n.sheet.parent,a=null===(e=i.getPivotSyncModelManager().getSyncModel(r))||void 0===e?void 0:e.getSnapshot();if(!a||(0,_.default)(a))return[];var s=i.pivotService.getCacheByName(a.cacheName);if(!s)return[];var l=a.cacheFieldInfo,u=s.getDataSourceInfo(!1);return(0,m.default)(l,u)?[]:(0,d.iT)(o,(function(){return null==o||o.clearBroadcastList(),null==o||o.broadcast({type:d.ju.UPDATE_CACHE_FIELD,data:{oldCacheField:l,newCacheField:u,ignoreUndo:!0}}),t._fieldsModel.clearFieldsNotExistInCache(u),(null==o?void 0:o.getBroadcastMsgList())||[]}))},this._handleSnapshotChange=function(){var e=(0,p.Z)(v().mark((function e(t){var r,o,i,a,s,l;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.snapshot,o=t.prevSnapshot,i=t.isPassive,a=n.pivotTable.getName(),i){e.next=4;break}return e.abrupt("return");case 4:return s=(0,c.MPy)(r.rangeId),e.next=7,n.waitSheetLoaded(s);case 7:l=a,r.rangeId!==(null==o?void 0:o.rangeId)&&n.sheet.inject(y.gJ).setPivotSourceRangeByRangeId(l,r.rangeId,null==o?void 0:o.rangeId,!0),n._setPivotTableWithSnapshot(r);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this._handleSyncModelError=function(e){var t,r,o=n.blockToken;console.error("[PIVOT] pivot network error!","token: ".concat(o),e);var i=e.detail,a=null==i||null===(t=i.config)||void 0===t?void 0:t.logId,s="ERROR"===e.type&&String(null==i?void 0:i.requestType).endsWith("/pivot_table/user_change/"),l=i instanceof Error?"nativeError":(null==i?void 0:i.code)||"unknown",u="604144003"===String(l),c="90003088"===String(l);n.handleSyncError({askToReload:s&&!u&&!c,errorType:"syncModel#".concat(l),error:null!==(r=null==i?void 0:i.originalError)&&void 0!==r?r:i,logId:a})},this._setPivotTableWithSnapshot=function(e){var t=n.pivotTableManagerController,r=n.syncModel,o=n.blockToken;if(r){var i=n.sheet.parent,a=t.getPivotTableByName(o);a&&(a.fromJSON((0,c.hs4)(e),S),"crossTableReference"===i.options.situation&&(r.model.getRecord().pauseSync(),t.markDirtyAllPivotTables()))}};var r=t.sheet,o=t.dataDeps,a=t.pivotTable,s=t.syncModel;this.sheet=r,this.pivotTable=a,this.syncModel=s,this.blockToken=a.getName(),this.dataDeps=o,this.pivotBroadcaster=a.getBroadcaster(),this.dataSourceManager=r.inject(c.THe),this.renderManager=r.inject(y.MS),this.pivotTableManagerController=r.inject(y.Cy),this.bindOnlineBroadcaster(),this.bindOnlineSyncModel()}var t;return(0,a.Z)(e,[{key:"fetchSnapshotBySpecificVersion",value:function(e){var t=this.syncModel;t.setVersion(e),t.fetchSnapshot()}},{key:"getSnapshot",value:function(){return this.syncModel.getSnapshot()}},{key:"bindOnlineBroadcaster",value:function(){var e=this.pivotBroadcaster;e.addListener(this._checkModalAfterBroadcaster),e.addListener(this._handleOpAfterBroadcaster),e.addListener(this._handlePivotTableConfigChange)}},{key:"unbindOnlineBroadcaster",value:function(){var e=this.pivotBroadcaster;e.removeListener(this._checkModalAfterBroadcaster),e.removeListener(this._handleOpAfterBroadcaster),e.removeListener(this._handlePivotTableConfigChange)}},{key:"bindOnlineSyncModel",value:function(){var e=this,t=this.syncModel,n=t.onSnapshotSet((function(){var t=e.sheet;t.dispatch(l.U_F.SheetPivotCreated,{sheetId:t.id(),pivotId:e.blockToken}),n()}));t.onSnapshotChange(this._handleSnapshotChange),t.onError(this._handleSyncModelError)}},{key:"unbindOnlineSyncModel",value:function(){var e=this.syncModel;e.onSnapshotChange(this._handleSnapshotChange),e.onError(this._handleSyncModelError)}},{key:"onChannelOffline",value:function(){this.unbindOnlineBroadcaster()}},{key:"onChannelOnline",value:function(){this._setPivotTableWithSnapshot(this.syncModel.getSnapshot()),this.bindOnlineBroadcaster(),this.syncModel.opsApply([],void 0,{undoable:!1})}},{key:"waitSheetLoaded",value:(t=(0,p.Z)(v().mark((function e(t){return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.dataDeps.isSheetLoaded(t)){e.next=3;break}return e.next=3,this.dataDeps.loadSheets([t]);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"handleSyncError",value:function(e){var t,n,r,o=e.askToReload,i=e.errorType,a=e.error,s=e.actionNames,u=e.logId,h=null!=a&&a.message?a:{message:i,data:a};(null===(t=l.Ps3.moirae)||void 0===t||t.ravenCatch(h,{tags:{key:"PIVOT_TABLE_SYNC",pivotErrorType:i,pivotReloaded:o}}),null===(n=l.Ps3.collectSheetEvent)||void 0===n||n.call(l.Ps3,"ccm_sheet_data_pivotd_sync_error_dev",{error_type:i,error_msg:"".concat((null==a?void 0:a.message)||(null==a?void 0:a.msg)||"unknown"),error_stack:(null==a?void 0:a.stack)||"",action_name:null==s?void 0:s.join(","),is_reload:String(o),log_id:u}),o)&&(this.config.showServerErrorModal?this.config.showServerErrorModal({code:c.nl1.ERR_RCE_LIVE_SYNC,reason:"[PIVOT] ".concat(i," - ").concat((null==a?void 0:a.message)||(null==a?void 0:a.msg)||"unknown")},"pivot-table"):null===(r=l.Ps3.Toast)||void 0===r||r.error({key:"pivot_sync_error",content:C("sheet.data_save_fail"),actionText:C("common.refresh"),onActionClick:function(){return location.reload()}}))}},{key:"destory",value:function(){delete this.pivotBroadcaster}}]),e}();function E(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return T(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return T(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var b=function(){function e(t){var n=this;(0,i.Z)(this,e),this.config=t,this.eventsMap=new Map,this.pivotTableWithSyncMap=new Map,this.getBroadcasterByToken=function(e){var t=n.pivotTableManagerV2.getPivotTableByName(e);return null==t?void 0:t.getBroadcaster()},this.getPivotTableWithSync=function(e){return n.pivotTableWithSyncMap.get(e)},this.getPivotTableByToken=function(e){var t;return null===(t=n.pivotTableWithSyncMap.get(e))||void 0===t?void 0:t.pivotTable},this.getSnapshotByToken=function(e){var t;return null===(t=n.pivotTableWithSyncMap.get(e))||void 0===t?void 0:t.getSnapshot()},this.getSyncModelByToken=function(e){return n.sheet.parent.getPivotSyncModelManager().getSyncModel(e)},this.sheet=t.sheet,this.pivotService=this.sheet.parent.pivotService,this.pivotTableController=this.sheet.inject(y.gJ),this.pivotTableManagerV2=this.sheet.inject(c.RSl)}return(0,a.Z)(e,[{key:"getBlockInfoByToken",value:function(e){return this.sheet.embeddedBlocksModel.getBlock(e)}},{key:"handlePivotBlockCreate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=this.getBlockInfoByToken(e);if(n){var r=n.position,o=this.pivotService,i=this.pivotTableManagerV2,a=new d.Zw({cacheName:e,service:o}),s=e;a.setName(s),i.setPivotTable(s,a),i.setCellPivotCache(r.row,r.col,e);var u=this.sheet.parent.getPivotSyncModelManager(),c=u.createSyncModel(e,t);if(c){var h=new k({sheet:this.sheet,pivotTable:a,syncModel:c,dataDeps:this.config.dataDeps,showServerErrorModal:this.config.showServerErrorModal});this.pivotTableWithSyncMap.set(e,h),l.Ps3.Toast.remove(l.iPD.PASTE_PIVOT_TABLE),this.sheet.parent.undoManager()._allowUndo=!0}else console.error("[PIVOT] SyncModel failed to create. Pivot table now runs in offline mode.")}}},{key:"onChannelOffline",value:function(){var e,t=E(this.pivotTableWithSyncMap);try{for(t.s();!(e=t.n()).done;){var n=(0,r.Z)(e.value,2);n[0];n[1].onChannelOffline()}}catch(e){t.e(e)}finally{t.f()}}},{key:"onChannelOnline",value:function(){var e,t=E(this.pivotTableWithSyncMap);try{for(t.s();!(e=t.n()).done;){var n=(0,r.Z)(e.value,2);n[0];n[1].onChannelOnline()}}catch(e){t.e(e)}finally{t.f()}}},{key:"handlePivotBlockUpdate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=this.pivotTableWithSyncMap.get(e);if(!n)return!1;var r=this.sheet.parent.getPivotSyncModelManager(),o=r.getVersion(e),i="number"==typeof t&&o!==t;return!!i&&(n.fetchSnapshotBySpecificVersion(t),!0)}},{key:"handlePivotBlockRefresh",value:function(e){var t=this.getBlockInfoByToken(e);t&&this.pivotTableController.handlePivotBlockUpdate(t)}},{key:"handlePivotBlockDelete",value:function(e){this.pivotTableController.reRenderDeletePivotTable(e)}},{key:"destory",value:function(){var e,t=E(this.pivotTableWithSyncMap);try{for(t.s();!(e=t.n()).done;){var n=(0,r.Z)(e.value,2);n[0];n[1].destory()}}catch(e){t.e(e)}finally{t.f()}}}]),e}(),I=n("vsh_74340"),R=n("vsh_52690"),w=n("vsh_64365"),A=n("vsh_35911"),F=n("vsh_92292");function D(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return N(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return N(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function N(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var P=function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":(0,s.Z)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},O="PivotDataLoaderPlugin",M=function(){function e(t){var n=this;(0,i.Z)(this,e),this.config=t,this.name=O,this.dataLoaderMap=new Map,this.preNetState=I.Giu.online,this.subscription=new R.w,this.setEditable=function(e){n.config.readonly=!e},this._handleChannelStateChange=function(e){var t=e.netState,r=n.preNetState!==t;n.preNetState=t,r&&(t===I.Giu.online?n._onChannelOnline():n._onChannelOffline())},this._handleWorksheetLoaded=function(e){n._createDataLoader(e)},this._createDataLoader=function(e){var t=n.sdk.spread.getSheetFromId(e);if(t&&!n.dataLoaderMap.get(e)){var r=new b({sheet:t,showServerErrorModal:n.config.showServerErrorModal,dataDeps:n.dataDeps});n.dataLoaderMap.set(e,r)}},this._handleEmbeddedBlockSet=function(e,t){var r=n.sdk.spread.getSheetFromId(e);if(r){var o=t.blockToken;if(t.blockType===h.kH.PIVOT_TABLE){n._createDataLoader(e);var i=n.dataLoaderMap.get(e);if(i){var a=n.sdk.spread.getPivotSyncModelManager().getSyncModel(o),s=n._getSpecificVersion(o);a?i.handlePivotBlockUpdate(o,s):i.handlePivotBlockCreate(o,s),n._updateEmbeddedBlockInfo(r,t)}}else console.error("[PIVOT] Cannot create/update pivot - wrong data type!")}},this._updateEmbeddedBlockInfo=function(e,t){var n=e.inject(c.RSl),r=t.blockToken,o=t.position,i=o.row,a=o.col;if(n.getPivotInfoByToken(r))n.updatePivotTableInfo(r,{row:i,col:a});else{var s={row:i,col:a,themeName:"primary",isCopy:!1,isEmpty:!0,errorState:c.bfo.Loading,loaded:!1};n.setPivotTableInfo(r,s)}},this._getSpecificVersion=function(e){return n.config.getHistoryVersionInfo?n.config.getHistoryVersionInfo(e):-1},this._handleEmbeddedBlockDelete=function(e,t){var r=n.dataLoaderMap.get(e);if(r){var o=t.blockToken;r.handlePivotBlockDelete(o),n.sdk.spread.getPivotSyncModelManager().deleteSyncModel(o)}},this._handleEmbeddedBlockRefresh=function(e,t){var r=n.dataLoaderMap.get(e),o=n.sdk.spread.getSheetFromId(e);r&&o&&(r.handlePivotBlockRefresh(t.blockToken),n._updateEmbeddedBlockInfo(o,t))}}return(0,a.Z)(e,[{key:"init",value:function(e){this.sdk=e,this.store=e.pluginStore;var t=e.spread;this.dataDeps=(0,w.O)(e),this._bindCollaBlockPluginEvent(),t.subscribe(this.getWorkbookEvents());var n=this.config.initSheetBlocksManager;"function"==typeof n?(t.sheetBlocksManager||(t.sheetBlocksManager=n(t,t._context.getToken())),this.config.readonly||this._bindServiceEvent()):console.error("no inject initSheetBlocksManager")}},{key:"getWorkbookEvents",value:function(){return(0,o.Z)({},l.HaZ.SheetRemoved,this.handleSheetRemoved)}},{key:"handleSheetRemoved",value:function(e){var t=e.sheet.id(),n=this.dataLoaderMap.get(t);n&&n.destory(),this.dataLoaderMap.delete(t)}},{key:"updateGetHistoryVersionInfoFn",value:function(e){var t,n;this.config.getHistoryVersionInfo=e;var o=null===(t=this.sdk.spread)||void 0===t?void 0:t.getActiveSheet(),i=this.getDataLoader(null==o?void 0:o.id());if(o&&i){var a,s=D(i.pivotTableWithSyncMap);try{for(s.s();!(a=s.n()).done;){var l=(0,r.Z)(a.value,1)[0],u=this._getSpecificVersion(l);!i.handlePivotBlockUpdate(l,u)&&this.sdk.spread.calcEngine.pivotCalculateEngine.markDirtyByBlockToken(l)}}catch(e){s.e(e)}finally{s.f()}null===(n=o.embeddedBlocksModel)||void 0===n||n.raiseAllBlocksSet()}}},{key:"getDataLoader",value:function(e){return this.dataLoaderMap.get(e)}},{key:"_bindServiceEvent",value:function(){var e,t=this.sdk.getService(I.ClJ).subscribeChannelState(this._handleChannelStateChange);null===(e=this.subscription)||void 0===e||e.add(t)}},{key:"_unbindServiceEvent",value:function(){this.subscription.unsubscribe()}},{key:"_onChannelOnline",value:function(){var e,t=D(this.dataLoaderMap);try{for(t.s();!(e=t.n()).done;){var n=(0,r.Z)(e.value,2);n[0];n[1].onChannelOnline()}}catch(e){t.e(e)}finally{t.f()}}},{key:"_onChannelOffline",value:function(){var e,t=D(this.dataLoaderMap);try{for(t.s();!(e=t.n()).done;){var n=(0,r.Z)(e.value,2);n[0];n[1].onChannelOffline()}}catch(e){t.e(e)}finally{t.f()}}},{key:"_bindCollaBlockPluginEvent",value:function(){var e;this.sdk.pluginStore.subscribeEventMap((e={},(0,o.Z)(e,"".concat(u.by,"/").concat(u.e0.Set),this._handleEmbeddedBlockSet),(0,o.Z)(e,"".concat(u.by,"/").concat(u.e0.Delete),this._handleEmbeddedBlockDelete),(0,o.Z)(e,"".concat(u.by,"/").concat(u.e0.Refresh),this._handleEmbeddedBlockRefresh),e)),this.sdk.pluginStore.subscribeEventMap((0,o.Z)({},"".concat(A.qq,"/").concat(A.ke.WorksheetLoaded),this._handleWorksheetLoaded))}},{key:"_unbindCollaBlockPluginEvent",value:function(){var e;this.sdk.pluginStore.unsubscribeEventMap((e={},(0,o.Z)(e,"".concat(u.by,"/").concat(u.e0.Set),this._handleEmbeddedBlockSet),(0,o.Z)(e,"".concat(u.by,"/").concat(u.e0.Delete),this._handleEmbeddedBlockDelete),(0,o.Z)(e,"".concat(u.by,"/").concat(u.e0.Refresh),this._handleEmbeddedBlockRefresh),e)),this.sdk.pluginStore.unsubscribeEventMap((0,o.Z)({},"".concat(A.qq,"/").concat(A.ke.WorksheetLoaded),this._handleWorksheetLoaded))}},{key:"resetDataLoaderMap",value:function(){this.dataLoaderMap.clear()}},{key:"destroy",value:function(){this._unbindCollaBlockPluginEvent(),this._unbindServiceEvent()}}]),e}();P([(0,F.Bind)()],M.prototype,"handleSheetRemoved",null)},vsh_32728:function(e,t,n){n.d(t,{uA:function(){return C},XK:function(){return S}});var r,o=n("vsh_74561"),i=n("vsh_19264"),a=n("vsh_4175"),s=n("vsh_65498"),l=n("vsh_22023"),u=n("vsh_22485"),c=n("vsh_92292"),h=n("vsh_24627"),d=n("vsh_72834");!function(e){e.CACHE_FIELD_INFO_CHANGE="CACHE_FIELD_INFO_CHANGE"}(r||(r={}));var f,v=n("vsh_55478"),p=n("vsh_46544"),g=n("vsh_77233");!function(e){e[e.LOADING=0]="LOADING",e[e.LOADED=1]="LOADED"}(f||(f={}));var m=n("vsh_1084"),_=n("vsh_83836"),y=function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":(0,s.Z)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};var C="PivotFormulaPlugin",S=function(){function e(){var t=this;(0,i.Z)(this,e),this.name=C,this.subscriber=null,this.collectEvents={},this.existingPivotTable=new Set,this.pivotStageStateMap=new Map,this.pivotSnapshotEventHandler=(0,o.Z)({},d.Zqx.SnapshotChanged,this.handlePivotSnapshotChanged),this.handleEmbeddedBlockSet=function(e,n){var r=n.blockToken;if(n.blockType===_.kH.PIVOT_TABLE){var o="".concat(e,"_").concat(r);t.existingPivotTable.has(o)||(t.existingPivotTable.add(o),h.QYs.collect(h.W9G.TIME_TO_VISIT,h.G2P.START,r),h.QYs.collect(h.W9G.TIME_TO_USAGE,h.G2P.START,r))}else console.error("[PIVOT] Cannot create/update pivot - wrong data type!")},this.useWorkerCalculate=(0,g.le)()}return(0,a.Z)(e,[{key:"init",value:function(e){this.sdk=e,this.bindEvents(),this.store=e.pluginStore,this.store.registerModule({namespace:"PivotFormulaStore",state:{},commit:{}})}},{key:"bindEvents",value:function(){this.subscriber=this.sdk.spread.subscribe(this.getWorkbookEvents()),this.sdk.spread.getCalcEngine().pivotCalculateEngine.addPivotCalcEventListener(this.getPivotCalcEvents()),this.sdk.pluginStore.subscribeEventMap((0,o.Z)({},"".concat(m.by,"/").concat(m.e0.Set),this.handleEmbeddedBlockSet)),this.sdk.spread.getPivotSyncModelManager().subscribe(this.pivotSnapshotEventHandler)}},{key:"getWorkbookEvents",value:function(){var e;return e={},(0,o.Z)(e,h.U_F.PivotFormulaCalculated,this.handlePivotFormulaCalculated),(0,o.Z)(e,h.U_F.SheetAllPivotTableLoaded,this.handleAllPivotTableLoaded),e}},{key:"unbindEvents",value:function(){var e,t,n;null===(e=this.subscriber)||void 0===e||e.unsubscribe();var r=null===(t=this.sdk.spread)||void 0===t||null===(n=t.getCalcEngine())||void 0===n?void 0:n.pivotCalculateEngine;null==r||r.removePivotCalcEventListener(this.getPivotCalcEvents()),this.sdk.pluginStore.unsubscribeEventMap((0,o.Z)({},"".concat(m.by,"/").concat(m.e0.Set),this.handleEmbeddedBlockSet))}},{key:"getPivotCalcEvents",value:function(){var e;return e={},(0,o.Z)(e,d.THQ.onCacheCalculateStart,this.handleCacheCalculateStart),(0,o.Z)(e,d.THQ.onCacheCalculated,this.handleCacheCalculated),(0,o.Z)(e,d.THQ.onCubeCalculateStart,this.handleCubeCalculateStart),(0,o.Z)(e,d.THQ.onCubeCalculated,this.handleCubeCalculated),(0,o.Z)(e,d.THQ.onViewCalculateStart,this.handleViewCalculateStart),(0,o.Z)(e,d.THQ.onViewCalculated,this.handleViewCalculated),e}},{key:"handlePivotSnapshotChanged",value:function(e){var t=e.blockToken;e.data.type===d.EGQ.SNAPSHOT_SET&&this.trackAndReportTTU(t,"SnapshotChanged")}},{key:"handleCacheCalculateStart",value:function(e){this.handlePivotPerformanceData(e,h.W9G.CALCULATE_CACHE,h.G2P.START)}},{key:"handleCacheCalculated",value:function(e,t){this.handlePivotPerformanceData(e,h.W9G.CALCULATE_CACHE,t?h.G2P.END:h.G2P.ERROR)}},{key:"handleCubeCalculateStart",value:function(e){this.handlePivotPerformanceData(e,h.W9G.CALCULATE_CUBE,h.G2P.START)}},{key:"handleCubeCalculated",value:function(e,t){this.handlePivotPerformanceData(e,h.W9G.CALCULATE_CUBE,t?h.G2P.END:h.G2P.ERROR)}},{key:"handleViewCalculateStart",value:function(e){this.handlePivotPerformanceData(e,h.W9G.CALCULATE_VIEW,h.G2P.START)}},{key:"handleViewCalculated",value:function(e,t){this.handlePivotPerformanceData(e,h.W9G.CALCULATE_VIEW,t?h.G2P.END:h.G2P.ERROR)}},{key:"handlePivotPerformanceData",value:function(e,t,n){this.collectEvents[e]||(this.collectEvents[e]=[]),this.collectEvents[e].push({pivotName:e,stage:t,status:n,time:performance.now()})}},{key:"reportCollectEvents",value:function(e,t){this.collectEvents[e]&&(h.QYs.fromPendingTrackerInfo(this.collectEvents[e]),this.collectEvents[e]=[]),h.QYs.reportPendingTrackData(e,Object.assign({},t,{enable_worker:this.useWorkerCalculate,spread_pivot_table_count:(0,p.Tv)(this.sdk.spread)}))}},{key:"handlePivotFormulaCalculated",value:function(e){var t,n=e.sheetId,r=e.blockToken,o=this.sdk.spread.getSheetFromId(n);if(o){var i=o.getCalcEngine().pivotCalculateEngine.getFormula(r);if(i){var a=null===(t=i.getState().cache)||void 0===t?void 0:t.getRawVar();if(a){var s=a.getValue(),c=Promise.resolve(),f=s.options,g=function(e){if(!e)return null;var t=e.getRefMap();return t?(0,d.xxt)(t.R1,e.getRef()):null}(i),m=this.sdk.spread.getPivotDataSourceManager().getSourceRange(r),_=this.sdk.spread;if(null!=f&&f.isPassive&&null!=g&&g.isValid()&&!(0,l.default)(g.toJSON(),null==m?void 0:m.toJSON())){var y,C=_.getPivotSyncModelManager(),S=_.getPivotDataSourceManagerV2(),k=null===(y=C.getSyncModel(r))||void 0===y?void 0:y.getSnapshot();if(!k)return;var E=(0,d.rKz)(g,k.rangeId);if(!E)return;S.updateSourceDataRange(r,E,d.kiZ.FORMULA_REF_ADJUST),c.then((function(){_.setDataRange([E],!0)}))}var T=o.inject(p.gJ),b=o.getPivotTableManager().getPivotInfoByName(r);if(b){var I=b.fromPaste;I&&o.getPivotTableManagerV2().updatePivotTableInfo(r,{fromPaste:void 0});var R={error_type:d.bfo[b.errorState],passive:!(null==f||!f.isPassive)},w=s.dataView;if(w instanceof v.b$){this.handlePivotPerformanceData(r,h.W9G.RENDER_VIEW,h.G2P.START);var A=i.getRef(),F=A.rowFrom(),D=A.colFrom(),N=T.renderPivotTableWithPosition(r,F,D,w,{passive:null==f?void 0:f.isPassive,dontAddToCommandStack:I||(null==f?void 0:f.isPassive),checkOldRange:null==f?void 0:f.isPassive});return this.handlePivotPerformanceData(r,h.W9G.RENDER_VIEW,N?h.G2P.ERROR:h.G2P.END),h.QYs.collect(h.W9G.TIME_TO_VISIT,h.G2P.END,r),this.reportCollectEvents(r,R),N?void o.parent.undoManager().undo():void 0}if(this.reportCollectEvents(r,R),a.isError()){var P,O=null===(P=o.getPivotTableManager().getPivotInfoByName(r))||void 0===P?void 0:P.errorState;a.errorType===u.ErrorType.CIRCULAR_DEPENDENCY&&O!==d.bfo.Circle?T.setErrorState(r,d.bfo.Circle):a.errorType===u.ErrorType.WAIT_ASYNC?T.setErrorState(r,d.bfo.Loading):T.setErrorState(r,d.bfo.FormulaError)}}}}}}},{key:"trackAndReportTTU",value:function(e,t){var n,r=null!==(n=this.pivotStageStateMap.get(e))&&void 0!==n?n:{};r[t]=!0,this.pivotStageStateMap.set(e,r),r.SnapshotChanged&&r.UpdateCache&&(h.QYs.collect(h.W9G.TIME_TO_USAGE,h.G2P.END,e),this.pivotStageStateMap.delete(e))}},{key:"handleAllPivotTableLoaded",value:function(){var e,t,n,r=this.sdk.spread.getPivotDataSourceManagerV2();h.QYs.reportAllPivotPerformance({sub_event_name:"all_pivot_table_loaded_event",same_data_source_pivot_count:(e=r.getSourceRangeMap(),t=0,n={},e.forEach((function(e){var r=e.toString({isShowSheetName:!0,ref:e});n[r]=(n[r]||0)+1,n[r]>t&&(t=n[r])})),t)})}},{key:"getCacheByToken",value:function(e){var t,n=this.sdk.spread,r=n.pivotService,o=null===(t=n.getPivotSyncModelManager().getSyncModel(e))||void 0===t?void 0:t.getSnapshot();if(o)return r.getCacheByName(o.cacheName)}},{key:"updateCache",value:function(e,t){var n,r=this.sdk.spread,o=r.pivotService,i=r.getPivotSyncModelManager(),a=r.calcEngine.pivotCalculateEngine,s=null===(n=i.getSyncModel(e))||void 0===n?void 0:n.getSnapshot(),l=a.getPivotSheetByBlockToken(e);s&&t&&s.cacheName&&l&&(o.setCacheByJSON(s.cacheName,t),this.trackAndReportTTU(e,"UpdateCache"),l&&l.dispatch(h.U_F.SheetPivotDataSourceUpdated,{blockToken:e}))}},{key:"handleCacheStatusChange",value:function(e,t){if(t===f.LOADING){var n=this.sdk.spread.calcEngine.pivotCalculateEngine.getPivotSheetByBlockToken(e);n&&n.dispatch(h.U_F.SheetPivotDataSourceUpdating,{blockToken:e})}}},{key:"destroy",value:function(){this.unbindEvents()}}]),e}();y([(0,c.Bind)()],S.prototype,"handlePivotSnapshotChanged",null),y([(0,c.Bind)()],S.prototype,"handleCacheCalculateStart",null),y([(0,c.Bind)()],S.prototype,"handleCacheCalculated",null),y([(0,c.Bind)()],S.prototype,"handleCubeCalculateStart",null),y([(0,c.Bind)()],S.prototype,"handleCubeCalculated",null),y([(0,c.Bind)()],S.prototype,"handleViewCalculateStart",null),y([(0,c.Bind)()],S.prototype,"handleViewCalculated",null),y([(0,c.Bind)()],S.prototype,"reportCollectEvents",null),y([(0,c.Bind)()],S.prototype,"handlePivotFormulaCalculated",null),y([(0,c.Bind)()],S.prototype,"trackAndReportTTU",null),y([(0,c.Bind)()],S.prototype,"handleAllPivotTableLoaded",null),y([(0,c.Bind)()],S.prototype,"handleCacheStatusChange",null)},vsh_80049:function(e,t,n){n.d(t,{i:function(){return r.i},C:function(){return f}});var r=n("vsh_5914"),o=n("vsh_19264"),i=n("vsh_4175"),a=n("vsh_12064"),s=n("vsh_56589"),l=n("vsh_22462"),u=n("vsh_73455"),c=n("vsh_98125"),h=n.n(c),d=n("vsh_73043"),f=function(e){function t(){var e;return(0,o.Z)(this,t),(e=(0,a.Z)(this,(0,l.Z)(t).apply(this,arguments))).hasIgnoreFormulaSecurityDialog=!1,e.STORAGE_KEY="protect-formula-security",e}return(0,u.Z)(t,e),(0,i.Z)(t,[{key:"init",value:function(e){(0,s.Z)((0,l.Z)(t.prototype),"init",this).call(this,e),this.updateIgnoreFormulaSecurity()}},{key:"updateIgnoreFormulaSecurity",value:function(){try{if(!window.localStorage.getItem(this.STORAGE_KEY))return void(this.hasIgnoreFormulaSecurityDialog=!1);this.hasIgnoreFormulaSecurityDialog=!0}catch(e){console.error(e)}}},{key:"clearIgnoreFormulaSecurity",value:function(){try{window.localStorage.removeItem(this.STORAGE_KEY),this.hasIgnoreFormulaSecurityDialog=!1}catch(e){console.error(e)}}},{key:"shouldShowFormulaSecurityDialog",value:function(){return!this.hasIgnoreFormulaSecurityDialog}},{key:"saveCurrentDate",value:function(){try{window.localStorage.setItem(this.STORAGE_KEY,"true")}catch(e){console.error(e)}}},{key:"hideFormulaSecurityDialog",value:function(){this.dialogInstance&&(this.dialogInstance.destroy(),this.dialogInstance=null)}},{key:"showFormulaSecurityDialog",value:function(){var e=this;if(!this.dialogInstance){var t=!1;Promise.resolve().then(n.t.bind(n,"vsh_56450",23)).then((function(n){var r=n.Dialog,o=n.Checkbox;e.dialogInstance=r.info({title:d("LarkCCM_Sheets_Protect_AreaContainProtect_Title"),content:d("LarkCCM_Sheets_Protect_AreaContainProtect_Desc"),okText:d("LarkCCM_Sheets_Protect_AreaContainProtect_Proceed_Button"),cancelText:d("common.cancel"),enableCancelButton:!0,onOk:function(){t&&e.saveCurrentDate(),e.hasIgnoreFormulaSecurityDialog=!0;var n=e.sdk.getPlugin("CellEditorPlugin");null==n||n.endEdit({sheet:e.sdk.spread.getActiveSheet()}),!t&&(e.hasIgnoreFormulaSecurityDialog=!1),e.hideFormulaSecurityDialog()},onCancel:function(){e.hideFormulaSecurityDialog()},onClose:function(){e.hideFormulaSecurityDialog()},extraAction:h().createElement("div",null,h().createElement(o,{onChange:function(e){t=e.target.checked}},h().createElement("span",null,d("LarkCCM_Sheets_Protect_AreaContainProtect_NoRemind_Checkbox"))))})}))}}},{key:"destroy",value:function(){this.hideFormulaSecurityDialog(),(0,s.Z)((0,l.Z)(t.prototype),"destroy",this).call(this)}}]),t}(r.i)},vsh_5914:function(e,t,n){n.d(t,{i:function(){return v}});var r=n("vsh_74561"),o=n("vsh_19264"),i=n("vsh_4175"),a=n("vsh_72834"),s=n("vsh_24627"),l=n("vsh_74340"),u=n("vsh_82905"),c=n("vsh_73043"),h={"-1":s.BX.INVISIBLE,0:s.BX.VISIBLE,1:s.BX.EDITABLE},d=function(e){return"data:image/svg+xml;base64,"+btoa(e)},f=function(e,t){Object.assign(e.style,t)},v=function(){function e(t){var n,r,i=this;(0,o.Z)(this,e),this.readonly=!0,this.isEmbed=!1,this.invisibleMark=null,this.sheetView=null,this.name="ProtectZonePlugin",this.handleUserPermissionChange=function(e){var t=h[e.could_edit];(0,a.vYR)()===e.zone_id&&t!==s.BX.EDITABLE&&i.sdk.getService(u.zv).eventReport({key:"client_sheet_permission_change_message_error",requestId:e.requestId,logId:e.logId}),(0,a.JPx)(e.zone_id,t,e.exist_invisible),i.sdk.spread.permissionManager&&i.sdk.spread.permissionManager.refreshPermission()},this.readonly=null===(n=null==t?void 0:t.readonly)||void 0===n||n,this.isEmbed=null!==(r=null==t?void 0:t.isEmbed)&&void 0!==r&&r}return(0,i.Z)(e,[{key:"init",value:function(e){var t=this;this.sdk=e,this.readonly||(this.protectZoneSubscription=this.sdk.getService(l.ClJ).subscribeExtractChangedEventDataMessage(l.uaV.ZONE_PERMISSION_CHANGE,this.handleUserPermissionChange));var n=this.sdk.spread,o=n.permissionManager;this.isEmbed?o.userPerm.setReady(!0):(this.curSheetVisiblePermSubscribe=o.curSheetVisiblePerm$.subscribe((function(e){var n,r;e?null===(n=t.sheetView)||void 0===n||n.showVisibleSheet():null===(r=t.sheetView)||void 0===r||r.hideInvisibleSheet(o.userPerm.isReady),t.setInvisibleMarkVisible(!e)})),this.curSheetVisiblePermSubscribe.add(n.subscribe((0,r.Z)({},s.HaZ.PermissionReady,(function(){t.setInvisibleMarkVisible(!o.curSheetVisiblePerm)})))))}},{key:"onShellRegistered",value:function(e){this.sheetView=e.sheetView()}},{key:"destroy",value:function(){var e,t;null===(e=this.protectZoneSubscription)||void 0===e||e.unsubscribe(),null===(t=this.curSheetVisiblePermSubscribe)||void 0===t||t.unsubscribe(),this.sdk={}}},{key:"createInvisibleMark",value:function(e){var t=this.sdk.spread,n=t.permissionManager,r=t.getActiveSheet().id()||"",o=!n.hasSheetVisiblePermission(r),i=document.createElement("div");this.invisibleMark=i,i.addEventListener("click",(function(e){e.stopPropagation()})),f(i,{position:"absolute",userSelect:"none",top:"0",left:"0",width:"100%",height:"100%",backgroundColor:"var(--N100)",backgroundImage:"url('".concat(d('\n  <svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg"><g opacity="1"><path d="M1 0L0 1V0H1ZM7 8L8 7V8H7Z" fill="#DEE0E3"/><path d="M0 8V7L7 0H8V1L1 8H0Z" fill="#DEE0E3"/></g></svg>\n'),"')"),backgroundRepeat:"repeat",display:n.userPerm.isReady&&o?"flex":"none",alignItems:"center",justifyContent:"center",cursor:"not-allowed"}),i.id="invisible-mark";var a=document.createElement("div");f(a,{display:"flex",flexDirection:"column",alignItems:"center"});var s=document.createElement("img");s.src=d('<svg width="60" height="60" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M16.25 20V18.75C16.25 11.1561 22.4061 5 30 5C37.5939 5 43.75 11.1561 43.75 18.75V20H50C52.7614 20 55 22.2386 55 25V50C55 52.7614 52.7614 55 50 55H10C7.23858 55 5 52.7614 5 50V25C5 22.2386 7.23858 20 10 20H16.25ZM38.75 18.75C38.75 13.9175 34.8325 10 30 10C25.1675 10 21.25 13.9175 21.25 18.75V20H38.75V18.75ZM36.25 37.5C36.25 34.0482 33.4518 31.25 30 31.25C26.5482 31.25 23.75 34.0482 23.75 37.5C23.75 40.9518 26.5482 43.75 30 43.75C33.4518 43.75 36.25 40.9518 36.25 37.5Z" fill="#BBBFC4"/>\n</svg>\n'),f(s,{height:"60px",width:"60px"}),a.appendChild(s);var l=document.createElement("span");return l.innerText=c("LarkCCM_Sheets_Protect_Sheet_EmptyStateText"),f(l,{fontSize:"14px",color:"var(--text-caption)",marginTop:"20px"}),a.appendChild(l),i.appendChild(a),e.appendChild(i),i}},{key:"setInvisibleMarkVisible",value:function(e){this.invisibleMark&&this.sdk.spread.permissionManager.userPerm.isReady&&(this.invisibleMark.style.display=e?"flex":"none")}},{key:"updateHost",value:function(e){this.invisibleMark&&e.appendChild(this.invisibleMark)}}]),e}()},vsh_20680:function(e,t,n){n.d(t,{hM:function(){return r},B_:function(){return te},jm:function(){return ee},_D:function(){return V},aK:function(){return W}});var r,o,i,a=n("vsh_1139"),s=n("vsh_19264"),l=n("vsh_4175"),u=n("vsh_85001"),c=n("vsh_65725"),h=n("vsh_24627"),d=n("vsh_72834"),f=n("vsh_74561");!function(e){e.ADD_ROW_OR_COL_AHEAD="addRowOrColAhead",e.ADD_ROW_OR_COL_BEHIND="addRowOrColBehind",e.AUTO_FILL_RANGE="autoFillRange",e.BOLD="bold",e.BOTTOM_BORDER="bottomBorder",e.CANCEL_BORDER="cancelBorder",e.CLEAR="clear",e.CLEAR2="clear2",e.COMMENT="comment",e.COPY="copy",e.CUT="cut",e.DECREASE_FONT_SIZE="decreaseFontSize",e.DEL_ROW_OR_COL="delRowOrCol",e.DO_CLEAR="doClear",e.FILTER="filter",e.FIND="find",e.FIND_AND_REPLACE="findAndReplace",e.FORMAT_PAINTING="formatPainting",e.H_ALIGN_CENTER="hAlignCenter",e.H_ALIGN_LEFT="hAlignLeft",e.H_ALIGN_RIGHT="hAlignRight",e.HORIZONTAL_FILL_BY_SHORTCUT="horizontalFillByShortcut",e.HIDE_COL="hideCol",e.HIDE_ROW="hideRow",e.INCREASE_FONT_SIZE="increaseFontSize",e.INSERT_DATE="insertDate",e.INSERT_TIME="insertTime",e.ITALIC="italic",e.LEFT_BORDER="leftBorder",e.LINE_THROUGH="lineThrough",e.LINK="link",e.MERGE_AND_SPLIT="mergeAndSplit",e.MODIFY_TO_STRING="modifyToString",e.MOVE_ACTIVE="moveActive",e.MOVE_END="moveEnd",e.MOVE_HEAD="moveHead",e.MOVE_TO_NEXT_CELL="moveToNextCell",e.MOVE_TO_PREVIOUS_CELL="moveToPreviousCell",e.NAVIGATION_BOTTOM="navigationBottom",e.NAVIGATION_DOWN="navigationDown",e.NAVIGATION_DOWN2="navigationDown2",e.NAVIGATION_END="navigationEnd",e.NAVIGATION_END_2="navigationEnd2",e.NAVIGATION_HOME="navigationHome",e.NAVIGATION_HOME_2="navigationHome2",e.NAVIGATION_LEFT="navigationLeft",e.NAVIGATION_PAGE_DOWN="navigationPageDown",e.NAVIGATION_PAGE_UP="navigationPageUp",e.NAVIGATION_NEXT_SHEET="navigationNextSheet",e.NAVIGATION_NEXT_SHEET2="navigationNextSheet2",e.NAVIGATION_PREVIOUS_SHEET="navigationPreviousSheet",e.NAVIGATION_PREVIOUS_SHEET2="navigationPreviousSheet2",e.NAVIGATION_RIGHT="navigationRight",e.NAVIGATION_TOP="navigationTop",e.NAVIGATION_UP="navigationUp",e.NAVIGATION_UP2="navigationUp2",e.NEW_SHEET_TAB="newSheetTab",e.OPEN_COMMENT="openComment",e.OPEN_CONTEXT_MENU="openContextMenu",e.OPEN_FILTER_MENU="openFilterMenu",e.OPEN_GUIDE_BAR="openGuideBar",e.OPEN_HYPER_LINK="openHyperLink",e.PASTE="paste",e.PASTE_FORMATS_ONLY="pasteFormatsOnly",e.PASTE_VALUES_ONLY="pasteValuesOnly",e.PREVENT_SAVE="preventSave",e.QUICK_SUM="quickSum",e.REDO="redo",e.REDO2="redo2",e.RIGHT_BORDER="rightBorder",e.SELECT_ALL="selectAll",e.SELECT_COLUMN="selectColumn",e.SELECT_ROW="selectRow",e.SELECTION_LEFT="selectionLeft",e.SELECTION_RIGHT="selectionRight",e.SELECTION_UP="selectionUp",e.SELECTION_DOWN="selectionDown",e.SELECTION_HOME="selectionHome",e.SELECTION_END="selectionEnd",e.SELECTION_PAGEUP="selectionPageUp",e.SELECTION_PAGEDOWN="selectionPageDown",e.SELECTION_TOP="selectionTop",e.SELECTION_BOTTOM="selectionBottom",e.SELECTION_FIRST="selectionFirst",e.SELECTION_LAST="selectionLast",e.SHOW_ALL_TABS="showAllTabs",e.SORT="sort",e.TO_DATE="toDate",e.TO_DECIMAL="toDecimal",e.TO_MONEY="toMoney",e.TO_PERCENTAGE="toPercentage",e.TO_SCIENTIFIC="toScientific",e.TO_TIME="toTime",e.TOGGLE_FORMULA_DISPLAY="toggleFormulaDisplay",e.TOGGLE_HISTORY_PANEL="toggleHistoryPanel",e.TOP_BORDER="topBorder",e.UNDERLINE="underline",e.UNDO="undo",e.UNHIDE_COL="unhideCOl",e.UNHIDE_ROW="unhideRow",e.VERTICAL_FILL_BY_SHORTCUT="verticalFillByShortcut",e.CANCEL_INPUT="cancelInput",e.PRINT="print",e.ADD_NOTE="addNote",e.ADD_OUTLINE="addOutline",e.DEL_OUTLINE="delOutline"}(r||(r={})),function(e){e.MAC="MAC",e.WINDOWS="WINDOWS",e.IPAD="IPAD",e.UNKNOWN="UNKNOWN",e.UNIVERSAL="UNIVERSAL"}(o||(o={}));var v,p,g,m,_=(i={},(0,f.Z)(i,r.ADD_ROW_OR_COL_AHEAD,{fnName:r.ADD_ROW_OR_COL_AHEAD,keyCode:h.VDZ.Plus,shownKey:"+",shiftKey:!0,metaKey:!0,disableWhileEditing:!0}),(0,f.Z)(i,r.ADD_ROW_OR_COL_BEHIND,{fnName:r.ADD_ROW_OR_COL_BEHIND,keyCode:h.VDZ.BracketRight,shownKey:"}",shiftKey:!0,metaKey:!0,disableWhileEditing:!0}),(0,f.Z)(i,r.BOTTOM_BORDER,{fnName:r.BOTTOM_BORDER,keyCode:h.VDZ.Digit3,shownKey:"3",altKey:!0,shiftKey:!0}),(0,f.Z)(i,r.CANCEL_BORDER,{fnName:r.CANCEL_BORDER,keyCode:h.VDZ.Digit5,shownKey:"5",shiftKey:!0,altKey:!0}),(0,f.Z)(i,r.COMMENT,{fnName:r.COMMENT,keyCode:h.VDZ.M,shownKey:"M",ctrlKey:!0,altKey:!0,cancelDefault:!0,doNotNeedEditPermission:!0}),(0,f.Z)(i,r.DECREASE_FONT_SIZE,{fnName:r.DECREASE_FONT_SIZE,keyCode:h.VDZ.Comma,shownKey:",",ctrlKey:!0,shiftKey:!0,disableWhileEditing:!0}),(0,f.Z)(i,r.DEL_ROW_OR_COL,{fnName:r.DEL_ROW_OR_COL,keyCode:h.VDZ.Minus,shownKey:"-",ctrlKey:!0,altKey:!0,disableWhileEditing:!0}),(0,f.Z)(i,r.FORMAT_PAINTING,{fnName:r.FORMAT_PAINTING,keyCode:h.VDZ.C,shownKey:"C",ctrlKey:!0,metaKey:!0}),(0,f.Z)(i,r.FILTER,{fnName:r.FILTER,keyCode:h.VDZ.L,shownKey:"L",shiftKey:!0,metaKey:!0}),(0,f.Z)(i,r.H_ALIGN_CENTER,{fnName:r.H_ALIGN_CENTER,keyCode:h.VDZ.E,shownKey:"E",ctrlKey:!0,shiftKey:!0}),(0,f.Z)(i,r.H_ALIGN_LEFT,{fnName:r.H_ALIGN_LEFT,keyCode:h.VDZ.L,shownKey:"L",ctrlKey:!0,shiftKey:!0,cancelDefault:!0}),(0,f.Z)(i,r.H_ALIGN_RIGHT,{fnName:r.H_ALIGN_RIGHT,keyCode:h.VDZ.R,shownKey:"R",ctrlKey:!0,shiftKey:!0,cancelDefault:!0}),(0,f.Z)(i,r.HIDE_COL,{fnName:r.HIDE_COL,keyCode:h.VDZ.Digit0,shownKey:"0",ctrlKey:!0,altKey:!0,disableWhileEditing:!0}),(0,f.Z)(i,r.HIDE_ROW,{fnName:r.HIDE_ROW,keyCode:h.VDZ.Digit9,shownKey:"9",ctrlKey:!0,altKey:!0,disableWhileEditing:!0}),(0,f.Z)(i,r.HORIZONTAL_FILL_BY_SHORTCUT,{fnName:r.HORIZONTAL_FILL_BY_SHORTCUT,keyCode:h.VDZ.R,shownKey:"R",ctrlKey:!0,cancelDefault:!0}),(0,f.Z)(i,r.INCREASE_FONT_SIZE,{fnName:r.INCREASE_FONT_SIZE,keyCode:h.VDZ.Dot,shownKey:">",ctrlKey:!0,shiftKey:!0,disableWhileEditing:!0}),(0,f.Z)(i,r.INSERT_TIME,{fnName:r.INSERT_TIME,keyCode:h.VDZ.Semicolon,shownKey:";",ctrlKey:!0,shiftKey:!0,cancelDefault:!0,disableWhileEditing:!0}),(0,f.Z)(i,r.LEFT_BORDER,{fnName:r.LEFT_BORDER,keyCode:h.VDZ.Digit4,shownKey:"4",altKey:!0,shiftKey:!0}),(0,f.Z)(i,r.LINE_THROUGH,{fnName:r.LINE_THROUGH,keyCode:h.VDZ.X,shownKey:"X",ctrlKey:!0,shiftKey:!0,disableWhileEditing:!0}),(0,f.Z)(i,r.MERGE_AND_SPLIT,{fnName:r.MERGE_AND_SPLIT,keyCode:h.VDZ.D,shownKey:"D",shiftKey:!0,altKey:!0,cancelDefault:!0}),(0,f.Z)(i,r.MODIFY_TO_STRING,{fnName:r.MODIFY_TO_STRING,keyCode:h.VDZ.S,shownKey:"S",ctrlKey:!0,shiftKey:!0,cancelDefault:!0}),(0,f.Z)(i,r.NAVIGATION_NEXT_SHEET,{fnName:r.NAVIGATION_NEXT_SHEET,keyCode:h.VDZ.PageDown,shownKey:"PageDown",ctrlKey:!0,disableWhileEditing:!0,doNotNeedEditPermission:!0,doNotNeedFocusSheet:!0}),(0,f.Z)(i,r.NAVIGATION_PREVIOUS_SHEET,{fnName:r.NAVIGATION_PREVIOUS_SHEET,keyCode:h.VDZ.PageUp,shownKey:"PageUp",ctrlKey:!0,disableWhileEditing:!0,doNotNeedEditPermission:!0,doNotNeedFocusSheet:!0}),(0,f.Z)(i,r.OPEN_COMMENT,{fnName:r.OPEN_COMMENT,keyCode:h.VDZ.M,shownKey:"M",ctrlKey:!0,shiftKey:!0,cancelDefault:!0,doNotNeedEditPermission:!0}),(0,f.Z)(i,r.OPEN_CONTEXT_MENU,{fnName:r.OPEN_CONTEXT_MENU,keyCode:h.VDZ.I,shownKey:"I",metaKey:!0,altKey:!0,code:"KeyI",cancelDefault:!0}),(0,f.Z)(i,r.OPEN_FILTER_MENU,{fnName:r.OPEN_FILTER_MENU,keyCode:h.VDZ.R,shownKey:"R",ctrlKey:!0,metaKey:!0,cancelDefault:!0}),(0,f.Z)(i,r.OPEN_GUIDE_BAR,{fnName:r.OPEN_GUIDE_BAR,keyCode:h.VDZ.H,shownKey:"H",metaKey:!0,altKey:!0,doNotNeedEditPermission:!0}),(0,f.Z)(i,r.PASTE_FORMATS_ONLY,{fnName:r.PASTE_FORMATS_ONLY,keyCode:h.VDZ.V,shownKey:"V",shouldEndEditing:!0,ctrlKey:!0,altKey:!0}),(0,f.Z)(i,r.PASTE_VALUES_ONLY,{fnName:r.PASTE_VALUES_ONLY,keyCode:h.VDZ.V,shownKey:"V",shouldEndEditing:!0,ctrlKey:!0,shiftKey:!0}),(0,f.Z)(i,r.QUICK_SUM,{fnName:r.QUICK_SUM,keyCode:h.VDZ.Plus,shownKey:"=",ctrlKey:!0,altKey:!0,disableWhileEditing:!0}),(0,f.Z)(i,r.REDO2,{fnName:r.REDO,keyCode:h.VDZ.Z,shownKey:"Z",ctrlKey:!0,shiftKey:!0,doNotNeedEditPermission:!0}),(0,f.Z)(i,r.RIGHT_BORDER,{fnName:r.RIGHT_BORDER,keyCode:h.VDZ.Digit2,shownKey:"2",altKey:!0,shiftKey:!0}),(0,f.Z)(i,r.SELECT_COLUMN,{fnName:r.SELECT_COLUMN,keyCode:h.VDZ.Space,shownKey:"Space",altKey:!0,disableWhileEditing:!0}),(0,f.Z)(i,r.SHOW_ALL_TABS,{fnName:r.SHOW_ALL_TABS,keyCode:h.VDZ.K,shownKey:"K",shiftKey:!0,altKey:!0,doNotNeedEditPermission:!0}),(0,f.Z)(i,r.SORT,{fnName:r.SORT,keyCode:h.VDZ.F,shownKey:"F",shiftKey:!0,altKey:!0,disableWhileEditing:!0}),(0,f.Z)(i,r.TOGGLE_FORMULA_DISPLAY,{fnName:r.TOGGLE_FORMULA_DISPLAY,keyCode:h.VDZ.Grave,shownKey:"`",metaKey:!0,shouldEndEditing:!0,doNotNeedEditPermission:!0}),(0,f.Z)(i,r.TOGGLE_HISTORY_PANEL,{fnName:r.TOGGLE_HISTORY_PANEL,keyCode:h.VDZ.H,shownKey:"H",ctrlKey:!0,shiftKey:!0,altKey:!0,shouldEndEditing:!0,cancelDefault:!0}),(0,f.Z)(i,r.TOP_BORDER,{fnName:r.TOP_BORDER,keyCode:h.VDZ.Digit1,shownKey:"1",altKey:!0,shiftKey:!0,shouldEndEditing:!0}),(0,f.Z)(i,r.TO_DATE,{fnName:r.TO_DATE,keyCode:h.VDZ.Digit3,shownKey:"3",shiftKey:!0,metaKey:!0,shouldEndEditing:!0}),(0,f.Z)(i,r.TO_DECIMAL,{fnName:r.TO_DECIMAL,keyCode:h.VDZ.Digit1,shownKey:"1",shiftKey:!0,metaKey:!0,shouldEndEditing:!0}),(0,f.Z)(i,r.TO_MONEY,{fnName:r.TO_MONEY,keyCode:h.VDZ.Digit4,shownKey:"4",shiftKey:!0,metaKey:!0,shouldEndEditing:!0}),(0,f.Z)(i,r.TO_PERCENTAGE,{fnName:r.TO_PERCENTAGE,keyCode:h.VDZ.Digit5,shownKey:"5",shiftKey:!0,metaKey:!0,shouldEndEditing:!0}),(0,f.Z)(i,r.TO_SCIENTIFIC,{fnName:r.TO_SCIENTIFIC,keyCode:h.VDZ.Digit6,shownKey:"6",shiftKey:!0,metaKey:!0,shouldEndEditing:!0}),(0,f.Z)(i,r.TO_TIME,{fnName:r.TO_TIME,keyCode:h.VDZ.Digit2,shownKey:"2",shiftKey:!0,metaKey:!0,shouldEndEditing:!0}),(0,f.Z)(i,r.UNHIDE_COL,{fnName:r.UNHIDE_COL,keyCode:h.VDZ.Digit0,shownKey:"0",ctrlKey:!0,shiftKey:!0}),(0,f.Z)(i,r.UNHIDE_ROW,{fnName:r.UNHIDE_ROW,keyCode:h.VDZ.Digit9,shownKey:"9",ctrlKey:!0,shiftKey:!0}),i),y=(v={},(0,f.Z)(v,r.ADD_ROW_OR_COL_AHEAD,{fnName:r.ADD_ROW_OR_COL_AHEAD,keyCode:h.VDZ.Plus,shownKey:"+",ctrlKey:!0,altKey:!0,disableWhileEditing:!0}),(0,f.Z)(v,r.ADD_ROW_OR_COL_BEHIND,{fnName:r.ADD_ROW_OR_COL_BEHIND,keyCode:h.VDZ.BracketRight,shownKey:"]",ctrlKey:!0,altKey:!0,disableWhileEditing:!0}),(0,f.Z)(v,r.BOTTOM_BORDER,{fnName:r.BOTTOM_BORDER,keyCode:h.VDZ.Digit3,shownKey:"3",altKey:!0,shiftKey:!0}),(0,f.Z)(v,r.CANCEL_BORDER,{fnName:r.CANCEL_BORDER,keyCode:h.VDZ.Digit5,shownKey:"5",shiftKey:!0,altKey:!0,cancelDefault:!0}),(0,f.Z)(v,r.COMMENT,{fnName:r.COMMENT,keyCode:h.VDZ.M,shownKey:"M",ctrlKey:!0,altKey:!0,cancelDefault:!0,doNotNeedEditPermission:!0}),(0,f.Z)(v,r.DECREASE_FONT_SIZE,{fnName:r.DECREASE_FONT_SIZE,keyCode:h.VDZ.Comma,shownKey:"<",shiftKey:!0,altKey:!0,disableWhileEditing:!0}),(0,f.Z)(v,r.DEL_ROW_OR_COL,{fnName:r.DEL_ROW_OR_COL,keyCode:h.VDZ.Minus,shownKey:"-",ctrlKey:!0,altKey:!0,disableWhileEditing:!0}),(0,f.Z)(v,r.FORMAT_PAINTING,{fnName:r.FORMAT_PAINTING,keyCode:h.VDZ.C,shownKey:"C",shiftKey:!0,altKey:!0}),(0,f.Z)(v,r.FILTER,{fnName:r.FILTER,keyCode:h.VDZ.L,shownKey:"L",shiftKey:!0,altKey:!0}),(0,f.Z)(v,r.H_ALIGN_CENTER,{fnName:r.H_ALIGN_CENTER,keyCode:h.VDZ.E,shownKey:"E",ctrlKey:!0,shiftKey:!0}),(0,f.Z)(v,r.H_ALIGN_LEFT,{fnName:r.H_ALIGN_LEFT,keyCode:h.VDZ.L,shownKey:"L",ctrlKey:!0,shiftKey:!0}),(0,f.Z)(v,r.H_ALIGN_RIGHT,{fnName:r.H_ALIGN_RIGHT,keyCode:h.VDZ.R,shownKey:"R",ctrlKey:!0,shiftKey:!0,cancelDefault:!0}),(0,f.Z)(v,r.HIDE_COL,{fnName:r.HIDE_COL,keyCode:h.VDZ.Digit0,shownKey:"0",ctrlKey:!0,altKey:!0,disableWhileEditing:!0}),(0,f.Z)(v,r.HIDE_ROW,{fnName:r.HIDE_ROW,keyCode:h.VDZ.Digit9,shownKey:"9",ctrlKey:!0,altKey:!0,disableWhileEditing:!0}),(0,f.Z)(v,r.HORIZONTAL_FILL_BY_SHORTCUT,{fnName:r.HORIZONTAL_FILL_BY_SHORTCUT,keyCode:h.VDZ.R,shownKey:"R",ctrlKey:!0,cancelDefault:!0}),(0,f.Z)(v,r.INCREASE_FONT_SIZE,{fnName:r.INCREASE_FONT_SIZE,keyCode:h.VDZ.Dot,shownKey:">",shiftKey:!0,altKey:!0,disableWhileEditing:!0}),(0,f.Z)(v,r.INSERT_TIME,{fnName:r.INSERT_TIME,keyCode:h.VDZ.Semicolon,shownKey:";",ctrlKey:!0,shiftKey:!0,cancelDefault:!0,disableWhileEditing:!0}),(0,f.Z)(v,r.LEFT_BORDER,{fnName:r.LEFT_BORDER,keyCode:h.VDZ.Digit4,shownKey:"4",altKey:!0,shiftKey:!0}),(0,f.Z)(v,r.LINE_THROUGH,{fnName:r.LINE_THROUGH,keyCode:h.VDZ.X,shownKey:"X",ctrlKey:!0,shiftKey:!0,disableWhileEditing:!0}),(0,f.Z)(v,r.MERGE_AND_SPLIT,{fnName:r.MERGE_AND_SPLIT,keyCode:h.VDZ.D,shownKey:"D",shiftKey:!0,altKey:!0,cancelDefault:!0}),(0,f.Z)(v,r.NAVIGATION_NEXT_SHEET,{fnName:r.NAVIGATION_NEXT_SHEET,keyCode:h.VDZ.PageDown,shownKey:"PageDown",ctrlKey:!0,shiftKey:!0,disableWhileEditing:!0,doNotNeedEditPermission:!0,doNotNeedFocusSheet:!0}),(0,f.Z)(v,r.NAVIGATION_PREVIOUS_SHEET,{fnName:r.NAVIGATION_PREVIOUS_SHEET,keyCode:h.VDZ.PageUp,shownKey:"PageUp",ctrlKey:!0,shiftKey:!0,disableWhileEditing:!0,doNotNeedEditPermission:!0,doNotNeedFocusSheet:!0}),(0,f.Z)(v,r.MODIFY_TO_STRING,{fnName:r.MODIFY_TO_STRING,keyCode:h.VDZ.S,shownKey:"S",ctrlKey:!0,shiftKey:!0}),(0,f.Z)(v,r.OPEN_COMMENT,{fnName:r.OPEN_COMMENT,keyCode:h.VDZ.M,shownKey:"M",ctrlKey:!0,shiftKey:!0,cancelDefault:!0,doNotNeedEditPermission:!0}),(0,f.Z)(v,r.OPEN_CONTEXT_MENU,{fnName:r.OPEN_CONTEXT_MENU,keyCode:h.VDZ.I,shownKey:"I",shiftKey:!0,altKey:!0,cancelDefault:!0}),(0,f.Z)(v,r.OPEN_FILTER_MENU,{fnName:r.OPEN_FILTER_MENU,keyCode:h.VDZ.R,shownKey:"R",ctrlKey:!0,altKey:!0}),(0,f.Z)(v,r.OPEN_GUIDE_BAR,{fnName:r.OPEN_GUIDE_BAR,keyCode:h.VDZ.H,shownKey:"H",shiftKey:!0,altKey:!0,doNotNeedEditPermission:!0}),(0,f.Z)(v,r.PASTE_FORMATS_ONLY,{fnName:r.PASTE_FORMATS_ONLY,keyCode:h.VDZ.V,shownKey:"V",shouldEndEditing:!0,ctrlKey:!0,altKey:!0}),(0,f.Z)(v,r.PASTE_VALUES_ONLY,{fnName:r.PASTE_VALUES_ONLY,keyCode:h.VDZ.V,shownKey:"V",shouldEndEditing:!0,ctrlKey:!0,shiftKey:!0}),(0,f.Z)(v,r.QUICK_SUM,{fnName:r.QUICK_SUM,keyCode:h.VDZ.Plus,shownKey:"=",altKey:!0,disableWhileEditing:!0}),(0,f.Z)(v,r.REDO2,{fnName:r.REDO,keyCode:h.VDZ.Z,shownKey:"Z",ctrlKey:!0,shiftKey:!0,doNotNeedEditPermission:!0}),(0,f.Z)(v,r.RIGHT_BORDER,{fnName:r.RIGHT_BORDER,keyCode:h.VDZ.Digit2,shownKey:"2",altKey:!0,shiftKey:!0}),(0,f.Z)(v,r.SELECT_COLUMN,{fnName:r.SELECT_COLUMN,keyCode:h.VDZ.Space,shownKey:"Space",ctrlKey:!0,altKey:!0,disableWhileEditing:!0,doNotNeedEditPermission:!0}),(0,f.Z)(v,r.SHOW_ALL_TABS,{fnName:r.SHOW_ALL_TABS,keyCode:h.VDZ.K,shownKey:"K",shiftKey:!0,altKey:!0,doNotNeedEditPermission:!0}),(0,f.Z)(v,r.SORT,{fnName:r.SORT,keyCode:h.VDZ.F,shownKey:"F",shiftKey:!0,altKey:!0,disableWhileEditing:!0}),(0,f.Z)(v,r.TOGGLE_FORMULA_DISPLAY,{fnName:r.TOGGLE_FORMULA_DISPLAY,keyCode:h.VDZ.Grave,shownKey:"`",ctrlKey:!0,shouldEndEditing:!0,doNotNeedEditPermission:!0}),(0,f.Z)(v,r.TOGGLE_HISTORY_PANEL,{fnName:r.TOGGLE_HISTORY_PANEL,keyCode:h.VDZ.H,shownKey:"H",ctrlKey:!0,shiftKey:!0,altKey:!0}),(0,f.Z)(v,r.TOP_BORDER,{fnName:r.TOP_BORDER,shownKey:"1",keyCode:h.VDZ.Digit1,altKey:!0,shiftKey:!0}),(0,f.Z)(v,r.TO_DATE,{fnName:r.TO_DATE,keyCode:h.VDZ.Digit3,shownKey:"3",ctrlKey:!0,shiftKey:!0,shouldEndEditing:!0}),(0,f.Z)(v,r.TO_DECIMAL,{fnName:r.TO_DECIMAL,keyCode:h.VDZ.Digit1,shownKey:"1",ctrlKey:!0,shiftKey:!0,shouldEndEditing:!0}),(0,f.Z)(v,r.TO_MONEY,{fnName:r.TO_MONEY,keyCode:h.VDZ.Digit4,shownKey:"4",ctrlKey:!0,shiftKey:!0,shouldEndEditing:!0}),(0,f.Z)(v,r.TO_PERCENTAGE,{fnName:r.TO_PERCENTAGE,keyCode:h.VDZ.Digit5,shownKey:"5",ctrlKey:!0,shiftKey:!0,shouldEndEditing:!0}),(0,f.Z)(v,r.TO_SCIENTIFIC,{fnName:r.TO_SCIENTIFIC,keyCode:h.VDZ.Digit6,shownKey:"6",ctrlKey:!0,shiftKey:!0,shouldEndEditing:!0}),(0,f.Z)(v,r.TO_TIME,{fnName:r.TO_TIME,keyCode:h.VDZ.Digit2,shownKey:"2",ctrlKey:!0,shiftKey:!0,shouldEndEditing:!0}),(0,f.Z)(v,r.UNHIDE_COL,{fnName:r.UNHIDE_COL,keyCode:h.VDZ.Digit0,shownKey:"0",ctrlKey:!0,shiftKey:!0}),(0,f.Z)(v,r.UNHIDE_ROW,{fnName:r.UNHIDE_ROW,keyCode:h.VDZ.Digit9,shownKey:"9",ctrlKey:!0,shiftKey:!0}),v),C=(p={},(0,f.Z)(p,r.NAVIGATION_NEXT_SHEET,{fnName:r.NAVIGATION_NEXT_SHEET,keyCode:h.VDZ.PageDown,shownKey:"PageDown",metaKey:!0,disableWhileEditing:!0,doNotNeedEditPermission:!0,doNotNeedFocusSheet:!0}),(0,f.Z)(p,r.NAVIGATION_NEXT_SHEET2,{fnName:r.NAVIGATION_NEXT_SHEET2,keyCode:h.VDZ.Down,shownKey:"ArrowDown",altKey:!0,metaKey:!0,disableWhileEditing:!0,doNotNeedEditPermission:!0}),(0,f.Z)(p,r.NAVIGATION_PREVIOUS_SHEET,{fnName:r.NAVIGATION_PREVIOUS_SHEET,keyCode:h.VDZ.PageUp,shownKey:"PageUp",metaKey:!0,disableWhileEditing:!0,doNotNeedEditPermission:!0,doNotNeedFocusSheet:!0}),(0,f.Z)(p,r.SELECTION_BOTTOM,{fnName:r.SELECTION_BOTTOM,keyCode:h.VDZ.Down,shownKey:"ArrowDown",metaKey:!0,shiftKey:!0,doNotNeedEditPermission:!0}),(0,f.Z)(p,r.SELECTION_END,{fnName:r.SELECTION_END,keyCode:h.VDZ.Right,shownKey:"ArrowRight",metaKey:!0,shiftKey:!0,doNotNeedEditPermission:!0}),(0,f.Z)(p,r.SELECTION_HOME,{fnName:r.SELECTION_HOME,keyCode:h.VDZ.Left,shownKey:"ArrowLeft",metaKey:!0,shiftKey:!0,doNotNeedEditPermission:!0}),(0,f.Z)(p,r.SELECTION_TOP,{fnName:r.SELECTION_TOP,keyCode:h.VDZ.Up,shownKey:"ArrowUp",metaKey:!0,shiftKey:!0,doNotNeedEditPermission:!0}),p),S=(g={},(0,f.Z)(g,r.AUTO_FILL_RANGE,{fnName:r.AUTO_FILL_RANGE,keyCode:h.VDZ.Enter,shownKey:"Enter",ctrlKey:!0,cancelDefault:!0,disableWhileEditing:!0}),(0,f.Z)(g,r.BOLD,{fnName:r.BOLD,keyCode:h.VDZ.B,shownKey:"B",ctrlKey:!0,cancelDefault:!0,disableWhileEditing:!0}),(0,f.Z)(g,r.CLEAR,{fnName:r.CLEAR,keyCode:h.VDZ.Delete,shownKey:"Delete",disableWhileEditing:!0}),(0,f.Z)(g,r.CLEAR2,{fnName:r.CLEAR,keyCode:h.VDZ.BackSpace,shownKey:"BackSpace",disableWhileEditing:!0}),(0,f.Z)(g,r.COPY,{fnName:r.COPY,keyCode:h.VDZ.C,shownKey:"C",ctrlKey:!0,disableWhileEditing:{exception:"noSelectionSummary"},doNotNeedEditPermission:!0}),(0,f.Z)(g,r.CUT,{fnName:r.CUT,keyCode:h.VDZ.X,shownKey:"X",ctrlKey:!0,disableWhileEditing:!0}),(0,f.Z)(g,r.DO_CLEAR,{fnName:r.DO_CLEAR,keyCode:h.VDZ["\\"],shownKey:"\\",ctrlKey:!0}),(0,f.Z)(g,r.FIND,{fnName:r.FIND,keyCode:h.VDZ.F,shownKey:"F",ctrlKey:!0}),(0,f.Z)(g,r.FIND_AND_REPLACE,{fnName:r.FIND_AND_REPLACE,keyCode:h.VDZ.H,shownKey:"H",ctrlKey:!0,shiftKey:!0}),(0,f.Z)(g,r.INSERT_DATE,{fnName:r.INSERT_DATE,keyCode:h.VDZ.Semicolon,shownKey:";",ctrlKey:!0,cancelDefault:!0,disableWhileEditing:!0}),(0,f.Z)(g,r.ITALIC,{fnName:r.ITALIC,keyCode:h.VDZ.I,shownKey:"I",ctrlKey:!0,cancelDefault:!0,disableWhileEditing:!0}),(0,f.Z)(g,r.LINK,{fnName:r.LINK,keyCode:h.VDZ.K,shownKey:"K",ctrlKey:!0}),(0,f.Z)(g,r.MOVE_ACTIVE,{fnName:r.MOVE_ACTIVE,keyCode:h.VDZ.BackSpace,shownKey:"BackSpace",ctrlKey:!0,cancelDefault:!0,disableWhileEditing:!0,doNotNeedEditPermission:!0}),(0,f.Z)(g,r.MOVE_END,{fnName:r.MOVE_END,keyCode:h.VDZ.End,shownKey:"End",ctrlKey:!0,disableWhileEditing:!0,doNotNeedEditPermission:!0}),(0,f.Z)(g,r.MOVE_HEAD,{fnName:r.MOVE_HEAD,ctrlKey:!0,keyCode:h.VDZ.Home,shownKey:"Home",disableWhileEditing:!0,doNotNeedEditPermission:!0}),(0,f.Z)(g,r.MOVE_TO_NEXT_CELL,{fnName:r.MOVE_TO_NEXT_CELL,keyCode:h.VDZ.Tab,shownKey:"Tab",doNotNeedEditPermission:!0,shouldEndEditing:!0}),(0,f.Z)(g,r.MOVE_TO_PREVIOUS_CELL,{fnName:r.MOVE_TO_PREVIOUS_CELL,keyCode:h.VDZ.Tab,shownKey:"Tab",shiftKey:!0,doNotNeedEditPermission:!0,shouldEndEditing:!0}),(0,f.Z)(g,r.NAVIGATION_BOTTOM,{fnName:r.NAVIGATION_BOTTOM,keyCode:h.VDZ.Down,shownKey:"ArrowDown",ctrlKey:!0,disableWhileEditing:!0,doNotNeedEditPermission:!0}),(0,f.Z)(g,r.NAVIGATION_DOWN,{fnName:r.NAVIGATION_DOWN,keyCode:h.VDZ.Down,shownKey:"ArrowDown",disableWhileEditing:!0,cancelDefault:!0,doNotNeedEditPermission:!0,shouldEndSummaryGraceful:!0}),(0,f.Z)(g,r.NAVIGATION_DOWN2,{fnName:r.NAVIGATION_DOWN,keyCode:h.VDZ.Enter,shownKey:"Enter",cancelDefault:!0,doNotNeedEditPermission:!0,shouldEndEditing:!0,shouldEndSummaryGraceful:!0}),(0,f.Z)(g,r.NAVIGATION_END,{fnName:r.NAVIGATION_END,keyCode:h.VDZ.End,shownKey:"End",disableWhileEditing:!0,doNotNeedEditPermission:!0}),(0,f.Z)(g,r.NAVIGATION_END_2,{fnName:r.NAVIGATION_END_2,keyCode:h.VDZ.Right,shownKey:"ArrowRight",ctrlKey:!0,cancelDefault:!0,disableWhileEditing:!0,doNotNeedEditPermission:!0}),(0,f.Z)(g,r.NAVIGATION_HOME,{fnName:r.NAVIGATION_HOME,keyCode:h.VDZ.Home,shownKey:"Home",disableWhileEditing:!0,doNotNeedEditPermission:!0}),(0,f.Z)(g,r.NAVIGATION_HOME_2,{fnName:r.NAVIGATION_HOME_2,keyCode:h.VDZ.Left,shownKey:"ArrowLeft",ctrlKey:!0,disableWhileEditing:!0,cancelDefault:!0,doNotNeedEditPermission:!0}),(0,f.Z)(g,r.NAVIGATION_LEFT,{fnName:r.NAVIGATION_LEFT,keyCode:h.VDZ.Left,shownKey:"ArrowLeft",disableWhileEditing:!0,cancelDefault:!0,doNotNeedEditPermission:!0,shouldEndSummaryGraceful:!0}),(0,f.Z)(g,r.NAVIGATION_PAGE_DOWN,{fnName:r.NAVIGATION_PAGE_DOWN,keyCode:h.VDZ.PageDown,shownKey:"PageDown",disableWhileEditing:!0,doNotNeedEditPermission:!0}),(0,f.Z)(g,r.NAVIGATION_PAGE_UP,{fnName:r.NAVIGATION_PAGE_UP,keyCode:h.VDZ.PageUp,shownKey:"PageUp",disableWhileEditing:!0,doNotNeedEditPermission:!0}),(0,f.Z)(g,r.NAVIGATION_RIGHT,{fnName:r.NAVIGATION_RIGHT,keyCode:h.VDZ.Right,shownKey:"ArrowRight",disableWhileEditing:!0,cancelDefault:!0,doNotNeedEditPermission:!0,shouldEndSummaryGraceful:!0}),(0,f.Z)(g,r.NAVIGATION_TOP,{fnName:r.NAVIGATION_TOP,keyCode:h.VDZ.Up,shownKey:"ArrowUp",disableWhileEditing:!0,ctrlKey:!0,doNotNeedEditPermission:!0}),(0,f.Z)(g,r.NAVIGATION_UP,{fnName:r.NAVIGATION_UP,keyCode:h.VDZ.Up,shownKey:"ArrowUp",disableWhileEditing:!0,cancelDefault:!0,doNotNeedEditPermission:!0,shouldEndSummaryGraceful:!0}),(0,f.Z)(g,r.NAVIGATION_UP2,{fnName:r.NAVIGATION_UP,keyCode:h.VDZ.Enter,shownKey:"Enter",shiftKey:!0,doNotNeedEditPermission:!0,shouldEndEditing:!0,shouldEndSummaryGraceful:!0}),(0,f.Z)(g,r.NEW_SHEET_TAB,{fnName:r.NEW_SHEET_TAB,keyCode:h.VDZ.F11,shownKey:"F11",shiftKey:!0}),(0,f.Z)(g,r.OPEN_HYPER_LINK,{fnName:r.OPEN_HYPER_LINK,keyCode:h.VDZ.Enter,shownKey:"Enter",altKey:!0,disableWhileEditing:!0,doNotNeedEditPermission:!0}),(0,f.Z)(g,r.PASTE,{fnName:r.PASTE,keyCode:h.VDZ.V,shownKey:"V",ctrlKey:!0,disableWhileEditing:!0,canPropagation:!0}),(0,f.Z)(g,r.PREVENT_SAVE,{fnName:r.PREVENT_SAVE,keyCode:h.VDZ.S,shownKey:"S",ctrlKey:!0,cancelDefault:!0,doNotNeedEditPermission:!0}),(0,f.Z)(g,r.REDO,{fnName:r.REDO,keyCode:h.VDZ.Y,shownKey:"Y",ctrlKey:!0,disableWhileEditing:!0,cancelDefault:!0,doNotNeedEditPermission:!0}),(0,f.Z)(g,r.SELECT_ALL,{fnName:r.SELECT_ALL,keyCode:h.VDZ.A,shownKey:"A",ctrlKey:!0,cancelDefault:!0,disableWhileEditing:!0,doNotNeedEditPermission:!0}),(0,f.Z)(g,r.SELECT_ROW,{fnName:r.SELECT_ROW,keyCode:h.VDZ.Space,shownKey:"Space",shiftKey:!0,disableWhileEditing:!0,doNotNeedEditPermission:!0}),(0,f.Z)(g,r.SELECTION_BOTTOM,{fnName:r.SELECTION_BOTTOM,keyCode:h.VDZ.Down,shownKey:"ArrowDown",ctrlKey:!0,shiftKey:!0,disableWhileEditing:!0,doNotNeedEditPermission:!0}),(0,f.Z)(g,r.SELECTION_DOWN,{fnName:r.SELECTION_DOWN,keyCode:h.VDZ.Down,shownKey:"ArrowDown",shiftKey:!0,disableWhileEditing:!0,doNotNeedEditPermission:!0}),(0,f.Z)(g,r.SELECTION_END,{fnName:r.SELECTION_END,keyCode:h.VDZ.Right,shownKey:"ArrowRight",ctrlKey:!0,shiftKey:!0,disableWhileEditing:!0,doNotNeedEditPermission:!0}),(0,f.Z)(g,r.SELECTION_FIRST,{fnName:r.SELECTION_FIRST,keyCode:h.VDZ.Home,shownKey:"Home",ctrlKey:!0,disableWhileEditing:!0,shiftKey:!0}),(0,f.Z)(g,r.SELECTION_HOME,{fnName:r.SELECTION_HOME,keyCode:h.VDZ.Left,shownKey:"ArrowLeft",ctrlKey:!0,shiftKey:!0,disableWhileEditing:!0,doNotNeedEditPermission:!0}),(0,f.Z)(g,r.SELECTION_LAST,{fnName:r.SELECTION_LAST,keyCode:h.VDZ.End,shownKey:"End",ctrlKey:!0,shiftKey:!0,disableWhileEditing:!0,doNotNeedEditPermission:!0}),(0,f.Z)(g,r.SELECTION_LEFT,{fnName:r.SELECTION_LEFT,keyCode:h.VDZ.Left,shownKey:"ArrowLeft",shiftKey:!0,disableWhileEditing:!0,doNotNeedEditPermission:!0}),(0,f.Z)(g,r.SELECTION_PAGEDOWN,{fnName:r.SELECTION_PAGEDOWN,keyCode:h.VDZ.PageDown,shownKey:"PageDown",shiftKey:!0,disableWhileEditing:!0,doNotNeedEditPermission:!0}),(0,f.Z)(g,r.SELECTION_PAGEUP,{fnName:r.SELECTION_PAGEUP,keyCode:h.VDZ.PageUp,shownKey:"PageUp",shiftKey:!0,disableWhileEditing:!0,doNotNeedEditPermission:!0}),(0,f.Z)(g,r.SELECTION_RIGHT,{fnName:r.SELECTION_RIGHT,keyCode:h.VDZ.Right,shownKey:"ArrowRight",shiftKey:!0,disableWhileEditing:!0,doNotNeedEditPermission:!0}),(0,f.Z)(g,r.SELECTION_TOP,{fnName:r.SELECTION_TOP,keyCode:h.VDZ.Up,shownKey:"ArrowUp",ctrlKey:!0,shiftKey:!0,disableWhileEditing:!0,doNotNeedEditPermission:!0}),(0,f.Z)(g,r.SELECTION_UP,{fnName:r.SELECTION_UP,keyCode:h.VDZ.Up,shownKey:"ArrowUp",shiftKey:!0,disableWhileEditing:!0,doNotNeedEditPermission:!0}),(0,f.Z)(g,r.UNDERLINE,{fnName:r.UNDERLINE,keyCode:h.VDZ.U,shownKey:"U",ctrlKey:!0,cancelDefault:!0,disableWhileEditing:!0}),(0,f.Z)(g,r.UNDO,{fnName:r.UNDO,keyCode:h.VDZ.Z,shownKey:"Z",ctrlKey:!0,disableWhileEditing:!0,cancelDefault:!0,doNotNeedEditPermission:!0}),(0,f.Z)(g,r.VERTICAL_FILL_BY_SHORTCUT,{fnName:r.VERTICAL_FILL_BY_SHORTCUT,keyCode:h.VDZ.D,shownKey:"D",ctrlKey:!0,cancelDefault:!0}),(0,f.Z)(g,r.CANCEL_INPUT,{fnName:r.CANCEL_INPUT,keyCode:h.VDZ.Esc,shownKey:"Esc",cancelDefault:!0,shouldEndEditing:!0,ignoreEndEditingValueChange:!0,canPropagation:!0}),(0,f.Z)(g,r.PRINT,{fnName:r.PRINT,keyCode:h.VDZ.P,shownKey:"P",ctrlKey:!0}),(0,f.Z)(g,r.ADD_NOTE,{fnName:r.ADD_NOTE,keyCode:h.VDZ.F2,shownKey:"F2",shiftKey:!0,disableWhileEditing:!0}),(0,f.Z)(g,r.ADD_OUTLINE,{fnName:r.ADD_OUTLINE,keyCode:h.VDZ.Right,shownKey:"Right",altKey:!0,shiftKey:!0,doNotNeedEditPermission:!0}),(0,f.Z)(g,r.DEL_OUTLINE,{fnName:r.DEL_OUTLINE,keyCode:h.VDZ.Left,shownKey:"Left",altKey:!0,shiftKey:!0,doNotNeedEditPermission:!0}),g),k=n("vsh_6127"),E=n.n(k),T=function(){function e(){(0,s.Z)(this,e)}return(0,l.Z)(e,null,[{key:"initPlatform",value:function(){var t=E().isWindows,n=E().isMac,r=E().isIPad;e.platform=t?o.WINDOWS:r?o.IPAD:n?o.MAC:o.UNKNOWN,e.isUsingAppleKeyboard=e.platform===o.MAC||e.platform===o.IPAD}}]),e}();T.initPlatform();var b=(m={},(0,f.Z)(m,o.MAC,_),(0,f.Z)(m,o.WINDOWS,y),(0,f.Z)(m,o.IPAD,Object.assign({},_,{},C)),(0,f.Z)(m,o.UNIVERSAL,S),(0,f.Z)(m,o.UNKNOWN,y),m),I=Object.assign({},b[T.platform],b[o.UNIVERSAL]),R=n("vsh_78400"),w=n("vsh_63738"),A=n("vsh_84784"),F=n("vsh_91497"),D=n("vsh_46544"),N=n("vsh_82905"),P=n("vsh_17811"),O=n("vsh_30157"),M=n("vsh_93301");function L(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:T.isUsingAppleKeyboard,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=[];if(e.ctrlKey){var o=t?"⌘":"Ctrl";r.push(o)}if(e.metaKey){var i=t?"Control":"Win";r.push(i)}if(e.shiftKey&&r.push("Shift"),e.altKey){var a=t?"Option":"Alt";r.push(a)}return n&&e.shownKey?r.push(e.shownKey):r.push(String(e.keyCode)),r}function x(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:T.isUsingAppleKeyboard,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"+",r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!e)return"";var o=L(e,t,r);return o.join(n)}function V(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:T.isUsingAppleKeyboard,n=arguments.length>2?arguments[2]:void 0,r=x(I[e],t,n,!0);return r.replace(/\+[a-z]/g,(function(e){return e.toUpperCase()}))}function Z(e,t){var n=e.getActiveRowIndex(),r=e.getActiveColumnIndex(),o=(0,d.t3y)(e,n,r,t),i=o.row,a=o.col;e.setActiveCell(i,a),e.showCell(i,a,d.cLE.center,d.D4r.center)}function B(e){if(e._selectionModel.length>1)e._isNavigateInSelection=!0;else{var t=e._getActiveSelectedRange();t&&e._selectionModel.length>0&&(e._isNavigateInSelection=!(e._activeRowIndex===t.rowFrom()&&e._activeColIndex===t.colFrom()&&e._activeRowCount===t.rowCount()&&e._activeColCount===t.colCount()))}}function H(e,t){e.isTabNavigation=!0,e._isNavigateInSelection?function(e,t){e._trigger(h.zW2.LeaveCell),3===t?e._moveActiveCellLeftInSelection(e._activeRowIndex,e._activeColIndex):4===t&&e._moveActiveCellRightInSelection(e._activeRowIndex,e._activeColIndex),e._moveActiveCellEnd()}(e,t):e._tabMoveCell(t),e.isTabNavigation=!1}function U(e,t){var n,r,o=e.getVisiableSheetsLength();if(e&&o>1){if(n=r=e.getActiveSheetIndex(),t&&r>=0){var i=function(e){for(var t=e.sheets,n=e.getSheetCount(),r=e.getActiveSheetIndex(),o=r+1;o<n;o++)if(t[o]&&!t[o].getHiddenStatus())return o;for(var i=0;i<=r-1;i++)if(t[i]&&!t[i].getHiddenStatus())return i;return-1}(e);i>=0&&(r=i)}else if(r>=0){var a=function(e){for(var t=e.sheets,n=e.getSheetCount(),r=e.getActiveSheetIndex(),o=r-1;o>=0;o--)if(t[o]&&!t[o].getHiddenStatus())return o;for(var i=n-1;i>r;i--)if(t[i]&&!t[i].getHiddenStatus())return i;return-1}(e);a>=0&&(r=a)}if(n!==r&&r>=0)return r!==e.getActiveSheetIndex()&&e._setActiveSheetIndexImp(r),!0}return!1}function j(e,t,n){if(e){var r=e.getActiveSheet(),o=n.map((function(e){var n="hideRow"===t||"unhideRow"===t;return{target:n?e.rowFrom():e.colFrom(),count:n?e.rowCount():e.colCount()}}));switch(t){case"hideRow":return r.hideRow(o);case"unhideRow":return r.unhideRow(o);case"hideCol":return r.hideCol(o);case"unhideCol":return r.unhideCol(o);default:return}}}function G(e){var t=e.getActiveSheet();if(!t)return{};var n=t.getActiveColumnIndex(),r=t.getActiveRowIndex(),o=t.getActualStyle(r,n),i=(o=o&&o.toJSON()||{}).hAlign;if(null==i||i===h.KqL.General)if(t.getReminder(r,n))i=h.KqL.Left;else{var a=t.getValue(r,n);i=(0,M.default)(a)?h.KqL.Right:h.KqL.Left}return o.hAlign=i,o}function K(e,t,n){var r=t.getSelections();if(!r.every((function(e){return e.rgType===r[0].rgType})))return!1;var o=r[0],i=Object.assign({},n,{target:0,count:0});if(o instanceof d.lq$)i.type=d.NHZ.ROW,i.rows=r.map((function(e){return{target:e.rowFrom(),count:e.rowCount(),size:t.getRowHeight(e.rowFrom())}})),i.target=r[r.length-1].rowFrom(),i.count=r[r.length-1].rowCount();else{if(!(o instanceof d.rvb))return!1;i.type=d.NHZ.COL,i.columns=r.map((function(e){return{target:e.colFrom(),count:e.colCount(),size:t.getColumnWidth(e.colFrom())}})),i.target=r[r.length-1].colFrom(),i.count=r[r.length-1].colCount()}return i}function W(e,t){if(t){var n=x(ee.getKeysFromEvent(e));return t.getShortcutConfig(n)}}function z(e){var t=e.getActiveSheet();return t.getSelections().some((function(e){var n=e.toJSON(),r=n.row,o=n.col,i=n.colCount,a=n.rowCount;return(0,d.MUL)(t,r,o,a,i)}))}var Y,J=n("vsh_73043"),q=function(e){var t;return e.getService(N.tb).resolve("isIgnoreCopyableCheck",!1)||(null===(t=e.getPlugin("PermissionPlugin"))||void 0===t?void 0:t.canCopy())},$=(Y={},(0,f.Z)(Y,r.ADD_ROW_OR_COL_AHEAD,(function(e,t){var n=K(0,t,{method:d.Dx_.ADD});return!n||("row"===n.type?t.addRow("up",1,n.rows):t.addCol("left",1,n.columns))})),(0,f.Z)(Y,r.ADD_ROW_OR_COL_BEHIND,(function(e,t){var n=K(0,t,{method:d.Dx_.ADD});return!n||("row"===n.type?t.addRow("down",1,n.rows):t.addCol("right",1,n.columns))})),(0,f.Z)(Y,r.AUTO_FILL_RANGE,(function(e,t){var n=t._getActiveSelectedRange(),r=(0,D.Je)(t,n),o=r.sourceRange,i=r.fillRange;return!!(0,D.nT)(t,i,o)&&((0,D.nb)(t,{sourceRange:o,fillRange:i,fillDirection:d._8N.Range}),!0)})),(0,f.Z)(Y,r.BOLD,(function(e,t){var n,r=G(e),o=r.font?r.font.includes("bold"):(null===(n=r.fontInfo)||void 0===n?void 0:n.fontWeight)===F.FontWeight.bold;return t.setFontStyle(t.getSelections(),"fontWeight",o?"normal":"bold")})),(0,f.Z)(Y,r.BOTTOM_BORDER,(function(e,t){return t.setRangeStyle(t.getSelections(),d.fVw.Frame,{border:h.ZL2.BOTTOM_BORDER,color:R.N900})})),(0,f.Z)(Y,r.CANCEL_BORDER,(function(e,t){return t.setRangeStyle(t.getSelections(),d.fVw.Frame,{border:h.ZL2.NO_BORDER})})),(0,f.Z)(Y,r.CLEAR,(function(e,t){return t.clearValues()})),(0,f.Z)(Y,r.COMMENT,(function(e,t,n,r){var o;return!(null===(o=r.pluginStore.getState("PermissionStore"))||void 0===o||!o.commentable)&&(t.trigger(h.zW2.CommentHotkeyPress,{spread:e,command:{row:t.getActiveRowIndex(),col:t.getActiveColumnIndex()}}),!0)})),(0,f.Z)(Y,r.COPY,(function(e,t,n,r){var o;return e.checkUseAnonymousLogin&&e.checkUseAnonymousLogin(n)?(n.preventDefault(),!1):q(r)?!!(null===(o=r.getPlugin(P.VT))||void 0===o?void 0:o.doCopy()):(n.preventDefault(),!1)})),(0,f.Z)(Y,r.CUT,(function(e,t,n,r){var o;if(!q(r))return n.preventDefault(),!1;if(function(e){for(var t=e.getActiveSheet(),n=t.getSelections(),r=0;r<n.length;r++)if((0,d.p9h)(t,n[r]))return!0;return!1}(e))return h.Ps3.Toast.warning({key:"pivot_table_area_cannot_cut",content:J("LarkCCM_Sheets_PivotTable_UnableToCutCellsWithPivotTable_Toast")}),!0;var i=null===(o=r.getPlugin(P.VT))||void 0===o?void 0:o.doCut();return!1===i&&n.preventDefault(),!!i})),(0,f.Z)(Y,r.DECREASE_FONT_SIZE,(function(e,t){var n=t.getSelections().filter((function(e){return t._canChange(e.rowFrom(),e.colFrom(),e.rowCount(),e.colCount())}));return 0===n.length||t.setFontStyle(n,"fontSize",void 0,!1)})),(0,f.Z)(Y,r.DEL_ROW_OR_COL,(function(e,t){var n=K(0,t,{method:d.Dx_.DEL});return!n||("row"===n.type?((0,d.HCW)(t)&&(0,d.DBs)("hot_key","delete_row"),t.delRow(n.rows)):((0,d.uW2)(t)&&(0,d.DBs)("hot_key","delete_col"),t.delCol(n.columns)))})),(0,f.Z)(Y,r.DO_CLEAR,(function(e,t){return(0,d.tbe)(t)&&(0,d.DBs)("hot_key","clear_format"),(0,d.XMn)(t)&&h.Ps3.ccmEventTracking("ccm_sheet_content_page_click",{click:"clear_sheet",target:"none",type:(0,d.wG9)(t,"area"),sub_click:"clear_format",action_type:"hot_key"}),t.clearFormatting()})),(0,f.Z)(Y,r.FILTER,(function(e,t){if(!!t.filterModel.hasFilter())return t.delFilter();var n=(0,d.C12)(t);return!(!n||t.getPivotTableManager().isIntersectPivotTable(n.rowFrom(),n.colFrom(),n.rowCount(),n.colCount()))&&t.setFilter(n,null,null)})),(0,f.Z)(Y,r.FIND,(function(){return!1})),(0,f.Z)(Y,r.FIND_AND_REPLACE,(function(){return!1})),(0,f.Z)(Y,r.FORMAT_PAINTING,(function(e,t){return t.trigger(h.zW2.FormatPainting),!0})),(0,f.Z)(Y,r.H_ALIGN_CENTER,(function(e,t){return t.setRangeStyle(t.getSelections(),d.fVw.HAlign,h.KqL.Center)})),(0,f.Z)(Y,r.H_ALIGN_LEFT,(function(e,t){return t.setRangeStyle(t.getSelections(),d.fVw.HAlign,h.KqL.Left)})),(0,f.Z)(Y,r.H_ALIGN_RIGHT,(function(e,t){return t.setRangeStyle(t.getSelections(),d.fVw.HAlign,h.KqL.Right)})),(0,f.Z)(Y,r.HORIZONTAL_FILL_BY_SHORTCUT,(function(e,t){var n=t._getActiveSelectedRange(),r=(0,D.Yt)(t,n),o=r.sourceRange,i=r.fillRange;return 0!==i.colCount()&&(!!(0,D.nT)(t,i,o)&&((0,D.uM)(t,{sourceRange:o,fillRange:i,fillDirection:d._8N.Right}),!0))})),(0,f.Z)(Y,r.HIDE_COL,(function(e,t){return j(e,"hideCol",t.getSelections()),!0})),(0,f.Z)(Y,r.HIDE_ROW,(function(e,t){return j(e,"hideRow",t.getSelections()),!0})),(0,f.Z)(Y,r.INCREASE_FONT_SIZE,(function(e,t){var n=t.getSelections().filter((function(e){return t._canChange(e.rowFrom(),e.colFrom(),e.rowCount(),e.colCount())}));return 0===n.length||t.setFontStyle(n,"fontSize",void 0,!0)})),(0,f.Z)(Y,r.INSERT_DATE,(function(e,t){if(z(e))return!0;var n=t.getSelections(),r=new Date;r.setHours(0),r.setMinutes(0),r.setSeconds(0),r.setMilliseconds(0);var o={value:A.SheetDate.fromLocalDate(r).toNumber(),style:{formatter:{formatCached:e.formatterService.i18n.getDateTimeFormat().shortDatePattern}}};return t.setRangeValue(n,(function(e){if(t.filterModel.isVisible(e))return o}))})),(0,f.Z)(Y,r.INSERT_TIME,(function(e,t){if(z(e))return!0;var n=t.getSelections(),r=new Date,o=A.SheetDate.fromLocalDate(r);o.setDateTime({year:1899,month:12,date:30});var i={value:o.toNumber(),style:{formatter:{formatCached:"h:mm:ss"}}};return t.setRangeValue(n,(function(e){if(t.filterModel.isVisible(e))return i}))})),(0,f.Z)(Y,r.ITALIC,(function(e,t){var n,r=G(e),o=r.font?r.font.includes("italic"):"italic"===(null===(n=r.fontInfo)||void 0===n?void 0:n.fontStyle);return t.setFontStyle(t.getSelections(),"fontStyle",o?"normal":"italic")})),(0,f.Z)(Y,r.LEFT_BORDER,(function(e,t){return t.setRangeStyle(t.getSelections(),d.fVw.Frame,{border:h.ZL2.LEFT_BORDER,color:R.N900})})),(0,f.Z)(Y,r.LINE_THROUGH,(function(e,t){var n=G(e),r=!!n.textDecoration&&2==(2&n.textDecoration);return t.setTextDecoration(t.getSelections(),h.aBM.lineThrough,r)})),(0,f.Z)(Y,r.MERGE_AND_SPLIT,(function(e,t){if(z(e))return h.Ps3.Toast.warning({key:"pivot_table_area_cannot_merge",content:J("CreationDoc_Sheets_PivotTable_Failed_CanNotMergeCells")}),!0;var n=(0,d.ANU)(e),r=n.mergable,o=n.splitable;if(!r&&!o)return!0;if(r){if((0,d.Bkg)(e))return(0,d.JX8)(e,!0);e.trigger(h.zW2.MergeAndSplit,{spread:e})}else if(o)return(0,d.JX8)(e,!1);return!0})),(0,f.Z)(Y,r.MODIFY_TO_STRING,(function(e,t){return t.setRangeValue(t.getSelections(),(function(e,n){return function(e,t,n){var r=e.getValue(t,n);return(0,d.lep)(r)?null:{value:String(r)}}(t,e,n)}))})),(0,f.Z)(Y,r.MOVE_ACTIVE,(function(e,t){return t.getRowCount()>0&&t.getColumnCount()>0&&t.showCell(t.getActiveRowIndex(),t.getActiveColumnIndex(),d.cLE.center,d.D4r.center),!0})),(0,f.Z)(Y,r.MOVE_END,(function(e,t){if(t.getRowCount()>0&&t.getColumnCount()>0){var n=t.getRowCount()-1,r=t.getColumnCount()-1;t.setSelection(new d.e6w(n,r,1,1,t)),t.showCell(n,r,d.cLE.center,d.D4r.center)}return!0})),(0,f.Z)(Y,r.MOVE_HEAD,(function(e,t){return t.getRowCount()>0&&t.getColumnCount()>0&&(t.setSelection(new d.e6w(0,0,1,1,t)),t.showCell(0,0,d.cLE.top,d.D4r.left)),!0})),(0,f.Z)(Y,r.MOVE_TO_NEXT_CELL,(function(e,t){return B(t),H(t,4),!0})),(0,f.Z)(Y,r.MOVE_TO_PREVIOUS_CELL,(function(e,t){return B(t),H(t,3),!0})),(0,f.Z)(Y,r.NAVIGATION_BOTTOM,(function(e,t){return Z(t,h.Nmp.Down),!0})),(0,f.Z)(Y,r.NAVIGATION_DOWN,(function(e,t){return t._moveActiveCell(2,!1),!0})),(0,f.Z)(Y,r.NAVIGATION_END,(function(e,t){return t._moveActiveCell(3,!1,null,t.getColumnCount()),!0})),(0,f.Z)(Y,r.NAVIGATION_END_2,(function(e,t){return Z(t,h.Nmp.Right),!0})),(0,f.Z)(Y,r.NAVIGATION_HOME,(function(e,t){return t._moveActiveCell(4,!1,null,t.frozenColumnCount()-1),!0})),(0,f.Z)(Y,r.NAVIGATION_HOME_2,(function(e,t){return Z(t,h.Nmp.Left),!0})),(0,f.Z)(Y,r.NAVIGATION_LEFT,(function(e,t){return t._moveActiveCell(3,!1),!0})),(0,f.Z)(Y,r.NAVIGATION_NEXT_SHEET,(function(e,t){return U(e,!0)})),(0,f.Z)(Y,r.NAVIGATION_PAGE_DOWN,(function(e,t){var n=t._scrollTopRow,r=t.nextPage();if(!r)return!0;var o=r.row;if(o===n)return!0;var i=t._activeRowIndex+o-n;return(i<o||o+r.rowCount<=i)&&(i=t._getNextVisualRow(o)),!!t._canSelect(i,t.getActiveColumnIndex())&&(t._setActiveCellCore(i,null),t._leadingCellRow=i,t._moveActiveCell(),!0)})),(0,f.Z)(Y,r.NAVIGATION_PAGE_UP,(function(e,t){var n=t._scrollTopRow,r=t.prePage();if(!r)return!0;if(0===n&&0===r.row)return!0;var o=t.nextPage();if(!o)return!0;var i=o.row-r.row,a=r.row-i;a<0&&(a=0);var s=t._getNextVisualRow(a);return s>a&&(s=a),!!t._canSelect(s,t.getActiveColumnIndex())&&(t._setActiveCellCore(s,null),t._leadingCellRow=s,t._moveActiveCell(),!0)})),(0,f.Z)(Y,r.NAVIGATION_PREVIOUS_SHEET,(function(e,t){return U(e,!1)})),(0,f.Z)(Y,r.NAVIGATION_RIGHT,(function(e,t){return t._moveActiveCell(4,!1),!0})),(0,f.Z)(Y,r.NAVIGATION_TOP,(function(e,t){return Z(t,h.Nmp.Up),!0})),(0,f.Z)(Y,r.NAVIGATION_UP,(function(e,t){return t._moveActiveCell(1,!1),!0})),(0,f.Z)(Y,r.NEW_SHEET_TAB,(function(e,t){return t.trigger(h.zW2.NewSheetTab,{spread:e}),!0})),(0,f.Z)(Y,r.OPEN_COMMENT,(function(e,t){return t.trigger(h.zW2.OpenCommentPanel,{spread:e}),!0})),(0,f.Z)(Y,r.OPEN_CONTEXT_MENU,(function(e){return e.trigger(h.zW2.ShowContextMenu),!0})),(0,f.Z)(Y,r.OPEN_FILTER_MENU,(function(e,t){var n=t.filterModel.getInfo();if(!(n&&n.range))return!0;var r=t.getSelections(),o=r[r.length-1],i=o.colFrom(),a=o.rowFrom(),s=t.filterModel.getFilterButton(a,i);if(s){var l=t.getCellRect(a,i);t._trigger(h.zW2.ShowFilter,{sheet:t,btnInfo:s,cellRect:{x:l.x,y:l.y,width:l.width,height:l.height}})}return!0})),(0,f.Z)(Y,r.OPEN_GUIDE_BAR,(function(e,t){return t.trigger(h.zW2.GuideBarToggling,{spread:e}),!0})),(0,f.Z)(Y,r.OPEN_HYPER_LINK,(function(e,t){if(z(e))return!0;var n=t.getSelections(),r=!1;return(0,d.KST)(n,(function(e,n){if(!r){var o=t.getSafeValue(e,n);if(Array.isArray(o)&&o.length>0){var i="";"url"===o[0].type?i=o[0].link?o[0].link:o[0].text:"mention"===o[0].type&&(i=decodeURIComponent(o[0].link)),i&&(!h.Ps3.openSafeLink(i)&&t._raiseInvalidOperation(1,J("sheet.invalid_link")),r=!0)}}})),!0})),(0,f.Z)(Y,r.PASTE,(function(e,t,n,r){var o=r.getPlugin(P.VJ);return o&&o.doClipboardPaste(),!0})),(0,f.Z)(Y,r.PASTE_FORMATS_ONLY,(function(e,t,n,r){var o;return null===(o=r.getPlugin(P.VJ))||void 0===o||o.doCustomPaste(h.Ve9.formatting,P.Sb.SHORTKEY),!0})),(0,f.Z)(Y,r.PASTE_VALUES_ONLY,(function(e,t,n,r){var o;return n.preventDefault(),null===(o=r.getPlugin(P.VJ))||void 0===o||o.doCustomPaste(h.Ve9.values,P.Sb.SHORTKEY),!0})),(0,f.Z)(Y,r.PREVENT_SAVE,(function(e,t){return!0})),(0,f.Z)(Y,r.QUICK_SUM,(function(e,t){var n=function(e){var t=e.getSelections(),n=[],r={},o=e.parent.calcEngine;return t.forEach((function(t){var i=t.rowFrom(),a=t.colFrom(),s=t.rowTo(),l=t.colTo(),u=t.rowCount(),c=t.colCount(),h=!1,f=!0;function v(t,n){var r=o.compile(n,{spread:e.parent,ref:t,enableCalculation:!0}).formulaVar;return r?o.serializeFormula(r,{ref:t}):void 0}if(1!==c)for(var p=i;p<=s;p++)if(null==e.getValue(p,l)){if(p!==s){for(var g=!0,m=a;m<l;m++)if(null!==e.getValue(p,m)){g=!1;break}if(g)continue}else if(!f)break;n.push(new d.e6w(p,l,1,1,e));var _=void 0;if(2===c){var y=new d.luK(p,a,e),C="SUM("+y.toString({ref:y})+")";_=v(y,C)}else{var S=new d.e6w(p,a,1,c-1,e),k="SUM("+S.toString({ref:S})+")";_=v(S,k)}r[p+"_"+l]={formulaData:_},p===s&&(h=!0)}else f=!1;for(var E=a;E<=l&&(!h||E!==l);E++){var T=e.getValue(s,E);if(null==T||"string"==typeof T&&""===T.trim()){for(var b=!0,I=i;I<s;I++)if(null!==e.getValue(I,E)){b=!1;break}if(b)continue;n.push(new d.e6w(s,E,1,1,e));var R=void 0;if(2===u){var w=new d.luK(i,E,e),A="SUM("+w.toString({ref:w})+")";R=v(w,A)}else{var F=new d.e6w(i,E,u-1,1,e),D="SUM("+F.toString({ref:F})+")";R=v(F,D)}r[s+"_"+E]={formulaData:R}}}})),{getValueFn:function(e,t){return r[e+"_"+t]},ranges:n}}(t),r=n.getValueFn,o=n.ranges;return 0!==o.length&&t.setRangeValue(o,r)})),(0,f.Z)(Y,r.REDO,(function(e,t){var n=e.undoManager();return!!n&&(n.redo(),!0)})),(0,f.Z)(Y,r.RIGHT_BORDER,(function(e,t){return t.setRangeStyle(t.getSelections(),d.fVw.Frame,{border:h.ZL2.RIGHT_BORDER,color:R.N900})})),(0,f.Z)(Y,r.SELECT_ALL,(function(e,t){var n=t.getSelections()[0];if(n){var r=(0,D.TG)(t,n);if(r)return n.equal(r)?t.selectAll():t.setSelection(r),!0;var o=(0,d.qpA)(t,n.clone());return o.rowFrom()!==n.rowFrom()||o.colFrom()!==n.colFrom()||o.rowCount()!==n.rowCount()||o.colCount()!==n.colCount()?t.setSelection(o):t.selectAll(),!0}return!1})),(0,f.Z)(Y,r.SELECT_COLUMN,(function(e,t){var n=t.getSelections();if(n.length>0){var r=n[0];return t.setSelection(new d.rvb(r.colFrom(),r.colCount(),t)),!0}return!1})),(0,f.Z)(Y,r.SELECT_ROW,(function(e,t){var n=t.getSelections();if(n.length>0){var r=n[0];return t.setSelection(new d.lq$(r.rowFrom(),r.rowCount(),t)),!0}return!1})),(0,f.Z)(Y,r.SELECTION_BOTTOM,(function(e,t){return t._changeActiveSelectedRange(h.VDZ.Down,!0),!0})),(0,f.Z)(Y,r.SELECTION_DOWN,(function(e,t){return t._changeActiveSelectedRange(h.VDZ.Down),!0})),(0,f.Z)(Y,r.SELECTION_END,(function(e,t){return t._changeActiveSelectedRange(h.VDZ.Right,!0),!0})),(0,f.Z)(Y,r.SELECTION_FIRST,(function(e,t){return t._changeActiveSelectedRange(h.VDZ.Up,!0),!0})),(0,f.Z)(Y,r.SELECTION_HOME,(function(e,t){return t._changeActiveSelectedRange(h.VDZ.Left,!0),!0})),(0,f.Z)(Y,r.SELECTION_LAST,(function(e,t){return t._changeActiveSelectedRange(h.VDZ.End,!0),!0})),(0,f.Z)(Y,r.SELECTION_LEFT,(function(e,t){return t._changeActiveSelectedRange(h.VDZ.Left),!0})),(0,f.Z)(Y,r.SELECTION_PAGEDOWN,(function(e,t){return t._changeActiveSelectedRange(h.VDZ.PageDown),!0})),(0,f.Z)(Y,r.SELECTION_PAGEUP,(function(e,t){return t._changeActiveSelectedRange(h.VDZ.PageUp),!0})),(0,f.Z)(Y,r.SELECTION_RIGHT,(function(e,t){return t._changeActiveSelectedRange(h.VDZ.Right),!0})),(0,f.Z)(Y,r.SELECTION_TOP,(function(e,t){return t._changeActiveSelectedRange(h.VDZ.Up,!0),!0})),(0,f.Z)(Y,r.SELECTION_UP,(function(e,t){return t._changeActiveSelectedRange(h.VDZ.Up),!0})),(0,f.Z)(Y,r.SHOW_ALL_TABS,(function(e,t){return t.trigger(h.zW2.ShowAllTabs,{spread:e}),!0})),(0,f.Z)(Y,r.SORT,(function(e,t){var n=t.getSelections();return 1===n.length&&1!==n[0].rowCount()&&(t._trigger(h.zW2.RangeSorting,{spread:e,ascending:"asc",sortSource:h.WjP.HotKey}),!0)})),(0,f.Z)(Y,r.TO_DATE,(function(e,t){return t.setFormatter(t.getSelections(),w.BuiltinFormatter.DateTime(!1,!0,"/"))})),(0,f.Z)(Y,r.TO_DECIMAL,(function(e,t){return t.setFormatter(t.getSelections(),w.BuiltinFormatter.GroupSeparator(!0))})),(0,f.Z)(Y,r.TO_MONEY,(function(e,t){var n;return n="en"===e.getUserLanguage()?w.BuiltinFormatter.Currency("$",!0):w.BuiltinFormatter.Currency("¥",!0),t.setFormatter(t.getSelections(),n)})),(0,f.Z)(Y,r.TO_PERCENTAGE,(function(e,t){return t.setFormatter(t.getSelections(),w.BuiltinFormatter.Percent("%",!0))})),(0,f.Z)(Y,r.TO_SCIENTIFIC,(function(e,t){return t.setFormatter(t.getSelections(),w.BuiltinFormatter.ScientificNotation)})),(0,f.Z)(Y,r.TOGGLE_FORMULA_DISPLAY,(function(e,t,n,r){var o=t.options.showFormulaText;t.options.showFormulaText=!o;var i=(0,O.F)(r,t);if(!i)return!0;var s=t.getRowCount(),l=t.getColumnCount();return t._getModel().iterContentWithPos(0,0,s,l).forEach((function(e){var n=(0,a.Z)(e,2)[1],r=n.row,o=n.col;t.hasFormula(r,o)&&i.removeRangeCache(r,o,1,1)})),!0})),(0,f.Z)(Y,r.TOGGLE_HISTORY_PANEL,(function(e,t){return t.trigger(h.zW2.HistoryPanelToggling,{spread:e}),!0})),(0,f.Z)(Y,r.TOP_BORDER,(function(e,t){return t.setRangeStyle(t.getSelections(),d.fVw.Frame,{border:h.ZL2.TOP_BORDER,color:R.N900})})),(0,f.Z)(Y,r.UNDERLINE,(function(e,t){var n=G(e),r=n.textDecoration&&1==(1&n.textDecoration);return t.setTextDecoration(t.getSelections(),h.aBM.underline,r)})),(0,f.Z)(Y,r.UNDO,(function(e,t){var n=e.undoManager();return!!n&&(n.undo(),!0)})),(0,f.Z)(Y,r.UNHIDE_COL,(function(e,t){return j(e,"unhideCol",t.getSelections())})),(0,f.Z)(Y,r.UNHIDE_ROW,(function(e,t){return j(e,"unhideRow",t.getSelections())})),(0,f.Z)(Y,r.VERTICAL_FILL_BY_SHORTCUT,(function(e,t){var n=t._getActiveSelectedRange(),r=(0,D.J$)(t,n),o=r.sourceRange,i=r.fillRange;return 0!==i.rowCount()&&(!!(0,D.nT)(t,i,o)&&((0,D.iw)(t,{sourceRange:o,fillRange:i,fillDirection:d._8N.Down}),!0))})),(0,f.Z)(Y,r.TO_TIME,(function(e,t){return t.setFormatter(t.getSelections(),w.BuiltinFormatter.DateTime(!0,!1))})),(0,f.Z)(Y,r.CANCEL_INPUT,(function(e,t){return e.sheets.forEach((function(e){return e.notifyShell(d._16.CancelCutCopyIndicator)})),!0})),(0,f.Z)(Y,r.PRINT,(function(e,t,n,r){return!1})),(0,f.Z)(Y,r.ADD_NOTE,(function(e,t,n,r){var o=null==r?void 0:r.getPlugin("CellNoteEditorPlugin");return null==o||o.startEditNoteByShortcut(),!0})),(0,f.Z)(Y,r.ADD_OUTLINE,(function(e,t,n,r){return e.getService(D.zA).addOutline("quick_access")})),(0,f.Z)(Y,r.DEL_OUTLINE,(function(e,t,n,r){return e.getService(D.zA).delOutline(void 0,"quick_access")})),Y),X=n("vsh_88177"),Q=n("vsh_73043"),ee=function(){function e(){var t=this;(0,s.Z)(this,e),this.name=te,this.shortcutsConfigMap=new Map,this.disabledShortcuts=new Map,this.effectFnMap=new Map,this.effectSkipCheck=new Set,this.disabledFnNames=new Set,this.handleKeydown=function(n){var r;if(t.sheetSDK.isSuspended())return!1;var o,i,a,s,l,u=x(e.getKeysFromEvent(n)),c=t.shortcutsConfigMap.get(u),h=t._getFocusedSheetId(),d=t.sheetSDK.spread,f=null!=c&&c.doNotNeedFocusSheet?d.getActiveSheet():h&&d.getSheetFromId(h),v=null===(r=t.sheetSDK)||void 0===r?void 0:r.getPlugin("FormulaLanguageServicePlugin");if(v&&("Esc"===(null==c?void 0:c.shownKey)&&v.aiFunctionHelper.setAiFuncEditorStatus(!1),"Enter"===(null==c?void 0:c.shownKey)&&document.getElementsByClassName("func-ai-footer")[0]&&(null==v||null===(o=v.activeEditor)||void 0===o||null===(i=o.editor)||void 0===i||null===(a=i.isFocus)||void 0===a||!a.call(i))))return null===(s=v.aiFunctionHelper)||void 0===s||null===(l=s.handleEnter)||void 0===l||l.call(s),!1;if(!f||!c||!t.fnMap)return!1;if(!t.configCheck(u,c,f))return t.effectSkipCheck.has(c.fnName)&&t.tryRunEffectFunction(c,d,f,n),!1;var p=t.executeCommand({shortcutStr:u,config:c,spread:d,sheet:f,e:n});return t.tryRunEffectFunction(c,d,f,n),p},this.handleUndoAndRedo=function(n,o){var i=x(e.getKeysFromEvent(n)),a=t.shortcutsConfigMap.get(i);if(a&&[r.UNDO,r.REDO].includes(null==a?void 0:a.fnName))if(o)n.stopPropagation();else{var s=t.sheetSDK.spread,l=s.getActiveSheet();t.executeCommand({shortcutStr:i,spread:s,sheet:l,config:a,e:n})}}}return(0,l.Z)(e,[{key:"init",value:function(e){this.sheetSDK=e,this.fnMap=(0,c.Z)($),this.registerShortcutsConfig(),this.bindEvents()}},{key:"registerShortcutsConfig",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I;Object.values(t).forEach((function(t){t&&e.shortcutsConfigMap.set(x(t),t)}))}},{key:"bindEvents",value:function(){window.addEventListener("keydown",this.handleKeydown)}},{key:"unbindEvents",value:function(){window.removeEventListener("keydown",this.handleKeydown)}},{key:"configCheck",value:function(e,t,n){var r=n.tabType&&n.tabType.isConnectorTab()&&!n.tabType.isShortcutAllowed(t.fnName);if(!this.isShortcutEnabled(e))return!1;var o=this.sheetSDK.getPlugin("CellEditorPlugin");if(t.disableWhileEditing&&null!=o&&o.isEditing(n)){if("boolean"==typeof t.disableWhileEditing)return!1;if("noSelectionSummary"!==t.disableWhileEditing.exception)return!1;if(!((null==o?void 0:o.isSummaryEditorOpen())&&!o.hasSelection()))return!1}return!(!t.doNotNeedEditPermission&&!this.isEditable)&&!(this.isEditable&&r&&!t.doNotNeedEditPermission)}},{key:"_getFocusedSheetId",value:function(){var e,t,n,r,o=null===(e=this.sheetSDK.pluginStore.getState("FocusStore"))||void 0===e?void 0:e.focusedSheetId,i=this.sheetSDK.spread;if(!(i._context&&i._context.isEmbed()&&!i._context.isFullScreenMode()))return(null===(r=document.activeElement)||void 0===r?void 0:r.closest(".inline-ai-contain"))?null:o;if(null===(t=document.activeElement)||void 0===t?void 0:t.closest(".sheet-block-container"))return o;var a=null===(n=window.getSelection())||void 0===n?void 0:n.anchorNode,s=a&&(1===a.nodeType?a:a.parentElement);return(null==s?void 0:s.closest(".faster.spreadsheet, .embed-sheet-dialog-overlay"))?o:null}},{key:"tryRunEffectFunction",value:function(e,t,n,r){if(this.fnMap&&0!==this.effectFnMap.size)try{var o=e.fnName,i=this.effectFnMap.get(o);i&&Array.isArray(i)&&i.forEach((function(e){return e(t,n,r)}))}catch(e){console.error("Execute Shortcut Effect Function Error",e)}}},{key:"executeCommand",value:function(e){e.shortcutStr;var t=e.config,n=e.spread,r=e.sheet,o=e.e;if(!this.fnMap)return!1;if(!(0,d.A8G)(r))return h.Ps3.Toast.warning({key:"visibility_sheet_short_cut",content:Q("LarkCCM_Sheets_Protect_ShortcutUnavailable_Toast")}),!1;var i=t.fnName,a=t.shouldEndEditing,s=t.ignoreEndEditingValueChange,l=t.cancelDefault,u=t.canPropagation,c=t.shouldEndSummaryGraceful,f=this.fnMap[i];if(f&&"function"==typeof f){var v=function(e){return e.toLowerCase().replace("⌘","command")}(x(t,void 0,"+",!0));try{var p=this.sheetSDK.getPlugin("CellEditorPlugin"),g=this.sheetSDK.getPlugin("FormulaLanguageServicePlugin");if(a){if(null!=g&&g.handleNeedRecommendArrayFormula())return!1;if(p&&!p.endEdit({sheet:r,ignoreValueChange:s,source:X.F5.SHORTCUT_PLUGIN}))return!1}if(c&&(null==p||p.endSummaryGraceful(X.F5.SHORTCUT_PLUGIN_GRACEFUL)),this.disabledFnNames.size&&this.disabledFnNames.has(i))return!1;h.Ps3.shortcutPluginDep.logShortcutExcutedBefore(i,n);var m=f(n,r,o,this.sheetSDK);return this.postEventProcess(o,{preventDefault:!(!l||!m),stopPropagation:!u}),h.Ps3.shortcutPluginDep.logShortcutExecuted(v,i,r.id(),n),m}catch(o){h.Ps3.shortcutPluginDep.logShortcutExecuteError(o,v)}}return!1}},{key:"postEventProcess",value:function(e,t){t.preventDefault&&e.preventDefault(),t.stopPropagation&&e.stopImmediatePropagation()}},{key:"setCustomShortcuts",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.registerShortcutsConfig(e),Object.entries(n).forEach((function(e){var n=(0,a.Z)(e,2),r=n[0],o=n[1];"function"==typeof o&&t.setFn(r,o)}))}},{key:"addDisabledFunctionName",value:function(e){this.disabledFnNames.add(e)}},{key:"removeDisabledFunctionName",value:function(e){this.disabledFnNames.delete(e)}},{key:"addEffectFunction",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.effectFnMap.get(e);r||(r=[],this.effectFnMap.set(e,r)),r.push(t),n&&this.effectSkipCheck.add(e)}},{key:"_enableOrDisableShortcutsImp",value:function(e,t){var n=this,r=e;(0,u.Z)(e)||(r=[e]),r.forEach((function(e){var r=x(e),o=n.disabledShortcuts.get(r);o?n.disabledShortcuts.set(r,"enable"===t?o-1:o+1):"disable"===t&&n.disabledShortcuts.set(r,1)}))}},{key:"disableShortcuts",value:function(e){this._enableOrDisableShortcutsImp(e,"disable")}},{key:"enableShortcuts",value:function(e){this._enableOrDisableShortcutsImp(e,"enable")}},{key:"isShortcutEnabled",value:function(e){return!this.disabledShortcuts.get(e)}},{key:"setFn",value:function(e,t){this.fnMap&&(this.fnMap[e]=t)}},{key:"destroy",value:function(){this.shortcutsConfigMap.clear(),this.fnMap=null,this.effectFnMap.clear(),this.effectSkipCheck.clear(),this.disabledFnNames.clear(),this.disabledShortcuts.clear(),this.unbindEvents()}},{key:"getShortcutConfig",value:function(e){return this.shortcutsConfigMap.get(e)}},{key:"isEditable",get:function(){var e;return null===(e=this.sheetSDK.pluginStore.getState("PermissionStore"))||void 0===e?void 0:e.editable}}],[{key:"getKeysFromEvent",value:function(e){var t=e.key,n=e.shiftKey,r=e.altKey,i=e.code,a=e.ctrlKey,s=e.metaKey,l=e.keyCode;if(T.isUsingAppleKeyboard){var u=[s,a];a=u[0],s=u[1]}return T.platform===o.IPAD&&a&&"KeyC"===i&&l===h.VDZ.Ime&&(l=67),{key:t,keyCode:l,ctrlKey:a,shiftKey:n,altKey:r,metaKey:s,code:i}}}]),e}(),te="ShortcutPlugin"},vsh_916:function(e,t,n){n.d(t,{lP:function(){return r},Q:function(){return o},AA:function(){return i},Nd:function(){return a},S5:function(){return s},aM:function(){return l},vN:function(){return u}});var r=640,o=640,i=400,a=400,s="block_for_shortcut",l=16/9,u=40},vsh_58342:function(e,t,n){n.d(t,{$:function(){return a},V:function(){return u}});var r=n("vsh_24627"),o=n("vsh_72834"),i=n("vsh_916");function a(e){var t=function(e){var t=e.sheet(),n=s(t,e.rowFrom(),!0),r=s(t,e.colFrom(),!1),i=new o.e6w(n.start,r.start,n.count,r.count,e.sheet()),a=i.rowFrom(),l=i.colFrom(),u=i.rowEnd(),c=i.colEnd();return t.getSpans(i).forEach((function(e){a=Math.min(a,e.rowFrom()),l=Math.min(l,e.colFrom())})),i.setRowFrom(a),i.setRowCount(u-a),i.setColFrom(l),i.setColCount(c-l),i}(e),n=function(e){var t=e.sheet();if(!t)return[];var n=e.toJSON(),o=[],i=e,a=new Set;t.getSparklineModel().iter(n.row,n.col,n.rowCount,n.colCount).forEach((function(e){var t=e.getSourceRange();if(t){for(var n=t.rowFrom();n<t.rowEnd();n++)a.add(n);i.isIntersect(t)?i=i.union(t):o.push(t.toGridJSON())}}));var s=Array.from(t.filterModel.filteredOutRows).filter((function(e){return!a.has(e)})),u=l(i.toGridJSON(),s);return o.forEach((function(e){var t=l(e,s);(0,r.hTd)(u,t)})),u}(t);return n}function s(e,t,n){var r=n?e._getRowInfos():e._getColInfos(),o=n?e.getRowCount():e.getColumnCount(),a=t,s=t+1,l=(n?i.Q:i.lP)+i.vN;return r.iterEachActualVisible(0,t,!0).exitWhen((function(e){return a=e,r.getDistance(e,t)>l/2})).forEach((function(e){})),r.iterEachActualVisible(t+1,o).exitWhen((function(e){return s=e+1,r.getDistance(t,e)>l})).forEach((function(e){})),{start:a,count:s-a}}function l(e,t){if(!t.length)return[e];for(var n=e.startRow,r=e.startCol,o=e.endRow,i=e.endCol,a=e.sheetId,s=e.sheetName,l=[],u=n,c=o,h=!1,d=n;d<o;d++)t.includes(d)?h&&(h=!1,c=d,l.push({startRow:u,startCol:r,endRow:c,endCol:i,sheetId:a,sheetName:s})):h||(h=!0,u=d);return h&&l.push({startRow:u,startCol:r,endRow:o,endCol:i,sheetId:a,sheetName:s}),l}var u=function(e,t,n){var i="".concat(t,"_").concat((0,r.zsn)(10)),a=Object.assign({},(0,o.z3T)(n),{sheetId:t,rangeId:i,usageType:r.m2A.COPY_LINK});return e.setDataRange([a],!0),i}},vsh_30157:function(e,t,n){n.d(t,{F:function(){return o}});var r=n("vsh_49352");function o(e,t){var n,o=null===(n=e.getPlugin(r.c))||void 0===n?void 0:n.manager;if(o)return o.getViewModel(t)}},vsh_49352:function(e,t,n){n.d(t,{c:function(){return r}});var r="ViewModelManagerPlugin"},vsh_46110:function(e,t,n){n.d(t,{HA:function(){return K},CQ:function(){return w.CQ},Pj:function(){return w.Pj},Dv:function(){return X},Pt:function(){return L.Pt}});var r=n("vsh_1139"),o=n("vsh_67017"),i=n.n(o),a=n("vsh_35067"),s=n("vsh_74561"),l=n("vsh_19264"),u=n("vsh_4175"),c=n("vsh_65498"),h=n("vsh_14499"),d=n("vsh_22485"),f=n("vsh_66588"),v=n.n(f);function p(){return v()('!function(){var t,n,r={vsh_67017:function(t,n,r){t.exports=r("vsh_3410")},vsh_59835:function(t,n,r){"use strict";r.d(n,{p:function(){return u}});var e=r("vsh_61332"),s=r.n(e),i=r("vsh_85734"),o=r.n(i),u=function(t){var n=String(t);return o()("08a441"+s()(n+"42b91e")).toString()}},vsh_61332:function(t,n,r){var e;!function(s){"use strict";function i(t,n){var r=(65535&t)+(65535&n);return(t>>16)+(n>>16)+(r>>16)<<16|65535&r}function o(t,n,r,e,s,o){return i((u=i(i(n,t),i(e,o)))<<(h=s)|u>>>32-h,r);var u,h}function u(t,n,r,e,s,i,u){return o(n&r|~n&e,t,n,s,i,u)}function h(t,n,r,e,s,i,u){return o(n&e|r&~e,t,n,s,i,u)}function c(t,n,r,e,s,i,u){return o(n^r^e,t,n,s,i,u)}function v(t,n,r,e,s,i,u){return o(r^(n|~e),t,n,s,i,u)}function a(t,n){var r,e,s,o,a;t[n>>5]|=128<<n%32,t[14+(n+64>>>9<<4)]=n;var f=1732584193,_=-271733879,l=-1732584194,p=271733878;for(r=0;r<t.length;r+=16)e=f,s=_,o=l,a=p,f=u(f,_,l,p,t[r],7,-680876936),p=u(p,f,_,l,t[r+1],12,-389564586),l=u(l,p,f,_,t[r+2],17,606105819),_=u(_,l,p,f,t[r+3],22,-1044525330),f=u(f,_,l,p,t[r+4],7,-176418897),p=u(p,f,_,l,t[r+5],12,1200080426),l=u(l,p,f,_,t[r+6],17,-1473231341),_=u(_,l,p,f,t[r+7],22,-45705983),f=u(f,_,l,p,t[r+8],7,1770035416),p=u(p,f,_,l,t[r+9],12,-1958414417),l=u(l,p,f,_,t[r+10],17,-42063),_=u(_,l,p,f,t[r+11],22,-1990404162),f=u(f,_,l,p,t[r+12],7,1804603682),p=u(p,f,_,l,t[r+13],12,-40341101),l=u(l,p,f,_,t[r+14],17,-1502002290),f=h(f,_=u(_,l,p,f,t[r+15],22,1236535329),l,p,t[r+1],5,-165796510),p=h(p,f,_,l,t[r+6],9,-1069501632),l=h(l,p,f,_,t[r+11],14,643717713),_=h(_,l,p,f,t[r],20,-373897302),f=h(f,_,l,p,t[r+5],5,-701558691),p=h(p,f,_,l,t[r+10],9,38016083),l=h(l,p,f,_,t[r+15],14,-660478335),_=h(_,l,p,f,t[r+4],20,-405537848),f=h(f,_,l,p,t[r+9],5,568446438),p=h(p,f,_,l,t[r+14],9,-1019803690),l=h(l,p,f,_,t[r+3],14,-187363961),_=h(_,l,p,f,t[r+8],20,1163531501),f=h(f,_,l,p,t[r+13],5,-1444681467),p=h(p,f,_,l,t[r+2],9,-51403784),l=h(l,p,f,_,t[r+7],14,1735328473),f=c(f,_=h(_,l,p,f,t[r+12],20,-1926607734),l,p,t[r+5],4,-378558),p=c(p,f,_,l,t[r+8],11,-2022574463),l=c(l,p,f,_,t[r+11],16,1839030562),_=c(_,l,p,f,t[r+14],23,-35309556),f=c(f,_,l,p,t[r+1],4,-1530992060),p=c(p,f,_,l,t[r+4],11,1272893353),l=c(l,p,f,_,t[r+7],16,-155497632),_=c(_,l,p,f,t[r+10],23,-1094730640),f=c(f,_,l,p,t[r+13],4,681279174),p=c(p,f,_,l,t[r],11,-358537222),l=c(l,p,f,_,t[r+3],16,-722521979),_=c(_,l,p,f,t[r+6],23,76029189),f=c(f,_,l,p,t[r+9],4,-640364487),p=c(p,f,_,l,t[r+12],11,-421815835),l=c(l,p,f,_,t[r+15],16,530742520),f=v(f,_=c(_,l,p,f,t[r+2],23,-995338651),l,p,t[r],6,-198630844),p=v(p,f,_,l,t[r+7],10,1126891415),l=v(l,p,f,_,t[r+14],15,-1416354905),_=v(_,l,p,f,t[r+5],21,-57434055),f=v(f,_,l,p,t[r+12],6,1700485571),p=v(p,f,_,l,t[r+3],10,-1894986606),l=v(l,p,f,_,t[r+10],15,-1051523),_=v(_,l,p,f,t[r+1],21,-2054922799),f=v(f,_,l,p,t[r+8],6,1873313359),p=v(p,f,_,l,t[r+15],10,-30611744),l=v(l,p,f,_,t[r+6],15,-1560198380),_=v(_,l,p,f,t[r+13],21,1309151649),f=v(f,_,l,p,t[r+4],6,-145523070),p=v(p,f,_,l,t[r+11],10,-1120210379),l=v(l,p,f,_,t[r+2],15,718787259),_=v(_,l,p,f,t[r+9],21,-343485551),f=i(f,e),_=i(_,s),l=i(l,o),p=i(p,a);return[f,_,l,p]}function f(t){var n,r="",e=32*t.length;for(n=0;n<e;n+=8)r+=String.fromCharCode(t[n>>5]>>>n%32&255);return r}function _(t){var n,r=[];for(r[(t.length>>2)-1]=void 0,n=0;n<r.length;n+=1)r[n]=0;var e=8*t.length;for(n=0;n<e;n+=8)r[n>>5]|=(255&t.charCodeAt(n/8))<<n%32;return r}function l(t){var n,r,e="0123456789abcdef",s="";for(r=0;r<t.length;r+=1)n=t.charCodeAt(r),s+=e.charAt(n>>>4&15)+e.charAt(15&n);return s}function p(t){return unescape(encodeURIComponent(t))}function g(t){return function(t){return f(a(_(t),8*t.length))}(p(t))}function d(t,n){return function(t,n){var r,e,s=_(t),i=[],o=[];for(i[15]=o[15]=void 0,s.length>16&&(s=a(s,8*t.length)),r=0;r<16;r+=1)i[r]=909522486^s[r],o[r]=1549556828^s[r];return e=a(i.concat(_(n)),512+8*n.length),f(a(o.concat(e),640))}(p(t),p(n))}function y(t,n,r){return n?r?d(n,t):l(d(n,t)):r?g(t):l(g(t))}void 0===(e=function(){return y}.call(n,r,n,t))||(t.exports=e)}()},vsh_47347:function(t){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},vsh_19597:function(t,n,r){var e=r("vsh_41732")("unscopables"),s=Array.prototype;null==s[e]&&r("vsh_25993")(s,e,{}),t.exports=function(t){s[e][t]=!0}},vsh_35699:function(t){t.exports=function(t,n,r,e){if(!(t instanceof n)||void 0!==e&&e in t)throw TypeError(r+": incorrect invocation!");return t}},vsh_21059:function(t,n,r){var e=r("vsh_17840");t.exports=function(t){if(!e(t))throw TypeError(t+" is not an object!");return t}},vsh_65824:function(t,n,r){"use strict";var e=r("vsh_58830"),s=r("vsh_11332"),i=r("vsh_53890");t.exports=[].copyWithin||function(t,n){var r=e(this),o=i(r.length),u=s(t,o),h=s(n,o),c=arguments.length>2?arguments[2]:void 0,v=Math.min((void 0===c?o:s(c,o))-h,o-u),a=1;for(h<u&&u<h+v&&(a=-1,h+=v-1,u+=v-1);v-- >0;)h in r?r[u]=r[h]:delete r[u],u+=a,h+=a;return r}},vsh_9551:function(t,n,r){"use strict";var e=r("vsh_58830"),s=r("vsh_11332"),i=r("vsh_53890");t.exports=function(t){for(var n=e(this),r=i(n.length),o=arguments.length,u=s(o>1?arguments[1]:void 0,r),h=o>2?arguments[2]:void 0,c=void 0===h?r:s(h,r);c>u;)n[u++]=t;return n}},vsh_25640:function(t,n,r){var e=r("vsh_36063"),s=r("vsh_53890"),i=r("vsh_11332");t.exports=function(t){return function(n,r,o){var u,h=e(n),c=s(h.length),v=i(o,c);if(t&&r!=r){for(;c>v;)if((u=h[v++])!=u)return!0}else for(;c>v;v++)if((t||v in h)&&h[v]===r)return t||v||0;return!t&&-1}}},vsh_61494:function(t,n,r){var e=r("vsh_80832"),s=r("vsh_60355"),i=r("vsh_58830"),o=r("vsh_53890"),u=r("vsh_79944");t.exports=function(t,n){var r=1==t,h=2==t,c=3==t,v=4==t,a=6==t,f=5==t||a,_=n||u;return function(n,u,l){for(var p,g,d=i(n),y=s(d),m=e(u,l,3),b=o(y.length),S=0,w=r?_(n,b):h?_(n,0):void 0;b>S;S++)if((f||S in y)&&(g=m(p=y[S],S,d),t))if(r)w[S]=g;else if(g)switch(t){case 3:return!0;case 5:return p;case 6:return S;case 2:w.push(p)}else if(v)return!1;return a?-1:c||v?v:w}}},vsh_56186:function(t,n,r){var e=r("vsh_17840"),s=r("vsh_5957"),i=r("vsh_41732")("species");t.exports=function(t){var n;return s(t)&&("function"!=typeof(n=t.constructor)||n!==Array&&!s(n.prototype)||(n=void 0),e(n)&&null===(n=n[i])&&(n=void 0)),void 0===n?Array:n}},vsh_79944:function(t,n,r){var e=r("vsh_56186");t.exports=function(t,n){return new(e(t))(n)}},vsh_77797:function(t,n,r){"use strict";var e=r("vsh_47347"),s=r("vsh_17840"),i=r("vsh_68757"),o=[].slice,u={},h=function(t,n,r){if(!(n in u)){for(var e=[],s=0;s<n;s++)e[s]="a["+s+"]";u[n]=Function("F,a","return new F("+e.join(",")+")")}return u[n](t,r)};t.exports=Function.bind||function(t){var n=e(this),r=o.call(arguments,1),u=function(){var e=r.concat(o.call(arguments));return this instanceof u?h(n,e.length,e):i(n,e,t)};return s(n.prototype)&&(u.prototype=n.prototype),u}},vsh_18987:function(t,n,r){var e=r("vsh_75551"),s=r("vsh_41732")("toStringTag"),i="Arguments"==e(function(){return arguments}());t.exports=function(t){var n,r,o;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=function(t,n){try{return t[n]}catch(t){}}(n=Object(t),s))?r:i?e(n):"Object"==(o=e(n))&&"function"==typeof n.callee?"Arguments":o}},vsh_75551:function(t){var n={}.toString;t.exports=function(t){return n.call(t).slice(8,-1)}},vsh_42492:function(t,n,r){"use strict";var e=r("vsh_35088").f,s=r("vsh_28216"),i=r("vsh_52753"),o=r("vsh_80832"),u=r("vsh_35699"),h=r("vsh_17800"),c=r("vsh_61960"),v=r("vsh_25011"),a=r("vsh_9283"),f=r("vsh_95157"),_=r("vsh_41930").fastKey,l=r("vsh_19585"),p=f?"_s":"size",g=function(t,n){var r,e=_(n);if("F"!==e)return t._i[e];for(r=t._f;r;r=r.n)if(r.k==n)return r};t.exports={getConstructor:function(t,n,r,c){var v=t((function(t,e){u(t,v,n,"_i"),t._t=n,t._i=s(null),t._f=void 0,t._l=void 0,t[p]=0,null!=e&&h(e,r,t[c],t)}));return i(v.prototype,{clear:function(){for(var t=l(this,n),r=t._i,e=t._f;e;e=e.n)e.r=!0,e.p&&(e.p=e.p.n=void 0),delete r[e.i];t._f=t._l=void 0,t[p]=0},delete:function(t){var r=l(this,n),e=g(r,t);if(e){var s=e.n,i=e.p;delete r._i[e.i],e.r=!0,i&&(i.n=s),s&&(s.p=i),r._f==e&&(r._f=s),r._l==e&&(r._l=i),r[p]--}return!!e},forEach:function(t){l(this,n);for(var r,e=o(t,arguments.length>1?arguments[1]:void 0,3);r=r?r.n:this._f;)for(e(r.v,r.k,this);r&&r.r;)r=r.p},has:function(t){return!!g(l(this,n),t)}}),f&&e(v.prototype,"size",{get:function(){return l(this,n)[p]}}),v},def:function(t,n,r){var e,s,i=g(t,n);return i?i.v=r:(t._l=i={i:s=_(n,!0),k:n,v:r,p:e=t._l,n:void 0,r:!1},t._f||(t._f=i),e&&(e.n=i),t[p]++,"F"!==s&&(t._i[s]=i)),t},getEntry:g,setStrong:function(t,n,r){c(t,n,(function(t,r){this._t=l(t,n),this._k=r,this._l=void 0}),(function(){for(var t=this,n=t._k,r=t._l;r&&r.r;)r=r.p;return t._t&&(t._l=r=r?r.n:t._t._f)?v(0,"keys"==n?r.k:"values"==n?r.v:[r.k,r.v]):(t._t=void 0,v(1))}),r?"entries":"values",!r,!0),a(n)}}},vsh_42425:function(t,n,r){"use strict";var e=r("vsh_52753"),s=r("vsh_41930").getWeak,i=r("vsh_21059"),o=r("vsh_17840"),u=r("vsh_35699"),h=r("vsh_17800"),c=r("vsh_61494"),v=r("vsh_64717"),a=r("vsh_19585"),f=c(5),_=c(6),l=0,p=function(t){return t._l||(t._l=new g)},g=function(){this.a=[]},d=function(t,n){return f(t.a,(function(t){return t[0]===n}))};g.prototype={get:function(t){var n=d(this,t);if(n)return n[1]},has:function(t){return!!d(this,t)},set:function(t,n){var r=d(this,t);r?r[1]=n:this.a.push([t,n])},delete:function(t){var n=_(this.a,(function(n){return n[0]===t}));return~n&&this.a.splice(n,1),!!~n}},t.exports={getConstructor:function(t,n,r,i){var c=t((function(t,e){u(t,c,n,"_i"),t._t=n,t._i=l++,t._l=void 0,null!=e&&h(e,r,t[i],t)}));return e(c.prototype,{delete:function(t){if(!o(t))return!1;var r=s(t);return!0===r?p(a(this,n)).delete(t):r&&v(r,this._i)&&delete r[this._i]},has:function(t){if(!o(t))return!1;var r=s(t);return!0===r?p(a(this,n)).has(t):r&&v(r,this._i)}}),c},def:function(t,n,r){var e=s(i(n),!0);return!0===e?p(t).set(n,r):e[t._i]=r,t},ufstore:p}},vsh_83293:function(t,n,r){"use strict";var e=r("vsh_70607"),s=r("vsh_96609"),i=r("vsh_4318"),o=r("vsh_52753"),u=r("vsh_41930"),h=r("vsh_17800"),c=r("vsh_35699"),v=r("vsh_17840"),a=r("vsh_50560"),f=r("vsh_97189"),_=r("vsh_27324"),l=r("vsh_62417");t.exports=function(t,n,r,p,g,d){var y=e[t],m=y,b=g?"set":"add",S=m&&m.prototype,w={},x=function(t){var n=S[t];i(S,t,"delete"==t||"has"==t?function(t){return!(d&&!v(t))&&n.call(this,0===t?0:t)}:"get"==t?function(t){return d&&!v(t)?void 0:n.call(this,0===t?0:t)}:"add"==t?function(t){return n.call(this,0===t?0:t),this}:function(t,r){return n.call(this,0===t?0:t,r),this})};if("function"==typeof m&&(d||S.forEach&&!a((function(){(new m).entries().next()})))){var E=new m,O=E[b](d?{}:-0,1)!=E,P=a((function(){E.has(1)})),M=f((function(t){new m(t)})),A=!d&&a((function(){for(var t=new m,n=5;n--;)t[b](n,n);return!t.has(-0)}));M||((m=n((function(n,r){c(n,m,t);var e=l(new y,n,m);return null!=r&&h(r,g,e[b],e),e}))).prototype=S,S.constructor=m),(P||A)&&(x("delete"),x("has"),g&&x("get")),(A||O)&&x(b),d&&S.clear&&delete S.clear}else m=p.getConstructor(n,t,g,b),o(m.prototype,r),u.NEED=!0;return _(m,t),w[t]=m,s(s.G+s.W+s.F*(m!=y),w),d||p.setStrong(m,t,g),m}},vsh_84897:function(t){var n=t.exports={version:"2.5.3"};"number"==typeof __e&&(__e=n)},vsh_67188:function(t,n,r){"use strict";var e=r("vsh_35088"),s=r("vsh_52996");t.exports=function(t,n,r){n in t?e.f(t,n,s(0,r)):t[n]=r}},vsh_80832:function(t,n,r){var e=r("vsh_47347");t.exports=function(t,n,r){if(e(t),void 0===n)return t;switch(r){case 1:return function(r){return t.call(n,r)};case 2:return function(r,e){return t.call(n,r,e)};case 3:return function(r,e,s){return t.call(n,r,e,s)}}return function(){return t.apply(n,arguments)}}},vsh_29970:function(t,n,r){"use strict";var e=r("vsh_21059"),s=r("vsh_45094"),i="number";t.exports=function(t){if("string"!==t&&t!==i&&"default"!==t)throw TypeError("Incorrect hint");return s(e(this),t!=i)}},vsh_71609:function(t){t.exports=function(t){if(null==t)throw TypeError("Can\'t call method on  "+t);return t}},vsh_95157:function(t,n,r){t.exports=!r("vsh_50560")((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},vsh_17075:function(t,n,r){var e=r("vsh_17840"),s=r("vsh_70607").document,i=e(s)&&e(s.createElement);t.exports=function(t){return i?s.createElement(t):{}}},vsh_44950:function(t){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},vsh_61975:function(t,n,r){var e=r("vsh_25694"),s=r("vsh_32250"),i=r("vsh_92895");t.exports=function(t){var n=e(t),r=s.f;if(r)for(var o,u=r(t),h=i.f,c=0;u.length>c;)h.call(t,o=u[c++])&&n.push(o);return n}},vsh_96609:function(t,n,r){var e=r("vsh_70607"),s=r("vsh_84897"),i=r("vsh_25993"),o=r("vsh_4318"),u=r("vsh_80832"),h=function(t,n,r){var c,v,a,f,_=t&h.F,l=t&h.G,p=t&h.S,g=t&h.P,d=t&h.B,y=l?e:p?e[n]||(e[n]={}):(e[n]||{}).prototype,m=l?s:s[n]||(s[n]={}),b=m.prototype||(m.prototype={});for(c in l&&(r=n),r)a=((v=!_&&y&&void 0!==y[c])?y:r)[c],f=d&&v?u(a,e):g&&"function"==typeof a?u(Function.call,a):a,y&&o(y,c,a,t&h.U),m[c]!=a&&i(m,c,f),g&&b[c]!=a&&(b[c]=a)};e.core=s,h.F=1,h.G=2,h.S=4,h.P=8,h.B=16,h.W=32,h.U=64,h.R=128,t.exports=h},vsh_8328:function(t,n,r){var e=r("vsh_41732")("match");t.exports=function(t){var n=/./;try{"/./"[t](n)}catch(r){try{return n[e]=!1,!"/./"[t](n)}catch(t){}}return!0}},vsh_50560:function(t){t.exports=function(t){try{return!!t()}catch(t){return!0}}},vsh_61596:function(t,n,r){"use strict";var e=r("vsh_25993"),s=r("vsh_4318"),i=r("vsh_50560"),o=r("vsh_71609"),u=r("vsh_41732");t.exports=function(t,n,r){var h=u(t),c=r(o,h,""[t]),v=c[0],a=c[1];i((function(){var n={};return n[h]=function(){return 7},7!=""[t](n)}))&&(s(String.prototype,t,v),e(RegExp.prototype,h,2==n?function(t,n){return a.call(t,this,n)}:function(t){return a.call(t,this)}))}},vsh_76662:function(t,n,r){"use strict";var e=r("vsh_21059");t.exports=function(){var t=e(this),n="";return t.global&&(n+="g"),t.ignoreCase&&(n+="i"),t.multiline&&(n+="m"),t.unicode&&(n+="u"),t.sticky&&(n+="y"),n}},vsh_43529:function(t,n,r){"use strict";var e=r("vsh_5957"),s=r("vsh_17840"),i=r("vsh_53890"),o=r("vsh_80832"),u=r("vsh_41732")("isConcatSpreadable");t.exports=function t(n,r,h,c,v,a,f,_){for(var l,p,g=v,d=0,y=!!f&&o(f,_,3);d<c;){if(d in h){if(l=y?y(h[d],d,r):h[d],p=!1,s(l)&&(p=void 0!==(p=l[u])?!!p:e(l)),p&&a>0)g=t(n,r,l,i(l.length),g,a-1)-1;else{if(g>=9007199254740991)throw TypeError();n[g]=l}g++}d++}return g}},vsh_17800:function(t,n,r){var e=r("vsh_80832"),s=r("vsh_12683"),i=r("vsh_75089"),o=r("vsh_21059"),u=r("vsh_53890"),h=r("vsh_82240"),c={},v={},a=t.exports=function(t,n,r,a,f){var _,l,p,g,d=f?function(){return t}:h(t),y=e(r,a,n?2:1),m=0;if("function"!=typeof d)throw TypeError(t+" is not iterable!");if(i(d)){for(_=u(t.length);_>m;m++)if((g=n?y(o(l=t[m])[0],l[1]):y(t[m]))===c||g===v)return g}else for(p=d.call(t);!(l=p.next()).done;)if((g=s(p,y,l.value,n))===c||g===v)return g};a.BREAK=c,a.RETURN=v},vsh_70607:function(t){var n=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},vsh_64717:function(t){var n={}.hasOwnProperty;t.exports=function(t,r){return n.call(t,r)}},vsh_25993:function(t,n,r){var e=r("vsh_35088"),s=r("vsh_52996");t.exports=r("vsh_95157")?function(t,n,r){return e.f(t,n,s(1,r))}:function(t,n,r){return t[n]=r,t}},vsh_88569:function(t,n,r){var e=r("vsh_70607").document;t.exports=e&&e.documentElement},vsh_23627:function(t,n,r){t.exports=!r("vsh_95157")&&!r("vsh_50560")((function(){return 7!=Object.defineProperty(r("vsh_17075")("div"),"a",{get:function(){return 7}}).a}))},vsh_62417:function(t,n,r){var e=r("vsh_17840"),s=r("vsh_89563").set;t.exports=function(t,n,r){var i,o=n.constructor;return o!==r&&"function"==typeof o&&(i=o.prototype)!==r.prototype&&e(i)&&s&&s(t,i),t}},vsh_68757:function(t){t.exports=function(t,n,r){var e=void 0===r;switch(n.length){case 0:return e?t():t.call(r);case 1:return e?t(n[0]):t.call(r,n[0]);case 2:return e?t(n[0],n[1]):t.call(r,n[0],n[1]);case 3:return e?t(n[0],n[1],n[2]):t.call(r,n[0],n[1],n[2]);case 4:return e?t(n[0],n[1],n[2],n[3]):t.call(r,n[0],n[1],n[2],n[3])}return t.apply(r,n)}},vsh_60355:function(t,n,r){var e=r("vsh_75551");t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==e(t)?t.split(""):Object(t)}},vsh_75089:function(t,n,r){var e=r("vsh_66476"),s=r("vsh_41732")("iterator"),i=Array.prototype;t.exports=function(t){return void 0!==t&&(e.Array===t||i[s]===t)}},vsh_5957:function(t,n,r){var e=r("vsh_75551");t.exports=Array.isArray||function(t){return"Array"==e(t)}},vsh_70441:function(t,n,r){var e=r("vsh_17840"),s=Math.floor;t.exports=function(t){return!e(t)&&isFinite(t)&&s(t)===t}},vsh_17840:function(t){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},vsh_64525:function(t,n,r){var e=r("vsh_17840"),s=r("vsh_75551"),i=r("vsh_41732")("match");t.exports=function(t){var n;return e(t)&&(void 0!==(n=t[i])?!!n:"RegExp"==s(t))}},vsh_12683:function(t,n,r){var e=r("vsh_21059");t.exports=function(t,n,r,s){try{return s?n(e(r)[0],r[1]):n(r)}catch(n){var i=t.return;throw void 0!==i&&e(i.call(t)),n}}},vsh_88084:function(t,n,r){"use strict";var e=r("vsh_28216"),s=r("vsh_52996"),i=r("vsh_27324"),o={};r("vsh_25993")(o,r("vsh_41732")("iterator"),(function(){return this})),t.exports=function(t,n,r){t.prototype=e(o,{next:s(1,r)}),i(t,n+" Iterator")}},vsh_61960:function(t,n,r){"use strict";var e=r("vsh_50927"),s=r("vsh_96609"),i=r("vsh_4318"),o=r("vsh_25993"),u=r("vsh_64717"),h=r("vsh_66476"),c=r("vsh_88084"),v=r("vsh_27324"),a=r("vsh_78675"),f=r("vsh_41732")("iterator"),_=!([].keys&&"next"in[].keys()),l="keys",p="values",g=function(){return this};t.exports=function(t,n,r,d,y,m,b){c(r,n,d);var S,w,x,E=function(t){if(!_&&t in A)return A[t];switch(t){case l:case p:return function(){return new r(this,t)}}return function(){return new r(this,t)}},O=n+" Iterator",P=y==p,M=!1,A=t.prototype,j=A[f]||A["@@iterator"]||y&&A[y],F=!_&&j||E(y),I=y?P?E("entries"):F:void 0,L="Array"==n&&A.entries||j;if(L&&(x=a(L.call(new t)))!==Object.prototype&&x.next&&(v(x,O,!0),e||u(x,f)||o(x,f,g)),P&&j&&j.name!==p&&(M=!0,F=function(){return j.call(this)}),e&&!b||!_&&!M&&A[f]||o(A,f,F),h[n]=F,h[O]=g,y)if(S={values:P?F:E(p),keys:m?F:E(l),entries:I},b)for(w in S)w in A||i(A,w,S[w]);else s(s.P+s.F*(_||M),n,S);return S}},vsh_97189:function(t,n,r){var e=r("vsh_41732")("iterator"),s=!1;try{var i=[7][e]();i.return=function(){s=!0},Array.from(i,(function(){throw 2}))}catch(t){}t.exports=function(t,n){if(!n&&!s)return!1;var r=!1;try{var i=[7],o=i[e]();o.next=function(){return{done:r=!0}},i[e]=function(){return o},t(i)}catch(t){}return r}},vsh_25011:function(t){t.exports=function(t,n){return{value:n,done:!!t}}},vsh_66476:function(t){t.exports={}},vsh_50927:function(t){t.exports=!1},vsh_12803:function(t){var n=Math.expm1;t.exports=!n||n(10)>22025.465794806718||n(10)<22025.465794806718||-2e-17!=n(-2e-17)?function(t){return 0==(t=+t)?t:t>-1e-6&&t<1e-6?t+t*t/2:Math.exp(t)-1}:n},vsh_96857:function(t,n,r){var e=r("vsh_63037"),s=Math.pow,i=s(2,-52),o=s(2,-23),u=s(2,127)*(2-o),h=s(2,-126);t.exports=Math.fround||function(t){var n,r,s=Math.abs(t),c=e(t);return s<h?c*(s/h/o+1/i-1/i)*h*o:(r=(n=(1+o/i)*s)-(n-s))>u||r!=r?c*(1/0):c*r}},vsh_71410:function(t){t.exports=Math.log1p||function(t){return(t=+t)>-1e-8&&t<1e-8?t-t*t/2:Math.log(1+t)}},vsh_63037:function(t){t.exports=Math.sign||function(t){return 0==(t=+t)||t!=t?t:t<0?-1:1}},vsh_41930:function(t,n,r){var e=r("vsh_41819")("meta"),s=r("vsh_17840"),i=r("vsh_64717"),o=r("vsh_35088").f,u=0,h=Object.isExtensible||function(){return!0},c=!r("vsh_50560")((function(){return h(Object.preventExtensions({}))})),v=function(t){o(t,e,{value:{i:"O"+ ++u,w:{}}})},a=t.exports={KEY:e,NEED:!1,fastKey:function(t,n){if(!s(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!i(t,e)){if(!h(t))return"F";if(!n)return"E";v(t)}return t[e].i},getWeak:function(t,n){if(!i(t,e)){if(!h(t))return!0;if(!n)return!1;v(t)}return t[e].w},onFreeze:function(t){return c&&a.NEED&&h(t)&&!i(t,e)&&v(t),t}}},vsh_38756:function(t,n,r){var e=r("vsh_70607"),s=r("vsh_40179").set,i=e.MutationObserver||e.WebKitMutationObserver,o=e.process,u=e.Promise,h="process"==r("vsh_75551")(o);t.exports=function(){var t,n,r,c=function(){var e,s;for(h&&(e=o.domain)&&e.exit();t;){s=t.fn,t=t.next;try{s()}catch(e){throw t?r():n=void 0,e}}n=void 0,e&&e.enter()};if(h)r=function(){o.nextTick(c)};else if(!i||e.navigator&&e.navigator.standalone)if(u&&u.resolve){var v=u.resolve();r=function(){v.then(c)}}else r=function(){s.call(e,c)};else{var a=!0,f=document.createTextNode("");new i(c).observe(f,{characterData:!0}),r=function(){f.data=a=!a}}return function(e){var s={fn:e,next:void 0};n&&(n.next=s),t||(t=s,r()),n=s}}},vsh_80530:function(t,n,r){"use strict";var e=r("vsh_47347");function s(t){var n,r;this.promise=new t((function(t,e){if(void 0!==n||void 0!==r)throw TypeError("Bad Promise constructor");n=t,r=e})),this.resolve=e(n),this.reject=e(r)}t.exports.f=function(t){return new s(t)}},vsh_24268:function(t,n,r){"use strict";var e=r("vsh_25694"),s=r("vsh_32250"),i=r("vsh_92895"),o=r("vsh_58830"),u=r("vsh_60355"),h=Object.assign;t.exports=!h||r("vsh_50560")((function(){var t={},n={},r=Symbol(),e="abcdefghijklmnopqrst";return t[r]=7,e.split("").forEach((function(t){n[t]=t})),7!=h({},t)[r]||Object.keys(h({},n)).join("")!=e}))?function(t,n){for(var r=o(t),h=arguments.length,c=1,v=s.f,a=i.f;h>c;)for(var f,_=u(arguments[c++]),l=v?e(_).concat(v(_)):e(_),p=l.length,g=0;p>g;)a.call(_,f=l[g++])&&(r[f]=_[f]);return r}:h},vsh_28216:function(t,n,r){var e=r("vsh_21059"),s=r("vsh_72203"),i=r("vsh_44950"),o=r("vsh_32975")("IE_PROTO"),u=function(){},h=function(){var t,n=r("vsh_17075")("iframe"),e=i.length;for(n.style.display="none",r("vsh_88569").appendChild(n),n.src="javascript:",(t=n.contentWindow.document).open(),t.write("<script>document.F=Object<\\/script>"),t.close(),h=t.F;e--;)delete h.prototype[i[e]];return h()};t.exports=Object.create||function(t,n){var r;return null!==t?(u.prototype=e(t),r=new u,u.prototype=null,r[o]=t):r=h(),void 0===n?r:s(r,n)}},vsh_35088:function(t,n,r){var e=r("vsh_21059"),s=r("vsh_23627"),i=r("vsh_45094"),o=Object.defineProperty;n.f=r("vsh_95157")?Object.defineProperty:function(t,n,r){if(e(t),n=i(n,!0),e(r),s)try{return o(t,n,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(t[n]=r.value),t}},vsh_72203:function(t,n,r){var e=r("vsh_35088"),s=r("vsh_21059"),i=r("vsh_25694");t.exports=r("vsh_95157")?Object.defineProperties:function(t,n){s(t);for(var r,o=i(n),u=o.length,h=0;u>h;)e.f(t,r=o[h++],n[r]);return t}},vsh_4292:function(t,n,r){"use strict";t.exports=r("vsh_50927")||!r("vsh_50560")((function(){var t=Math.random();__defineSetter__.call(null,t,(function(){})),delete r("vsh_70607")[t]}))},vsh_26166:function(t,n,r){var e=r("vsh_92895"),s=r("vsh_52996"),i=r("vsh_36063"),o=r("vsh_45094"),u=r("vsh_64717"),h=r("vsh_23627"),c=Object.getOwnPropertyDescriptor;n.f=r("vsh_95157")?c:function(t,n){if(t=i(t),n=o(n,!0),h)try{return c(t,n)}catch(t){}if(u(t,n))return s(!e.f.call(t,n),t[n])}},vsh_86423:function(t,n,r){var e=r("vsh_36063"),s=r("vsh_42955").f,i={}.toString,o="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];t.exports.f=function(t){return o&&"[object Window]"==i.call(t)?function(t){try{return s(t)}catch(t){return o.slice()}}(t):s(e(t))}},vsh_42955:function(t,n,r){var e=r("vsh_2345"),s=r("vsh_44950").concat("length","prototype");n.f=Object.getOwnPropertyNames||function(t){return e(t,s)}},vsh_32250:function(t,n){n.f=Object.getOwnPropertySymbols},vsh_78675:function(t,n,r){var e=r("vsh_64717"),s=r("vsh_58830"),i=r("vsh_32975")("IE_PROTO"),o=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=s(t),e(t,i)?t[i]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?o:null}},vsh_2345:function(t,n,r){var e=r("vsh_64717"),s=r("vsh_36063"),i=r("vsh_25640")(!1),o=r("vsh_32975")("IE_PROTO");t.exports=function(t,n){var r,u=s(t),h=0,c=[];for(r in u)r!=o&&e(u,r)&&c.push(r);for(;n.length>h;)e(u,r=n[h++])&&(~i(c,r)||c.push(r));return c}},vsh_25694:function(t,n,r){var e=r("vsh_2345"),s=r("vsh_44950");t.exports=Object.keys||function(t){return e(t,s)}},vsh_92895:function(t,n){n.f={}.propertyIsEnumerable},vsh_57707:function(t,n,r){var e=r("vsh_96609"),s=r("vsh_84897"),i=r("vsh_50560");t.exports=function(t,n){var r=(s.Object||{})[t]||Object[t],o={};o[t]=n(r),e(e.S+e.F*i((function(){r(1)})),"Object",o)}},vsh_68794:function(t,n,r){var e=r("vsh_25694"),s=r("vsh_36063"),i=r("vsh_92895").f;t.exports=function(t){return function(n){for(var r,o=s(n),u=e(o),h=u.length,c=0,v=[];h>c;)i.call(o,r=u[c++])&&v.push(t?[r,o[r]]:o[r]);return v}}},vsh_336:function(t,n,r){var e=r("vsh_42955"),s=r("vsh_32250"),i=r("vsh_21059"),o=r("vsh_70607").Reflect;t.exports=o&&o.ownKeys||function(t){var n=e.f(i(t)),r=s.f;return r?n.concat(r(t)):n}},vsh_17224:function(t,n,r){var e=r("vsh_70607").parseFloat,s=r("vsh_17108").trim;t.exports=1/e(r("vsh_63596")+"-0")!=-1/0?function(t){var n=s(String(t),3),r=e(n);return 0===r&&"-"==n.charAt(0)?-0:r}:e},vsh_35672:function(t,n,r){var e=r("vsh_70607").parseInt,s=r("vsh_17108").trim,i=r("vsh_63596"),o=/^[-+]?0[xX]/;t.exports=8!==e(i+"08")||22!==e(i+"0x16")?function(t,n){var r=s(String(t),3);return e(r,n>>>0||(o.test(r)?16:10))}:e},vsh_78547:function(t){t.exports=function(t){try{return{e:!1,v:t()}}catch(t){return{e:!0,v:t}}}},vsh_70413:function(t,n,r){var e=r("vsh_21059"),s=r("vsh_17840"),i=r("vsh_80530");t.exports=function(t,n){if(e(t),s(n)&&n.constructor===t)return n;var r=i.f(t);return(0,r.resolve)(n),r.promise}},vsh_52996:function(t){t.exports=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}}},vsh_52753:function(t,n,r){var e=r("vsh_4318");t.exports=function(t,n,r){for(var s in n)e(t,s,n[s],r);return t}},vsh_4318:function(t,n,r){var e=r("vsh_70607"),s=r("vsh_25993"),i=r("vsh_64717"),o=r("vsh_41819")("src"),u="toString",h=Function.toString,c=(""+h).split(u);r("vsh_84897").inspectSource=function(t){return h.call(t)},(t.exports=function(t,n,r,u){var h="function"==typeof r;h&&(i(r,"name")||s(r,"name",n)),t[n]!==r&&(h&&(i(r,o)||s(r,o,t[n]?""+t[n]:c.join(String(n)))),t===e?t[n]=r:u?t[n]?t[n]=r:s(t,n,r):(delete t[n],s(t,n,r)))})(Function.prototype,u,(function(){return"function"==typeof this&&this[o]||h.call(this)}))},vsh_38134:function(t){t.exports=Object.is||function(t,n){return t===n?0!==t||1/t==1/n:t!=t&&n!=n}},vsh_89563:function(t,n,r){var e=r("vsh_17840"),s=r("vsh_21059"),i=function(t,n){if(s(t),!e(n)&&null!==n)throw TypeError(n+": can\'t set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,n,e){try{(e=r("vsh_80832")(Function.call,r("vsh_26166").f(Object.prototype,"__proto__").set,2))(t,[]),n=!(t instanceof Array)}catch(t){n=!0}return function(t,r){return i(t,r),n?t.__proto__=r:e(t,r),t}}({},!1):void 0),check:i}},vsh_9283:function(t,n,r){"use strict";var e=r("vsh_70607"),s=r("vsh_35088"),i=r("vsh_95157"),o=r("vsh_41732")("species");t.exports=function(t){var n=e[t];i&&n&&!n[o]&&s.f(n,o,{configurable:!0,get:function(){return this}})}},vsh_27324:function(t,n,r){var e=r("vsh_35088").f,s=r("vsh_64717"),i=r("vsh_41732")("toStringTag");t.exports=function(t,n,r){t&&!s(t=r?t:t.prototype,i)&&e(t,i,{configurable:!0,value:n})}},vsh_32975:function(t,n,r){var e=r("vsh_12530")("keys"),s=r("vsh_41819");t.exports=function(t){return e[t]||(e[t]=s(t))}},vsh_12530:function(t,n,r){var e=r("vsh_70607"),s="__core-js_shared__",i=e[s]||(e[s]={});t.exports=function(t){return i[t]||(i[t]={})}},vsh_21623:function(t,n,r){var e=r("vsh_21059"),s=r("vsh_47347"),i=r("vsh_41732")("species");t.exports=function(t,n){var r,o=e(t).constructor;return void 0===o||null==(r=e(o)[i])?n:s(r)}},vsh_17535:function(t,n,r){"use strict";var e=r("vsh_50560");t.exports=function(t,n){return!!t&&e((function(){n?t.call(null,(function(){}),1):t.call(null)}))}},vsh_49969:function(t,n,r){var e=r("vsh_47992"),s=r("vsh_71609");t.exports=function(t){return function(n,r){var i,o,u=String(s(n)),h=e(r),c=u.length;return h<0||h>=c?t?"":void 0:(i=u.charCodeAt(h))<55296||i>56319||h+1===c||(o=u.charCodeAt(h+1))<56320||o>57343?t?u.charAt(h):i:t?u.slice(h,h+2):o-56320+(i-55296<<10)+65536}}},vsh_78326:function(t,n,r){var e=r("vsh_64525"),s=r("vsh_71609");t.exports=function(t,n,r){if(e(n))throw TypeError("String#"+r+" doesn\'t accept regex!");return String(s(t))}},vsh_18793:function(t,n,r){var e=r("vsh_96609"),s=r("vsh_50560"),i=r("vsh_71609"),o=/"/g,u=function(t,n,r,e){var s=String(i(t)),u="<"+n;return""!==r&&(u+=" "+r+\'="\'+String(e).replace(o,"&quot;")+\'"\'),u+">"+s+"</"+n+">"};t.exports=function(t,n){var r={};r[t]=n(u),e(e.P+e.F*s((function(){var n=""[t](\'"\');return n!==n.toLowerCase()||n.split(\'"\').length>3})),"String",r)}},vsh_27524:function(t,n,r){var e=r("vsh_53890"),s=r("vsh_77861"),i=r("vsh_71609");t.exports=function(t,n,r,o){var u=String(i(t)),h=u.length,c=void 0===r?" ":String(r),v=e(n);if(v<=h||""==c)return u;var a=v-h,f=s.call(c,Math.ceil(a/c.length));return f.length>a&&(f=f.slice(0,a)),o?f+u:u+f}},vsh_77861:function(t,n,r){"use strict";var e=r("vsh_47992"),s=r("vsh_71609");t.exports=function(t){var n=String(s(this)),r="",i=e(t);if(i<0||i==1/0)throw RangeError("Count can\'t be negative");for(;i>0;(i>>>=1)&&(n+=n))1&i&&(r+=n);return r}},vsh_17108:function(t,n,r){var e=r("vsh_96609"),s=r("vsh_71609"),i=r("vsh_50560"),o=r("vsh_63596"),u="["+o+"]",h=RegExp("^"+u+u+"*"),c=RegExp(u+u+"*$"),v=function(t,n,r){var s={},u=i((function(){return!!o[t]()||"​"!="​"[t]()})),h=s[t]=u?n(a):o[t];r&&(s[r]=h),e(e.P+e.F*u,"String",s)},a=v.trim=function(t,n){return t=String(s(t)),1&n&&(t=t.replace(h,"")),2&n&&(t=t.replace(c,"")),t};t.exports=v},vsh_63596:function(t){t.exports="\\t\\n\\v\\f\\r   ᠎             　\\u2028\\u2029\\ufeff"},vsh_40179:function(t,n,r){var e,s,i,o=r("vsh_80832"),u=r("vsh_68757"),h=r("vsh_88569"),c=r("vsh_17075"),v=r("vsh_70607"),a=v.process,f=v.setImmediate,_=v.clearImmediate,l=v.MessageChannel,p=v.Dispatch,g=0,d={},y="onreadystatechange",m=function(){var t=+this;if(d.hasOwnProperty(t)){var n=d[t];delete d[t],n()}},b=function(t){m.call(t.data)};f&&_||(f=function(t){for(var n=[],r=1;arguments.length>r;)n.push(arguments[r++]);return d[++g]=function(){u("function"==typeof t?t:Function(t),n)},e(g),g},_=function(t){delete d[t]},"process"==r("vsh_75551")(a)?e=function(t){a.nextTick(o(m,t,1))}:p&&p.now?e=function(t){p.now(o(m,t,1))}:l?(i=(s=new l).port2,s.port1.onmessage=b,e=o(i.postMessage,i,1)):v.addEventListener&&"function"==typeof postMessage&&!v.importScripts?(e=function(t){v.postMessage(t+"","*")},v.addEventListener("message",b,!1)):e=y in c("script")?function(t){h.appendChild(c("script")).onreadystatechange=function(){h.removeChild(this),m.call(t)}}:function(t){setTimeout(o(m,t,1),0)}),t.exports={set:f,clear:_}},vsh_11332:function(t,n,r){var e=r("vsh_47992"),s=Math.max,i=Math.min;t.exports=function(t,n){return(t=e(t))<0?s(t+n,0):i(t,n)}},vsh_65654:function(t,n,r){var e=r("vsh_47992"),s=r("vsh_53890");t.exports=function(t){if(void 0===t)return 0;var n=e(t),r=s(n);if(n!==r)throw RangeError("Wrong length!");return r}},vsh_47992:function(t){var n=Math.ceil,r=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?r:n)(t)}},vsh_36063:function(t,n,r){var e=r("vsh_60355"),s=r("vsh_71609");t.exports=function(t){return e(s(t))}},vsh_53890:function(t,n,r){var e=r("vsh_47992"),s=Math.min;t.exports=function(t){return t>0?s(e(t),9007199254740991):0}},vsh_58830:function(t,n,r){var e=r("vsh_71609");t.exports=function(t){return Object(e(t))}},vsh_45094:function(t,n,r){var e=r("vsh_17840");t.exports=function(t,n){if(!e(t))return t;var r,s;if(n&&"function"==typeof(r=t.toString)&&!e(s=r.call(t)))return s;if("function"==typeof(r=t.valueOf)&&!e(s=r.call(t)))return s;if(!n&&"function"==typeof(r=t.toString)&&!e(s=r.call(t)))return s;throw TypeError("Can\'t convert object to primitive value")}},vsh_84804:function(t,n,r){"use strict";if(r("vsh_95157")){var e=r("vsh_50927"),s=r("vsh_70607"),i=r("vsh_50560"),o=r("vsh_96609"),u=r("vsh_18708"),h=r("vsh_70642"),c=r("vsh_80832"),v=r("vsh_35699"),a=r("vsh_52996"),f=r("vsh_25993"),_=r("vsh_52753"),l=r("vsh_47992"),p=r("vsh_53890"),g=r("vsh_65654"),d=r("vsh_11332"),y=r("vsh_45094"),m=r("vsh_64717"),b=r("vsh_18987"),S=r("vsh_17840"),w=r("vsh_58830"),x=r("vsh_75089"),E=r("vsh_28216"),O=r("vsh_78675"),P=r("vsh_42955").f,M=r("vsh_82240"),A=r("vsh_41819"),j=r("vsh_41732"),F=r("vsh_61494"),I=r("vsh_25640"),L=r("vsh_21623"),N=r("vsh_15640"),R=r("vsh_66476"),k=r("vsh_97189"),T=r("vsh_9283"),C=r("vsh_9551"),B=r("vsh_65824"),D=r("vsh_35088"),W=r("vsh_26166"),U=D.f,V=W.f,z=s.RangeError,G=s.TypeError,H=s.Uint8Array,Y="ArrayBuffer",K="SharedArrayBuffer",X="BYTES_PER_ELEMENT",q=Array.prototype,J=h.ArrayBuffer,$=h.DataView,Z=F(0),Q=F(2),tt=F(3),nt=F(4),rt=F(5),et=F(6),st=I(!0),it=I(!1),ot=N.values,ut=N.keys,ht=N.entries,ct=q.lastIndexOf,vt=q.reduce,at=q.reduceRight,ft=q.join,_t=q.sort,lt=q.slice,pt=q.toString,gt=q.toLocaleString,dt=j("iterator"),yt=j("toStringTag"),mt=A("typed_constructor"),bt=A("def_constructor"),St=u.CONSTR,wt=u.TYPED,xt=u.VIEW,Et="Wrong length!",Ot=F(1,(function(t,n){return Ft(L(t,t[bt]),n)})),Pt=i((function(){return 1===new H(new Uint16Array([1]).buffer)[0]})),Mt=!!H&&!!H.prototype.set&&i((function(){new H(1).set({})})),At=function(t,n){var r=l(t);if(r<0||r%n)throw z("Wrong offset!");return r},jt=function(t){if(S(t)&&wt in t)return t;throw G(t+" is not a typed array!")},Ft=function(t,n){if(!S(t)||!(mt in t))throw G("It is not a typed array constructor!");return new t(n)},It=function(t,n){return Lt(L(t,t[bt]),n)},Lt=function(t,n){for(var r=0,e=n.length,s=Ft(t,e);e>r;)s[r]=n[r++];return s},Nt=function(t,n,r){U(t,n,{get:function(){return this._d[r]}})},Rt=function(t){var n,r,e,s,i,o,u=w(t),h=arguments.length,v=h>1?arguments[1]:void 0,a=void 0!==v,f=M(u);if(null!=f&&!x(f)){for(o=f.call(u),e=[],n=0;!(i=o.next()).done;n++)e.push(i.value);u=e}for(a&&h>2&&(v=c(v,arguments[2],2)),n=0,r=p(u.length),s=Ft(this,r);r>n;n++)s[n]=a?v(u[n],n):u[n];return s},kt=function(){for(var t=0,n=arguments.length,r=Ft(this,n);n>t;)r[t]=arguments[t++];return r},Tt=!!H&&i((function(){gt.call(new H(1))})),Ct=function(){return gt.apply(Tt?lt.call(jt(this)):jt(this),arguments)},Bt={copyWithin:function(t,n){return B.call(jt(this),t,n,arguments.length>2?arguments[2]:void 0)},every:function(t){return nt(jt(this),t,arguments.length>1?arguments[1]:void 0)},fill:function(t){return C.apply(jt(this),arguments)},filter:function(t){return It(this,Q(jt(this),t,arguments.length>1?arguments[1]:void 0))},find:function(t){return rt(jt(this),t,arguments.length>1?arguments[1]:void 0)},findIndex:function(t){return et(jt(this),t,arguments.length>1?arguments[1]:void 0)},forEach:function(t){Z(jt(this),t,arguments.length>1?arguments[1]:void 0)},indexOf:function(t){return it(jt(this),t,arguments.length>1?arguments[1]:void 0)},includes:function(t){return st(jt(this),t,arguments.length>1?arguments[1]:void 0)},join:function(t){return ft.apply(jt(this),arguments)},lastIndexOf:function(t){return ct.apply(jt(this),arguments)},map:function(t){return Ot(jt(this),t,arguments.length>1?arguments[1]:void 0)},reduce:function(t){return vt.apply(jt(this),arguments)},reduceRight:function(t){return at.apply(jt(this),arguments)},reverse:function(){for(var t,n=this,r=jt(n).length,e=Math.floor(r/2),s=0;s<e;)t=n[s],n[s++]=n[--r],n[r]=t;return n},some:function(t){return tt(jt(this),t,arguments.length>1?arguments[1]:void 0)},sort:function(t){return _t.call(jt(this),t)},subarray:function(t,n){var r=jt(this),e=r.length,s=d(t,e);return new(L(r,r[bt]))(r.buffer,r.byteOffset+s*r.BYTES_PER_ELEMENT,p((void 0===n?e:d(n,e))-s))}},Dt=function(t,n){return It(this,lt.call(jt(this),t,n))},Wt=function(t){jt(this);var n=At(arguments[1],1),r=this.length,e=w(t),s=p(e.length),i=0;if(s+n>r)throw z(Et);for(;i<s;)this[n+i]=e[i++]},Ut={entries:function(){return ht.call(jt(this))},keys:function(){return ut.call(jt(this))},values:function(){return ot.call(jt(this))}},Vt=function(t,n){return S(t)&&t[wt]&&"symbol"!=typeof n&&n in t&&String(+n)==String(n)},zt=function(t,n){return Vt(t,n=y(n,!0))?a(2,t[n]):V(t,n)},Gt=function(t,n,r){return!(Vt(t,n=y(n,!0))&&S(r)&&m(r,"value"))||m(r,"get")||m(r,"set")||r.configurable||m(r,"writable")&&!r.writable||m(r,"enumerable")&&!r.enumerable?U(t,n,r):(t[n]=r.value,t)};St||(W.f=zt,D.f=Gt),o(o.S+o.F*!St,"Object",{getOwnPropertyDescriptor:zt,defineProperty:Gt}),i((function(){pt.call({})}))&&(pt=gt=function(){return ft.call(this)});var Ht=_({},Bt);_(Ht,Ut),f(Ht,dt,Ut.values),_(Ht,{slice:Dt,set:Wt,constructor:function(){},toString:pt,toLocaleString:Ct}),Nt(Ht,"buffer","b"),Nt(Ht,"byteOffset","o"),Nt(Ht,"byteLength","l"),Nt(Ht,"length","e"),U(Ht,yt,{get:function(){return this[wt]}}),t.exports=function(t,n,r,h){var c=t+((h=!!h)?"Clamped":"")+"Array",a="get"+t,_="set"+t,l=s[c],d=l||{},y=l&&O(l),m=!l||!u.ABV,w={},x=l&&l.prototype,M=function(t,r){U(t,r,{get:function(){return function(t,r){var e=t._d;return e.v[a](r*n+e.o,Pt)}(this,r)},set:function(t){return function(t,r,e){var s=t._d;h&&(e=(e=Math.round(e))<0?0:e>255?255:255&e),s.v[_](r*n+s.o,e,Pt)}(this,r,t)},enumerable:!0})};m?(l=r((function(t,r,e,s){v(t,l,c,"_d");var i,o,u,h,a=0,_=0;if(S(r)){if(!(r instanceof J||(h=b(r))==Y||h==K))return wt in r?Lt(l,r):Rt.call(l,r);i=r,_=At(e,n);var d=r.byteLength;if(void 0===s){if(d%n)throw z(Et);if((o=d-_)<0)throw z(Et)}else if((o=p(s)*n)+_>d)throw z(Et);u=o/n}else u=g(r),i=new J(o=u*n);for(f(t,"_d",{b:i,o:_,l:o,e:u,v:new $(i)});a<u;)M(t,a++)})),x=l.prototype=E(Ht),f(x,"constructor",l)):i((function(){l(1)}))&&i((function(){new l(-1)}))&&k((function(t){new l,new l(null),new l(1.5),new l(t)}),!0)||(l=r((function(t,r,e,s){var i;return v(t,l,c),S(r)?r instanceof J||(i=b(r))==Y||i==K?void 0!==s?new d(r,At(e,n),s):void 0!==e?new d(r,At(e,n)):new d(r):wt in r?Lt(l,r):Rt.call(l,r):new d(g(r))})),Z(y!==Function.prototype?P(d).concat(P(y)):P(d),(function(t){t in l||f(l,t,d[t])})),l.prototype=x,e||(x.constructor=l));var A=x[dt],j=!!A&&("values"==A.name||null==A.name),F=Ut.values;f(l,mt,!0),f(x,wt,c),f(x,xt,!0),f(x,bt,l),(h?new l(1)[yt]==c:yt in x)||U(x,yt,{get:function(){return c}}),w[c]=l,o(o.G+o.W+o.F*(l!=d),w),o(o.S,c,{BYTES_PER_ELEMENT:n}),o(o.S+o.F*i((function(){d.of.call(l,1)})),c,{from:Rt,of:kt}),X in x||f(x,X,n),o(o.P,c,Bt),T(c),o(o.P+o.F*Mt,c,{set:Wt}),o(o.P+o.F*!j,c,Ut),e||x.toString==pt||(x.toString=pt),o(o.P+o.F*i((function(){new l(1).slice()})),c,{slice:Dt}),o(o.P+o.F*(i((function(){return[1,2].toLocaleString()!=new l([1,2]).toLocaleString()}))||!i((function(){x.toLocaleString.call([1,2])}))),c,{toLocaleString:Ct}),R[c]=j?A:F,e||j||f(x,dt,F)}}else t.exports=function(){}},vsh_70642:function(t,n,r){"use strict";var e=r("vsh_70607"),s=r("vsh_95157"),i=r("vsh_50927"),o=r("vsh_18708"),u=r("vsh_25993"),h=r("vsh_52753"),c=r("vsh_50560"),v=r("vsh_35699"),a=r("vsh_47992"),f=r("vsh_53890"),_=r("vsh_65654"),l=r("vsh_42955").f,p=r("vsh_35088").f,g=r("vsh_9551"),d=r("vsh_27324"),y="ArrayBuffer",m="DataView",b="Wrong index!",S=e.ArrayBuffer,w=e.DataView,x=e.Math,E=e.RangeError,O=e.Infinity,P=S,M=x.abs,A=x.pow,j=x.floor,F=x.log,I=x.LN2,L="buffer",N="byteLength",R="byteOffset",k=s?"_b":L,T=s?"_l":N,C=s?"_o":R;function B(t,n,r){var e,s,i,o=new Array(r),u=8*r-n-1,h=(1<<u)-1,c=h>>1,v=23===n?A(2,-24)-A(2,-77):0,a=0,f=t<0||0===t&&1/t<0?1:0;for((t=M(t))!=t||t===O?(s=t!=t?1:0,e=h):(e=j(F(t)/I),t*(i=A(2,-e))<1&&(e--,i*=2),(t+=e+c>=1?v/i:v*A(2,1-c))*i>=2&&(e++,i/=2),e+c>=h?(s=0,e=h):e+c>=1?(s=(t*i-1)*A(2,n),e+=c):(s=t*A(2,c-1)*A(2,n),e=0));n>=8;o[a++]=255&s,s/=256,n-=8);for(e=e<<n|s,u+=n;u>0;o[a++]=255&e,e/=256,u-=8);return o[--a]|=128*f,o}function D(t,n,r){var e,s=8*r-n-1,i=(1<<s)-1,o=i>>1,u=s-7,h=r-1,c=t[h--],v=127&c;for(c>>=7;u>0;v=256*v+t[h],h--,u-=8);for(e=v&(1<<-u)-1,v>>=-u,u+=n;u>0;e=256*e+t[h],h--,u-=8);if(0===v)v=1-o;else{if(v===i)return e?NaN:c?-O:O;e+=A(2,n),v-=o}return(c?-1:1)*e*A(2,v-n)}function W(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]}function U(t){return[255&t]}function V(t){return[255&t,t>>8&255]}function z(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]}function G(t){return B(t,52,8)}function H(t){return B(t,23,4)}function Y(t,n,r){p(t.prototype,n,{get:function(){return this[r]}})}function K(t,n,r,e){var s=_(+r);if(s+n>t[T])throw E(b);var i=t[k]._b,o=s+t[C],u=i.slice(o,o+n);return e?u:u.reverse()}function X(t,n,r,e,s,i){var o=_(+r);if(o+n>t[T])throw E(b);for(var u=t[k]._b,h=o+t[C],c=e(+s),v=0;v<n;v++)u[h+v]=c[i?v:n-v-1]}if(o.ABV){if(!c((function(){S(1)}))||!c((function(){new S(-1)}))||c((function(){return new S,new S(1.5),new S(NaN),S.name!=y}))){for(var q,J=(S=function(t){return v(this,S),new P(_(t))}).prototype=P.prototype,$=l(P),Z=0;$.length>Z;)(q=$[Z++])in S||u(S,q,P[q]);i||(J.constructor=S)}var Q=new w(new S(2)),tt=w.prototype.setInt8;Q.setInt8(0,2147483648),Q.setInt8(1,2147483649),!Q.getInt8(0)&&Q.getInt8(1)||h(w.prototype,{setInt8:function(t,n){tt.call(this,t,n<<24>>24)},setUint8:function(t,n){tt.call(this,t,n<<24>>24)}},!0)}else S=function(t){v(this,S,y);var n=_(t);this._b=g.call(new Array(n),0),this[T]=n},w=function(t,n,r){v(this,w,m),v(t,S,m);var e=t[T],s=a(n);if(s<0||s>e)throw E("Wrong offset!");if(s+(r=void 0===r?e-s:f(r))>e)throw E("Wrong length!");this[k]=t,this[C]=s,this[T]=r},s&&(Y(S,N,"_l"),Y(w,L,"_b"),Y(w,N,"_l"),Y(w,R,"_o")),h(w.prototype,{getInt8:function(t){return K(this,1,t)[0]<<24>>24},getUint8:function(t){return K(this,1,t)[0]},getInt16:function(t){var n=K(this,2,t,arguments[1]);return(n[1]<<8|n[0])<<16>>16},getUint16:function(t){var n=K(this,2,t,arguments[1]);return n[1]<<8|n[0]},getInt32:function(t){return W(K(this,4,t,arguments[1]))},getUint32:function(t){return W(K(this,4,t,arguments[1]))>>>0},getFloat32:function(t){return D(K(this,4,t,arguments[1]),23,4)},getFloat64:function(t){return D(K(this,8,t,arguments[1]),52,8)},setInt8:function(t,n){X(this,1,t,U,n)},setUint8:function(t,n){X(this,1,t,U,n)},setInt16:function(t,n){X(this,2,t,V,n,arguments[2])},setUint16:function(t,n){X(this,2,t,V,n,arguments[2])},setInt32:function(t,n){X(this,4,t,z,n,arguments[2])},setUint32:function(t,n){X(this,4,t,z,n,arguments[2])},setFloat32:function(t,n){X(this,4,t,H,n,arguments[2])},setFloat64:function(t,n){X(this,8,t,G,n,arguments[2])}});d(S,y),d(w,m),u(w.prototype,o.VIEW,!0),n.ArrayBuffer=S,n.DataView=w},vsh_18708:function(t,n,r){for(var e,s=r("vsh_70607"),i=r("vsh_25993"),o=r("vsh_41819"),u=o("typed_array"),h=o("view"),c=!(!s.ArrayBuffer||!s.DataView),v=c,a=0,f="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");a<9;)(e=s[f[a++]])?(i(e.prototype,u,!0),i(e.prototype,h,!0)):v=!1;t.exports={ABV:c,CONSTR:v,TYPED:u,VIEW:h}},vsh_41819:function(t){var n=0,r=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++n+r).toString(36))}},vsh_76240:function(t,n,r){var e=r("vsh_70607").navigator;t.exports=e&&e.userAgent||""},vsh_19585:function(t,n,r){var e=r("vsh_17840");t.exports=function(t,n){if(!e(t)||t._t!==n)throw TypeError("Incompatible receiver, "+n+" required!");return t}},vsh_93618:function(t,n,r){var e=r("vsh_70607"),s=r("vsh_84897"),i=r("vsh_50927"),o=r("vsh_73164"),u=r("vsh_35088").f;t.exports=function(t){var n=s.Symbol||(s.Symbol=i?{}:e.Symbol||{});"_"==t.charAt(0)||t in n||u(n,t,{value:o.f(t)})}},vsh_73164:function(t,n,r){n.f=r("vsh_41732")},vsh_41732:function(t,n,r){var e=r("vsh_12530")("wks"),s=r("vsh_41819"),i=r("vsh_70607").Symbol,o="function"==typeof i;(t.exports=function(t){return e[t]||(e[t]=o&&i[t]||(o?i:s)("Symbol."+t))}).store=e},vsh_82240:function(t,n,r){var e=r("vsh_18987"),s=r("vsh_41732")("iterator"),i=r("vsh_66476");t.exports=r("vsh_84897").getIteratorMethod=function(t){if(null!=t)return t[s]||t["@@iterator"]||i[e(t)]}},vsh_85621:function(t,n,r){var e=r("vsh_96609");e(e.P,"Array",{copyWithin:r("vsh_65824")}),r("vsh_19597")("copyWithin")},vsh_79085:function(t,n,r){var e=r("vsh_96609");e(e.P,"Array",{fill:r("vsh_9551")}),r("vsh_19597")("fill")},vsh_41282:function(t,n,r){"use strict";var e=r("vsh_96609"),s=r("vsh_61494")(6),i="findIndex",o=!0;i in[]&&Array(1)[i]((function(){o=!1})),e(e.P+e.F*o,"Array",{findIndex:function(t){return s(this,t,arguments.length>1?arguments[1]:void 0)}}),r("vsh_19597")(i)},vsh_97017:function(t,n,r){"use strict";var e=r("vsh_96609"),s=r("vsh_61494")(5),i="find",o=!0;i in[]&&Array(1).find((function(){o=!1})),e(e.P+e.F*o,"Array",{find:function(t){return s(this,t,arguments.length>1?arguments[1]:void 0)}}),r("vsh_19597")(i)},vsh_4915:function(t,n,r){"use strict";var e=r("vsh_80832"),s=r("vsh_96609"),i=r("vsh_58830"),o=r("vsh_12683"),u=r("vsh_75089"),h=r("vsh_53890"),c=r("vsh_67188"),v=r("vsh_82240");s(s.S+s.F*!r("vsh_97189")((function(t){Array.from(t)})),"Array",{from:function(t){var n,r,s,a,f=i(t),_="function"==typeof this?this:Array,l=arguments.length,p=l>1?arguments[1]:void 0,g=void 0!==p,d=0,y=v(f);if(g&&(p=e(p,l>2?arguments[2]:void 0,2)),null==y||_==Array&&u(y))for(r=new _(n=h(f.length));n>d;d++)c(r,d,g?p(f[d],d):f[d]);else for(a=y.call(f),r=new _;!(s=a.next()).done;d++)c(r,d,g?o(a,p,[s.value,d],!0):s.value);return r.length=d,r}})},vsh_15640:function(t,n,r){"use strict";var e=r("vsh_19597"),s=r("vsh_25011"),i=r("vsh_66476"),o=r("vsh_36063");t.exports=r("vsh_61960")(Array,"Array",(function(t,n){this._t=o(t),this._i=0,this._k=n}),(function(){var t=this._t,n=this._k,r=this._i++;return!t||r>=t.length?(this._t=void 0,s(1)):s(0,"keys"==n?r:"values"==n?t[r]:[r,t[r]])}),"values"),i.Arguments=i.Array,e("keys"),e("values"),e("entries")},vsh_57822:function(t,n,r){"use strict";var e=r("vsh_96609"),s=r("vsh_67188");e(e.S+e.F*r("vsh_50560")((function(){function t(){}return!(Array.of.call(t)instanceof t)})),"Array",{of:function(){for(var t=0,n=arguments.length,r=new("function"==typeof this?this:Array)(n);n>t;)s(r,t,arguments[t++]);return r.length=n,r}})},vsh_88175:function(t,n,r){"use strict";var e=r("vsh_96609"),s=r("vsh_47347"),i=r("vsh_58830"),o=r("vsh_50560"),u=[].sort,h=[1,2,3];e(e.P+e.F*(o((function(){h.sort(void 0)}))||!o((function(){h.sort(null)}))||!r("vsh_17535")(u)),"Array",{sort:function(t){return void 0===t?u.call(i(this)):u.call(i(this),s(t))}})},vsh_13212:function(t,n,r){r("vsh_9283")("Array")},vsh_34645:function(t,n,r){var e=r("vsh_41732")("toPrimitive"),s=Date.prototype;e in s||r("vsh_25993")(s,e,r("vsh_29970"))},vsh_16452:function(t,n,r){"use strict";var e=r("vsh_17840"),s=r("vsh_78675"),i=r("vsh_41732")("hasInstance"),o=Function.prototype;i in o||r("vsh_35088").f(o,i,{value:function(t){if("function"!=typeof this||!e(t))return!1;if(!e(this.prototype))return t instanceof this;for(;t=s(t);)if(this.prototype===t)return!0;return!1}})},vsh_19577:function(t,n,r){var e=r("vsh_35088").f,s=Function.prototype,i=/^\\s*function ([^ (]*)/,o="name";o in s||r("vsh_95157")&&e(s,o,{configurable:!0,get:function(){try{return(""+this).match(i)[1]}catch(t){return""}}})},vsh_12267:function(t,n,r){"use strict";var e=r("vsh_42492"),s=r("vsh_19585"),i="Map";t.exports=r("vsh_83293")(i,(function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}}),{get:function(t){var n=e.getEntry(s(this,i),t);return n&&n.v},set:function(t,n){return e.def(s(this,i),0===t?0:t,n)}},e,!0)},vsh_41620:function(t,n,r){var e=r("vsh_96609"),s=r("vsh_71410"),i=Math.sqrt,o=Math.acosh;e(e.S+e.F*!(o&&710==Math.floor(o(Number.MAX_VALUE))&&o(1/0)==1/0),"Math",{acosh:function(t){return(t=+t)<1?NaN:t>94906265.62425156?Math.log(t)+Math.LN2:s(t-1+i(t-1)*i(t+1))}})},vsh_72525:function(t,n,r){var e=r("vsh_96609"),s=Math.asinh;e(e.S+e.F*!(s&&1/s(0)>0),"Math",{asinh:function t(n){return isFinite(n=+n)&&0!=n?n<0?-t(-n):Math.log(n+Math.sqrt(n*n+1)):n}})},vsh_53721:function(t,n,r){var e=r("vsh_96609"),s=Math.atanh;e(e.S+e.F*!(s&&1/s(-0)<0),"Math",{atanh:function(t){return 0==(t=+t)?t:Math.log((1+t)/(1-t))/2}})},vsh_79134:function(t,n,r){var e=r("vsh_96609"),s=r("vsh_63037");e(e.S,"Math",{cbrt:function(t){return s(t=+t)*Math.pow(Math.abs(t),1/3)}})},vsh_46879:function(t,n,r){var e=r("vsh_96609");e(e.S,"Math",{clz32:function(t){return(t>>>=0)?31-Math.floor(Math.log(t+.5)*Math.LOG2E):32}})},vsh_6840:function(t,n,r){var e=r("vsh_96609"),s=Math.exp;e(e.S,"Math",{cosh:function(t){return(s(t=+t)+s(-t))/2}})},vsh_1853:function(t,n,r){var e=r("vsh_96609"),s=r("vsh_12803");e(e.S+e.F*(s!=Math.expm1),"Math",{expm1:s})},vsh_8284:function(t,n,r){var e=r("vsh_96609");e(e.S,"Math",{fround:r("vsh_96857")})},vsh_28630:function(t,n,r){var e=r("vsh_96609"),s=Math.abs;e(e.S,"Math",{hypot:function(t,n){for(var r,e,i=0,o=0,u=arguments.length,h=0;o<u;)h<(r=s(arguments[o++]))?(i=i*(e=h/r)*e+1,h=r):i+=r>0?(e=r/h)*e:r;return h===1/0?1/0:h*Math.sqrt(i)}})},vsh_53987:function(t,n,r){var e=r("vsh_96609"),s=Math.imul;e(e.S+e.F*r("vsh_50560")((function(){return-5!=s(4294967295,5)||2!=s.length})),"Math",{imul:function(t,n){var r=65535,e=+t,s=+n,i=r&e,o=r&s;return 0|i*o+((r&e>>>16)*o+i*(r&s>>>16)<<16>>>0)}})},vsh_3457:function(t,n,r){var e=r("vsh_96609");e(e.S,"Math",{log10:function(t){return Math.log(t)*Math.LOG10E}})},vsh_52512:function(t,n,r){var e=r("vsh_96609");e(e.S,"Math",{log1p:r("vsh_71410")})},vsh_45908:function(t,n,r){var e=r("vsh_96609");e(e.S,"Math",{log2:function(t){return Math.log(t)/Math.LN2}})},vsh_80918:function(t,n,r){var e=r("vsh_96609");e(e.S,"Math",{sign:r("vsh_63037")})},vsh_68299:function(t,n,r){var e=r("vsh_96609"),s=r("vsh_12803"),i=Math.exp;e(e.S+e.F*r("vsh_50560")((function(){return-2e-17!=!Math.sinh(-2e-17)})),"Math",{sinh:function(t){return Math.abs(t=+t)<1?(s(t)-s(-t))/2:(i(t-1)-i(-t-1))*(Math.E/2)}})},vsh_69139:function(t,n,r){var e=r("vsh_96609"),s=r("vsh_12803"),i=Math.exp;e(e.S,"Math",{tanh:function(t){var n=s(t=+t),r=s(-t);return n==1/0?1:r==1/0?-1:(n-r)/(i(t)+i(-t))}})},vsh_94524:function(t,n,r){var e=r("vsh_96609");e(e.S,"Math",{trunc:function(t){return(t>0?Math.floor:Math.ceil)(t)}})},vsh_9910:function(t,n,r){"use strict";var e=r("vsh_70607"),s=r("vsh_64717"),i=r("vsh_75551"),o=r("vsh_62417"),u=r("vsh_45094"),h=r("vsh_50560"),c=r("vsh_42955").f,v=r("vsh_26166").f,a=r("vsh_35088").f,f=r("vsh_17108").trim,_="Number",l=e.Number,p=l,g=l.prototype,d=i(r("vsh_28216")(g))==_,y="trim"in String.prototype,m=function(t){var n=u(t,!1);if("string"==typeof n&&n.length>2){var r,e,s,i=(n=y?n.trim():f(n,3)).charCodeAt(0);if(43===i||45===i){if(88===(r=n.charCodeAt(2))||120===r)return NaN}else if(48===i){switch(n.charCodeAt(1)){case 66:case 98:e=2,s=49;break;case 79:case 111:e=8,s=55;break;default:return+n}for(var o,h=n.slice(2),c=0,v=h.length;c<v;c++)if((o=h.charCodeAt(c))<48||o>s)return NaN;return parseInt(h,e)}}return+n};if(!l(" 0o1")||!l("0b1")||l("+0x1")){l=function(t){var n=arguments.length<1?0:t,r=this;return r instanceof l&&(d?h((function(){g.valueOf.call(r)})):i(r)!=_)?o(new p(m(n)),r,l):m(n)};for(var b,S=r("vsh_95157")?c(p):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),w=0;S.length>w;w++)s(p,b=S[w])&&!s(l,b)&&a(l,b,v(p,b));l.prototype=g,g.constructor=l,r("vsh_4318")(e,_,l)}},vsh_75422:function(t,n,r){var e=r("vsh_96609");e(e.S,"Number",{EPSILON:Math.pow(2,-52)})},vsh_64988:function(t,n,r){var e=r("vsh_96609"),s=r("vsh_70607").isFinite;e(e.S,"Number",{isFinite:function(t){return"number"==typeof t&&s(t)}})},vsh_91170:function(t,n,r){var e=r("vsh_96609");e(e.S,"Number",{isInteger:r("vsh_70441")})},vsh_33318:function(t,n,r){var e=r("vsh_96609");e(e.S,"Number",{isNaN:function(t){return t!=t}})},vsh_68264:function(t,n,r){var e=r("vsh_96609"),s=r("vsh_70441"),i=Math.abs;e(e.S,"Number",{isSafeInteger:function(t){return s(t)&&i(t)<=9007199254740991}})},vsh_45071:function(t,n,r){var e=r("vsh_96609");e(e.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},vsh_45753:function(t,n,r){var e=r("vsh_96609");e(e.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},vsh_17919:function(t,n,r){var e=r("vsh_96609"),s=r("vsh_17224");e(e.S+e.F*(Number.parseFloat!=s),"Number",{parseFloat:s})},vsh_89664:function(t,n,r){var e=r("vsh_96609"),s=r("vsh_35672");e(e.S+e.F*(Number.parseInt!=s),"Number",{parseInt:s})},vsh_14711:function(t,n,r){var e=r("vsh_96609");e(e.S+e.F,"Object",{assign:r("vsh_24268")})},vsh_34930:function(t,n,r){var e=r("vsh_17840"),s=r("vsh_41930").onFreeze;r("vsh_57707")("freeze",(function(t){return function(n){return t&&e(n)?t(s(n)):n}}))},vsh_4652:function(t,n,r){var e=r("vsh_36063"),s=r("vsh_26166").f;r("vsh_57707")("getOwnPropertyDescriptor",(function(){return function(t,n){return s(e(t),n)}}))},vsh_31728:function(t,n,r){r("vsh_57707")("getOwnPropertyNames",(function(){return r("vsh_86423").f}))},vsh_23828:function(t,n,r){var e=r("vsh_58830"),s=r("vsh_78675");r("vsh_57707")("getPrototypeOf",(function(){return function(t){return s(e(t))}}))},vsh_82660:function(t,n,r){var e=r("vsh_17840");r("vsh_57707")("isExtensible",(function(t){return function(n){return!!e(n)&&(!t||t(n))}}))},vsh_33015:function(t,n,r){var e=r("vsh_17840");r("vsh_57707")("isFrozen",(function(t){return function(n){return!e(n)||!!t&&t(n)}}))},vsh_51393:function(t,n,r){var e=r("vsh_17840");r("vsh_57707")("isSealed",(function(t){return function(n){return!e(n)||!!t&&t(n)}}))},vsh_88279:function(t,n,r){var e=r("vsh_96609");e(e.S,"Object",{is:r("vsh_38134")})},vsh_2909:function(t,n,r){var e=r("vsh_58830"),s=r("vsh_25694");r("vsh_57707")("keys",(function(){return function(t){return s(e(t))}}))},vsh_37981:function(t,n,r){var e=r("vsh_17840"),s=r("vsh_41930").onFreeze;r("vsh_57707")("preventExtensions",(function(t){return function(n){return t&&e(n)?t(s(n)):n}}))},vsh_17569:function(t,n,r){var e=r("vsh_17840"),s=r("vsh_41930").onFreeze;r("vsh_57707")("seal",(function(t){return function(n){return t&&e(n)?t(s(n)):n}}))},vsh_62185:function(t,n,r){var e=r("vsh_96609");e(e.S,"Object",{setPrototypeOf:r("vsh_89563").set})},vsh_28265:function(t,n,r){"use strict";var e=r("vsh_18987"),s={};s[r("vsh_41732")("toStringTag")]="z",s+""!="[object z]"&&r("vsh_4318")(Object.prototype,"toString",(function(){return"[object "+e(this)+"]"}),!0)},vsh_72665:function(t,n,r){"use strict";var e,s,i,o,u=r("vsh_50927"),h=r("vsh_70607"),c=r("vsh_80832"),v=r("vsh_18987"),a=r("vsh_96609"),f=r("vsh_17840"),_=r("vsh_47347"),l=r("vsh_35699"),p=r("vsh_17800"),g=r("vsh_21623"),d=r("vsh_40179").set,y=r("vsh_38756")(),m=r("vsh_80530"),b=r("vsh_78547"),S=r("vsh_70413"),w="Promise",x=h.TypeError,E=h.process,O=h.Promise,P="process"==v(E),M=function(){},A=s=m.f,j=!!function(){try{var t=O.resolve(1),n=(t.constructor={})[r("vsh_41732")("species")]=function(t){t(M,M)};return(P||"function"==typeof PromiseRejectionEvent)&&t.then(M)instanceof n}catch(t){}}(),F=function(t){var n;return!(!f(t)||"function"!=typeof(n=t.then))&&n},I=function(t,n){if(!t._n){t._n=!0;var r=t._c;y((function(){for(var e=t._v,s=1==t._s,i=0,o=function(n){var r,i,o=s?n.ok:n.fail,u=n.resolve,h=n.reject,c=n.domain;try{o?(s||(2==t._h&&R(t),t._h=1),!0===o?r=e:(c&&c.enter(),r=o(e),c&&c.exit()),r===n.promise?h(x("Promise-chain cycle")):(i=F(r))?i.call(r,u,h):u(r)):h(e)}catch(t){h(t)}};r.length>i;)o(r[i++]);t._c=[],t._n=!1,n&&!t._h&&L(t)}))}},L=function(t){d.call(h,(function(){var n,r,e,s=t._v,i=N(t);if(i&&(n=b((function(){P?E.emit("unhandledRejection",s,t):(r=h.onunhandledrejection)?r({promise:t,reason:s}):(e=h.console)&&e.error&&e.error("Unhandled promise rejection",s)})),t._h=P||N(t)?2:1),t._a=void 0,i&&n.e)throw n.v}))},N=function(t){return 1!==t._h&&0===(t._a||t._c).length},R=function(t){d.call(h,(function(){var n;P?E.emit("rejectionHandled",t):(n=h.onrejectionhandled)&&n({promise:t,reason:t._v})}))},k=function(t){var n=this;n._d||(n._d=!0,(n=n._w||n)._v=t,n._s=2,n._a||(n._a=n._c.slice()),I(n,!0))},T=function(t){var n,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===t)throw x("Promise can\'t be resolved itself");(n=F(t))?y((function(){var e={_w:r,_d:!1};try{n.call(t,c(T,e,1),c(k,e,1))}catch(t){k.call(e,t)}})):(r._v=t,r._s=1,I(r,!1))}catch(t){k.call({_w:r,_d:!1},t)}}};j||(O=function(t){l(this,O,w,"_h"),_(t),e.call(this);try{t(c(T,this,1),c(k,this,1))}catch(t){k.call(this,t)}},(e=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=r("vsh_52753")(O.prototype,{then:function(t,n){var r=A(g(this,O));return r.ok="function"!=typeof t||t,r.fail="function"==typeof n&&n,r.domain=P?E.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&I(this,!1),r.promise},catch:function(t){return this.then(void 0,t)}}),i=function(){var t=new e;this.promise=t,this.resolve=c(T,t,1),this.reject=c(k,t,1)},m.f=A=function(t){return t===O||t===o?new i(t):s(t)}),a(a.G+a.W+a.F*!j,{Promise:O}),r("vsh_27324")(O,w),r("vsh_9283")(w),o=r("vsh_84897").Promise,a(a.S+a.F*!j,w,{reject:function(t){var n=A(this);return(0,n.reject)(t),n.promise}}),a(a.S+a.F*(u||!j),w,{resolve:function(t){return S(u&&this===o?O:this,t)}}),a(a.S+a.F*!(j&&r("vsh_97189")((function(t){O.all(t).catch(M)}))),w,{all:function(t){var n=this,r=A(n),e=r.resolve,s=r.reject,i=b((function(){var r=[],i=0,o=1;p(t,!1,(function(t){var u=i++,h=!1;r.push(void 0),o++,n.resolve(t).then((function(t){h||(h=!0,r[u]=t,--o||e(r))}),s)})),--o||e(r)}));return i.e&&s(i.v),r.promise},race:function(t){var n=this,r=A(n),e=r.reject,s=b((function(){p(t,!1,(function(t){n.resolve(t).then(r.resolve,e)}))}));return s.e&&e(s.v),r.promise}})},vsh_86418:function(t,n,r){var e=r("vsh_96609"),s=r("vsh_47347"),i=r("vsh_21059"),o=(r("vsh_70607").Reflect||{}).apply,u=Function.apply;e(e.S+e.F*!r("vsh_50560")((function(){o((function(){}))})),"Reflect",{apply:function(t,n,r){var e=s(t),h=i(r);return o?o(e,n,h):u.call(e,n,h)}})},vsh_19338:function(t,n,r){var e=r("vsh_96609"),s=r("vsh_28216"),i=r("vsh_47347"),o=r("vsh_21059"),u=r("vsh_17840"),h=r("vsh_50560"),c=r("vsh_77797"),v=(r("vsh_70607").Reflect||{}).construct,a=h((function(){function t(){}return!(v((function(){}),[],t)instanceof t)})),f=!h((function(){v((function(){}))}));e(e.S+e.F*(a||f),"Reflect",{construct:function(t,n){i(t),o(n);var r=arguments.length<3?t:i(arguments[2]);if(f&&!a)return v(t,n,r);if(t==r){switch(n.length){case 0:return new t;case 1:return new t(n[0]);case 2:return new t(n[0],n[1]);case 3:return new t(n[0],n[1],n[2]);case 4:return new t(n[0],n[1],n[2],n[3])}var e=[null];return e.push.apply(e,n),new(c.apply(t,e))}var h=r.prototype,_=s(u(h)?h:Object.prototype),l=Function.apply.call(t,_,n);return u(l)?l:_}})},vsh_48295:function(t,n,r){var e=r("vsh_35088"),s=r("vsh_96609"),i=r("vsh_21059"),o=r("vsh_45094");s(s.S+s.F*r("vsh_50560")((function(){Reflect.defineProperty(e.f({},1,{value:1}),1,{value:2})})),"Reflect",{defineProperty:function(t,n,r){i(t),n=o(n,!0),i(r);try{return e.f(t,n,r),!0}catch(t){return!1}}})},vsh_26604:function(t,n,r){var e=r("vsh_96609"),s=r("vsh_26166").f,i=r("vsh_21059");e(e.S,"Reflect",{deleteProperty:function(t,n){var r=s(i(t),n);return!(r&&!r.configurable)&&delete t[n]}})},vsh_98037:function(t,n,r){var e=r("vsh_26166"),s=r("vsh_96609"),i=r("vsh_21059");s(s.S,"Reflect",{getOwnPropertyDescriptor:function(t,n){return e.f(i(t),n)}})},vsh_86077:function(t,n,r){var e=r("vsh_96609"),s=r("vsh_78675"),i=r("vsh_21059");e(e.S,"Reflect",{getPrototypeOf:function(t){return s(i(t))}})},vsh_75468:function(t,n,r){var e=r("vsh_26166"),s=r("vsh_78675"),i=r("vsh_64717"),o=r("vsh_96609"),u=r("vsh_17840"),h=r("vsh_21059");o(o.S,"Reflect",{get:function t(n,r){var o,c,v=arguments.length<3?n:arguments[2];return h(n)===v?n[r]:(o=e.f(n,r))?i(o,"value")?o.value:void 0!==o.get?o.get.call(v):void 0:u(c=s(n))?t(c,r,v):void 0}})},vsh_80769:function(t,n,r){var e=r("vsh_96609");e(e.S,"Reflect",{has:function(t,n){return n in t}})},vsh_90037:function(t,n,r){var e=r("vsh_96609"),s=r("vsh_21059"),i=Object.isExtensible;e(e.S,"Reflect",{isExtensible:function(t){return s(t),!i||i(t)}})},vsh_1218:function(t,n,r){var e=r("vsh_96609");e(e.S,"Reflect",{ownKeys:r("vsh_336")})},vsh_69676:function(t,n,r){var e=r("vsh_96609"),s=r("vsh_21059"),i=Object.preventExtensions;e(e.S,"Reflect",{preventExtensions:function(t){s(t);try{return i&&i(t),!0}catch(t){return!1}}})},vsh_38312:function(t,n,r){var e=r("vsh_96609"),s=r("vsh_89563");s&&e(e.S,"Reflect",{setPrototypeOf:function(t,n){s.check(t,n);try{return s.set(t,n),!0}catch(t){return!1}}})},vsh_55854:function(t,n,r){var e=r("vsh_35088"),s=r("vsh_26166"),i=r("vsh_78675"),o=r("vsh_64717"),u=r("vsh_96609"),h=r("vsh_52996"),c=r("vsh_21059"),v=r("vsh_17840");u(u.S,"Reflect",{set:function t(n,r,u){var a,f,_=arguments.length<4?n:arguments[3],l=s.f(c(n),r);if(!l){if(v(f=i(n)))return t(f,r,u,_);l=h(0)}return o(l,"value")?!(!1===l.writable||!v(_))&&((a=s.f(_,r)||h(0)).value=u,e.f(_,r,a),!0):void 0!==l.set&&(l.set.call(_,u),!0)}})},vsh_19785:function(t,n,r){var e=r("vsh_70607"),s=r("vsh_62417"),i=r("vsh_35088").f,o=r("vsh_42955").f,u=r("vsh_64525"),h=r("vsh_76662"),c=e.RegExp,v=c,a=c.prototype,f=/a/g,_=/a/g,l=new c(f)!==f;if(r("vsh_95157")&&(!l||r("vsh_50560")((function(){return _[r("vsh_41732")("match")]=!1,c(f)!=f||c(_)==_||"/a/i"!=c(f,"i")})))){c=function(t,n){var r=this instanceof c,e=u(t),i=void 0===n;return!r&&e&&t.constructor===c&&i?t:s(l?new v(e&&!i?t.source:t,n):v((e=t instanceof c)?t.source:t,e&&i?h.call(t):n),r?this:a,c)};for(var p=function(t){t in c||i(c,t,{configurable:!0,get:function(){return v[t]},set:function(n){v[t]=n}})},g=o(v),d=0;g.length>d;)p(g[d++]);a.constructor=c,c.prototype=a,r("vsh_4318")(e,"RegExp",c)}r("vsh_9283")("RegExp")},vsh_9857:function(t,n,r){r("vsh_95157")&&"g"!=/./g.flags&&r("vsh_35088").f(RegExp.prototype,"flags",{configurable:!0,get:r("vsh_76662")})},vsh_5987:function(t,n,r){r("vsh_61596")("match",1,(function(t,n,r){return[function(r){"use strict";var e=t(this),s=null==r?void 0:r[n];return void 0!==s?s.call(r,e):new RegExp(r)[n](String(e))},r]}))},vsh_53468:function(t,n,r){r("vsh_61596")("replace",2,(function(t,n,r){return[function(e,s){"use strict";var i=t(this),o=null==e?void 0:e[n];return void 0!==o?o.call(e,i,s):r.call(String(i),e,s)},r]}))},vsh_40764:function(t,n,r){r("vsh_61596")("search",1,(function(t,n,r){return[function(r){"use strict";var e=t(this),s=null==r?void 0:r[n];return void 0!==s?s.call(r,e):new RegExp(r)[n](String(e))},r]}))},vsh_45965:function(t,n,r){r("vsh_61596")("split",2,(function(t,n,e){"use strict";var s=r("vsh_64525"),i=e,o=[].push;if("c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length){var u=void 0===/()??/.exec("")[1];e=function(t,n){var r=String(this);if(void 0===t&&0===n)return[];if(!s(t))return i.call(r,t,n);var e,h,c,v,a,f=[],_=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),l=0,p=void 0===n?4294967295:n>>>0,g=new RegExp(t.source,_+"g");for(u||(e=new RegExp("^"+g.source+"$(?!\\\\s)",_));(h=g.exec(r))&&!((c=h.index+h[0].length)>l&&(f.push(r.slice(l,h.index)),!u&&h.length>1&&h[0].replace(e,(function(){for(a=1;a<arguments.length-2;a++)void 0===arguments[a]&&(h[a]=void 0)})),h.length>1&&h.index<r.length&&o.apply(f,h.slice(1)),v=h[0].length,l=c,f.length>=p));)g.lastIndex===h.index&&g.lastIndex++;return l===r.length?!v&&g.test("")||f.push(""):f.push(r.slice(l)),f.length>p?f.slice(0,p):f}}else"0".split(void 0,0).length&&(e=function(t,n){return void 0===t&&0===n?[]:i.call(this,t,n)});return[function(r,s){var i=t(this),o=null==r?void 0:r[n];return void 0!==o?o.call(r,i,s):e.call(String(i),r,s)},e]}))},vsh_3809:function(t,n,r){"use strict";r("vsh_9857");var e=r("vsh_21059"),s=r("vsh_76662"),i=r("vsh_95157"),o="toString",u=/./.toString,h=function(t){r("vsh_4318")(RegExp.prototype,o,t,!0)};r("vsh_50560")((function(){return"/a/b"!=u.call({source:"a",flags:"b"})}))?h((function(){var t=e(this);return"/".concat(t.source,"/","flags"in t?t.flags:!i&&t instanceof RegExp?s.call(t):void 0)})):u.name!=o&&h((function(){return u.call(this)}))},vsh_52995:function(t,n,r){"use strict";var e=r("vsh_42492"),s=r("vsh_19585");t.exports=r("vsh_83293")("Set",(function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}}),{add:function(t){return e.def(s(this,"Set"),t=0===t?0:t,t)}},e)},vsh_84648:function(t,n,r){"use strict";r("vsh_18793")("anchor",(function(t){return function(n){return t(this,"a","name",n)}}))},vsh_10851:function(t,n,r){"use strict";r("vsh_18793")("big",(function(t){return function(){return t(this,"big","","")}}))},vsh_52603:function(t,n,r){"use strict";r("vsh_18793")("blink",(function(t){return function(){return t(this,"blink","","")}}))},vsh_9389:function(t,n,r){"use strict";r("vsh_18793")("bold",(function(t){return function(){return t(this,"b","","")}}))},vsh_93446:function(t,n,r){"use strict";var e=r("vsh_96609"),s=r("vsh_49969")(!1);e(e.P,"String",{codePointAt:function(t){return s(this,t)}})},vsh_14505:function(t,n,r){"use strict";var e=r("vsh_96609"),s=r("vsh_53890"),i=r("vsh_78326"),o="endsWith",u="".endsWith;e(e.P+e.F*r("vsh_8328")(o),"String",{endsWith:function(t){var n=i(this,t,o),r=arguments.length>1?arguments[1]:void 0,e=s(n.length),h=void 0===r?e:Math.min(s(r),e),c=String(t);return u?u.call(n,c,h):n.slice(h-c.length,h)===c}})},vsh_66833:function(t,n,r){"use strict";r("vsh_18793")("fixed",(function(t){return function(){return t(this,"tt","","")}}))},vsh_8197:function(t,n,r){"use strict";r("vsh_18793")("fontcolor",(function(t){return function(n){return t(this,"font","color",n)}}))},vsh_99163:function(t,n,r){"use strict";r("vsh_18793")("fontsize",(function(t){return function(n){return t(this,"font","size",n)}}))},vsh_50656:function(t,n,r){var e=r("vsh_96609"),s=r("vsh_11332"),i=String.fromCharCode,o=String.fromCodePoint;e(e.S+e.F*(!!o&&1!=o.length),"String",{fromCodePoint:function(t){for(var n,r=[],e=arguments.length,o=0;e>o;){if(n=+arguments[o++],s(n,1114111)!==n)throw RangeError(n+" is not a valid code point");r.push(n<65536?i(n):i(55296+((n-=65536)>>10),n%1024+56320))}return r.join("")}})},vsh_72463:function(t,n,r){"use strict";var e=r("vsh_96609"),s=r("vsh_78326"),i="includes";e(e.P+e.F*r("vsh_8328")(i),"String",{includes:function(t){return!!~s(this,t,i).indexOf(t,arguments.length>1?arguments[1]:void 0)}})},vsh_32134:function(t,n,r){"use strict";r("vsh_18793")("italics",(function(t){return function(){return t(this,"i","","")}}))},vsh_97234:function(t,n,r){"use strict";var e=r("vsh_49969")(!0);r("vsh_61960")(String,"String",(function(t){this._t=String(t),this._i=0}),(function(){var t,n=this._t,r=this._i;return r>=n.length?{value:void 0,done:!0}:(t=e(n,r),this._i+=t.length,{value:t,done:!1})}))},vsh_95250:function(t,n,r){"use strict";r("vsh_18793")("link",(function(t){return function(n){return t(this,"a","href",n)}}))},vsh_52398:function(t,n,r){var e=r("vsh_96609"),s=r("vsh_36063"),i=r("vsh_53890");e(e.S,"String",{raw:function(t){for(var n=s(t.raw),r=i(n.length),e=arguments.length,o=[],u=0;r>u;)o.push(String(n[u++])),u<e&&o.push(String(arguments[u]));return o.join("")}})},vsh_95501:function(t,n,r){var e=r("vsh_96609");e(e.P,"String",{repeat:r("vsh_77861")})},vsh_53884:function(t,n,r){"use strict";r("vsh_18793")("small",(function(t){return function(){return t(this,"small","","")}}))},vsh_53289:function(t,n,r){"use strict";var e=r("vsh_96609"),s=r("vsh_53890"),i=r("vsh_78326"),o="startsWith",u="".startsWith;e(e.P+e.F*r("vsh_8328")(o),"String",{startsWith:function(t){var n=i(this,t,o),r=s(Math.min(arguments.length>1?arguments[1]:void 0,n.length)),e=String(t);return u?u.call(n,e,r):n.slice(r,r+e.length)===e}})},vsh_78733:function(t,n,r){"use strict";r("vsh_18793")("strike",(function(t){return function(){return t(this,"strike","","")}}))},vsh_97736:function(t,n,r){"use strict";r("vsh_18793")("sub",(function(t){return function(){return t(this,"sub","","")}}))},vsh_53509:function(t,n,r){"use strict";r("vsh_18793")("sup",(function(t){return function(){return t(this,"sup","","")}}))},vsh_1794:function(t,n,r){"use strict";var e=r("vsh_70607"),s=r("vsh_64717"),i=r("vsh_95157"),o=r("vsh_96609"),u=r("vsh_4318"),h=r("vsh_41930").KEY,c=r("vsh_50560"),v=r("vsh_12530"),a=r("vsh_27324"),f=r("vsh_41819"),_=r("vsh_41732"),l=r("vsh_73164"),p=r("vsh_93618"),g=r("vsh_61975"),d=r("vsh_5957"),y=r("vsh_21059"),m=r("vsh_17840"),b=r("vsh_36063"),S=r("vsh_45094"),w=r("vsh_52996"),x=r("vsh_28216"),E=r("vsh_86423"),O=r("vsh_26166"),P=r("vsh_35088"),M=r("vsh_25694"),A=O.f,j=P.f,F=E.f,I=e.Symbol,L=e.JSON,N=L&&L.stringify,R=_("_hidden"),k=_("toPrimitive"),T={}.propertyIsEnumerable,C=v("symbol-registry"),B=v("symbols"),D=v("op-symbols"),W=Object.prototype,U="function"==typeof I,V=e.QObject,z=!V||!V.prototype||!V.prototype.findChild,G=i&&c((function(){return 7!=x(j({},"a",{get:function(){return j(this,"a",{value:7}).a}})).a}))?function(t,n,r){var e=A(W,n);e&&delete W[n],j(t,n,r),e&&t!==W&&j(W,n,e)}:j,H=function(t){var n=B[t]=x(I.prototype);return n._k=t,n},Y=U&&"symbol"==typeof I.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof I},K=function(t,n,r){return t===W&&K(D,n,r),y(t),n=S(n,!0),y(r),s(B,n)?(r.enumerable?(s(t,R)&&t[R][n]&&(t[R][n]=!1),r=x(r,{enumerable:w(0,!1)})):(s(t,R)||j(t,R,w(1,{})),t[R][n]=!0),G(t,n,r)):j(t,n,r)},X=function(t,n){y(t);for(var r,e=g(n=b(n)),s=0,i=e.length;i>s;)K(t,r=e[s++],n[r]);return t},q=function(t){var n=T.call(this,t=S(t,!0));return!(this===W&&s(B,t)&&!s(D,t))&&(!(n||!s(this,t)||!s(B,t)||s(this,R)&&this[R][t])||n)},J=function(t,n){if(t=b(t),n=S(n,!0),t!==W||!s(B,n)||s(D,n)){var r=A(t,n);return!r||!s(B,n)||s(t,R)&&t[R][n]||(r.enumerable=!0),r}},$=function(t){for(var n,r=F(b(t)),e=[],i=0;r.length>i;)s(B,n=r[i++])||n==R||n==h||e.push(n);return e},Z=function(t){for(var n,r=t===W,e=F(r?D:b(t)),i=[],o=0;e.length>o;)!s(B,n=e[o++])||r&&!s(W,n)||i.push(B[n]);return i};U||(I=function(){if(this instanceof I)throw TypeError("Symbol is not a constructor!");var t=f(arguments.length>0?arguments[0]:void 0),n=function(r){this===W&&n.call(D,r),s(this,R)&&s(this[R],t)&&(this[R][t]=!1),G(this,t,w(1,r))};return i&&z&&G(W,t,{configurable:!0,set:n}),H(t)},u(I.prototype,"toString",(function(){return this._k})),O.f=J,P.f=K,r("vsh_42955").f=E.f=$,r("vsh_92895").f=q,r("vsh_32250").f=Z,i&&!r("vsh_50927")&&u(W,"propertyIsEnumerable",q,!0),l.f=function(t){return H(_(t))}),o(o.G+o.W+o.F*!U,{Symbol:I});for(var Q="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),tt=0;Q.length>tt;)_(Q[tt++]);for(var nt=M(_.store),rt=0;nt.length>rt;)p(nt[rt++]);o(o.S+o.F*!U,"Symbol",{for:function(t){return s(C,t+="")?C[t]:C[t]=I(t)},keyFor:function(t){if(!Y(t))throw TypeError(t+" is not a symbol!");for(var n in C)if(C[n]===t)return n},useSetter:function(){z=!0},useSimple:function(){z=!1}}),o(o.S+o.F*!U,"Object",{create:function(t,n){return void 0===n?x(t):X(x(t),n)},defineProperty:K,defineProperties:X,getOwnPropertyDescriptor:J,getOwnPropertyNames:$,getOwnPropertySymbols:Z}),L&&o(o.S+o.F*(!U||c((function(){var t=I();return"[null]"!=N([t])||"{}"!=N({a:t})||"{}"!=N(Object(t))}))),"JSON",{stringify:function(t){for(var n,r,e=[t],s=1;arguments.length>s;)e.push(arguments[s++]);if(r=n=e[1],(m(n)||void 0!==t)&&!Y(t))return d(n)||(n=function(t,n){if("function"==typeof r&&(n=r.call(this,t,n)),!Y(n))return n}),e[1]=n,N.apply(L,e)}}),I.prototype[k]||r("vsh_25993")(I.prototype,k,I.prototype.valueOf),a(I,"Symbol"),a(Math,"Math",!0),a(e.JSON,"JSON",!0)},vsh_45621:function(t,n,r){"use strict";var e=r("vsh_96609"),s=r("vsh_18708"),i=r("vsh_70642"),o=r("vsh_21059"),u=r("vsh_11332"),h=r("vsh_53890"),c=r("vsh_17840"),v=r("vsh_70607").ArrayBuffer,a=r("vsh_21623"),f=i.ArrayBuffer,_=i.DataView,l=s.ABV&&v.isView,p=f.prototype.slice,g=s.VIEW,d="ArrayBuffer";e(e.G+e.W+e.F*(v!==f),{ArrayBuffer:f}),e(e.S+e.F*!s.CONSTR,d,{isView:function(t){return l&&l(t)||c(t)&&g in t}}),e(e.P+e.U+e.F*r("vsh_50560")((function(){return!new f(2).slice(1,void 0).byteLength})),d,{slice:function(t,n){if(void 0!==p&&void 0===n)return p.call(o(this),t);for(var r=o(this).byteLength,e=u(t,r),s=u(void 0===n?r:n,r),i=new(a(this,f))(h(s-e)),c=new _(this),v=new _(i),l=0;e<s;)v.setUint8(l++,c.getUint8(e++));return i}}),r("vsh_9283")(d)},vsh_91026:function(t,n,r){r("vsh_84804")("Float32",4,(function(t){return function(n,r,e){return t(this,n,r,e)}}))},vsh_53910:function(t,n,r){r("vsh_84804")("Float64",8,(function(t){return function(n,r,e){return t(this,n,r,e)}}))},vsh_32578:function(t,n,r){r("vsh_84804")("Int16",2,(function(t){return function(n,r,e){return t(this,n,r,e)}}))},vsh_75969:function(t,n,r){r("vsh_84804")("Int32",4,(function(t){return function(n,r,e){return t(this,n,r,e)}}))},vsh_26298:function(t,n,r){r("vsh_84804")("Int8",1,(function(t){return function(n,r,e){return t(this,n,r,e)}}))},vsh_67496:function(t,n,r){r("vsh_84804")("Uint16",2,(function(t){return function(n,r,e){return t(this,n,r,e)}}))},vsh_18764:function(t,n,r){r("vsh_84804")("Uint32",4,(function(t){return function(n,r,e){return t(this,n,r,e)}}))},vsh_6360:function(t,n,r){r("vsh_84804")("Uint8",1,(function(t){return function(n,r,e){return t(this,n,r,e)}}))},vsh_23935:function(t,n,r){r("vsh_84804")("Uint8",1,(function(t){return function(n,r,e){return t(this,n,r,e)}}),!0)},vsh_99645:function(t,n,r){"use strict";var e,s=r("vsh_61494")(0),i=r("vsh_4318"),o=r("vsh_41930"),u=r("vsh_24268"),h=r("vsh_42425"),c=r("vsh_17840"),v=r("vsh_50560"),a=r("vsh_19585"),f="WeakMap",_=o.getWeak,l=Object.isExtensible,p=h.ufstore,g={},d=function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},y={get:function(t){if(c(t)){var n=_(t);return!0===n?p(a(this,f)).get(t):n?n[this._i]:void 0}},set:function(t,n){return h.def(a(this,f),t,n)}},m=t.exports=r("vsh_83293")(f,d,y,h,!0,!0);v((function(){return 7!=(new m).set((Object.freeze||Object)(g),7).get(g)}))&&(u((e=h.getConstructor(d,f)).prototype,y),o.NEED=!0,s(["delete","has","get","set"],(function(t){var n=m.prototype,r=n[t];i(n,t,(function(n,s){if(c(n)&&!l(n)){this._f||(this._f=new e);var i=this._f[t](n,s);return"set"==t?this:i}return r.call(this,n,s)}))})))},vsh_40470:function(t,n,r){"use strict";var e=r("vsh_42425"),s=r("vsh_19585"),i="WeakSet";r("vsh_83293")(i,(function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}}),{add:function(t){return e.def(s(this,i),t,!0)}},e,!1,!0)},vsh_2212:function(t,n,r){"use strict";var e=r("vsh_96609"),s=r("vsh_43529"),i=r("vsh_58830"),o=r("vsh_53890"),u=r("vsh_47347"),h=r("vsh_79944");e(e.P,"Array",{flatMap:function(t){var n,r,e=i(this);return u(t),n=o(e.length),r=h(e,0),s(r,e,e,n,0,1,t,arguments[1]),r}}),r("vsh_19597")("flatMap")},vsh_14770:function(t,n,r){"use strict";var e=r("vsh_96609"),s=r("vsh_25640")(!0);e(e.P,"Array",{includes:function(t){return s(this,t,arguments.length>1?arguments[1]:void 0)}}),r("vsh_19597")("includes")},vsh_44574:function(t,n,r){"use strict";var e=r("vsh_96609"),s=r("vsh_58830"),i=r("vsh_47347"),o=r("vsh_35088");r("vsh_95157")&&e(e.P+r("vsh_4292"),"Object",{__defineGetter__:function(t,n){o.f(s(this),t,{get:i(n),enumerable:!0,configurable:!0})}})},vsh_79626:function(t,n,r){"use strict";var e=r("vsh_96609"),s=r("vsh_58830"),i=r("vsh_47347"),o=r("vsh_35088");r("vsh_95157")&&e(e.P+r("vsh_4292"),"Object",{__defineSetter__:function(t,n){o.f(s(this),t,{set:i(n),enumerable:!0,configurable:!0})}})},vsh_94098:function(t,n,r){var e=r("vsh_96609"),s=r("vsh_68794")(!0);e(e.S,"Object",{entries:function(t){return s(t)}})},vsh_69989:function(t,n,r){var e=r("vsh_96609"),s=r("vsh_336"),i=r("vsh_36063"),o=r("vsh_26166"),u=r("vsh_67188");e(e.S,"Object",{getOwnPropertyDescriptors:function(t){for(var n,r,e=i(t),h=o.f,c=s(e),v={},a=0;c.length>a;)void 0!==(r=h(e,n=c[a++]))&&u(v,n,r);return v}})},vsh_24243:function(t,n,r){"use strict";var e=r("vsh_96609"),s=r("vsh_58830"),i=r("vsh_45094"),o=r("vsh_78675"),u=r("vsh_26166").f;r("vsh_95157")&&e(e.P+r("vsh_4292"),"Object",{__lookupGetter__:function(t){var n,r=s(this),e=i(t,!0);do{if(n=u(r,e))return n.get}while(r=o(r))}})},vsh_37889:function(t,n,r){"use strict";var e=r("vsh_96609"),s=r("vsh_58830"),i=r("vsh_45094"),o=r("vsh_78675"),u=r("vsh_26166").f;r("vsh_95157")&&e(e.P+r("vsh_4292"),"Object",{__lookupSetter__:function(t){var n,r=s(this),e=i(t,!0);do{if(n=u(r,e))return n.set}while(r=o(r))}})},vsh_48994:function(t,n,r){var e=r("vsh_96609"),s=r("vsh_68794")(!1);e(e.S,"Object",{values:function(t){return s(t)}})},vsh_88948:function(t,n,r){"use strict";var e=r("vsh_96609"),s=r("vsh_84897"),i=r("vsh_70607"),o=r("vsh_21623"),u=r("vsh_70413");e(e.P+e.R,"Promise",{finally:function(t){var n=o(this,s.Promise||i.Promise),r="function"==typeof t;return this.then(r?function(r){return u(n,t()).then((function(){return r}))}:t,r?function(r){return u(n,t()).then((function(){throw r}))}:t)}})},vsh_80035:function(t,n,r){"use strict";var e=r("vsh_96609"),s=r("vsh_27524"),i=r("vsh_76240");e(e.P+e.F*/Version\\/10\\.\\d+(\\.\\d+)? Safari\\//.test(i),"String",{padEnd:function(t){return s(this,t,arguments.length>1?arguments[1]:void 0,!1)}})},vsh_44069:function(t,n,r){"use strict";var e=r("vsh_96609"),s=r("vsh_27524"),i=r("vsh_76240");e(e.P+e.F*/Version\\/10\\.\\d+(\\.\\d+)? Safari\\//.test(i),"String",{padStart:function(t){return s(this,t,arguments.length>1?arguments[1]:void 0,!0)}})},vsh_45734:function(t,n,r){"use strict";r("vsh_17108")("trimLeft",(function(t){return function(){return t(this,1)}}),"trimStart")},vsh_13624:function(t,n,r){"use strict";r("vsh_17108")("trimRight",(function(t){return function(){return t(this,2)}}),"trimEnd")},vsh_69003:function(t,n,r){r("vsh_93618")("asyncIterator")},vsh_16038:function(t,n,r){for(var e=r("vsh_15640"),s=r("vsh_25694"),i=r("vsh_4318"),o=r("vsh_70607"),u=r("vsh_25993"),h=r("vsh_66476"),c=r("vsh_41732"),v=c("iterator"),a=c("toStringTag"),f=h.Array,_={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},l=s(_),p=0;p<l.length;p++){var g,d=l[p],y=_[d],m=o[d],b=m&&m.prototype;if(b&&(b[v]||u(b,v,f),b[a]||u(b,a,d),h[d]=f,y))for(g in e)b[g]||i(b,g,e[g],!0)}},vsh_73920:function(t,n,r){var e=r("vsh_96609"),s=r("vsh_40179");e(e.G+e.B,{setImmediate:s.set,clearImmediate:s.clear})},vsh_84885:function(t,n,r){var e=r("vsh_70607"),s=r("vsh_96609"),i=r("vsh_76240"),o=[].slice,u=/MSIE .\\./.test(i),h=function(t){return function(n,r){var e=arguments.length>2,s=!!e&&o.call(arguments,2);return t(e?function(){("function"==typeof n?n:Function(n)).apply(this,s)}:n,r)}};s(s.G+s.B+s.F*u,{setTimeout:h(e.setTimeout),setInterval:h(e.setInterval)})},vsh_79509:function(t,n){var r;t.exports=(r=r||function(t,n){var r=Object.create||function(){function t(){}return function(n){var r;return t.prototype=n,r=new t,t.prototype=null,r}}(),e={},s=e.lib={},i=s.Base={extend:function(t){var n=r(this);return t&&n.mixIn(t),n.hasOwnProperty("init")&&this.init!==n.init||(n.init=function(){n.$super.init.apply(this,arguments)}),n.init.prototype=n,n.$super=this,n},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var n in t)t.hasOwnProperty(n)&&(this[n]=t[n]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},o=s.WordArray=i.extend({init:function(t,r){t=this.words=t||[],this.sigBytes=r!=n?r:4*t.length},toString:function(t){return(t||h).stringify(this)},concat:function(t){var n=this.words,r=t.words,e=this.sigBytes,s=t.sigBytes;if(this.clamp(),e%4)for(var i=0;i<s;i++){var o=r[i>>>2]>>>24-i%4*8&255;n[e+i>>>2]|=o<<24-(e+i)%4*8}else for(i=0;i<s;i+=4)n[e+i>>>2]=r[i>>>2];return this.sigBytes+=s,this},clamp:function(){var n=this.words,r=this.sigBytes;n[r>>>2]&=4294967295<<32-r%4*8,n.length=t.ceil(r/4)},clone:function(){var t=i.clone.call(this);return t.words=this.words.slice(0),t},random:function(n){for(var r,e=[],s=function(n){n=n;var r=987654321,e=4294967295;return function(){var s=((r=36969*(65535&r)+(r>>16)&e)<<16)+(n=18e3*(65535&n)+(n>>16)&e)&e;return s/=4294967296,(s+=.5)*(t.random()>.5?1:-1)}},i=0;i<n;i+=4){var u=s(4294967296*(r||t.random()));r=987654071*u(),e.push(4294967296*u()|0)}return new o.init(e,n)}}),u=e.enc={},h=u.Hex={stringify:function(t){for(var n=t.words,r=t.sigBytes,e=[],s=0;s<r;s++){var i=n[s>>>2]>>>24-s%4*8&255;e.push((i>>>4).toString(16)),e.push((15&i).toString(16))}return e.join("")},parse:function(t){for(var n=t.length,r=[],e=0;e<n;e+=2)r[e>>>3]|=parseInt(t.substr(e,2),16)<<24-e%8*4;return new o.init(r,n/2)}},c=u.Latin1={stringify:function(t){for(var n=t.words,r=t.sigBytes,e=[],s=0;s<r;s++){var i=n[s>>>2]>>>24-s%4*8&255;e.push(String.fromCharCode(i))}return e.join("")},parse:function(t){for(var n=t.length,r=[],e=0;e<n;e++)r[e>>>2]|=(255&t.charCodeAt(e))<<24-e%4*8;return new o.init(r,n)}},v=u.Utf8={stringify:function(t){try{return decodeURIComponent(escape(c.stringify(t)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(t){return c.parse(unescape(encodeURIComponent(t)))}},a=s.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=v.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(n){var r=this._data,e=r.words,s=r.sigBytes,i=this.blockSize,u=s/(4*i),h=(u=n?t.ceil(u):t.max((0|u)-this._minBufferSize,0))*i,c=t.min(4*h,s);if(h){for(var v=0;v<h;v+=i)this._doProcessBlock(e,v);var a=e.splice(0,h);r.sigBytes-=c}return new o.init(a,c)},clone:function(){var t=i.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0}),f=(s.Hasher=a.extend({cfg:i.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){a.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(n,r){return new t.init(r).finalize(n)}},_createHmacHelper:function(t){return function(n,r){return new f.HMAC.init(t,r).finalize(n)}}}),e.algo={});return e}(Math),r)},vsh_85734:function(t,n,r){var e,s,i,o,u,h,c,v;t.exports=(v=r("vsh_79509"),s=(e=v).lib,i=s.WordArray,o=s.Hasher,u=e.algo,h=[],c=u.SHA1=o.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,n){for(var r=this._hash.words,e=r[0],s=r[1],i=r[2],o=r[3],u=r[4],c=0;c<80;c++){if(c<16)h[c]=0|t[n+c];else{var v=h[c-3]^h[c-8]^h[c-14]^h[c-16];h[c]=v<<1|v>>>31}var a=(e<<5|e>>>27)+u+h[c];a+=c<20?1518500249+(s&i|~s&o):c<40?1859775393+(s^i^o):c<60?(s&i|s&o|i&o)-1894007588:(s^i^o)-899497514,u=o,o=i,i=s<<30|s>>>2,s=e,e=a}r[0]=r[0]+e|0,r[1]=r[1]+s|0,r[2]=r[2]+i|0,r[3]=r[3]+o|0,r[4]=r[4]+u|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,e=8*t.sigBytes;return n[e>>>5]|=128<<24-e%32,n[14+(e+64>>>9<<4)]=Math.floor(r/4294967296),n[15+(e+64>>>9<<4)]=r,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var t=o.clone.call(this);return t._hash=this._hash.clone(),t}}),e.SHA1=o._createHelper(c),e.HmacSHA1=o._createHmacHelper(c),v.SHA1)},vsh_3410:function(t,n,r){var e=function(){return this}()||Function("return this")(),s=e.regeneratorRuntime&&Object.getOwnPropertyNames(e).indexOf("regeneratorRuntime")>=0,i=s&&e.regeneratorRuntime;if(e.regeneratorRuntime=void 0,t.exports=r("vsh_70315"),s)e.regeneratorRuntime=i;else try{delete e.regeneratorRuntime}catch(t){e.regeneratorRuntime=void 0}},vsh_70315:function(t){!function(n){"use strict";var r,e=Object.prototype,s=e.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",h=i.toStringTag||"@@toStringTag",c=n.regeneratorRuntime;if(c)t.exports=c;else{(c=n.regeneratorRuntime=t.exports).wrap=m;var v="suspendedStart",a="suspendedYield",f="executing",_="completed",l={},p={};p[o]=function(){return this};var g=Object.getPrototypeOf,d=g&&g(g(F([])));d&&d!==e&&s.call(d,o)&&(p=d);var y=x.prototype=S.prototype=Object.create(p);w.prototype=y.constructor=x,x.constructor=w,x[h]=w.displayName="GeneratorFunction",c.isGeneratorFunction=function(t){var n="function"==typeof t&&t.constructor;return!!n&&(n===w||"GeneratorFunction"===(n.displayName||n.name))},c.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,h in t||(t[h]="GeneratorFunction")),t.prototype=Object.create(y),t},c.awrap=function(t){return{__await:t}},E(O.prototype),O.prototype[u]=function(){return this},c.AsyncIterator=O,c.async=function(t,n,r,e){var s=new O(m(t,n,r,e));return c.isGeneratorFunction(n)?s:s.next().then((function(t){return t.done?t.value:s.next()}))},E(y),y[h]="Generator",y[o]=function(){return this},y.toString=function(){return"[object Generator]"},c.keys=function(t){var n=[];for(var r in t)n.push(r);return n.reverse(),function r(){for(;n.length;){var e=n.pop();if(e in t)return r.value=e,r.done=!1,r}return r.done=!0,r}},c.values=F,j.prototype={constructor:j,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(A),!t)for(var n in this)"t"===n.charAt(0)&&s.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=r)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function e(e,s){return u.type="throw",u.arg=t,n.next=e,s&&(n.method="next",n.arg=r),!!s}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],u=o.completion;if("root"===o.tryLoc)return e("end");if(o.tryLoc<=this.prev){var h=s.call(o,"catchLoc"),c=s.call(o,"finallyLoc");if(h&&c){if(this.prev<o.catchLoc)return e(o.catchLoc,!0);if(this.prev<o.finallyLoc)return e(o.finallyLoc)}else if(h){if(this.prev<o.catchLoc)return e(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return e(o.finallyLoc)}}}},abrupt:function(t,n){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.tryLoc<=this.prev&&s.call(e,"finallyLoc")&&this.prev<e.finallyLoc){var i=e;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=n&&n<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=t,o.arg=n,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(o)},complete:function(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),l},finish:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),l}},catch:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc===t){var e=r.completion;if("throw"===e.type){var s=e.arg;A(r)}return s}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,e){return this.delegate={iterator:F(t),resultName:n,nextLoc:e},"next"===this.method&&(this.arg=r),l}}}function m(t,n,r,e){var s=n&&n.prototype instanceof S?n:S,i=Object.create(s.prototype),o=new j(e||[]);return i._invoke=function(t,n,r){var e=v;return function(s,i){if(e===f)throw new Error("Generator is already running");if(e===_){if("throw"===s)throw i;return I()}for(r.method=s,r.arg=i;;){var o=r.delegate;if(o){var u=P(o,r);if(u){if(u===l)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(e===v)throw e=_,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);e=f;var h=b(t,n,r);if("normal"===h.type){if(e=r.done?_:a,h.arg===l)continue;return{value:h.arg,done:r.done}}"throw"===h.type&&(e=_,r.method="throw",r.arg=h.arg)}}}(t,r,o),i}function b(t,n,r){try{return{type:"normal",arg:t.call(n,r)}}catch(t){return{type:"throw",arg:t}}}function S(){}function w(){}function x(){}function E(t){["next","throw","return"].forEach((function(n){t[n]=function(t){return this._invoke(n,t)}}))}function O(t){function n(r,e,i,o){var u=b(t[r],t,e);if("throw"!==u.type){var h=u.arg,c=h.value;return c&&"object"==typeof c&&s.call(c,"__await")?Promise.resolve(c.__await).then((function(t){n("next",t,i,o)}),(function(t){n("throw",t,i,o)})):Promise.resolve(c).then((function(t){h.value=t,i(h)}),o)}o(u.arg)}var r;this._invoke=function(t,e){function s(){return new Promise((function(r,s){n(t,e,r,s)}))}return r=r?r.then(s,s):s()}}function P(t,n){var e=t.iterator[n.method];if(e===r){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=r,P(t,n),"throw"===n.method))return l;n.method="throw",n.arg=new TypeError("The iterator does not provide a \'throw\' method")}return l}var s=b(e,t.iterator,n.arg);if("throw"===s.type)return n.method="throw",n.arg=s.arg,n.delegate=null,l;var i=s.arg;return i?i.done?(n[t.resultName]=i.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=r),n.delegate=null,l):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,l)}function M(t){var n={tryLoc:t[0]};1 in t&&(n.catchLoc=t[1]),2 in t&&(n.finallyLoc=t[2],n.afterLoc=t[3]),this.tryEntries.push(n)}function A(t){var n=t.completion||{};n.type="normal",delete n.arg,t.completion=n}function j(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(M,this),this.reset(!0)}function F(t){if(t){var n=t[o];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var e=-1,i=function n(){for(;++e<t.length;)if(s.call(t,e))return n.value=t[e],n.done=!1,n;return n.value=r,n.done=!0,n};return i.next=i}}return{next:I}}function I(){return{value:r,done:!0}}}(function(){return this}()||Function("return this")())},vsh_35067:function(t,n,r){"use strict";function e(t,n,r,e,s,i,o){try{var u=t[i](o),h=u.value}catch(t){return void r(t)}u.done?n(h):Promise.resolve(h).then(e,s)}function s(t){return function(){var n=this,r=arguments;return new Promise((function(s,i){var o=t.apply(n,r);function u(t){e(o,s,i,u,h,"next",t)}function h(t){e(o,s,i,u,h,"throw",t)}u(void 0)}))}}r.d(n,{Z:function(){return s}})},vsh_14499:function(t,n,r){"use strict";r.d(n,{Jj:function(){return c},Yy:function(){return i},Ud:function(){return a}});const e=Symbol("Comlink.proxy"),s=Symbol("Comlink.endpoint"),i=Symbol("Comlink.releaseProxy"),o=Symbol("Comlink.thrown"),u=t=>"object"==typeof t&&null!==t||"function"==typeof t,h=new Map([["proxy",{canHandle:t=>u(t)&&t[e],serialize(t){const{port1:n,port2:r}=new MessageChannel;return c(t,n),[r,[r]]},deserialize:t=>(t.start(),a(t))}],["throw",{canHandle:t=>u(t)&&o in t,serialize({value:t}){let n;return n=t instanceof Error?{isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:{isError:!1,value:t},[n,[]]},deserialize(t){if(t.isError)throw Object.assign(new Error(t.value.message),t.value);throw t.value}}]]);function c(t,n=self){n.addEventListener("message",(function r(s){if(!s||!s.data)return;const{id:i,type:u,path:h}=Object.assign({path:[]},s.data),a=(s.data.argumentList||[]).map(d);let f;try{const n=h.slice(0,-1).reduce(((t,n)=>t[n]),t),r=h.reduce(((t,n)=>t[n]),t);switch(u){case"GET":f=r;break;case"SET":n[h.slice(-1)[0]]=d(s.data.value),f=!0;break;case"APPLY":f=r.apply(n,a);break;case"CONSTRUCT":f=function(t){return Object.assign(t,{[e]:!0})}(new r(...a));break;case"ENDPOINT":{const{port1:n,port2:r}=new MessageChannel;c(t,r),f=function(t,n){return p.set(t,n),t}(n,[n])}break;case"RELEASE":f=void 0;break;default:return}}catch(t){f={value:t,[o]:0}}Promise.resolve(f).catch((t=>({value:t,[o]:0}))).then((t=>{const[e,s]=g(t);n.postMessage(Object.assign(Object.assign({},e),{id:i}),s),"RELEASE"===u&&(n.removeEventListener("message",r),v(n))}))})),n.start&&n.start()}function v(t){(function(t){return"MessagePort"===t.constructor.name})(t)&&t.close()}function a(t,n){return _(t,[],n)}function f(t){if(t)throw new Error("Proxy has been released and is not useable")}function _(t,n=[],r=function(){}){let e=!1;const o=new Proxy(r,{get(r,s){if(f(e),s===i)return()=>y(t,{type:"RELEASE",path:n.map((t=>t.toString()))}).then((()=>{v(t),e=!0}));if("then"===s){if(0===n.length)return{then:()=>o};const r=y(t,{type:"GET",path:n.map((t=>t.toString()))}).then(d);return r.then.bind(r)}return _(t,[...n,s])},set(r,s,i){f(e);const[o,u]=g(i);return y(t,{type:"SET",path:[...n,s].map((t=>t.toString())),value:o},u).then(d)},apply(r,i,o){f(e);const u=n[n.length-1];if(u===s)return y(t,{type:"ENDPOINT"}).then(d);if("bind"===u)return _(t,n.slice(0,-1));const[h,c]=l(o);return y(t,{type:"APPLY",path:n.map((t=>t.toString())),argumentList:h},c).then(d)},construct(r,s){f(e);const[i,o]=l(s);return y(t,{type:"CONSTRUCT",path:n.map((t=>t.toString())),argumentList:i},o).then(d)}});return o}function l(t){const n=t.map(g);return[n.map((t=>t[0])),(r=n.map((t=>t[1])),Array.prototype.concat.apply([],r))];var r}const p=new WeakMap;function g(t){for(const[n,r]of h)if(r.canHandle(t)){const[e,s]=r.serialize(t);return[{type:"HANDLER",name:n,value:e},s]}return[{type:"RAW",value:t},p.get(t)||[]]}function d(t){switch(t.type){case"HANDLER":return h.get(t.name).deserialize(t.value);case"RAW":return t.value}}function y(t,n,r){return new Promise((e=>{const s=new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-");t.addEventListener("message",(function n(r){r.data&&r.data.id&&r.data.id===s&&(t.removeEventListener("message",n),e(r.data))})),t.start&&t.start(),t.postMessage(Object.assign({id:s},n),r)}))}}},e={};function s(t){var n=e[t];if(void 0!==n)return n.exports;var i=e[t]={id:t,loaded:!1,exports:{}};return r[t].call(i.exports,i,i.exports,s),i.loaded=!0,i.exports}s.m=r,s.amdD=function(){throw new Error("define cannot be used indirect")},s.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(n,{a:n}),n},n=Object.getPrototypeOf?function(t){return Object.getPrototypeOf(t)}:function(t){return t.__proto__},s.t=function(r,e){if(1&e&&(r=this(r)),8&e)return r;if("object"==typeof r&&r){if(4&e&&r.__esModule)return r;if(16&e&&"function"==typeof r.then)return r}var i=Object.create(null);s.r(i);var o={};t=t||[null,n({}),n([]),n(n)];for(var u=2&e&&r;"object"==typeof u&&!~t.indexOf(u);u=n(u))Object.getOwnPropertyNames(u).forEach((function(t){o[t]=function(){return r[t]}}));return o.default=function(){return r},s.d(i,o),i},s.d=function(t,n){for(var r in n)s.o(n,r)&&!s.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},s.f={},s.e=function(t){return Promise.all(Object.keys(s.f).reduce((function(n,r){return s.f[r](t,n),n}),[]))},s.u=function(t){return("vsh_154"===t?"pinyinUtil":t)+"."+{vsh_268:"05f8e603",vsh_154:"b7d6d68d",vsh_884:"9c30e907",vsh_786:"e24e96d4",vsh_174:"25828141",vsh_279:"cb6ce345"}[t]+".chunk.worker.js"},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),s.hmd=function(t){return(t=Object.create(t)).children||(t.children=[]),Object.defineProperty(t,"exports",{enumerable:!0,set:function(){throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+t.id)}}),t},s.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.nmd=function(t){return t.paths=[],t.children||(t.children=[]),t},s.p="/eesz/bear/sheet/module/",function(){var t={vsh_410:1};s.f.i=function(n,r){t[n]||importScripts(s.p+s.u(n))};var n=self.webpackChunkbear_fe=self.webpackChunkbear_fe||[],r=n.push.bind(n);n.push=function(n){var e=n[0],i=n[1],o=n[2];for(var u in i)s.o(i,u)&&(s.m[u]=i[u]);for(o&&o(s);e.length;)t[e.pop()]=1;r(n)}}(),function(){"use strict";var t=s("vsh_67017"),n=s.n(t),r=s("vsh_35067"),e=(s("vsh_85621"),s("vsh_79085"),s("vsh_97017"),s("vsh_41282"),s("vsh_2212"),s("vsh_4915"),s("vsh_14770"),s("vsh_15640"),s("vsh_57822"),s("vsh_88175"),s("vsh_13212"),s("vsh_34645"),s("vsh_16452"),s("vsh_19577"),s("vsh_12267"),s("vsh_41620"),s("vsh_72525"),s("vsh_53721"),s("vsh_79134"),s("vsh_46879"),s("vsh_6840"),s("vsh_1853"),s("vsh_8284"),s("vsh_28630"),s("vsh_53987"),s("vsh_52512"),s("vsh_3457"),s("vsh_45908"),s("vsh_80918"),s("vsh_68299"),s("vsh_69139"),s("vsh_94524"),s("vsh_9910"),s("vsh_75422"),s("vsh_64988"),s("vsh_91170"),s("vsh_33318"),s("vsh_68264"),s("vsh_45071"),s("vsh_45753"),s("vsh_17919"),s("vsh_89664"),s("vsh_14711"),s("vsh_44574"),s("vsh_79626"),s("vsh_94098"),s("vsh_34930"),s("vsh_4652"),s("vsh_69989"),s("vsh_31728"),s("vsh_23828"),s("vsh_24243"),s("vsh_37889"),s("vsh_37981"),s("vsh_28265"),s("vsh_88279"),s("vsh_33015"),s("vsh_51393"),s("vsh_82660"),s("vsh_2909"),s("vsh_17569"),s("vsh_62185"),s("vsh_48994"),s("vsh_72665"),s("vsh_88948"),s("vsh_86418"),s("vsh_19338"),s("vsh_48295"),s("vsh_26604"),s("vsh_75468"),s("vsh_98037"),s("vsh_86077"),s("vsh_80769"),s("vsh_90037"),s("vsh_1218"),s("vsh_69676"),s("vsh_55854"),s("vsh_38312"),s("vsh_19785"),s("vsh_9857"),s("vsh_5987"),s("vsh_53468"),s("vsh_45965"),s("vsh_40764"),s("vsh_3809"),s("vsh_52995"),s("vsh_1794"),s("vsh_69003"),s("vsh_84648"),s("vsh_10851"),s("vsh_52603"),s("vsh_9389"),s("vsh_93446"),s("vsh_14505"),s("vsh_66833"),s("vsh_8197"),s("vsh_99163"),s("vsh_50656"),s("vsh_72463"),s("vsh_32134"),s("vsh_97234"),s("vsh_95250"),s("vsh_44069"),s("vsh_80035"),s("vsh_52398"),s("vsh_95501"),s("vsh_53884"),s("vsh_53289"),s("vsh_78733"),s("vsh_97736"),s("vsh_53509"),s("vsh_45734"),s("vsh_13624"),s("vsh_45621"),s("vsh_26298"),s("vsh_6360"),s("vsh_23935"),s("vsh_32578"),s("vsh_67496"),s("vsh_75969"),s("vsh_18764"),s("vsh_91026"),s("vsh_53910"),s("vsh_99645"),s("vsh_40470"),s("vsh_84885"),s("vsh_73920"),s("vsh_16038"),s("vsh_70315"),s("vsh_14499")),i=s("vsh_59835");function o(){return o=(0,r.Z)(n().mark((function t(e){var o,u,h,c,v;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return v=function(){return(v=(0,r.Z)(n().mark((function t(){var r,o,v,a,f,_,l;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,s.e("vsh_268").then(s.bind(s,"vsh_89268"));case 3:r=t.sent,o=r.sdk,v=r.SheetDep,a=r.ConfigIdentifier,o.spread.userLanguage=e.userLanguage,e.useFormulaFuncCache||o.spread.getCalcEngine().formulaService.getFuncCacheManager().stopUseCache(),v.getLanguage=function(){return h.language},v.getSheetCellLimitNum=function(){return h.getSheetCellLimitNum},v.getSheetCfCopyEnabled=function(){return h.getSheetCfCopyEnabled},v.getSheetImportRangeCountLimit=function(){return h.getSheetImportRangeCountLimit},v.getImportRangeV3Enable=function(){return h.getImportRangeV3Enable},v.getImportRangeV2Enable=function(){return h.getImportRangeV2Enable},o.getService(a).register({polyphoneSortEnable:function(){return h.polyphoneSortEnable}}),v.sheetCfMaxCount=h.sheetCfMaxCount,v.encryptTea=i.p,o.spread.resetPivotInWorker(),o.spread.importRangeManagerV3.V3Enable=v.getImportRangeV3Enable()&&!v.getImportRangeV2Enable(),f=o.spread.calcEngine,e.usePivotTableServerCalc&&(null===(_=o.spread.calcEngine)||void 0===_||_.pivotCalculateEngine.suspend()),f&&(f.markDirtyCacheOptimize=!!e.useMarkDirtyCacheOptimize),e.colDataAnalysisConfig&&(null===(l=o.getPlugin("CollaborativeSpreadPlugin"))||void 0===l||l.setColDataAnalysisConfig(e.colDataAnalysisConfig)),console.log("Worker Init Success"),t.next=38;break;case 27:if(t.prev=27,t.t0=t.catch(0),console.error("Worker Init Error: ",t.t0),self.postMessage({type:7,data:t.t0}),!(u++<1)){t.next=36;break}return t.next=34,c();case 34:t.next=38;break;case 36:self.postMessage({type:6,data:[{key:"client_sheet_worker_dev",params:{result:"fail",stage:"INIT",error:t.t0.message}}]}),self.postMessage({type:8});case 38:case"end":return t.stop()}}),t,null,[[0,27]])})))).apply(this,arguments)},c=function(){return v.apply(this,arguments)},u=0,console.log("Worker Init Start"),h=e.sheetDep,s.p={NODE_ENV:"production",CDN_URL:"/eesz/bear/sheet/module",FASTER_TEST:void 0}.NEXT_BUILD?"".concat(e.pathPrefix).concat(null!==(o={NODE_ENV:"production",CDN_URL:"/eesz/bear/sheet/module",FASTER_TEST:void 0}.CDN_PATH_PREFIX)&&void 0!==o?o:"/"):e.pathPrefix+s.p,t.next=8,c();case 8:case"end":return t.stop()}}),t)}))),o.apply(this,arguments)}function u(){}var h={init:function(t){return o.apply(this,arguments)},fromJSON:u,applySubBlock:u,applyActions:u,applyFormulaCache:u,applyImportRangeDataSet:u,applyImportRangeData:u,applyImportRangeDataHash:u,applyImportRangeChange:u,setSpreadToken:u,handleWorkSheetLoading:u,handleWorkSheetLoaded:u,handleFirstActiveSheetLoaded:u,handleActiveSheetChange:u,dispose:u,setBatchFetchMetaURLAndBaseURL:u};self.WorkerModules=h,(0,e.Jj)(h)}()}();',"Worker",void 0,void 0)}var g=n("vsh_24627"),m=n("vsh_21955"),_=n("vsh_82905"),y=n("vsh_74340"),C=n("vsh_72834"),S=n("vsh_30157"),k={namespace:"CalculateStatusStore",state:{taskNums:0,finishedTaskNums:0,percentage:100,statusTip:""},commit:{addTaskNum:function(e,t){0!==t&&(e.taskNums+=t,T(e,E(e)))},completeTasks:function(e,t){0!==e.taskNums&&0!==t&&(e.finishedTaskNums=Math.min(e.taskNums,e.finishedTaskNums+t),T(e,E(e)),e.finishedTaskNums===e.taskNums&&(e.finishedTaskNums=0,e.taskNums=0))},reset:function(e){e.taskNums=0,e.finishedTaskNums=0,e.statusTip=""},setStatusTip:function(e,t){e.statusTip!==t&&(e.statusTip=t)},setPercentage:function(e,t){T(e,t)}}};function E(e){return Math.floor(100*e.finishedTaskNums/e.taskNums)}function T(e,t){e.percentage!==t&&(e.percentage=t)}var b=n("vsh_47246");var I,R=((I=(0,b.default)(k)).namespace="CalculateConditionalFormatStatusStore",I),w=n("vsh_2902"),A=function(){function e(t){var n=this;(0,l.Z)(this,e),this.stagingTasks=[],this.handleAfterTTU=function(){n.isAfterTTU=!0,n.stagingTasks.length>0&&(n.stagingTasks.forEach((function(e){var t=(0,r.Z)(e,2),o=t[0],i=t[1];return n.registerIdleCallback(o,i)})),n.stagingTasks.length=0)},this.spread=t}return(0,u.Z)(e,[{key:"registerTask",value:function(e,t){this.isAfterTTU?this.registerIdleCallback(e,t):this.stagingTasks.push([e,t])}},{key:"registerIdleCallback",value:function(e,t){var n=this;this.spread.sheetIdle.turnOnIdle(),this.spread.sheetIdle.registerIdleCallback((function(){n.spread.sheetIdle.turnOffIdle(),e()}),t)}},{key:"destroy",value:function(){}}]),e}(),F=n("vsh_58054"),D=n("vsh_65778"),N=n("vsh_9160"),P=function(){function e(t,n){(0,l.Z)(this,e),this.trackerService=t,this.reportService=n,this.pendingTrackerInfo=[],this.addTrackerRules()}return(0,u.Z)(e,[{key:"reportPendingTrackData",value:function(){var e=this;this.pendingTrackerInfo&&(this.pendingTrackerInfo.forEach((function(t){e.reportService.eventReport(t)})),this.pendingTrackerInfo=null)}},{key:"collectPerformanceData",value:function(e,t,n){var r=n||e;this.trackerService.collect(M(r),{key:r,status:t})}},{key:"collectCommonEvents",value:function(e){e.forEach((function(e){g.Ps3.moirae.teaLog(Object.assign({key:e.key},e.params||{}))}))}},{key:"ravenCatch",value:function(e){g.Ps3.moirae.ravenCatch(e,{tags:{scm:JSON.stringify(window.scm),key:"SHEET_WORKER_ERROR"}})}},{key:"addTrackerRules",value:function(){var e=this;this.trackerService.addTrackRules(O().map((function(t){return{key:t,track:function(n){var r,o=n.getData,i=n.cleanData,a=n.reporter;o(t).forEach((function(n){if(n.status===g.G2P.START)r=n.nowTime;else if(n.status===g.G2P.END&&"number"==typeof r){var o,s=Number((n.nowTime-r).toFixed(2)),l={key:w.En,time_cost:s,result:w.Qs.SUCCESS};n.key in w.kg?(l.action=n.key,o=w.f1.SYNC):o=n.key,l.stage=o,e.pendingTrackerInfo?e.pendingTrackerInfo.push(l):a.eventReport(l),i(t)}}))}}})))}},{key:"destroy",value:function(){this.reportPendingTrackData(),this.trackerService.removeTrackRules(O()),this.trackerService.destroy()}}]),e}();function O(){var e=Object.keys(w.f1).map((function(e){return M(w.f1[e])})),t=Object.keys(w.kg).map((function(e){return M(w.kg[e])}));return e.concat(t)}function M(e){return"worker_tracker_rule_"+e}var L=n("vsh_18914");var x={namespace:"WorkerCalculatePluginStore",state:{applyResultsTasksRemainedNums:0},commit:{addTask:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;e.applyResultsTasksRemainedNums+=t},completeTask:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;e.applyResultsTasksRemainedNums=Math.min(e.applyResultsTasksRemainedNums,e.applyResultsTasksRemainedNums-t)}}},V=n("vsh_80420"),Z=["CreationDoc_Sheets_PivotTable_All","CreationDoc_Sheets_PivotTable_Several","CreationDoc_Sheets_PivotTable_TotalAfterText","CreationDoc_Sheets_PivotTable_ValueTitle","CreationDoc_Sheets_PivotTable_FilterWorkSpace","CreationDoc_Sheets_PivotTable_RowWorkSpace","CreationDoc_Sheets_PivotTable_ColumnWorkSpace","CreationDoc_Sheets_PivotTable_ValueWorkSpace","CreationDoc_Sheets_PivotTable_WorkSpacePlaceHolder","CreationDoc_Sheets_PivotTable_Blank","CreationDoc_Sheets_PivotTable_XMonth","CreationDoc_Sheets_PivotTable_XMonthYDay","CreationDoc_Sheets_PivotTable_XYearYMonth","LarkCCM_Sheets_PivotTable_FieldNameDateGroupMin","LarkCCM_Sheets_PivotTable_DateGroup_FieldNameHour","LarkCCM_Sheets_PivotTable_DateGroup_FieldNameHourMin","LarkCCM_Sheets_PivotTable_DateGroup_FieldNameDate","LarkCCM_Sheets_PivotTable_DateGroup_FieldNameMonth","LarkCCM_Sheets_PivotTable_DateGroup_FieldNameMonthWithDate","LarkCCM_Sheets_PivotTable_DateGroup_FieldNameQuarter","LarkCCM_Sheets_PivotTable_DateGroup_FieldNameYear","LarkCCM_Sheets_PivotTable_DateGroup_FieldNameYearMonth","LarkCCM_Sheets_PivotTable_DateGroup_FieldNameYearQuarter","LarkCCM_Sheets_PivotTable_DateGroup_FieldNameYearMonthQuarter","LarkCCM_Sheets_PivotTable_DateGroup_GroupedFieldName","CreationDoc_Sheets_PivotTable_ColumnName"];var B=n("vsh_69691"),H=n("vsh_74075"),U=n("vsh_96636"),j="CalcPerfMonitorPlugin",G={singleFormulaCount:0,arrayFormulaCount:0,pivotFormulaCount:0,transformTime:0,applyTime:0,transformCount:0},K=function(){function e(){(0,l.Z)(this,e),this.name=j,this.formulaCalcStartTime=0,this.transformPerformanceData=(0,b.default)(G),this.debounceReportResultApplyTeaLog=(0,U.default)(this.reportResultApplyTeaLog.bind(this),5e3)}return(0,u.Z)(e,[{key:"init",value:function(e){this.sdk=e,this.reset()}},{key:"reset",value:function(){this.formulaCalcStartTime=0,this.clearFormulaCalcTimer()}},{key:"getResultApplyCounter",value:function(){return this.transformPerformanceData}},{key:"handleWorkerResultApply",value:function(e,t){this.transformPerformanceData.transformCount++,this.transformPerformanceData.transformTime+=e,this.transformPerformanceData.applyTime+=t}},{key:"handleCalculatePercentageChanged",value:function(e){var t=this;if(0===e&&0===this.formulaCalcStartTime)return this.formulaCalcStartTime=performance.now(),void(this.formulaCalcTimer=setTimeout((function(){t.reportCostTimeTeaLog(0,!0),t.clearFormulaCalcTimer()}),5e3));if(100===e){var n=performance.now()-this.formulaCalcStartTime;this.formulaCalcTimer?this.reportCostTimeTeaLog(n,!0):this.reportCostTimeTeaLog(n,!1),this.reset(),this.debounceReportResultApplyTeaLog()}}},{key:"reportResultApplyTeaLog",value:function(){var e=this.sdk.spread.getCalcEngine().formulaSpace.formulas.size,t=this.transformPerformanceData,n=t.transformCount,r=t.transformTime,o=t.applyTime,i=t.singleFormulaCount,a=t.arrayFormulaCount,s=t.pivotFormulaCount;g.Ps3.collectSheetEvent(w.EH,{cost_time:r,type:"result_apply",formula_count:e,applyTime:o,calc_count:n,calc_formula_count:i,max_cell_array_size:a,sheet_pivot_table_count:s}),this.transformPerformanceData=(0,b.default)(G)}},{key:"reportCostTimeTeaLog",value:function(e,t){var n=this.sdk.spread.getCalcEngine().formulaSpace.formulas.size,r=0,o=this.sdk.spread.sheets.reduce((function(e,t){var n=t.getRowCount()*t.getColumnCount();return r=Math.max(r,n),e+n}),0);g.Ps3.collectSheetEvent(w.EH,{cost_time:e,type:"calc",less_then_bench_mark_time:t,formula_count:n,total_cell_count:o})}},{key:"clearFormulaCalcTimer",value:function(){this.formulaCalcTimer&&(clearTimeout(this.formulaCalcTimer),this.formulaCalcTimer=null)}},{key:"destroy",value:function(){this.clearFormulaCalcTimer(),this.debounceReportResultApplyTeaLog.cancel()}}]),e}(),W=n("vsh_32728"),z=n("vsh_52656"),Y=n("vsh_73043");function J(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return q(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return q(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function q(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var $=function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":(0,c.Z)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},X=function(){function e(){var t,n,r=this;(0,l.Z)(this,e),this.name=w.Pj,this.isTerminated=!1,this.pluginStoreEventSubscriptions=[],this.serviceSubscription=null,this.extraDataSheetId=null,this.messageHandlers=[{event:F.u.LOAD_WORKSHEET,handler:this.loadWorkSheet.bind(this)},{event:F.u.APPLY_CALCULATION_RESULTS,handler:this.applyCalculationResults.bind(this)},{event:F.u.UPDATE_CALCULATE_STATUS,handler:this.updateCalculateStatus.bind(this)},{event:F.u.UPDATE_CONDTIONAL_FORMAT_CALCULATE_STATUS,handler:this.updateConditionalFormatCalculateStatus.bind(this)},{event:F.u.UPDATE_AI_REQUEST_MANAGER_CALCULATE_STATUS,handler:this.updateAiRequestManagerCalculateStatus.bind(this)},{event:F.u.RECEIVE_IMPORTRANGE_DATASET_REQUEST,handler:this.receiveImportRangeDatasetRequest.bind(this)},{event:F.u.RECEIVE_IMPORTRANGE_DATA_REQUEST,handler:this.receiveImportRangeDataRequest.bind(this)},{event:F.u.RECEIVE_IMPORTRANGE_DATAHASH_REQUEST,handler:this.receiveImportRangeDataHash.bind(this)},{event:F.u.FETCH_IMPORTRANGE_DATA_V3,handler:this.handleImportRangeDataRequest.bind(this)},{event:F.u.UPDATE_CONDITIONAL_FORMAT_STYLE,handler:this.updateConditionalFormatStyleModel.bind(this)},{event:F.u.COLLECT_CONDITIONAL_FORMAT,handler:this.collectConditionFormular.bind(this)},{event:F.u.CLEAR_CONDITIONAL_FORMAT_STYLE,handler:this.clearConditionalFormatSyleModel.bind(this)},{event:F.u.COLLECT_EVENTS,handler:this.collectWorkerEvents.bind(this)},{event:F.u.COLLECT_PIVOT_TABLE_EVENTS,handler:this.handlePivotPerformanceData.bind(this)},{event:F.u.REPORT_ERROR,handler:this.reportWorkerError.bind(this)},{event:F.u.CRITICAL_ERROR,handler:this.handleCriticalError.bind(this)},{event:F.u.Fetch_AI_REQUEST,handler:this.handleFetchAiRequest.bind(this)},{event:F.u.RESET_OPERATE_ID,handler:this.handleResetOperateId.bind(this)},{event:F.u.FETCH_IMPORTFORMULA_DATA,handler:this.handleImportFormulaMetaRequest.bind(this)},{event:F.u.FETCH_IMPORTFORMULA_BLOCK,handler:this.handleImportFormulaBlockRequest.bind(this)},{event:F.u.FETCH_IMPORTFORMULA_REFRESH,handler:this.handleImportFormulaRefreshRequest.bind(this)},{event:F.u.UPDATE_IMPORTFORMULA_LABEL_INFO,handler:this.handleImportFormulaLabelInfo.bind(this)},{event:F.u.UPDATE_IMPORTRANGE_RELATIONSHIP,handler:this.updateImportRangeRelationship.bind(this)},{event:F.u.APPLY_PIVOT_CACHE_RESULT,handler:this.handleApplyPivotCacheResult.bind(this)},{event:F.u.APPLY_PIVOT_CACHE_STATUS,handler:this.handleApplyPivotCacheStatus.bind(this)}],this.spreadEventHandlers=(t={},(0,s.Z)(t,g.Fsj.BeforeApply,this.handleBeforeActionsApply.bind(this)),(0,s.Z)(t,g.HaZ.ActiveSheetChanged,this.handleActiveSheetChange.bind(this)),t),this.dataloaderEventHandlers=(n={},(0,s.Z)(n,"LoadStatusStore/WorksheetLoading",this.handleWorksheetLoading.bind(this)),(0,s.Z)(n,"LoadStatusStore/WorksheetLoaded",this.handleWorksheetLoaded.bind(this)),(0,s.Z)(n,"LoadStatusStore/BeforeApplySnapshot",this.syncSnapshot.bind(this)),(0,s.Z)(n,"LoadStatusStore/DataTableLoaded",this.syncSubBlock.bind(this)),(0,s.Z)(n,"LoadStatusStore/FormulaCacheMetaLoaded",this.syncFormulaCacheMeta.bind(this)),(0,s.Z)(n,"LoadStatusStore/FormulaCacheBlockLoaded",this.syncFormulaCache.bind(this)),(0,s.Z)(n,"LoadStatusStore/SheetToUsage",this.onSheetToUsage.bind(this)),(0,s.Z)(n,"LoadStatusStore/FirstActiveSheetLoaded",this.handleFirstActiveSheetLoaded.bind(this)),(0,s.Z)(n,"LoadStatusStore/FormulaCacheEmpty",this.handleNoFormulaCache.bind(this)),(0,s.Z)(n,"LoadStatusStore/SnapshotHasExtraData",this.setExtraDataSheetId.bind(this)),n),this._handlePivotSnapshotChanged=function(e){var t=e.blockToken,n=e.data;r.syncSheetDataToWorker({dataType:w.g.PivotTableSnapshotChanged,data:{blockToken:t,data:n}})},this.pivotSnapshotEventHandler=(0,s.Z)({},C.Zqx.SnapshotChanged,this._handlePivotSnapshotChanged),this.syncSheetDataToWorker=function(e){if(!r.isTerminated){var t=e.dataType,n=e.data,o=function(e){r.tracker.collectCommonEvents([{key:w.En,params:{stage:w.f1.SYNC,action:e,result:w.Qs.FAIL}}])};switch(t){case w.g.Snapshot:r.workerSDK.setSpreadToken({token:r.sdk.spread._context.getToken()}),r.tracker.collectPerformanceData(w.f1.SYNC,g.G2P.START,w.kg.FROM_JSON),r.workerSDK.fromJSON({data:n,extraData:e.extraData.data?e.extraData:null}).catch((function(e){o(w.kg.FROM_JSON),r.reportError(e)})),r.tracker.collectPerformanceData(w.f1.SYNC,g.G2P.END,w.kg.FROM_JSON),r.workerSDK.setBatchFetchMetaURLAndBaseURL(g.Ps3.baseURL,g.Ps3.apiURLs.POST_BATCH_META);break;case w.g.SubBlockCommands:r.workerSDK.setSpreadToken({token:r.sdk.spread._context.getToken()}),r.tracker.collectPerformanceData(w.f1.SYNC,g.G2P.START,w.kg.APPLY_SUB_BLOCK),r.workerSDK.applySubBlockCommands({gzipSubBlock:n,rowStart:e.rowStart,colStart:e.colStart}).catch((function(e){o(w.kg.APPLY_SUB_BLOCK),r.reportError(e)})),r.tracker.collectPerformanceData(w.f1.SYNC,g.G2P.END,w.kg.APPLY_SUB_BLOCK);break;case w.g.SnapshotCommands:r.workerSDK.setSpreadToken({token:r.sdk.spread._context.getToken()}),r.tracker.collectPerformanceData(w.f1.SYNC,g.G2P.START,w.kg.APPLY_SNAPSHOT_COMMANDS),r.workerSDK.applySnapshotCommands({data:n,extraData:e.extraData}).catch((function(e){o(w.kg.APPLY_SNAPSHOT_COMMANDS),r.reportError(e)})),r.tracker.collectPerformanceData(w.f1.SYNC,g.G2P.END,w.kg.APPLY_SNAPSHOT_COMMANDS),r.workerSDK.setBatchFetchMetaURLAndBaseURL(g.Ps3.baseURL,g.Ps3.apiURLs.POST_BATCH_META);break;case w.g.SubBlock:r.tracker.collectPerformanceData(w.f1.SYNC,g.G2P.START,w.kg.APPLY_SUB_BLOCK),r.workerSDK.applySubBlock({sheetId:e.sheetId,data:n,totalRowCount:e.totalRowCount,startRowIndex:e.startRowIndex}).catch((function(e){o(w.kg.APPLY_SUB_BLOCK),r.reportError(e)})),r.tracker.collectPerformanceData(w.f1.SYNC,g.G2P.END,w.kg.APPLY_SUB_BLOCK);break;case w.g.Action:r.tracker.collectPerformanceData(w.f1.SYNC,g.G2P.START,w.kg.APPLY_ACTIONS),r.workerSDK.applyActions(n).catch((function(e){o(w.kg.APPLY_ACTIONS),r.reportError(e)})),r.tracker.collectPerformanceData(w.f1.SYNC,g.G2P.END,w.kg.APPLY_ACTIONS);break;case w.g.FormulaCacheMeta:var i=n.sheetId,a=n.formulaCacheMeta;r.tracker.collectPerformanceData(w.f1.SYNC,g.G2P.START,w.kg.APPLY_FORMULA_CACHE_META),r.workerSDK.applyFormulaCacheMeta({sheetId:i,formulaCacheMeta:a}).catch((function(e){o(w.kg.APPLY_FORMULA_CACHE_META),r.reportError(e)})),r.tracker.collectPerformanceData(w.f1.SYNC,g.G2P.END,w.kg.APPLY_FORMULA_CACHE_META);break;case w.g.FormulaCache:var s=n.sheetId,l=n.isLastBlock,u=n.formulaBlocks;r.tracker.collectPerformanceData(w.f1.SYNC,g.G2P.START,w.kg.APPLY_FORMULA_CACHE),r.workerSDK.applyFormulaCache({sheetId:s,formulaBlocks:u,isLastBlock:l}).catch((function(e){o(w.kg.APPLY_FORMULA_CACHE),r.reportError(e)})),r.tracker.collectPerformanceData(w.f1.SYNC,g.G2P.END,w.kg.APPLY_FORMULA_CACHE);break;case w.g.ImportRangeDataset:r.tracker.collectPerformanceData(w.f1.SYNC,g.G2P.START,w.kg.APPLY_IMPORT_RANGE_DATASET),r.workerSDK.applyImportRangeDataset(n).catch((function(e){o(w.kg.APPLY_IMPORT_RANGE_DATASET),r.reportError(e)})),r.tracker.collectPerformanceData(w.f1.SYNC,g.G2P.END,w.kg.APPLY_IMPORT_RANGE_DATASET);break;case w.g.ImportRangeData:r.tracker.collectPerformanceData(w.f1.SYNC,g.G2P.START,w.kg.APPLY_IMPORT_RANGE_DATA),r.workerSDK.applyImportRangeData(n).catch((function(e){o(w.kg.APPLY_IMPORT_RANGE_DATA),r.reportError(e)})),r.tracker.collectPerformanceData(w.f1.SYNC,g.G2P.END,w.kg.APPLY_IMPORT_RANGE_DATA);break;case w.g.ImportRangeDataHash:r.tracker.collectPerformanceData(w.f1.SYNC,g.G2P.START,w.kg.APPLY_IMPORT_RANGE_DATAHASH),r.workerSDK.applyImportRangeDataHash(n).catch((function(e){o(w.kg.APPLY_IMPORT_RANGE_DATAHASH),r.reportError(e)})),r.tracker.collectPerformanceData(w.f1.SYNC,g.G2P.END,w.kg.APPLY_IMPORT_RANGE_DATAHASH);break;case w.g.ImportRangeChange:r.tracker.collectPerformanceData(w.f1.SYNC,g.G2P.START,w.kg.APPLY_IMPORT_RANGE_CHANGE),r.workerSDK.applyImportRangeChange(n).catch((function(e){o(w.kg.APPLY_IMPORT_RANGE_CHANGE),r.reportError(e)})),r.tracker.collectPerformanceData(w.f1.SYNC,g.G2P.END,w.kg.APPLY_IMPORT_RANGE_CHANGE);break;case w.g.ImportRangeRefresh:r.tracker.collectPerformanceData(w.f1.SYNC,g.G2P.START,w.kg.APPLY_IMPORT_RANGE_REFRESH),r.workerSDK.applyImportRangeRefresh(n).catch((function(e){o(w.kg.APPLY_IMPORT_RANGE_REFRESH),r.reportError(e)})),r.tracker.collectPerformanceData(w.f1.SYNC,g.G2P.END,w.kg.APPLY_IMPORT_RANGE_REFRESH);break;case w.g.ImportRangeDataV3:r.workerSDK.handleImportRangeDataResult(n);break;case w.g.ImportRangeRefreshV3:r.workerSDK.applyImportRangeRefreshV3(n);break;case w.g.AiLongTimeTaskRefresh:r.tracker.collectPerformanceData(w.f1.SYNC,g.G2P.START,w.kg.APPLY_AI_LONG_TIME_TASK_REFRESH),r.workerSDK.applyAiLongTimeTaskRefresh(n).catch((function(e){o(w.kg.APPLY_AI_LONG_TIME_TASK_REFRESH),r.reportError(e)})),r.tracker.collectPerformanceData(w.f1.SYNC,g.G2P.END,w.kg.APPLY_AI_LONG_TIME_TASK_REFRESH);break;case w.g.AIFormulaReferDataChange:r.tracker.collectPerformanceData(w.f1.SYNC,g.G2P.START,w.kg.APPLY_AI_FORMULA_REFER_DATA_CHANGE),r.workerSDK.applyAIFormulaReferDataChange(n).catch((function(e){o(w.kg.APPLY_AI_FORMULA_REFER_DATA_CHANGE),r.reportError(e)})),r.tracker.collectPerformanceData(w.f1.SYNC,g.G2P.END,w.kg.APPLY_AI_FORMULA_REFER_DATA_CHANGE);break;case w.g.AIFormulasRetry:r.tracker.collectPerformanceData(w.f1.SYNC,g.G2P.START,w.kg.APPLY_AI_FORMULAS_RETRY),r.workerSDK.applyAIFormulasRetry(n).catch((function(e){o(w.kg.APPLY_AI_FORMULAS_RETRY),r.reportError(e)})),r.tracker.collectPerformanceData(w.f1.SYNC,g.G2P.END,w.kg.APPLY_AI_FORMULAS_RETRY);break;case w.g.AIRequestResult:r.workerSDK.handleAiRequestResult(n);break;case w.g.TTI18N:r.workerSDK.setTTI18N(n);break;case w.g.ImportFormulaData:case w.g.ImportFormulaBlock:r.workerSDK.handleImportFormulaDataResult(n);break;case w.g.ImportFormulaRefresh:r.workerSDK.handleImportFormulaRefreshResult(n);break;case w.g.ImportFormulaLabelInfo:r.workerSDK.handleImportFormulaLabelInfo(n);break;case w.g.ImportFormulaServerData:r.workerSDK.handleImportFormulaServerData(n);break;case w.g.PivotTableSnapshotChanged:r.tracker.collectPerformanceData(w.f1.SYNC,g.G2P.START,w.kg.PIVOT_TABLE_SNAPSHOT_CHANGED),r.workerSDK.handlePivotSnapshotChanged(n),r.tracker.collectPerformanceData(w.f1.SYNC,g.G2P.END,w.kg.PIVOT_TABLE_SNAPSHOT_CHANGED);break;case w.g.PivotTableSnapshot:r.tracker.collectPerformanceData(w.f1.SYNC,g.G2P.START,w.kg.PIVOT_TABLE_SNAPSHOT_FROM_JSON),r.workerSDK.handlePivotTableFromJSON(n),r.tracker.collectPerformanceData(w.f1.SYNC,g.G2P.END,w.kg.PIVOT_TABLE_SNAPSHOT_FROM_JSON)}}},this.handleWorkerMessageError=function(e){r.tracker.ravenCatch(e)},this.handleWorkerError=function(e){null!=e&&e.message&&r.tracker.ravenCatch(e.message)}}var t,n,o,c,h,f,v,E;return(0,u.Z)(e,[{key:"init",value:function(e){var t=this;this.sdk=e,this.taskScheduler=new A(e.spread),this.tracker=new P(e.getService(_.kM),e.getService(_.zv)),this.initRPCService().catch((function(e){t.tracker.collectCommonEvents([{key:w.En,params:{stage:w.f1.INIT,result:w.Qs.FAIL,error:null==e?void 0:e.message}}]),t.reportError(e),t.handleCriticalError()})).finally((function(){t.tracker.collectPerformanceData(w.f1.INIT,g.G2P.END)})),this.sdk.spread.getCalcEngine().formulaService.suspend(),this.sdk.spread.importRangeManager.setShouldHeartBeat(!1),this.sdk.unregisterPlugin(m.a5),this.sdk.unregisterPlugin(D.eF),this.sdk.pluginStore.registerModule(k),this.sdk.pluginStore.registerModule(R),this.sdk.pluginStore.registerModule(z.Dy),this.sdk.pluginStore.registerModule(x)}},{key:"initRPCService",value:(E=(0,a.Z)(i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new p,this.worker=t,t.addEventListener("messageerror",this.handleWorkerMessageError),t.addEventListener("error",this.handleWorkerError),this.workerSDK=this.sdk.getService(_.ry)(t),this.bindEvents(),this.addWorkerRequestHandlers(),this.tracker.collectPerformanceData(w.f1.INIT,g.G2P.START),e.next=11,this.workerSDK.init(this.getWorkerInitOptions());case 11:case"end":return e.stop()}}),e,this)}))),function(){return E.apply(this,arguments)})},{key:"getWorkerInitOptions",value:function(){var e;(e=navigator.cdn_host).includes(location.protocol)||(e=location.protocol+e);var t=this.sdk.getService(_.tb);return{pathPrefix:e,useFormulaFuncCache:this.sdk.spread.calcEngine.formulaService.getFuncCacheManager().useCache,userLanguage:this.sdk.spread.userLanguage,sheetDep:Object.assign({getSheetCellLimitNum:g.Ps3.getSheetCellLimitNum(),getSheetCfCopyEnabled:g.Ps3.getSheetCfCopyEnabled(),getSheetImportRangeCountLimit:g.Ps3.getSheetImportRangeCountLimit(),getImportRangeV3Enable:g.Ps3.getImportRangeV3Enable(),getImportRangeV2Enable:g.Ps3.getImportRangeV2Enable(),language:g.Ps3.getLanguage&&g.Ps3.getLanguage(),sheetCfMaxCount:g.Ps3.sheetCfMaxCount},{polyphoneSortEnable:t.resolve("polyphoneSortEnable",!0)}),usePivotTableServerCalc:(0,L.tx)()||(0,g.pPK)(),useMarkDirtyCacheOptimize:this.sdk.spread.calcEngine.markDirtyCacheOptimize,colDataAnalysisConfig:t.resolve("colDataAnalysisConfig",null)}}},{key:"bindEvents",value:function(){this.subscriber=this.sdk.spread.subscribe(this.spreadEventHandlers),this.pluginStoreEventSubscriptions.push(this.sdk.pluginStore.subscribeEventMap(this.dataloaderEventHandlers)),this.sdk.spread.getPivotSyncModelManager().subscribe(this.pivotSnapshotEventHandler)}},{key:"handleBeforeActionsApply",value:function(e){var t=e.actions,n=e.local,r=e.fromUndoRedo;this.syncSheetDataToWorker({dataType:w.g.Action,data:{actions:t,local:n,fromUndoRedo:r}})}},{key:"handleNoFormulaCache",value:function(){this.workerSDK.handleNoFormulaCache()}},{key:"setExtraDataSheetId",value:function(e){this.extraDataSheetId=e}},{key:"handleWorksheetLoading",value:function(e){this.workerSDK.handleWorkSheetLoading(e)}},{key:"handleWorksheetLoaded",value:function(e,t){this.workerSDK.handleWorkSheetLoaded(e,t)}},{key:"syncSnapshot",value:function(e){if((0,y.VVp)(e.schemaVersion))this.syncSheetDataToWorker({dataType:w.g.SnapshotCommands,data:e,extraData:{extraDataSheetId:this.extraDataSheetId}});else{var t="snapshot_".concat(e.rev),n=this.sharedBufferService.getItemOnce(t)||e,r=null;n&&this.extraDataSheetId&&((r=this.sharedBufferService.getItemOnce("snapshot_extra_data"))?r.buffer=Q(r.buffer):n=e),this.syncSheetDataToWorker({dataType:w.g.Snapshot,data:n,extraData:{data:r,extraDataSheetId:r?this.extraDataSheetId:null}})}var o=Z.reduce((function(e,t){return e[t]=(0,V.t)(t),e}),{});this.syncSheetDataToWorker({dataType:w.g.TTI18N,data:o})}},{key:"syncSubBlock",value:function(e){var t=e.blockToken,n=e.sheetId,r=e.rowData,o=e.blockData,i=e.startRowIndex,a=e.blockVersion,s=e.range;if((0,y.VVp)(a))this.syncSheetDataToWorker({dataType:w.g.SubBlockCommands,sheetId:n,data:o,rowStart:null==s?void 0:s.rowStart,colStart:null==s?void 0:s.colStart});else{var l=this.sdk.getService(_.B2).getItemOnce(t);this.syncSheetDataToWorker({dataType:w.g.SubBlock,sheetId:n,data:l?Q(l):r||o,startRowIndex:i})}}},{key:"syncFormulaCacheMeta",value:function(e,t){this.syncSheetDataToWorker({dataType:w.g.FormulaCacheMeta,data:{sheetId:e,formulaCacheMeta:t}})}},{key:"syncFormulaCache",value:function(e,t,n){var r=this,o=t.map((function(e){var t=r.sharedBufferService.getItemOnce(e.block_token);return t||e.formulaBlock?t?Q(t):e.formulaBlock:null})).filter((function(e){return!!e}));o.length&&this.syncSheetDataToWorker({dataType:w.g.FormulaCache,data:{sheetId:e,formulaBlocks:o,isLastBlock:n}})}},{key:"syncImportRange",value:function(e){var t=e.importRangeId,n=e.dataType,r=e.version;this.syncSheetDataToWorker({dataType:w.g.ImportRangeChange,data:{importRangeId:t,dataType:n,version:r}})}},{key:"syncImportFormula",value:function(e){this.syncSheetDataToWorker({dataType:w.g.ImportFormulaServerData,data:e})}},{key:"onSheetToUsage",value:function(){this.taskScheduler.handleAfterTTU(),this.workerSDK.registerPivotPluginAfterTTU();var e=this.sdk.spread.getPivotSyncModelManager().toJSON();this.syncSheetDataToWorker({dataType:w.g.PivotTableSnapshot,data:e})}},{key:"handleActiveSheetChange",value:function(e){var t=e.newSheet;this.workerSDK.handleActiveSheetChange(t.id())}},{key:"handleFirstActiveSheetLoaded",value:function(e){this.workerSDK.handleFirstActiveSheetLoaded(e)}},{key:"addWorkerRequestHandlers",value:function(){for(var e=0;e<this.messageHandlers.length;e++){var t=this.messageHandlers[e],n=t.event,r=t.handler;this.workerSDK.addMessageHandler(n,r)}}},{key:"removeWorkerRequestHandlers",value:function(){for(var e=0;e<this.messageHandlers.length;e++){var t=this.messageHandlers[e],n=t.event,r=t.handler;this.workerSDK.removeMessageHandler(n,r)}}},{key:"loadWorkSheet",value:function(e){var t=this.sdk.spread;console.log("[sheet][WorkerCalculatePlugin] loadWorksheets: ".concat(e.join())),e.forEach((function(e){var n=t.getSheetFromId(e);n&&t.detectWorksheet(n)}))}},{key:"applyCalculationResults",value:function(e,t){var n,o=Date.now(),i=o-(t||0),a=w.k3,s=this.sdk.getPlugin(j),l=J(e);try{for(l.s();!(n=l.n()).done;){for(var u=(0,r.Z)(n.value,2),c=u[0],h=u[1],d=0,f=0;d<h.length;){var v=Math.min(d+a,h.length);this.applyCalculationResultsImp(c,h,d,v,s&&s.getResultApplyCounter()),d=v,f++}this.sdk.pluginStore.commit("WorkerCalculatePluginStore/addTask",f)}}catch(e){l.e(e)}finally{l.f()}s&&s.handleWorkerResultApply(i,Date.now()-o)}},{key:"applyCalculationResultsImp",value:function(e,t,n,o,i){for(var a=this,s=this.sdk.spread.getCalcEngine(),l=[],u=n;u<o;u++){var c,h=(0,r.Z)(t[u],2),d=h[0],f=h[1],v=s.getFormulaFromId(e,d);if(t[u][0]=null!==(c=v)&&void 0!==c?c:null,null!=v&&null!=f){var p=void 0;p=(0,C.sMb)(v)?v.getArrayRef():v.getRef(),Array.isArray(p)?p.forEach((function(e){(0,C.DHM)(l,e)})):(0,C.DHM)(l,p)}}for(var g=n;g<o;g++){var m=t[g],_=m[0],y=m[1];if(null!=_&&null!=y&&"number"!=typeof _)(0,C.sMb)(_)?(_.fromCache(y,{forceOverride:!0,loadRuntimeError:!0,ignoreArrayFormulaCanExpand:!0}),i&&i.arrayFormulaCount++):(0,C.v4_)(_)?(_.fromCache(y,{forceOverride:!0,loadRuntimeError:!0}),i&&i.pivotFormulaCount++):(_.fromCache(y,{forceOverride:!0,loadRuntimeError:!1}),i&&i.singleFormulaCount++)}l.forEach((function(e){var t,n=e.sheet();if(n){var r=e.rowFrom(),o=e.colFrom(),i=e.rowCount()||1,s=e.colCount()||1;null===(t=(0,S.F)(a.sdk,n))||void 0===t||t.removeRangeCache(r,o,i,s)}})),s.markDepRefDirty(l),this.sdk.pluginStore.commit("WorkerCalculatePluginStore/completeTask")}},{key:"updateConditionalFormatStyleModel",value:function(e){(0,N.Bl)(e,this.sdk)}},{key:"collectConditionFormular",value:function(e){(0,N._s)(e)}},{key:"reportWorkerCollectInfo",value:function(){this.tracker.reportPendingTrackData()}},{key:"clearConditionalFormatSyleModel",value:function(e){(0,N.gU)(e,this.sdk)}},{key:"updateCalculateStatus",value:function(e){var t,n=this.sdk.pluginStore.getState("CalculateStatusStore");if(this.sdk.pluginStore.commit("CalculateStatusStore/setStatusTip",Y("CreationDoc_Sheets_Calculate_Calculating")),void 0!==e.percentage)return this.sdk.pluginStore.commit("CalculateStatusStore/setPercentage",e.percentage),void(null===(t=this.sdk.getPlugin(j))||void 0===t||t.handleCalculatePercentageChanged(e.percentage));n&&n.taskNums>0&&this.sdk.pluginStore.commit("CalculateStatusStore/reset"),"number"==typeof e.taskNums&&this.sdk.pluginStore.commit("CalculateStatusStore/addTaskNum",e.taskNums),"number"==typeof e.finishedTaskNums&&this.sdk.pluginStore.commit("CalculateStatusStore/completeTasks",e.finishedTaskNums)}},{key:"updateConditionalFormatCalculateStatus",value:function(e){var t=this.sdk.pluginStore.getState("CalculateConditionalFormatStatusStore");this.sdk.pluginStore.commit("CalculateConditionalFormatStatusStore/setStatusTip",Y("LarkCCM_Sheets_ConditionalFormatting_Calculating_Description")),void 0===e.percentage?(t&&t.taskNums>0&&this.sdk.pluginStore.commit("CalculateConditionalFormatStatusStore/reset"),"number"==typeof e.taskNums&&this.sdk.pluginStore.commit("CalculateConditionalFormatStatusStore/addTaskNum",e.taskNums),"number"==typeof e.finishedTaskNums&&this.sdk.pluginStore.commit("CalculateConditionalFormatStatusStore/completeTasks",e.finishedTaskNums)):this.sdk.pluginStore.commit("CalculateConditionalFormatStatusStore/setPercentage",e.percentage)}},{key:"updateAiRequestManagerCalculateStatus",value:function(e){if(g.Ps3.getAiProgressBarEnabled()){var t=this.sdk.pluginStore.getState(z.T7);"number"==typeof e.percentage&&this.sdk.pluginStore.commit(z.hA,e.percentage),t&&t.taskNums>0&&this.sdk.pluginStore.commit(z.Z7),"number"==typeof e.taskNums&&this.sdk.pluginStore.commit(z.GY,e.taskNums),"number"==typeof e.finishedTaskNums&&this.sdk.pluginStore.commit(z.or,e.finishedTaskNums),"number"==typeof e.time&&this.sdk.pluginStore.commit(z.I2,e.time)}}},{key:"receiveImportRangeDatasetRequest",value:(v=(0,a.Z)(i().mark((function e(t){var n,r,o,a,s,l,u,c,h;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.queryParams,r=t.token,o=this.sdk.spread.importRangeManager,a=null,e.prev=3,e.next=6,o.getRequestMethod()(n,r);case 6:a=e.sent,e.next=13;break;case 9:e.prev=9,e.t0=e.catch(3),s={},e.t0 instanceof g.rBk?s.code=e.t0.code:s.message="ImportRange data request failed.";case 13:if(null!=a){l=J(n);try{for(l.s();!(u=l.n()).done;)c=u.value,(h=a[c])instanceof g.rBk&&(a[c]={code:h.code,name:h.name,message:h.message})}catch(e){l.e(e)}finally{l.f()}}this.syncSheetDataToWorker({dataType:w.g.ImportRangeDataset,data:{queryParams:n,importRangeDatas:a,error:s}});case 15:case"end":return e.stop()}}),e,this,[[3,9]])}))),function(e){return v.apply(this,arguments)})},{key:"receiveImportRangeDataRequest",value:(f=(0,a.Z)(i().mark((function e(t){var n,r,o,a,s,l,u;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.queryParams,r=t.token,o=t.options,a=null,e.prev=2,l=this.sdk.spread.importRangeManager,e.next=6,l.requestImportRangeData(n,r,o);case 6:a=e.sent,!(u=l.getDataFromId(n))||u instanceof g.rBk||(u.updateTime=Date.now()),l.emit(C.fOM.onAfterRequest,n),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),e.t0 instanceof g.rBk?a={code:e.t0.code,name:e.t0.name,message:e.t0.message}:null!=e.t0&&(s={message:e.t0.message});case 15:this.syncSheetDataToWorker({dataType:w.g.ImportRangeData,data:{queryParams:n,data:a,error:s}});case 16:case"end":return e.stop()}}),e,this,[[2,12]])}))),function(e){return f.apply(this,arguments)})},{key:"receiveImportRangeDataHash",value:(h=(0,a.Z)(i().mark((function e(t){var n,r,o,a,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.queryParams,r=t.token,o=null,e.prev=2,s=this.sdk.spread.importRangeManager,e.next=6,s.requestImportRangeDataHash(n,r);case 6:o=e.sent,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),a={message:"ImportRange Hearbeat request failed."};case 12:this.syncSheetDataToWorker({dataType:w.g.ImportRangeDataHash,data:{dataHash:o,error:a}});case 13:case"end":return e.stop()}}),e,this,[[2,9]])}))),function(e){return h.apply(this,arguments)})},{key:"handleImportRangeDataRequest",value:function(e){var t=this,n=e.data,r=e.requestId,o=this.sdk.getPlugin(H.XT);if(!o){var i="importrange plugin is not found but used";return console.error(i),void this.syncSheetDataToWorker({dataType:w.g.ImportRangeDataV3,data:{data:{},requestId:r,error:{code:g.O6N.REQUEST_FAIL,message:i}}})}o.fetchImportRangeData(n).then((function(e){if(e instanceof g.rBk)throw e;t.syncSheetDataToWorker({dataType:w.g.ImportRangeDataV3,data:{data:e,requestId:r}})})).catch((function(e){e instanceof g.rBk==!1&&console.error("[SHEET LOG] Unknown Error In ImportRange Fetch",e,n),t.syncSheetDataToWorker({dataType:w.g.ImportRangeDataV3,data:{data:{},requestId:r,error:{code:e.code,message:e.message}}})}))}},{key:"receiveImportRangeRefreshV3",value:function(e){this.syncSheetDataToWorker({dataType:w.g.ImportRangeRefreshV3,data:{importRangeIds:e}})}},{key:"receiveImportFormulaRefresh",value:function(e){if(e){if(e.isImportRange()){var t=this.sdk.spread.importRangeManager.getMetaFromFormula(e);t&&this.syncSheetDataToWorker({dataType:w.g.ImportRangeRefresh,data:{importRangeId:t.importRangeId}})}else if((0,C.mkm)(e)){var n=e.getRef().sheet().id(),r=e.getId();this.syncSheetDataToWorker({dataType:w.g.ImportFormulaRefresh,data:{data:[{sheetId:n,formulaId:r}]}})}}else this.syncSheetDataToWorker({dataType:w.g.ImportFormulaRefresh,data:{data:[]}})}},{key:"receiveAIFormulasRetry",value:function(e){this.syncSheetDataToWorker({dataType:w.g.AIFormulasRetry,data:{sheetId:e}})}},{key:"receiveAiLongTimeTaskRefresh",value:function(e){this.syncSheetDataToWorker({dataType:w.g.AiLongTimeTaskRefresh,data:e})}},{key:"receiveAIFormulaReferDataChange",value:function(e){this.syncSheetDataToWorker({dataType:w.g.AIFormulaReferDataChange,data:e})}},{key:"handleApplyPivotCacheStatus",value:function(e){if(e){var t=e.blockToken,n=e.status,r=this.sdk.getPlugin(W.uA);null==r||r.handleCacheStatusChange(t,n)}}},{key:"handleApplyPivotCacheResult",value:function(e){if(e){var t=(0,r.Z)(e,2),n=t[0],o=t[1],i=this.sdk.getPlugin(W.uA);null==i||i.updateCache(n,o)}}},{key:"handlePivotPerformanceData",value:function(e){e&&g.QYs.fromPendingTrackerInfo(e)}},{key:"collectWorkerEvents",value:function(e){this.tracker.collectCommonEvents(e)}},{key:"reportWorkerError",value:function(e){this.tracker.ravenCatch(e)}},{key:"reportError",value:function(e){console.error("WorkerPluginError: ",e),this.tracker.ravenCatch(e)}},{key:"handleCriticalError",value:function(){this.terminate(),g.Ps3.Toast.info({content:Y("LarkCCM_Sheets_Calculate_CalculationTimedOut_Toast_Common"),duration:5e3,actionText:Y("common.refresh"),onActionClick:function(){location.reload()}})}},{key:"terminate",value:function(){var e,t;this.isTerminated||(this.isTerminated=!0,null===(e=this.subscriber)||void 0===e||e.unsubscribe(),this.subscriber=null,this.pluginStoreEventSubscriptions.forEach((function(e){return e.unsubscribe()})),this.pluginStoreEventSubscriptions=[],null===(t=this.serviceSubscription)||void 0===t||t.unsubscribe(),this.serviceSubscription=null,this.removeWorkerRequestHandlers(),this.worker.removeEventListener("messageerror",this.handleWorkerMessageError),this.worker.removeEventListener("error",this.handleWorkerError),this.workerSDK&&(this.workerSDK.dispose(),this.workerSDK.destroy()))}},{key:"handleFetchAiRequest",value:(c=(0,a.Z)(i().mark((function e(t){var n,r,o,a,s,l,u,c,h,d,f,v=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=t.message,a=t.uid,s=(0,B.getLanguage)(),l=this.sdk.spread.getService(_.UU),u=l.token,c=l.memberId,!((h=C.uYg.prefetchAIActions())instanceof Promise)){e.next=7;break}return e.next=7,h;case 7:d=(null===(n=(r=this.sdk.spread.aiManager).getOperateId)||void 0===n?void 0:n.call(r))||"",f=o.map((function(e){var t=C.uYg.getActionIdByActionType(e.action_type||"",s);return Object.assign({},e,{action_id:t})})),g.Ps3.serverApi.aiRequest.getAiResult(f,u||"",Number(c||0),s||"en",d).then((function(e){v.syncSheetDataToWorker({dataType:w.g.AIRequestResult,data:{uid:a,result:e,isSuccess:!0}})})).catch((function(e){v.syncSheetDataToWorker({dataType:w.g.AIRequestResult,data:{uid:a,result:e,isSuccess:!1}})}));case 10:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"handleResetOperateId",value:function(){var e,t;null===(e=(t=this.sdk.spread.aiManager).resetOperateId)||void 0===e||e.call(t)}},{key:"handleImportFormulaMetaRequest",value:(o=(0,a.Z)(i().mark((function e(t){var n,r,o,a,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,o=t.data,a=t.requestId,e.next=4,null===(r=this.sdk.getPlugin(w.CQ))||void 0===r?void 0:r.requestImportFormulaMetaWithAuthorizedCheck(o);case 4:if(e.t1=n=e.sent,e.t0=null!==e.t1,!e.t0){e.next=8;break}e.t0=void 0!==n;case 8:if(!e.t0){e.next=12;break}e.t2=n,e.next=13;break;case 12:e.t2=[];case 13:s=e.t2,this.syncSheetDataToWorker({dataType:w.g.ImportFormulaData,data:{data:s,requestId:a}}),e.next=21;break;case 17:e.prev=17,e.t3=e.catch(0),e.t3 instanceof d.ErrorVar||(0,g.NN_)(g.O6N.IMPORT_ERR_UNKNOWN,e.t3.message),this.syncSheetDataToWorker({dataType:w.g.ImportFormulaData,data:{data:[],requestId:t.requestId,error:e.t3}});case 21:case"end":return e.stop()}}),e,this,[[0,17]])}))),function(e){return o.apply(this,arguments)})},{key:"handleImportFormulaBlockRequest",value:(n=(0,a.Z)(i().mark((function e(t){var n,r,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=t.data,r=t.requestId,e.next=4,g.Ps3.serverApi.importFormula.requestImportFormulaBlock(n);case 4:o=e.sent,this.syncSheetDataToWorker({dataType:w.g.ImportFormulaBlock,data:{data:o,requestId:r}}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),this.syncSheetDataToWorker({dataType:w.g.ImportFormulaData,data:{data:[],requestId:t.requestId,error:e.t0}});case 11:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(e){return n.apply(this,arguments)})},{key:"handleImportFormulaRefreshRequest",value:function(e){try{var t=e.data;g.Ps3.serverApi.importFormula.requestImportFormulaRefresh(t)}catch(e){}}},{key:"receiveImportFormulaLabelInfo",value:function(e){var t=(0,g.zsn)(5),n=C.OM_.ImportFormulaPromiseMap,r=e.getRef().sheet().id(),o=e.getId();return this.syncSheetDataToWorker({dataType:w.g.ImportFormulaLabelInfo,data:{data:{sheetId:r,formulaId:o},requestId:t}}),new Promise((function(e,r){return n.set(t,[e,r])})).finally((function(){return n.delete(t)}))}},{key:"handleImportFormulaLabelInfo",value:(t=(0,a.Z)(i().mark((function e(t){var n,o,a,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.data,o=t.requestId,a=C.OM_.ImportFormulaPromiseMap,(s=a.get(o))&&(0,(0,r.Z)(s,1)[0])(n);case 4:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"updateImportRangeRelationship",value:function(e){var t=e.importRangeIds,n=e.formula2ImportRange,o=e.importRange2Formula,i=e.referenceNotExistIds,a=this.sdk.getPlugin(H.XT),s=this.sdk.spread.importRangeManagerV3,l=new Map;o.forEach((function(e){var n=(0,r.Z)(e,2),o=n[0],i=n[1];l.set(t[o],i)}));var u=[],c=null==a?void 0:a.labelInfos;c&&(Object.keys(c).forEach((function(e){var t=l.get(e);t?c[e].formulas=t:u.push(e)})),u.forEach((function(e){return delete c[e]}))),a&&(a.referenceNotExistIds.clear(),i.forEach((function(e){return a.referenceNotExistIds.add(t[e])}))),s.formula2ImportRange.clear(),n.forEach((function(e){var n=(0,r.Z)(e,2),o=n[0],i=n[1].map((function(e){return t[e]}));s.formula2ImportRange.set(o,new Set(i))}))}},{key:"destroy",value:function(){this.terminate(),this.tracker.destroy(),this.taskScheduler.destroy()}},{key:"sharedBufferService",get:function(){return this._sharedBufferService||(this._sharedBufferService=this.sdk.getService(_.B2)),this._sharedBufferService}}]),e}();function Q(e){return(0,h.re)(e,[e.buffer])}function ee(e){return function(t,n,r){var o=r.value;return r.value=function(){var t=arguments,n=this;this.taskScheduler.registerTask((function(){return o.apply(n,t)}),e)},r}}$([ee(C.kyt.ApplyCalculationResults)],X.prototype,"applyCalculationResultsImp",null),$([ee(C.kyt.UpdateConditionalFormatStyle)],X.prototype,"updateConditionalFormatStyleModel",null),$([ee(C.kyt.UpdateConditionalFormatStyle)],X.prototype,"collectConditionFormular",null),$([ee(C.kyt.ApplyCalculationResults)],X.prototype,"updateCalculateStatus",null),$([ee(C.kyt.CalculateConditionalFormatStyle)],X.prototype,"updateConditionalFormatCalculateStatus",null),$([ee()],X.prototype,"collectWorkerEvents",null),$([function(e,t,n){var r=n.value;return n.value=function e(t,n,o){var i=this,a=this.sdk.getService(y.ClJ);if(a.getConnectState().netState!==y.Giu.offline)r.call(this,t,n,o);else var s=a.subscribeChannelState((function(){s.unsubscribe(),e.call(i,t,n,o)}))},n}],X.prototype,"handleFetchAiRequest",null)},vsh_52656:function(e,t,n){n.d(t,{T7:function(){return r},GY:function(){return o},or:function(){return i},Z7:function(){return a},hA:function(){return s},I2:function(){return l},Vx:function(){return u},nN:function(){return c},u7:function(){return h},t2:function(){return d},Dy:function(){return f}});var r="CalculateAIStatusStore",o="".concat(r,"/addTaskNum"),i="".concat(r,"/completeTasks"),a="".concat(r,"/reset"),s="".concat(r,"/setPercentage"),l="".concat(r,"/setTime"),u="".concat(r,"/percentage"),c="".concat(r,"/time"),h="".concat(r,"/taskNums"),d="".concat(r,"/finishedTaskNums"),f={namespace:r,state:{taskNums:0,finishedTaskNums:0,percentage:100,statusTip:"",time:0},commit:{addTaskNum:function(e,t){0!==t&&(e.taskNums+=t,p(e,v(e)))},completeTasks:function(e,t){0!==e.taskNums&&0!==t&&(e.finishedTaskNums=Math.min(e.taskNums,e.finishedTaskNums+t),p(e,v(e)),e.finishedTaskNums===e.taskNums&&(e.finishedTaskNums=0,e.taskNums=0,e.percentage=100,e.time=0))},reset:function(e){e.taskNums=0,e.finishedTaskNums=0,e.statusTip="",e.percentage=100,e.time=0},setPercentage:function(e,t){0!==e.taskNums&&p(e,t)},setTime:function(e,t){e.time=t}}};function v(e){return Math.floor(100*e.finishedTaskNums/e.taskNums)}function p(e,t){e.percentage!==t&&(e.percentage=t)}},vsh_2902:function(e,t,n){n.d(t,{Pj:function(){return l},CQ:function(){return u},g:function(){return o},En:function(){return f},EH:function(){return v},f1:function(){return c},kg:function(){return h},Qs:function(){return d},k3:function(){return p}});var r,o,i=n("vsh_74561"),a=n("vsh_24627"),s=n("vsh_73043"),l="WorkerCalculatePlugin",u="ImportFormulaPlugin";!function(e){e[e.Snapshot=0]="Snapshot",e[e.SnapshotCommands=1]="SnapshotCommands",e[e.SubBlockCommands=2]="SubBlockCommands",e[e.Action=3]="Action",e[e.SubBlock=4]="SubBlock",e[e.FormulaCacheMeta=5]="FormulaCacheMeta",e[e.FormulaCache=6]="FormulaCache",e[e.ImportRangeData=7]="ImportRangeData",e[e.ImportRangeDataset=8]="ImportRangeDataset",e[e.ImportRangeDataHash=9]="ImportRangeDataHash",e[e.ImportRangeChange=10]="ImportRangeChange",e[e.ImportRangeRefresh=11]="ImportRangeRefresh",e[e.ImportRangeDataV3=12]="ImportRangeDataV3",e[e.ImportRangeRefreshV3=13]="ImportRangeRefreshV3",e[e.AiLongTimeTaskRefresh=14]="AiLongTimeTaskRefresh",e[e.AIFormulaReferDataChange=15]="AIFormulaReferDataChange",e[e.AIRequestResult=16]="AIRequestResult",e[e.ImportFormulaData=17]="ImportFormulaData",e[e.ImportFormulaBlock=18]="ImportFormulaBlock",e[e.ImportFormulaRefresh=19]="ImportFormulaRefresh",e[e.ImportFormulaServerData=20]="ImportFormulaServerData",e[e.ImportFormulaLabelInfo=21]="ImportFormulaLabelInfo",e[e.AIFormulasRetry=22]="AIFormulasRetry",e[e.TTI18N=23]="TTI18N",e[e.Authorization=24]="Authorization",e[e.PivotTableSnapshotChanged=25]="PivotTableSnapshotChanged",e[e.PivotTableSnapshot=26]="PivotTableSnapshot"}(o||(o={}));var c,h,d,f="client_sheet_worker_dev",v="sheet_web_worker_performance";!function(e){e.INIT="INIT",e.SYNC="SYNC",e.OPERATE="OPERATE"}(c||(c={})),function(e){e.FROM_JSON="FROM_JSON",e.APPLY_SUB_BLOCK="APPLY_SUB_BLOCK",e.APPLY_ACTIONS="APPLY_ACTIONS",e.APPLY_FORMULA_CACHE="APPLY_FORMULA_CACHE",e.APPLY_FORMULA_CACHE_META="APPLY_FORMULA_CACHE_META",e.APPLY_IMPORT_RANGE_DATASET="APPLY_IMPORT_RANGE_DATASET",e.APPLY_IMPORT_RANGE_DATA="APPLY_IMPORT_RANGE_DATA",e.APPLY_IMPORT_RANGE_CHANGE="APPLY_IMPORT_RANGE_CHANGE",e.APPLY_IMPORT_RANGE_DATAHASH="APPLY_IMPORT_RANGE_DATAHASH",e.APPLY_IMPORT_RANGE_REFRESH="APPLY_IMPORT_RANGE_REFRESH",e.APPLY_IMPORT_RANGE_REFRESH_V3="APPLY_IMPORT_RANGE_REFRESH_V3",e.APPLY_AI_FORMULAS_RETRY="APPLY_AI_FORMULAS_RETRY",e.PIVOT_DATA_VIEW_UPDATE="PIVOT_DATA_VIEW_UPDATE",e.PIVOT_TABLE_INFO_UPDATE="PIVOT_TABLE_INFO_UPDATE",e.PIVOT_TABLE_DELETE="PIVOT_TABLE_DELETE",e.SET_TTI18N="SET_TTI18N",e.APPLY_SNAPSHOT_COMMANDS="APPLY_SNAPSHOT_COMMANDS",e.APPLY_AI_LONG_TIME_TASK_REFRESH="APPLY_AI_LONG_TIME_TASK_REFRESH",e.APPLY_AI_FORMULA_REFER_DATA_CHANGE="APPLY_AI_FORMULA_REFER_DATA_CHANGE",e.PIVOT_TABLE_SNAPSHOT_CHANGED="PIVOT_TABLE_SNAPSHOT_CHANGED",e.REGISTER_PIVOT_PLUGIN_AFTER_TTU="REGISTER_PIVOT_PLUGIN_AFTER_TTU",e.PIVOT_TABLE_SNAPSHOT_FROM_JSON="PIVOT_TABLE_SNAPSHOT_FROM_JSON"}(h||(h={})),function(e){e.SUCCESS="success",e.FAIL="fail"}(d||(d={}));r={},(0,i.Z)(r,a.crM.TNS_AREA,(function(e){return s("LarkCCM_Docs_MyAI_UnavailRegion_aiName_Text",{aiName:e})})),(0,i.Z)(r,a.crM.TNS_BRAND,(function(e){return s("LarkCCM_Docs_MyAI_LogInToUse_aiName_Text",{aiName:e})})),(0,i.Z)(r,a.crM.TNS_OUTPUT,(function(){return s("LarkCCM_Sheets_MyAI_TryAnotherPrompt_Title")})),(0,i.Z)(r,a.crM.TNS_INPUT,(function(){return s("LarkCCM_Sheets_MyAI_TryAnotherPrompt_Title")}));var p=1e3},vsh_58054:function(e,t,n){var r;n.d(t,{u:function(){return r}}),function(e){e[e.LOAD_WORKSHEET=0]="LOAD_WORKSHEET",e[e.APPLY_CALCULATION_RESULTS=1]="APPLY_CALCULATION_RESULTS",e[e.UPDATE_CALCULATE_STATUS=2]="UPDATE_CALCULATE_STATUS",e[e.RECEIVE_IMPORTRANGE_DATASET_REQUEST=3]="RECEIVE_IMPORTRANGE_DATASET_REQUEST",e[e.RECEIVE_IMPORTRANGE_DATA_REQUEST=4]="RECEIVE_IMPORTRANGE_DATA_REQUEST",e[e.UPDATE_CONDITIONAL_FORMAT_STYLE=5]="UPDATE_CONDITIONAL_FORMAT_STYLE",e[e.COLLECT_EVENTS=6]="COLLECT_EVENTS",e[e.REPORT_ERROR=7]="REPORT_ERROR",e[e.CRITICAL_ERROR=8]="CRITICAL_ERROR",e[e.CLEAR_CONDITIONAL_FORMAT_STYLE=9]="CLEAR_CONDITIONAL_FORMAT_STYLE",e[e.RECEIVE_IMPORTRANGE_DATAHASH_REQUEST=10]="RECEIVE_IMPORTRANGE_DATAHASH_REQUEST",e[e.RECEIVE_IMPORTRANGE_REFRESH=11]="RECEIVE_IMPORTRANGE_REFRESH",e[e.Fetch_AI_REQUEST=12]="Fetch_AI_REQUEST",e[e.RESET_OPERATE_ID=13]="RESET_OPERATE_ID",e[e.FETCH_IMPORTFORMULA_DATA=14]="FETCH_IMPORTFORMULA_DATA",e[e.FETCH_IMPORTFORMULA_BLOCK=15]="FETCH_IMPORTFORMULA_BLOCK",e[e.FETCH_IMPORTFORMULA_REFRESH=16]="FETCH_IMPORTFORMULA_REFRESH",e[e.RECEIVE_IMPORTFORMULA_REFRESH=17]="RECEIVE_IMPORTFORMULA_REFRESH",e[e.UPDATE_IMPORTFORMULA_LABEL_INFO=18]="UPDATE_IMPORTFORMULA_LABEL_INFO",e[e.UPDATE_ARRAYFORMULA_TIPS_STATUS=19]="UPDATE_ARRAYFORMULA_TIPS_STATUS",e[e.UPDATE_CONDTIONAL_FORMAT_CALCULATE_STATUS=20]="UPDATE_CONDTIONAL_FORMAT_CALCULATE_STATUS",e[e.COLLECT_PIVOT_TABLE_EVENTS=21]="COLLECT_PIVOT_TABLE_EVENTS",e[e.APPLY_PIVOT_CACHE_RESULT=22]="APPLY_PIVOT_CACHE_RESULT",e[e.APPLY_PIVOT_CACHE_STATUS=23]="APPLY_PIVOT_CACHE_STATUS",e[e.UPDATE_AI_REQUEST_MANAGER_CALCULATE_STATUS=24]="UPDATE_AI_REQUEST_MANAGER_CALCULATE_STATUS",e[e.FETCH_IMPORTRANGE_DATA_V3=25]="FETCH_IMPORTRANGE_DATA_V3",e[e.UPDATE_IMPORTRANGE_RELATIONSHIP=26]="UPDATE_IMPORTRANGE_RELATIONSHIP",e[e.COLLECT_CONDITIONAL_FORMAT=27]="COLLECT_CONDITIONAL_FORMAT"}(r||(r={}))},vsh_20327:function(e,t,n){n.d(t,{cm:function(){return i},l3:function(){return a}});var r=n("vsh_58054"),o=function(e,t,n){self.postMessage({type:e,data:t,time:n})};function i(e){o(r.u.UPDATE_CONDTIONAL_FORMAT_CALCULATE_STATUS,e)}function a(e){o(r.u.UPDATE_AI_REQUEST_MANAGER_CALCULATE_STATUS,e)}},vsh_86217:function(e,t,n){n.d(t,{n:function(){return r},b:function(){return i}});var r,o=n("vsh_24627");function i(){return function(e){o.Ps3.collectSuiteEvent("client_sheet_path_tracker_dev",e)}}!function(e){e.SheetPathTracker="SheetPathTracker"}(r||(r={}))},vsh_36290:function(e,t,n){n.d(t,{OG:function(){return c},OA:function(){return d}});var r=n("vsh_19264"),o=n("vsh_4175"),i=n("vsh_65498"),a=n("vsh_4561"),s=n("vsh_22392"),l=n("vsh_99520"),u=function(e,t,n,r){var o,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":(0,i.Z)(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(s=(a<3?o(s):a>3?o(t,n,s):o(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s},c="ui-notifier",h={Toast:{show:a.default,remove:a.default},Modal:{show:a.default}},d=function(){function e(){(0,r.Z)(this,e),this.notifier=h}return(0,o.Z)(e,[{key:"setNotifier",value:function(e,t){this.notifier=e,this.domToast=t}},{key:"destroy",value:function(){this.notifier=h,this.domToast=void 0}},{key:"Toast",get:function(){return this.notifier.Toast}},{key:"Modal",get:function(){return this.notifier.Modal}},{key:"DomToast",get:function(){return this.domToast||this.Toast}}]),e}();u([(0,s.P)()],d.prototype,"destroy",null),d=u([(0,l.b)()],d)},vsh_32613:function(e,t,n){n.d(t,{Ak:function(){return r},rW:function(){return h},Jn:function(){return d}});var r,o,i=n("vsh_94753"),a=n("vsh_10002"),s=n("vsh_95096"),l=n("vsh_85585"),u=n("vsh_50488"),c=n("vsh_14795");!function(e){e.Table="table",e.CodeBlock="codeBlock",e.CalloutBlock="calloutBlock",e.Default="default"}(r||(r={})),function(e){e.ZoneId="zoneId",e.ZoneType="zoneType"}(o||(o={}));var h=[{key:i.d.KEY,shortcut:{windows:{keyCode:66,ctrlKey:!0},mac:{metaKey:!0,keyCode:66}}},{key:a.T.KEY,shortcut:{windows:{keyCode:73,ctrlKey:!0},mac:{keyCode:73,metaKey:!0}}},{key:s.v.KEY,shortcut:{windows:{keyCode:85,ctrlKey:!0},mac:{keyCode:85,metaKey:!0}}},{key:l.n.KEY,shortcut:{windows:{keyCode:88,ctrlKey:!0,shiftKey:!0},mac:{keyCode:88,metaKey:!0,shiftKey:!0}}},{key:c.$l,shortcut:{windows:{ctrlKey:!0,keyCode:90},mac:{metaKey:!0,keyCode:90}}},{key:c.zq,shortcut:[{windows:{ctrlKey:!0,keyCode:90,shiftKey:!0},mac:{metaKey:!0,keyCode:90,shiftKey:!0}},{windows:{ctrlKey:!0,keyCode:89},mac:{metaKey:!0,keyCode:89}}]},{key:u.x.KEY,value:"left",shortcut:{windows:{shiftKey:!0,ctrlKey:!0,keyCode:76},mac:{metaKey:!0,shiftKey:!0,keyCode:76}}},{key:u.x.KEY,value:"center",shortcut:{windows:{shiftKey:!0,ctrlKey:!0,keyCode:69},mac:{metaKey:!0,shiftKey:!0,keyCode:69}}},{key:u.x.KEY,value:"right",shortcut:{windows:{shiftKey:!0,ctrlKey:!0,keyCode:82},mac:{metaKey:!0,shiftKey:!0,keyCode:82}}}],d=["--B400-BG","--B500","--primary-content-default","--primary-fill-solid-02","--function-info-fill-default"]},vsh_20770:function(e,t,n){n.d(t,{BV:function(){return i},Mc:function(){return a},JC:function(){return r},wy:function(){return r},HL:function(){return s},E5:function(){return l}});var r,o,i="undo",a="redo";!function(e){e[e.USER=0]="USER",e[e.DOC=1]="DOC",e[e.FILE=1]="FILE",e[e.FOLDER=2]="FOLDER",e[e.SHEET=3]="SHEET",e[e.SHEET_DOC=4]="SHEET_DOC",e[e.CHAT=5]="CHAT",e[e.GROUP=6]="GROUP",e[e.BLOCK=7]="BLOCK",e[e.BITABLE=8]="BITABLE",e[e.TABLE=9]="TABLE",e[e.INLINE_BLOCK=10]="INLINE_BLOCK",e[e.MINDNOTE=11]="MINDNOTE",e[e.BOX=12]="BOX",e[e.SLIDE=15]="SLIDE",e[e.WIKI=16]="WIKI",e[e.GRID=17]="GRID",e[e.KANBAN=18]="KANBAN",e[e.JIRA_FILTER=19]="JIRA_FILTER",e[e.DOCX=22]="DOCX",e[e.SLIDES=30]="SLIDES",e[e.WHITE_BOARD=38]="WHITE_BOARD",e[e.CATALOG=111]="CATALOG",e[e.UNKNOWN=112]="UNKNOWN"}(r||(r={})),function(e){e[e.DOC=0]="DOC",e[e.DOC_COMMENT=1]="DOC_COMMENT",e[e.SHEET=2]="SHEET",e[e.SHEET_COMMENT=3]="SHEET_COMMENT",e[e.BITABLE=4]="BITABLE",e[e.OPEN_DOC=6]="OPEN_DOC",e[e.BOX_COMMENT=9]="BOX_COMMENT",e[e.MINDNOTE=10]="MINDNOTE",e[e.MINDNOTE_COMMENT=11]="MINDNOTE_COMMENT",e[e.DOCX=22]="DOCX",e[e.SLIDES=30]="SLIDES",e[e.WHITE_BOARD=38]="WHITE_BOARD"}(o||(o={}));var s=320,l=520},vsh_47006:function(e,t,n){n.d(t,{M:function(){return D}});var r,o,i=n("vsh_19264"),a=n("vsh_4175"),s=n("vsh_12064"),l=n("vsh_22462"),u=n("vsh_93035"),c=n("vsh_73455"),h=n("vsh_74561"),d=n("vsh_75119"),f=n("vsh_34859"),v=n("vsh_45110"),p=n("vsh_48096"),g=n("vsh_4268"),m=n("vsh_36569"),_=n("vsh_14795"),y=n("vsh_99568"),C=n("vsh_85351"),S=n("vsh_10014"),k=n("vsh_37075"),E=n("vsh_40285"),T=n("vsh_24627"),b=function(){function e(){(0,i.Z)(this,e)}return(0,a.Z)(e,[{key:"getData",value:function(e,t){return T.Ps3.clipboardManager.getDataSynchronization(e,[t])[t]||""}},{key:"setData",value:function(e,t,n){T.Ps3.clipboardManager.setData(e,t,n)}},{key:"getTypes",value:function(e){return e.types}}]),e}(),I=(n("vsh_93920"),n("vsh_69691"));function R(){return R=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},R.apply(this,arguments)}var w=new f.V((r={bold:{mark:!0},italic:{mark:!0},underline:{mark:!0},strikethrough:{mark:!0},"comment-.*":{mark:!0},backcolor:{mark:!0},"at-holder":{mark:!0},"at-uuid_.*":{mark:!0},"clientside-mention-placeholder":{mark:!0},"inline-code":{mark:!0,tailInherit:!1},"url-.*":{mark:!0,tailInherit:!1,refresh:!0},removeLink:{mark:!0},"horizontal-line":{displayEnter:!1},textcolor:{mark:!0}},(0,h.Z)(r,T.Psm.FontSize,{mark:!0}),(0,h.Z)(r,T.Psm.FontFamily,{mark:!0}),(0,h.Z)(r,T.Psm.FormulaColor,{mark:!0}),r)),A=(o={},(0,h.Z)(o,v.h.ContentState,p.M),(0,h.Z)(o,v.h.Range,g.e),(0,h.Z)(o,v.h.ZoneState,m.i),(0,h.Z)(o,v.h.UndoModule,_.j0),(0,h.Z)(o,v.h.InputModel,y.g),o),F=new k.D({0:new E.I({zoneId:"0",ops:[{insert:"\n"}]})}),D=function(e){function t(){var e;return(0,i.Z)(this,t),(e=(0,s.Z)(this,(0,l.Z)(t).apply(this,arguments))).style=Object.assign({fontFamily:'LarkHackSafariFont, LarkEmojiFont, LarkChineseQuote, BlinkMacSystemFont, "Helvetica Neue", Tahoma, "PingFang SC", "Microsoft Yahei", Arial, "Hiragino Sans GB", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji"'},e.props.style),e.setStyle=function(t){e.$context.destroyed||(e.style=Object.assign({},e.style||{},t),e.forceUpdate())},e.onInit=function(t){var n,r;null===(r=(n=e.props).onInit)||void 0===r||r.call(n,t,e.setStyle.bind((0,u.Z)(e))),I.browser.mobile&&!I.browser.isBytedanceApp&&e.$context.on(d.FP.PAINT,e.correctHeight)},e.correctHeight=function(){var t,n;if(null===(t=e.$context.canvas)||void 0===t?void 0:t.style.height){var r="".concat(Math.ceil(parseFloat(e.$context.canvas.style.height)),"px");e.$context.canvas.style.height=r;var o=null===(n=e.$context.container)||void 0===n?void 0:n.querySelector(".roadster-placeholder");if(o){var i="".concat(Math.ceil(parseFloat(o.style.height)),"px");o.style.height=i}}},e}return(0,c.Z)(t,e),(0,a.Z)(t,[{key:"componentWillUnmount",value:function(){I.browser.mobile&&!I.browser.isBytedanceApp&&this.$context.off(d.FP.PAINT,this.correctHeight)}},{key:"render",value:function(){var e=this.props,t=e.schema,n=e.isInline;return(0,d.az)(S.P,R({},this.props,{proxyClipboard:new b,onInit:this.onInit,modules:A,initData:F,style:this.style,isInline:null==n||n,editable:!0,copyable:!0,isFocusAllArea:!0,log:function(){},businessKey:"lark-sheet",tagsIgnoreToParse:{table:!0},cursorColor:this.style.fontColor||"var(--text-title)",domPurifyConfig:{enable:!0,config:{WHOLE_DOCUMENT:!0,FORCE_BODY:!0,ADD_URI_SAFE_ATTR:["xmlns:o","xmlns:x","xmlns:w"],ADD_TAGS:["meta","google-sheets-html-origin","byte-sheet-html-origin","melo-data","mention","highlight"],ADD_ATTR:["sheet-word-wrap","xmlns:o","xmlns:x","xmlns:w"],FORBID_TAGS:["noscript"],KEEP_CONTENT:!1}},listenEvents:C.Cn,schema:t||w}))}}]),t}(d.wA)},vsh_70257:function(e,t,n){n.d(t,{O:function(){return a}});var r=n("vsh_2184"),o=n("vsh_24627"),i=n("vsh_20680");function a(e,t){var n=e.keyCode,a=o.Ps3.browser.isMac;if((0,i.aK)(e,t))return!1;if(0!==n){var s=n===o.VDZ.Enter;if(e.shiftKey&&s)return!1;if(a){if(e.metaKey||e.ctrlKey)return s;if(e.shiftKey&&e.altKey)return!1;if(e.altKey)return function(e){var t=e.keyCode,n=[function(){return t>=o.VDZ.A&&t<=o.VDZ.Z},function(){return t>=o.VDZ.Digit0&&t<=o.VDZ.Digit9},function(){return t>=o.VDZ.Semicolon&&t<=o.VDZ.Quot},function(){return t>=o.VDZ.Numpad0&&t<=o.VDZ.Numpad9},function(){return t===o.VDZ.Enter}];return(0,r.Z)(n,(function(e){return e()}))}(e)}else{if(e.altKey||e.ctrlKey)return s;if(e.metaKey)return!1}var l=[function(){return n>=o.VDZ.A&&n<=o.VDZ.Z},function(){return n>=o.VDZ.Digit0&&n<=o.VDZ.Digit9},function(){return n>=o.VDZ.Numpad0&&n<=o.VDZ.Slash},function(){return n>=o.VDZ.Semicolon&&n<=o.VDZ.Grave},function(){return n>=o.VDZ.Bracket&&n<=o.VDZ.Quot},function(){return n===o.VDZ.Space||n===o.VDZ.FirefoxEquals||n===o.VDZ.FirefoxMinus},function(){return(n===o.VDZ.Ime||0===n)&&"Shift"!==e.key}];return(0,r.Z)(l,(function(e){return e()}))}}},vsh_24480:function(e,t,n){n.d(t,{L:function(){return a}});var r=n("vsh_24627"),o=n("vsh_11725");function i(e,t){return"en"===t?e.en_name||e.name||e.cn_name:e.name||e.cn_name||e.en_name}function a(e,t){for(var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=e.getOps(),i="",a=0;a<r.length;a++){var l=r[a];if(l.attributes){if(n&&null!=l.attributes.lmkr)continue;if((0,o.zz)(l.attributes)){var u=(0,o.ro)(l.attributes);i+=s(u,t);continue}}i+=l.insert}return i}function s(e,t){var n;if(null!=e&&null!==(n=e.props)&&void 0!==n&&n.data)switch(e.blockType){case r.kHU.AT_USER_BLOCK:return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"en",n=e.data.user;return"@".concat(i(n,t))}(e.props,t.parent.getUserLanguage());case r.kHU.LINK_BLOCK:return e.props.data.title;case r.kHU.FILE_CARD_BLOCK:return function(e){return e.data.fileInfo.name}(e.props)}return"[Block]"}},vsh_63992:function(e,t,n){n.d(t,{p:function(){return o}});var r=n("vsh_24480");function o(e,t){for(var n=e.length(),o=[],i=0;i<n;i++){var a=e.getLine(i);if(a){var s=(0,r.L)(a,t);s=s.replace(/\u000A/g,""),o.push(s)}}return o.join("\n").replace(/\u200B/g,"").replace(/\u00A0/g," ")}},vsh_78325:function(e,t,n){n.d(t,{Vt:function(){return a},mc:function(){return s}});var r=n("vsh_4268"),o=n("vsh_32613"),i=n("vsh_24627");n("vsh_24480");function a(e,t){return!(!e||!t)&&r.e.isRangeEqual(e,t)}function s(e){var t=e.action,n=e.op,r=e.source,a=e.eventType,s=e.target,l=e.objectType,u=e.opItem,c=e.extraParams,h=void 0===c?{}:c,d="Caret"===getSelection().type,f=window.getSelection().anchorNode||s;i.Ps3.collectSuiteEvent("toggle_attribute",Object.assign({action:t,source:r||"shortKey",eventType:a||"keydown",attr_op_status:n||"",targetId:f&&f.id||"",targetClass:f&&f.className||"",is_cursor:d.toString(),zone:o.Ak.Default,object_type:l,op_item:u||""},h))}},vsh_9812:function(e,t,n){n.d(t,{Y:function(){return o},p:function(){return r}});var r,o="sheet";!function(e){e.HyperLinks="HyperLinks",e.Mention="Mention",e.CommonMention="CommonMention",e.Undo="Undo",e.Redo="Redo",e.Indent="Indent",e.LinkToBlock="LinkToBlock",e.Bold="Bold",e.Italic="Italic",e.Underline="Underline",e.Strikethrough="Strikethrough",e.HighlightColor="HighlightColor",e.HighlightAdaptor="HighlightAdaptor",e.BlockExternalServices="BlockExternalServices",e.BlockInstance="BlockInstance",e.FontSize="FontSize",e.FontFamily="FontFamily",e.PasteStyleInherit="PasteStyleInherit",e.CopyCutHandler="CopyCutHandler",e.HyperlinkBackground="HyperlinkBackground",e.FormulaColor="FormulaColor",e.FormulaHighlight="FormulaHighlight",e.SheetValueHandler="SheetValueHandler",e.TextNodeDeserializer="TextNodeDeserializer",e.TextPlaceholder="TextPlaceholder",e.BlockElementNodeDeserializer="BlockElementNodeDeserializer",e.BlockPlugin="BlockPlugin",e.Highlight="Highlight",e.FileCard="FileCard",e.Link="Link",e.KeyboardShortcuts="KeyboardShortcuts",e.TooltipMenu="TooltipMenu",e.BlankLine="BlankLine"}(r||(r={}))},vsh_30856:function(e,t,n){n.d(t,{MC:function(){return S},j5:function(){return I},A6:function(){return T.A6},Cf:function(){return c},CH:function(){return A},LK:function(){return f},Lx:function(){return k},nW:function(){return y},jE:function(){return p},HH:function(){return E}});var r=n("vsh_24627"),o=n("vsh_29207");function i(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){l=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(l)throw i}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var s,l,u="client_performance_command",c={key:u,track:function(e){var t=e.getData,n=e.cleanData,a=e.reporter;(t(u)||[]).forEach((function(e){var t=e.sheet,n=0,s=0;if(t){var l=t.getSelections();if(Array.isArray(l)){var c,h=i(l.values());try{for(h.s();!(c=h.n()).done;){var d=c.value;n+=d.rowCount()*d.colCount()}}catch(e){h.e(e)}finally{h.f()}}if(e.commandName===r.rvF.FILL)s=t.getSelections().reduce((function(e,n){return e+t.getFormulaCountByRange(n)}),0)}var f=Object.assign({time_cost:e.rangeTime,command_name:e.commandName,selected_cell_count:n,selection_formula_count:s,changeset_count:e.changesets.length,executeType:e.executeType},e),v=(0,o.i5)(t);a.collectSheetEvent(u,Object.assign({},f,{},v))})),n(u)}};!function(e){e.DOC_IMAGE="doc_image",e.DRIVE_IMAGE="drive_image"}(s||(s={})),function(e){e.RESOLVED="resolved",e.REJECTED="rejected"}(l||(l={}));var h,d="sheet_image_monitor",f=Object.keys(s).map((function(e){var t=s[e];return{key:t,track:function(e){var n=e.getData,r=e.cleanData,o=e.reporter,i=n(t)||[],a=0,s=0,u=0;i.forEach((function(e){e.status===l.RESOLVED&&(s+=e.timeCost,++a),e.status===l.REJECTED&&(++u,o.captureException(e.ex,{key:d,tags:{scm:JSON.stringify(window.scm),key:"SHEET_".concat(t.toUpperCase(),"_LOAD_FAIL")}}))})),0!==a&&o.collectSheetEvent(d,{status:l.RESOLVED,image_type:t,count:a,total_time_cost:s}),0!==u&&o.collectSheetEvent(d,{status:l.REJECTED,image_type:t,count:u}),r(t)}}}));!function(e){e.COLLECT_SNAPSIZE="collect_snapsize",e.COLLECT_SHEET_INFO="collect_sheet_info"}(h||(h={}));var v,p={key:h.COLLECT_SHEET_INFO,track:function(e){var t=e.getData,n=e.cleanData,o=e.reporter,i=t(h.COLLECT_SNAPSIZE)||[],a=t(h.COLLECT_SHEET_INFO)||[],s=i[i.length-1];s&&a.forEach((function(e){var t=0,i=0,a=s,l=e.snapshot.sheets;if(l){for(var u in l){var c=l[u];!c.externalResource&&c.blocks&&(void 0!==c.rowCount&&void 0!==c.columnCount&&(t++,i+=c.rowCount*c.columnCount,c.blocks.forEach((function(e){e.size&&(a+=e.size)}))))}o.eventReport({key:"collect_sheet_info",stage:"init",sheetNum:t,dataSize:(0,r.SSR)(a),sheetCellNum:i}),n(h.COLLECT_SHEET_INFO)}}))}},g=n("vsh_46775"),m={},_=!0;var y=function(){_=!1,m={}},C=function(){return _?"reload":"router"},S=[r.FHD.DOWNLOAD_RESOURCE,r.FHD.RENDER_SHEET_PAGE,r.FHD.LOAD_SHEET_PAGE,r.FHD.TIME_TO_USAGE,r.FHD.TOOLBAR_TIME_TO_USAGE,r.FHD.EDITOR_TIME_TO_USAGE,r.FHD.WINDOW_LOADED,r.FHD.PIVOT_TABLE_FIRST_RENDER],k=function(){var e,t,n=(null===(e=(t=performance).getEntriesByType)||void 0===e?void 0:e.call(t,"navigation"))||[];if(n.length>0&&_){var r=n[0].fetchStart;v=r}else v=performance.now()},E=Object.keys(r.FHD).map((function(e){var t=r.FHD[e];return{key:t,track:function(e){var n=e.getData,i=e.cleanData,a=e.reporter,s=S.includes(t),l=t===r.FHD.DOWNLOAD_RESOURCE,u=t===r.FHD.STAGE_PENDING;(n(t)||[]).forEach((function(e){var n="";if(e.transactionId?n="_".concat(e.transactionId):u&&(n="pending_".concat(e.start_stage,"_").concat(e.next_stage)),e){e.isSheetGarrEnable=1;var i=window,c=(0,o.i5)(e.sheet);if(s)if(r.Ps3.browser.isMobile){if(l&&(!i.renderStartTS||!i.tapVisitStartTS))return;e.open_from=i.renderStartTS-i.tapVisitStartTS>=500?"reload":"router"}else e.open_from=C();if(e.status===r.G2P.START){var h=e.nowTime;(s||l)&&(console.log("isRenderPageEvent",r.Ps3.browser.isMobile,i.tapVisitStartTS),h=r.Ps3.browser.isMobile&&i.tapVisitStartTS?i.tapVisitStartTS:v||e.nowTime),m["".concat(t,"_start").concat(n)]={startTime:h,startJsHeap:e.jsHeap}}else if(e.status===r.G2P.END||e.status===r.G2P.ERROR){var d,f,p=e.status===r.G2P.END?"success":"error",_=null===(d=m["".concat(t,"_start").concat(n)])||void 0===d?void 0:d.startTime,y=null===(f=m["".concat(t,"_start").concat(n)])||void 0===f?void 0:f.startJsHeap;if(_){var S=Math.round(e.nowTime-_);S=e.costTime?e.costTime:l&&i.tapVisitStartTS&&i.renderStartTS?i.renderStartTS-i.tapVisitStartTS:S,s&&(e.total_time_cost=Math.round(e.nowTime-v),window.sheet_stage_cost_time=window.sheet_stage_cost_time||{},window.sheet_stage_cost_time[t]=S);var k=Object.assign({stage:t,type:p,time_cost:S},e,{},c);if(a.collectSheetEvent("sheet_performance_stage",k),(0,g.default)(e.afterSend)&&e.afterSend(k),"error"===p&&console.info("[SHEET LOG] render-node-log: ".concat(t," error")),y){var E=e.jsHeap.totalJSHeapSize-y.totalJSHeapSize,T=e.jsHeap.usedJSHeapSize-y.usedJSHeapSize;a.collectSheetEvent("sheet_performance_memory",Object.assign({scene_name:t,duration:S,totalJSHeapSizeDelta:E,usedJSHeapSizeDelta:T,totalJSHeapSize:e.jsHeap.totalJSHeapSize,usedJSHeapSize:e.jsHeap.usedJSHeapSize},e,{},c))}delete m["".concat(t,"_start").concat(n)]}}}})),i(t)}}})),T=n("vsh_17444"),b=n("vsh_69691"),I={},R={};function w(e,t,n,o){if(e===(I=r.Ps3.sheetLoadMainStageDurationListKey).INDEX_DB_CHECK&&(R.hasLocalCs=o.hasLocalCs,R.localCheckCost=o.localCheckCost,R.localRevCheckCost=o.localRevCheckCost),e===I.TOOLBAR_RENDER_END){var i=n.getStageData(b.FILE_TYPE.SHEET),a=window,s=C(),l="reload"===s?{first_chunk_end:a.firstChunkEndTime,second_chunk_end:a.secondChunkEndTime,third_chunk_end:a.thirdChunkEndTime}:{},u=Object.assign({},l,{ttfb:i[I.RESPONSE_START],html_download_end:i[I.HTML_DOWNLOAD_END],html_parse_end:i[I.HTML_PARSE_END],time_to_visit:i[I.RENDER_FILE_ALLOW_VIEW],app_js_after_import:i[I.APP_JS_AFTER_IMPORT],app_js_exec_end:i[I.APP_JS_EXEC_END],index_exec:i[I.GARR_INDEX_EXEC_START],fetch_clientvars_start:i[I.FETCH_FILE_CLIENTVARS_START],fetch_clientvars_success:i[I.FETCH_FILE_CLIENTVARS_SUCCESS],apply_clientvars_start:i[I.APPLY_FILE_CLIENTVARS_START],apply_clientvars_success:i[I.APPLY_FILE_CLIENTVARS_SUCCESS],fetch_sub_block_start:i[I.FETCH_SUB_BLOCK_START],fetch_sub_block_success:i[I.FETCH_SUB_BLOCK_SUCCESS],apply_sub_block_start:i[I.APPLY_SUB_BLOCK_START],apply_sub_block_success:i[I.APPLY_SUB_BLOCK_SUCCESS],time_to_usage:i[I.RENDER_FILE_ALLOW_EDIT],toolbar_start_load:i[I.TOOLBAR_START_LOAD],toolbar_time_to_usage:i[I.TOOLBAR_RENDER_END],editor_start_load:i[I.EDITOR_START_LOAD],editor_time_to_usage:i[I.EDITOR_INIT]}),c=v+performance.timing.requestStart,h=Object.keys(u).reduce((function(e,t){var n=u[t]?u[t]-c:void 0;return e[t]=n,e}),{});t.collectSheetEvent("sheet_loading_performance",Object.assign({},h,{},o,{},t.getSpreadCommonOptions(),{},R,{open_from:s})),R={}}}function A(e){return I=r.Ps3.sheetLoadMainStageDurationListKey,Object.keys(r.Ps3.sheetLoadMainStageDurationListKey).map((function(t){return{key:t,track:function(n){var r=n.getData,o=n.reporter,i=r(t);if(i.length){var a=i.pop()||{};e.updateLoadMainStageDurationList(b.FILE_TYPE.SHEET,t,a.time),w(t,o,e,a)}}}}))}},vsh_17444:function(e,t,n){n.d(t,{A6:function(){return i},n_:function(){return a}});var r=n("vsh_69691"),o=Object.keys(r.SHEET_RENDER_STAGE),i=o.reduce((function(e,t){return e[t]=t,e}),{});function a(e){return o.map((function(t){return{key:t,track:function(n){var o=n.getData;n.cleanData;o(t).length&&e.updateStage(r.SHEET_RENDER_STAGE[t],r.FILE_TYPE.SHEET)}}}))}},vsh_29207:function(e,t,n){n.d(t,{i5:function(){return l},V:function(){return u}});var r=n("vsh_89443"),o=n("vsh_24627"),i=n("vsh_83836");function a(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){l=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(l)throw i}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function l(e){if(e){var t=0,n=0,a=0,s=0,l=0,u=0,c=0,h=0,d=0,f=0,v=0,p=0,g=0,m=0,_=0,y=o.Ps3.getCpuPerformance(),C=y.timeCost,S=y.estimatedSpeed;if(e){var k=e.sheetFilterModel.getFilterRange();k&&(s=k.rowCount*k.colCount),l=e._getSpanModel().length,p=e.conditionalFormatModel.getAllRules().length>0?1:0,g=(d=Object.keys(e.getChartMap()).length+Object.values(e.floatBlocksModel.getFloatBlocksMap()).filter((function(e){return e.blockType===i.kH.CHART})).length)>0?1:0,f=Object.keys(e.floatImageModel.getFloatImageMap()).length,v=e.getAllComments().length,a=(t=e.getRowCount())*(n=e.getColumnCount()),h=e.getValidationRefCount(),u=e.getCalcEngine().formulaSpace.formulas.size,c=e.getCalcEngine().formulaRefManager.getNodeCount(),_=(0,o.TvB)(e.parent);var E=e.embeddedBlocksModel.getBlocksMap();(0,r.Z)(E)&&(m=Object.keys(E).length)}return{row_count:t,col_count:n,cell_count:a,span_count:l,filter_cell_count:s,formula_count:u,aggregate_count:c,validation_ref_count:h,has_condition:p,has_chart:g,chart_count:d,sheet_pivot_table_count:m,spread_pivot_table_count:_,has_pivot_table:_>0?1:0,float_image_count:f,comment_count:v,timeCostCpu:C,estimatedSpeed:S,is_chunk_render:window.isChunkedRender?1:0}}}function u(e,t,n){if(!e)return{};var r=t?e.getSheetFromId(t):e.getActiveSheet();if(!r)return{};var o,i={row_count:0,col_count:0,cell_count:0,span_count:0,filter_cell_count:0,formula_count:0,validation_ref_count:0,typography_cache_size:0,chart_count:0,float_image_count:0,comment_count:0,total_float_image_count:0,total_comment_count:0,total_validation_ref_count:0,total_span_count:0,total_cell_count:0,total_chart_count:0,total_formula_count:0,using_worker:n,tab_count:e.sheets.length},s=a(e.sheets);try{for(s.s();!(o=s.n()).done;){var u=o.value,c=l(u);c&&u.id()===r.id()&&(i.row_count=c.row_count,i.col_count=c.col_count,i.cell_count=c.cell_count,i.span_count=c.span_count,i.filter_cell_count=c.filter_cell_count,i.formula_count=c.formula_count,i.validation_ref_count=c.validation_ref_count,i.chart_count=c.chart_count,i.float_image_count=c.float_image_count,i.comment_count=c.comment_count),c&&(i.total_cell_count+=c.cell_count,i.total_chart_count+=c.chart_count,i.total_comment_count+=c.comment_count,i.total_float_image_count+=c.float_image_count,i.total_span_count+=c.span_count,i.total_formula_count+=c.formula_count,i.total_validation_ref_count+=c.validation_ref_count)}}catch(e){s.e(e)}finally{s.f()}return i}},vsh_36009:function(e,t,n){n.d(t,{V5:function(){return a},tq:function(){return s},i7:function(){return l},w1:function(){return u},qz:function(){return c},Dc:function(){return h},gp:function(){return d},DE:function(){return v},Eo:function(){return p},Cr:function(){return m}});var r=n("vsh_77034"),o=n.n(r),i=n("vsh_24627"),a=o().mac,s=o().mobile,l=o().chrome||o().chromeos||o().chromium,u=o().msie||o().msedge;function c(e){return 0===e.filter((function(e){return-1!==e.col&&-1!==e.row})).length}function h(e,t){if(0===t)return[[]];for(var n=[],r=0,o=-1;r<e.length;r++)r%t==0&&(n[++o]=[]),n[o].push(e[r]);return n}function d(e){var t=document.createElement("div");return t.style.position="absolute",t.style.left="-10000px",t.style.top="-10000px",t.id=e,t.textContent="copy fail",document.body.appendChild(t),t.contentEditable="true",function(e){var t=document.createRange();t.selectNodeContents(e);var n=window.getSelection();n&&(n&&n.removeAllRanges(),n&&n.addRange(t))}(t),{destory:function(){t&&(document.body.removeChild(t),t=null)}}}var f=document.createElement("canvas");function v(e,t){if(!e)return 0;var n=0;return e.forEach((function(e){var r=function(e,t){var n=f.getContext("2d");return n?(n.font=t,n.measureText(e).width):12*e.length}(e,t);r>n&&(n=r)})),n}function p(e,t){i.Ps3.Toast.show({key:t,type:"error",content:e,duration:2e3})}var g=document.createElement("a");function m(e,t){try{g.href=e,g.setAttribute("download",t),g.click()}catch(e){console.log(e)}}},vsh_46544:function(e,t,n){n.d(t,{Xg:function(){return Pn},HE:function(){return Vn},N6:function(){return Nn},V$:function(){return ze},Gg:function(){return nt},_n:function(){return ue},Pt:function(){return Q},PQ:function(){return lr},kG:function(){return ar},S0:function(){return sr},Ri:function(){return X},mA:function(){return he},Re:function(){return Ye},lm:function(){return Ae},zA:function(){return Xe},lL:function(){return we},XD:function(){return er},gJ:function(){return it},Cy:function(){return at},lY:function(){return ut},MS:function(){return st},hr:function(){return dr},tc:function(){return hr},wG:function(){return _r},lQ:function(){return mr},LZ:function(){return Qe},J6:function(){return cn},WY:function(){return et},GY:function(){return zn},Hw:function(){return nn},i9:function(){return pt},WH:function(){return Ee},G3:function(){return cr},H8:function(){return ur},qq:function(){return Ue},dx:function(){return We},wM:function(){return Ze},C1:function(){return Be},uM:function(){return je},nb:function(){return Ke},iw:function(){return Ge},yU:function(){return He},yz:function(){return Le},fF:function(){return ae},Av:function(){return qn},TG:function(){return vt},G4:function(){return Tt},Yt:function(){return Se},Je:function(){return Ce},J$:function(){return ke},Zw:function(){return Ct},lH:function(){return Xn},Ux:function(){return Xt},Rc:function(){return kt},Bg:function(){return $n},pz:function(){return Rt},go:function(){return yr},pn:function(){return Yn},P2:function(){return Jn},Tv:function(){return bt},rB:function(){return se},mn:function(){return yt},XM:function(){return tn},U8:function(){return ie},Qi:function(){return en},tf:function(){return Qt},Li:function(){return wt},nT:function(){return me}});var r,o,i=n("vsh_98652"),a=n("vsh_67017"),s=n.n(a),l=n("vsh_35067"),u=n("vsh_56589"),c=n("vsh_74561"),h=n("vsh_1139"),d=n("vsh_12064"),f=n("vsh_22462"),v=n("vsh_73455"),p=n("vsh_19264"),g=n("vsh_4175"),m=n("vsh_65498"),_=n("vsh_72429"),y=n("vsh_47246"),C=n("vsh_70098"),S=n("vsh_59980"),k=n("vsh_96636"),E=n("vsh_22023"),T=n("vsh_22392"),b=n("vsh_99520"),I=n("vsh_47531"),R=n("vsh_93631"),w=n("vsh_64299"),A=n("vsh_52690"),F=n("vsh_62536"),D=n("vsh_42958"),N=n("vsh_17494"),P=n("vsh_23188"),O=n("vsh_24627"),M=n("vsh_72834"),L=n("vsh_8073"),x=n("vsh_33916"),V=n("vsh_7959"),Z=n("vsh_82905"),B=n("vsh_69691"),H=n("vsh_7459"),U=n("vsh_63738"),j=n("vsh_55478"),G=n("vsh_83836"),K=n("vsh_33417"),W=n("vsh_45617"),z=n("vsh_73043");function Y(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return J(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return J(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function J(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function q(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==("undefined"==typeof Reflect?"undefined":(0,m.Z)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a}function $(e,t){return function(n,r){t(n,r,e)}}"function"==typeof SuppressedError&&SuppressedError;var X,Q,ee=function(){function e(t,n,r){(0,p.Z)(this,e),this.isLeaf=t,this.parent=n,this.value=r,this.lineNumbers=new Set,this.pendingLineNumbers=new Set}return(0,g.Z)(e,[{key:"insertLine",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.lineNumbers.add(e),t&&this.pendingLineNumbers.add(e)}},{key:"getLines",value:function(){return Array.from(this.lineNumbers).sort()}},{key:"getPendingLines",value:function(){var e=Array.from(this.pendingLineNumbers);return this.pendingLineNumbers.clear(),e}}]),e}(),te=function(){function e(t){(0,p.Z)(this,e),this.dataSource=t,this.leaves=new Set}return(0,g.Z)(e,[{key:"getLeaveNodes",value:function(){return Array.from(this.leaves)}}]),e}(),ne=function(e){function t(e,n,r){var o;return(0,p.Z)(this,t),(o=(0,d.Z)(this,(0,f.Z)(t).call(this,e,n,r))).parent=n,o.children=new Map,o}return(0,v.Z)(t,e),t}(ee),re=function(e){function t(e){var n;return(0,p.Z)(this,t),(n=(0,d.Z)(this,(0,f.Z)(t).call(this,e))).root=new ne(!1,null,null),n}return(0,v.Z)(t,e),(0,g.Z)(t,[{key:"scanDataInRowFromCol",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._scanDataInRowFromCol(e,t,this.root)}},{key:"_scanDataInRowFromCol",value:function(e,t,n){for(var r=this,o=n,i=!1,a=this.dataSource.colNumbers.length,s=function(n){var s,l,u=t+n,c=u===a-1,h=r.dataSource.colNumbers[u],d=null===(s=(l=r.dataSource).getCellValue)||void 0===s?void 0:s.call(l,e,h),f=r.dataSource.hashValue(d,e,h);if(o.children.has(f))(o=o.children.get(f)).getPendingLines().forEach((function(e){return r._scanDataInRowFromCol(e,u+1,o)})),o.insertLine(e),c&&(i=!0);else{var v=new ne(!0,o,f);v.insertLine(e,!c),o.children.set(f,v),o.isLeaf=!1,v.parent=o,r.leaves.delete(o),r.leaves.add(v),i=!0}},l=0;!i;l+=1)s(l)}}]),t}(te),oe=function(e){function t(e,n){var r,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){return!0},a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return(0,p.Z)(this,t),(r=(0,d.Z)(this,(0,f.Z)(t).call(this))).to=n,r.iterStep=o,r.getRowIsVisible=i,r.withHiddenRows=a,r.skippedRows=new Set,r.currentRow=e-o,r}return(0,v.Z)(t,e),(0,g.Z)(t,[{key:"next",value:function(){for(this.currentRow+=this.iterStep;!this.withHiddenRows&&this.currentRow<=this.to&&!this.getRowIsVisible(this.currentRow);)this.skippedRows.add(this.currentRow),this.currentRow+=this.iterStep;return this.currentRow>this.to?null:this.currentRow}}]),t}(L.FIterator);function ie(e,t){var n=!0;return(0,M.KST)(e,(function(e,r){if(n){var o=t(e,r);n=null===o}})),!n}function ae(e,t){var n=t(e);if(0===n.length)return{result:!0,w:1,h:1};for(var r=n[0],o=r.colCount(!0),i=r.rowCount(!0),a=1;a<n.length;a++){var s=n[a];if(s.colCount(!0)!==o||s.rowCount(!0)!==i)return{result:!1,firstSpan:r}}return e.rowCount(!0)*e.colCount(!0)/(o*i)!==n.length?{result:!1,firstSpan:r}:{result:!0,w:o,h:i}}function se(e){return 7===e.result}!function(e){e[e.INIT=0]="INIT",e[e.CHANGED=1]="CHANGED",e[e.MULTIPLE_RANGES=2]="MULTIPLE_RANGES",e[e.NO_PERMISSION=3]="NO_PERMISSION",e[e.DIFFERENT_SPANS=4]="DIFFERENT_SPANS",e[e.NO_DATA=5]="NO_DATA",e[e.NO_COLS=6]="NO_COLS",e[e.FOUND=7]="FOUND",e[e.REMOVING=8]="REMOVING",e[e.REMOVED=9]="REMOVED",e[e.INTERSECT_PIVOT=10]="INTERSECT_PIVOT"}(X||(X={})),function(e){e[e.REMOVE_DUPLICATION=0]="REMOVE_DUPLICATION",e[e.DATA_CLEAN_SUGGESTION=1]="DATA_CLEAN_SUGGESTION"}(Q||(Q={}));var le=function(e){function t(){return(0,p.Z)(this,t),(0,d.Z)(this,(0,f.Z)(t).apply(this,arguments))}return(0,v.Z)(t,e),(0,g.Z)(t,[{key:"execute",value:function(){return this._command.isFirstExecution?this._doAction():this._redoAction()}},{key:"undo",value:function(){return this._undoAction()}},{key:"_doAction",value:function(){var e=this._sheet,t=!1;try{var n=this._command,r=n.duplicationGroups,o=n.step,i=n.range,a=n.selectionRange;this._setRangeValuesActionToChangeset((0,M.lbI)(e,i.toJSON(),{},M.mcV),!0);var s=function(e,t){function n(e,n){e.push(n),t>1&&(0,O.hTd)(e,new Array(t-1).fill(0).map((function(e,t){return n+t+1})))}var r=[],o=[];return e.sort((function(e,t){return e[0]-t[0]})).forEach((function(e){return e.forEach((function(e,t){return n(0===t?r:o,e)}))})),{sortValue:[].concat(r,o),retainLength:r.length}}(r,o),l=s.sortValue,u=s.retainLength;if(this._sortToChangeset(i.rowFrom(),i.colFrom(),i.rowCount(!0),i.colCount(!0),l,!1),this._clearRemoveRange(new M.e6w(i.rowFrom()+u,i.colFrom(),i.rowCount(!0)-u,i.colCount(!0),e)),this._command.$$selectionAfterAction=new M.e6w(a.rowFrom(),a.colFrom(),u+i.rowFrom()-a.rowFrom(),a.colCount(!0),this._sheet),this.filterRangeAdjust(this._command.$$selectionAfterAction),this._recalcFilter(),!this.checkRangeValid(e.getParent(),this._command._changesets))return!1;(t=this._applyChangsetWithEvent(this._command._changesets,!1))&&this._updateSelectionAfterExecution(this._command.$$selectionAfterAction)}catch(e){console.error("[Command RemoveDuplication]:",e)}return t}},{key:"_updateSelectionAfterExecution",value:function(e){this._command.setSelection&&e&&this._sheet.setSelections([e])}},{key:"filterRangeAdjust",value:function(e){var t=this._sheet,n=(0,M.qNh)(t,e),r=n.actions,o=n.oldActions;(0,O.hTd)(this._command._changesets,r),(0,O.hTd)(this._command._oldChangesets,o)}},{key:"_recalcFilter",value:function(){var e=M.c68.getOldSetFilterActions(this._sheet);if(e){var t=e[0].target;if(new M.e6w(t.row,t.col,t.row_count,t.col_count,this._sheet).intersect(this._command.selectionRange)){var n={action:"setFilter",value:null,target:e[0].target,sheet_id:this._sheetId,recalc:!0};this._command._changesets.push(n),this._command._oldChangesets.push(n)}}}},{key:"_clearRemoveRange",value:function(e){this._setRangeToChangeset(e,{style:null,formula:null,value:null,multipleValues:null,reminder:null,dataValidation:null}),this._conditionalFormatToChangeset([e])}},{key:"_redoAction",value:function(){var e=this._command._changesets;if(!0!==this.checkRangeValid(this._sheet.parent,e))return!1;var t=this._applyChangsetWithEvent(e,!1);return t&&this._updateSelectionAfterExecution(this.command.$$selectionAfterAction),t}},{key:"_undoAction",value:function(){var e=this._command._oldChangesets;if(!0!==this.checkRangeValid(this._sheet.parent,e))return!1;var t=this._applyChangsetWithEvent(e,!1);return t&&(this._updateSelectionAfterExecution(this._command.selectionRange),this._sheet.inject(ue).setSelection(this.command.selectionRange)),t}},{key:"_conditionalFormatToChangeset",value:function(e){var t=(0,M.z6i)(this._sheet,e);t&&t.actions&&t.oldActions&&((0,O.hTd)(this._command._changesets,t.actions),(0,O.hTd)(this._command._oldChangesets,t.oldActions))}}]),t}(M.T_g);var ue=function(){function e(t,n){var r=this;(0,p.Z)(this,e),this.commandManager=n,this.destroy$=new R.xQ,this.headerAsValue$=new w.X(!1),this.withHiddenRows$=new w.X(!1),this.cols$=new w.X([]),this.selection$=new w.X(null),this.mode=null,this.duplicationResult$=new w.X({result:0}),this.dispose=null,this.filterChangeSub=null,this.permissionChangeSub=null,this.previouslyHavePermission=!1,this.sheet=null,n.register(O.rvF.REMOVE_DUPLICATION,{canUndo:!0,execute:function(e,t,n,r){return(0,M.P0c)(e,le,t,n,r)}}),t.activeSheet$.pipe((0,F.O)(t.getActiveSheet()),(0,D.R)(this.destroy$),(0,N.h)((function(e){return!!e}))).subscribe((function(e){r.onActiveSheetChange(e)})),this.duplicationResult$.pipe((0,D.R)(this.destroy$),(0,N.h)((function(){return!!r.sheet}))).subscribe((function(e){return r.highlightOnRemoveDuplicationMode(e)}))}return(0,g.Z)(e,[{key:"onActiveSheetChange",value:function(e){var t,n=this;this.quitRemoveDuplications(),this.sheet=e,null!==(t=this.permissionChangeSub)&&void 0!==t&&t.unsubscribe(),this.permissionChangeSub=e.subscribe({ProtectedRangeChanged:function(){var t=n.selection$.getValue();if(t){var r=e.protectionModel.getRangePermissions([t]).hasPermission;r!==n.previouslyHavePermission&&n.emitDataChanges(),n.previouslyHavePermission=r}}})}},{key:"destroy",value:function(){var e;this.destroy$.next(),this.destroy$.complete(),this.headerAsValue$.complete(),this.withHiddenRows$.complete(),this.cols$.complete(),this.selection$.complete(),null===(e=this.permissionChangeSub)||void 0===e||e.unsubscribe()}},{key:"toggleMode",value:function(e){this.mode=e,this.clear(),0===e?(this.headerAsValue$.next(!0),this.withHiddenRows$.next(!0)):(this.headerAsValue$.next(!0),this.withHiddenRows$.next(!1))}},{key:"emitDataChanges",value:function(){this.duplicationResult$.next({result:1})}},{key:"highlightSpecificLine",value:function(e,t){if(this.sheet){var n=this.cols$.getValue().map((function(e){return e.col})),r=this.sheet.inject(M.bA2),o=[new M.e6w(e,n[0],1,n.length,this.sheet)];this.sheet.showCell(e,n[0]),r.cellInHighlightedRows(new Set([e])),r.updateDuplicationRanges(t?[]:o,[],t?o:[]),r.setIsFirstDuplicationItem(t)}}},{key:"toggleHeaderAsValue",value:function(e){this.headerAsValue$.next(e),this.findDuplications()}},{key:"toggleWithHiddenRows",value:function(e){this.withHiddenRows$.next(e),this.findDuplications()}},{key:"toggleColSelected",value:function(e){this.cols$.next(e),this.findDuplications()}},{key:"clear",value:function(){this.duplicationResult$.next({result:0}),this.cols$.next([])}},{key:"refresh",value:function(){this.setSelection(this.selection$.getValue().clone())}},{key:"adjustSelections",value:function(e){e.length>1?this.duplicationResult$.next({result:2}):this.setSelection(e[0])}},{key:"setSelection",value:function(e){var t,n=this.sheet;if(n){var r=this.cols$.getValue(),o=new Set(r.filter((function(e){return e.unchecked})).map((function(e){return e.col}))),i=e.colFrom(),a=e.colCount(!0),s=new Array(a).fill(0).map((function(e,t){var r=t+i;return{col:r,unchecked:o.has(r),visible:n.getColVisible(r)}}));this.selection$.next(e),this.cols$.next(s),this.findDuplications(),this.highlightRange(e,0===this.mode),null!==(t=this.dispose)&&void 0!==t&&t.call(this),this.dispose=n.parent.calcEngine.depRefManager.watchRef(e,this.emitDataChanges.bind(this))}}},{key:"findDuplications",value:function(){var e=this.sheet;if(!e)return{result:0};var t,n=e.inject(M.uIW),r=this.headerAsValue$.getValue(),o=this.withHiddenRows$.getValue(),i=this.cols$.getValue(),a=this.selection$.getValue();if(!a)return{result:6};var s=!e.protectionModel.getRangePermissions([a]).hasPermission;if(s)return t={result:3},this.duplicationResult$.next(t),t;this.previouslyHavePermission=!s;var l=ae(a,(function(t){return e.getSpans(t)}));if(!l.result)return t={result:4,firstSpan:l.firstSpan},this.duplicationResult$.next(t),t;if((0,M.MUL)(e,a.rowFrom(),a.colFrom(),a.rowCount(),a.colCount()))return t={result:10},this.duplicationResult$.next(t),t;var u=i.filter((function(e){return!e.unchecked&&e.visible})).map((function(e){return e.col})).filter((function(e,t){return t%l.w==0}));if(!u.length)return t={result:6},this.duplicationResult$.next(t),t;var c=e.inject(M.QWZ),h=l.h,d=r?a:c.createRange(a.rowFrom()+h,a.colFrom(),a.rowCount(!0)-h,a.colCount(!0));if(e.hasImportRangeByRange(a))return t={result:7,value:{duplicationCount:0,duplicatedRows:[],cols:u,uniqueItemCount:0,step:h,range:a,groups:[]}},this.duplicationResult$.next(t),t;n(O.FHD.DATA_CLEAN_GET_DUPLICATIONS,0);var f=this._findDuplications({cellSpan:l,cols:u,withHiddenRows:o,range:{rowFrom:d.rowFrom(),rowEnd:d.rowTo(!0),colFrom:d.colFrom(),colEnd:d.colTo(!0)}}),v=f.reduce((function(e,t){return e+t.length-1}),0),p=f.length,g=f.filter((function(e){return e.length>1})).flat().sort((function(e,t){return e-t}));return t={result:7,value:{step:h,range:d,groups:f,duplicationCount:v,uniqueItemCount:p,duplicatedRows:g,cols:u}},n(O.FHD.DATA_CLEAN_GET_DUPLICATIONS,1,{row_count:d.rowCount(!0)/l.h,unique_item_count:p,duplication_count:v}),this.duplicationResult$.next(t),t}},{key:"executeRemoveDuplication",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(7!==this.duplicationResult$.getValue().result)return!1;var r=this.duplicationResult$.getValue().value,o=r.range,i=r.groups,a=r.step,s=this.selection$.getValue();return this.removeDuplications(o,i,a,s,n),t?setTimeout((function(){return e.duplicationResult$.next({result:9})}),20):this.duplicationResult$.next({result:9}),!0}},{key:"executeWithSpecificRows",value:function(e){var t,n,r=this,o=null===(t=this.sheet)||void 0===t?void 0:t.inject(M.QWZ),i=this.duplicationResult$.getValue();if(7!==i.result)return!1;var a=i.value,s=a.step,l=a.range,u=a.groups,c=a.duplicationCount,h=this.selection$.getValue(),d=o.createRange(h.rowFrom(),h.colFrom(),h.rowCount(!0)-(e.length-1)*a.step,h.colCount(!0)),f=u.filter((function(t){return t[0]!==e[0]})).flat().map((function(e){return[e]})).concat([e]);return null!==(n=this.dispose)&&void 0!==n&&n.call(this),this.dispose=null,this.removeDuplications(l,f,s,h,!1,!0),c===e.length-1?this.duplicationResult$.next({result:9}):setTimeout((function(){r.setSelection(d)}),200),!0}},{key:"quitRemoveDuplications",value:function(){var e,t;this.sheet&&!this.sheet._disposed&&(this.clear(),this.removeDuplicationHighlight(),this.removeRangeHighlight(),null!==(e=this.dispose)&&void 0!==e&&e.call(this),this.dispose=null,null!==(t=this.filterChangeSub)&&void 0!==t&&t.unsubscribe(),this.filterChangeSub=null,this.permissionChangeSub=null,this.mode=null)}},{key:"removeDuplications",value:function(e,t,n,r,o,i){return this.commandManager.execute({cmd:O.rvF.REMOVE_DUPLICATION,sheetId:this.sheet.id(),sheetName:this.sheet.name(),duplicationGroups:t,step:n,range:e,selectionRange:r,setSelection:o,recalcOnUndo:i})}},{key:"highlightOnRemoveDuplicationMode",value:function(e){var t=this.sheet,n=t.inject(M.QWZ),r=t.inject(M.bA2);if(0===this.mode&&se(e)&&0!==e.value.duplicatedRows.length){var o=this.withHiddenRows$.getValue(),i=e.value,a=o?function(e,t,n){var r,o,i=e.range,a=e.duplicatedRows,s=e.step,l=i.colFrom(),u=i.colCount(!0),c=[],h=[],d=a.length,f=!0,v=0,p=0;function g(){var e=t.createRange(r,l,o+s-r,u);c.push(e)}function m(){if(!f){var e=t.createRange(p,l,s,u);h.push(e)}}for(;v<d;)p=a[v],f=n(p),m(),f&&(void 0===r&&(o=(r=p)-s),p-o!==s&&(g(),r=p),o=p),v+=1;return g(),m(),{visibleRanges:c,invisibleRanges:h}}(i,n,(function(e){return t.getRowVisible(e)})):function(e,t,n){var r=e.range,o=e.duplicatedRows,i=e.step,a=r.colFrom(),s=r.colCount(!0),l=[],u=o.length,c=o[0],h=c-i,d=0,f=0;function v(){var e=t.createRange(c,a,h+i-c,s);l.push(e)}function p(e,t){for(var r=t+i;r<e;r+=i)if(n(r))return!0;return!1}for(;d<u;)(f=o[d])-h!==i&&p(f,h)&&(v(),c=f),h=f,d+=1;return v(),{visibleRanges:l,invisibleRanges:[]}}(i,n,(function(e){return t.getRowVisible(e)})),s=a.visibleRanges,l=a.invisibleRanges;r.cellInHighlightedRows(new Set(i.duplicatedRows)),r.updateDuplicationRanges(s,l,[])}else this.removeDuplicationHighlight()}},{key:"removeDuplicationHighlight",value:function(){var e=this.sheet.inject(M.bA2);e.clearHighlight(),e.cellInHighlightedRows(null)}},{key:"highlightRange",value:function(e,t){e&&t?this.sheet.inject(M.bA2).updateSearchingRange(e):this.removeRangeHighlight()}},{key:"removeRangeHighlight",value:function(){this.sheet.inject(M.bA2).clear()}},{key:"_findDuplications",value:function(e){var t=e.cellSpan,n=e.cols,r=e.range,o=e.withHiddenRows,i=r.rowFrom,a=r.rowEnd,s=this.sheet,l=new fe(n,s),u=new oe(i,a,t.h,(function(e){return s.getRowVisible(e)}),o);u.forEach((function(e){return l.scanDataInRowFromCol(e)}));var c=l.getLeaveNodes().map((function(e){return e.getLines().sort((function(e,t){return e-t}))}));return u.skippedRows.size>0&&(c=c.concat(Array.from(u.skippedRows).map((function(e){return[e]})))),c.sort((function(e,t){return e[0]-t[0]}))}}]),e}();q([(0,T.P)()],ue.prototype,"destroy",null),ue=q([(0,b.b)(),$(0,(0,I.f)(M.Wje)),$(1,(0,I.f)(M.DsI))],ue);var ce,he,de,fe=function(e){function t(e,n){return(0,p.Z)(this,t),(0,d.Z)(this,(0,f.Z)(t).call(this,{colNumbers:e,hashValue:function(e,t,r){return function(e,t,n){var r,o=n.getValue,i=n.hasCheckbox,a=n.getReminder,s=n.getVar,l=n.getSegmentArray,u=o(e,t);if(i(e,t))return"$$CHECKBOX-".concat(u);if(a(e,t))return"$$DATE-REMINDER-".concat(u);if(8===(null===(r=s(e,t))||void 0===r?void 0:r.type))return"$$BOOLEAN-".concat(u);var c=l(e,t);return c&&c.length&&c[0].type===O.K6s.EMBED_IMAGE?"$$EMBED-IMAGE-".concat(c[0].link):"string"==typeof u?u.trim().toLowerCase():u}(t,r,{getValue:function(e,t){return n.getValue(e,t)},hasCheckbox:function(e,t){return n.hasCheckbox(e,t)},getReminder:function(e,t){return!!n.getReminder(e,t)},getVar:function(e,t){return n.getVar(e,t)},getSegmentArray:function(e,t){return n.getSegmentArray(e,t)}})}}))}return(0,v.Z)(t,e),t}(re),ve=function(e){function t(e,n){var r;return(0,p.Z)(this,t),(r=(0,d.Z)(this,(0,f.Z)(t).call(this,e,n)))._actualFillRange=n.fillRange,r}return(0,v.Z)(t,e),(0,g.Z)(t,[{key:"execute",value:function(){return this._command.isFirstExecution?this._doAction():this._redoAction()}},{key:"getFillDirection",value:function(){return this._command.fillDirection}},{key:"_doAction",value:function(){var e=this,t=!1;if(this.canExecute()){var n=this._sheet,r=this._command.fillRange;try{this._beforeAction(n,!0),this._collRangeInfo(n,r).forEach((function(t){e._command._oldChangesets.unshift(t)})),this.executeFill(),this.checkRangeValid(n.parent,this.command._changesets,!0)||(t=!1),this.extendFilterRange([this._actualFillRange]),t=this._applyChangsetWithEvent(this.command._changesets)}catch(e){t=!1}finally{this._afterAction(n,!0)}}return t?this.updateSelectionAfterExecute():this.updateSelectionAfterExecuteFailed(),t}},{key:"_redoAction",value:function(){return!0===this.checkRangeValid(this._sheet.parent,this._command._changesets)&&this._applyChangsetWithEvent(this._command._changesets)}},{key:"canExecute",value:function(){var e=this._command,t=e.sourceRange,n=e.fillRange,r=e.fillDirection,o=this._sheet,i=n.toJSON(),a=i.row,s=i.col,l=i.rowCount,u=i.colCount;return!o.checkRangesProtected(n)&&!(0,M.MUL)(o,a,s,l,u)&&(r!==M._8N.Left&&r!==M._8N.Right||t.rowFrom()===n.rowFrom()&&t.rowCount()===n.rowCount())&&(r!==M._8N.Up&&r!==M._8N.Down||t.colFrom()===n.colFrom()&&t.colCount()===n.colCount())&&!n.isIntersect(t)}},{key:"executeFill",value:function(){this.handleFillCalc(),this.generateFillRangeActions()}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this._command._oldChangesets)}},{key:"generateFillRangeActions",value:function(){var e=this,t=this.command.fillRange,n=this._sheet,r=n._spanModel,o=(0,M.n1H)(n.id(),t.toJSON()),i=n.inject(M.waE),a=new M.GfN,s=new Set,l=new M.GfN,u=new M.GfN,c=new M.GfN,d=new M.GfN,f=new M.GfN,v={cs:{action:"updateSparklineGroup",sheet_id:n.id(),value:{}},oldCs:{action:"updateSparklineGroup",sheet_id:n.id(),value:{}}};r.getSpans(t).forEach((function(r){if(e.saveNewRemoveSpanAction(r),!t.contain(r)){var o=e._collRangeInfo(n,r);e.saveChangesets(o,!0)}})),this.command._changesets.push(o);for(var p=i.getFillDataViewIter(),g=null==p?void 0:p.next();null!=g;g=null==p?void 0:p.next()){var m=g,_=m.targetCell,y=m.calcItemResult.sourceCell,C=(0,h.Z)(_,2),S=C[0],k=C[1],E=(0,h.Z)(y,2),T=E[0],b=E[1],I=r.find(T,b);if(I){var R=I.toJSON(),w=R.row,A=R.col,F=R.rowCount,D=R.colCount;if(w===T&&A===b&&!f.get(S,k)){this.saveNewSetSpansAction(S,k,F,D);for(var N=!1,P=S+F-1,O=k+D-1,L=S;L<=P;L++)for(var x=k;x<=O;x++)if(f.set(L,x,!0),!N&&!t.containCell(L,x)){var V=t.rowTo()===P?t.rowCount():Math.abs(P-t.rowTo()),Z=t.colTo()===O?t.colCount():Math.abs(O-t.colTo()),B=new M.e6w(L,x,V,Z,n),H=this._collRangeInfo(n,B);this.saveChangesets(H,!0),this._actualFillRange=this._actualFillRange.union(B),N=!0}}}var U=a.get(T,b);U||(U=this.getSetCellAction(n,T,b,{ignoreFormulaData:!0,handleStyleRef:!1,ignorePivotTable:!0}),this.preProcessFormulaInSetCellAction(U),this.preProcessPivotTableArea(U),a.set(T,b,U)),this.saveSetRangeValuesAction(U,g,o,{styleRefIdCache:l,dvJSONRefIdCache:u,multipleRefIdsCache:c,formulaDataRefIdCache:d}),this.saveSparklineAction(U,g,v),k===b||s.has(k)||(s.add(k),this.saveNewSetColumnWidthAction(k,n.getColumnWidth(b)))}this.mergeSparklineAction(v),o&&(0,M.ciS)(o)}},{key:"preProcessFormulaInSetCellAction",value:function(e){var t=e.target,n=t.row,r=t.col,o=this._sheet;if(o.hasFormula(n,r)){var i=o.getVar(n,r),a={ref:i.getRef()};e.value.formulaData=(0,M.dN9)(i,a,{refType:1})}}},{key:"preProcessPivotTableArea",value:function(e){var t=e.target,n=t.row,r=t.col,o=this._sheet,i=e.value.value,a=(0,M.MUL)(o,n,r,1,1);null==i&&a&&(e.value.value=o.getValue(n,r))}},{key:"saveSetRangeValuesAction",value:function(e,t,n,r){var o,i=this._sheet,a=e.target,s=a.row,l=a.col,u=t.targetCell,c=t.calcItemResult.result,d=(0,h.Z)(u,2),f=d[0],v=d[1],p=e.value,g=r.styleRefIdCache,m=r.dvJSONRefIdCache,_=r.multipleRefIdsCache,y=r.formulaDataRefIdCache,C=n.target,S=C.row,k=C.col,E=C.col_count,T=[0,null,null,null,null,null,null],b=0,I=this.generateTargetValue(p,c);if(null==I&&i.isProxyArrayFormula(s,l)&&(I=null===(o=i.getVar(s,l))||void 0===o?void 0:o.getValue()),b=(0,M.lXs)(M.SuU.CELL_VALUE),Array.isArray(I)&&((0,M.Hr1)(I,n.styleRefMgr),I.some(O.S3_)&&(b=(0,M.lXs)(8,b)),I.some(O.MgP)&&(b=(0,M.lXs)(9,b))),T[M.SuU.CELL_VALUE]=I,b=(0,M.lXs)(M.SuU.STYLE_INDEX,b),p.style){var R,w=g.get(s,l);if(void 0!==w)R=w;else{var A=this.generateTargetStyle(p),F=n.styleRefMgr.add(A).id;g.set(s,l,F),R=F}T[M.SuU.STYLE_INDEX]=R}else T[M.SuU.STYLE_INDEX]=null;b=(0,M.lXs)(M.SuU.FORMULADATA_INDEX,b);var D=this.generateTargetFormula(p,f,v);if(D){var N;if(D.externalDataReference)b=(0,M.lXs)(7,b),N=n.formulaDataRefMgr.add(D).id;else{var P=y.get(s,l);null!=P?N=P:(N=n.formulaDataRefMgr.add(D).id,y.set(s,l,N))}T[M.SuU.FORMULADATA_INDEX]=N}else T[M.SuU.FORMULADATA_INDEX]=null;var L=p.dataValidation;if(b=(0,M.lXs)(M.SuU.DATAVALIDATION_INDEX,b),L){var x,V=m.get(s,l);if(void 0!==V)x=V;else{var Z=this.generateTargetDataValidation(p),B=n.dvJSONRefMgr.add(Z).id;m.set(s,l,B),x=B}T[M.SuU.DATAVALIDATION_INDEX]=x}else T[M.SuU.DATAVALIDATION_INDEX]=null;var H=p.multipleValues;if(b=(0,M.lXs)(M.SuU.MULTIPLE_VALUE_INDEX,b),H){var U,j=_.get(s,l);if(void 0!==j)U=j;else{var G=this.generateTargetMultipValues(p).map((function(e){return n.multipleValuesJSONRefMgr.add(e).id}));_.set(s,l,G),U=G}T[M.SuU.MULTIPLE_VALUE_INDEX]=U}else T[M.SuU.MULTIPLE_VALUE_INDEX]=null;var K=p.reminder;if(b=(0,M.lXs)(M.SuU.REMINDER,b),K){var W=this.generateTargetReminer(p,c);W&&(T[M.SuU.REMINDER]=W)}else T[M.SuU.REMINDER]=null;T[M.SuU.CHANGED_FLAG]=b,0!==b&&((0,M.nBL)(T,M.SuU.REMINDER),n.value.value[(f-S)*E+(v-k)]=T)}},{key:"saveSparklineAction",value:function(e,t,n){var r=this._sheet,o=e.target,i=o.row,a=o.col,s=t.targetCell,l=(0,h.Z)(s,2),u=l[0],c=l[1],d=n.cs,f=n.oldCs,v=r.getSparklineByCell(i,a);if(v){var p=(0,M.Z7n)(),g=v.getGroupId(),m=(0,M.uVG)(r.parent,v.getSource(),v.getPosition(),{row:u,col:c});d.value[g]||(d.value[g]={sparklines:{}}),d.value[g].sparklines[p]={source:m,position:{row:u,col:c}},f.value[g]||(f.value[g]={sparklines:{}}),f.value[g].sparklines[p]=null;var _=r.getSparklineByCell(u,c);if(_){var y=_.getId(),C=_.getGroupId();d.value[C]||(d.value[C]={sparklines:{}}),d.value[C].sparklines[y]=null,f.value[C]||(f.value[C]={sparklines:{}}),f.value[C].sparklines[y]={source:_.getSource(),position:_.getPosition()}}}}},{key:"mergeSparklineAction",value:function(e){var t=e.cs,n=e.oldCs,r=[],o={action:"addSparklineGroup",sheet_id:this._sheetId,value:{}};if(Object.keys(t.value).length){for(var i=this._sheet,a=i.getSparklineModel(),s=0,l=Object.entries(t.value);s<l.length;s++){var u=(0,h.Z)(l[s],2),c=u[0],d=u[1].sparklines;if(d){var f=Object.values(d||{}).filter((function(e){return null===e})).length,v=Object.values(d||{}).length;if(f===a.getSparklinesByGroupId(c).length&&v===f){r.push(c),delete t.value[c],o.value[c]={sparklines:n.value[c].sparklines};var p=a.getSparklineRawConfig(c)||void 0;p&&(o.value[c].config=p),delete n.value[c]}}}Object.keys(t.value).length&&this._command._changesets.push(t),Object.keys(n.value).length&&this._command._oldChangesets.push(n),r.length&&(this._command._changesets.push({action:"delSparklineGroup",sheet_id:i.id(),value:r}),this._command._oldChangesets.push(o))}}},{key:"generateTargetStyle",value:function(e){return(0,M.V8g)(e.style)}},{key:"generateTargetValue",value:function(e,t){var n,r,o,i=e.value;return Array.isArray(i)?(o=Array.isArray(t)?t.map((function(e,t){var n=i[t];return n.type===O.K6s.MENTION||n.type===O.K6s.ATTACHMENT?Object.assign({},n):Object.assign({},n,{text:e})})):(0,M.V8g)(i),(0,O.Nsj)(o,!0),o):null!==(n=null!==(r=t)&&void 0!==r?r:i)&&void 0!==n?n:null}},{key:"generateTargetFormula",value:function(e,t,n){var r=this._sheet;if(e.formulaData&&e.formulaData.tokens&&e.formulaData.tree){var o=new M.e6w(t,n,1,1,r);return(0,M.S6s)(r,e.formulaData,o)}return null}},{key:"generateTargetDataValidation",value:function(e){return(0,M.V8g)(e.dataValidation)}},{key:"generateTargetMultipValues",value:function(e){return(0,M.V8g)(e.multipleValues)}},{key:"generateTargetReminer",value:function(e,t){if(e.reminder){var n,r="number"==typeof t?t:e.value;return null===(n=(0,M.Dwm)(e.reminder,r))||void 0===n?void 0:n.toChangeset()}return null}},{key:"saveNewRemoveSpanAction",value:function(e){this._command._changesets.push(this._setSpansAction(e))}},{key:"saveNewSetSpansAction",value:function(e,t,n,r){var o,i=this._sheet,a=i.getColumnCount(),s=i.getRowCount();e=(o=this.fixSpan({row:e,col:t,rowCount:n,colCount:r},s,a)).row,t=o.col,(n=o.rowCount)*(r=o.colCount)!=1&&this.command._changesets.push({action:"setSpans",sheet_id:i.id(),target:{row:e,col:t,row_count:n,col_count:r},value:[{target:{row:e,col:t,row_count:n,col_count:r}}]})}},{key:"fixSpan",value:function(e,t,n){var r=e.row,o=e.col,i=e.rowCount,a=e.colCount;return o+a>n&&(a=n-o),r+i>t&&(i=t-r),{row:r,col:o,rowCount:i,colCount:a}}},{key:"extendFilterRange",value:function(e){var t=this._sheet,n=this._command,r=n._changesets,o=n._oldChangesets,i=(0,M.buC)(t,e),a=i.actions,s=i.oldActions;(0,O.hTd)(r,a),(0,O.hTd)(o,s)}},{key:"updateSelectionAfterExecuteFailed",value:function(){var e=this.command.sourceRange;this.updateSelection(e)}},{key:"updateSelectionAfterExecute",value:function(){var e=this.command,t=e.sourceRange,n=e.fillRange,r=t.union(n);this.updateSelection(r)}},{key:"updateSelection",value:function(e){var t=this._sheet;t._setActiveCellImp(e.rowFrom(),e.colFrom(),t._activeRowViewportIndex,t._activeColViewportIndex),t._selectionModel&&t._clearSelectionImp(),t.addSelection(e)}}]),t}(M.RPo);!function(e){e.FillFormattingOnly="fillFormattingOnly",e.FillWithoutFormatting="fillWithoutFormatting"}(ce||(ce={})),function(e){e.DRAG_FILL="fill/dragFill",e.AUTO_FILL="fill/autoFill",e.COPY_FILL="fill/copyFill",e.SERIES_FILL="fill/seriesFill",e.FILL_RANGE="fill/fillRange",e.FILL_HORIZONTAL="fill/fillHorizontal",e.FILL_VERTICAL="fill/fillVertical",e.DB_CLICK="fill/dbClick"}(he||(he={})),function(e){e.VALUE="value",e.EMPTY="empty"}(de||(de={}));var pe=function(e){function t(){return(0,p.Z)(this,t),(0,d.Z)(this,(0,f.Z)(t).apply(this,arguments))}return(0,v.Z)(t,e),(0,g.Z)(t,[{key:"handleFillCalc",value:function(){var e=this._sheet,t=this.command,n=t.sourceRange,r=t.fillRange,o=t.fillDirection,i=t.reverseAutoFill,a=void 0!==i&&i,s=e.inject(M.waE);s.setSourceRange(n),s.setDirection(o),s.setReverseAutoFill(a),s.setFillRange(r),s.setFillType(M.Viq.Auto)}},{key:"commandName",get:function(){return he.AUTO_FILL}}]),t}(ve),ge=function(e){function t(){return(0,p.Z)(this,t),(0,d.Z)(this,(0,f.Z)(t).apply(this,arguments))}return(0,v.Z)(t,e),(0,g.Z)(t,[{key:"handleFillCalc",value:function(){var e=this._sheet,t=this.command,n=t.sourceRange,r=t.fillRange,o=t.fillDirection,i=e.inject(M.waE);i.setSourceRange(n),i.setDirection(o),i.setFillRange(r),i.setFillType(M.Viq.CopyCells)}},{key:"commandName",get:function(){return he.COPY_FILL}}]),t}(ve);function me(e,t,n){return!ye(e,t,n)&&!_e(e,t)}function _e(e,t){return!!(0,M.MUL)(e,t.rowFrom(),t.colFrom(),t.rowCount(),t.colCount())&&(O.Ps3.Toast.error({content:z("LarkCCM_Sheets_PivotTable_DoNotSupportAction_Toast")}),!0)}function ye(e,t,n){return function(e){var t=e.sheet();if(!t)return!0;for(var n=t.iterContent(e.rowFrom(),e.colFrom(),e.rowCount(),e.colCount(),!0),r=n.next();null!==r;r=n.next()){var o,i=null===(o=r.formulaVar)||void 0===o?void 0:o.getRefMap();if(i)for(var a=0,s=Object.values(i);a<s.length;a++){var l,u=(null===(l=s[a].sheet())||void 0===l?void 0:l.id())||"";if(!t.parent.permissionManager.hasSheetVisiblePermission(u))return!1}}return!0}(n)?e.protectionModel.getProtectionsByRange(t,"denied").length>0&&(e._raiseInvalidOperation(8,z("sheet.protection.cannot_start_edit")),!0):(O.Ps3.Toast.warning({content:z("LarkCCM_Sheets_Protect_SourceContainsProtected_Text")}),!0)}function Ce(e,t){return{sourceRange:e.extendSelectedRangeForMergeCell(new M.e6w(t.rowFrom(),t.colFrom(),1,1,e)),fillRange:t}}function Se(e,t){var n=e.extendSelectedRangeForMergeCell(new M.e6w(t.rowFrom(),t.colFrom(),t.rowCount(),1,e)),r=Math.max(t.colCount()-n.colCount(),0),o=new M.e6w(n.rowFrom(),n.colTo()+1,n.rowCount(),r,e);return{sourceRange:n,fillRange:o}}function ke(e,t){var n=e.extendSelectedRangeForMergeCell(new M.e6w(t.rowFrom(),t.colFrom(),1,t.colCount(),e)),r=Math.max(t.rowCount()-n.rowCount(),0),o=new M.e6w(n.rowTo()+1,n.colFrom(),r,n.colCount(),e);return{sourceRange:n,fillRange:o}}function Ee(e,t,n){var r=t.clone();if(!e.contain(r))switch(n){case M._8N.Up:r.setRowCount(r.rowCount(!0)-e.rowCount());break;case M._8N.Down:r.setRowFrom(r.rowFrom()+e.rowCount()),r.setRowCount(r.rowCount(!0)-e.rowCount());break;case M._8N.Left:r.setColCount(r.colCount(!0)-e.colCount());break;case M._8N.Right:r.setColFrom(r.colFrom()+e.colCount()),r.setColCount(r.colCount(!0)-e.colCount())}return r}var Te={color:V.i9H,width:1,style:x.borderDash.dash,dashLine:[5,5].map((function(e){return e*(devicePixelRatio||1)}))},be={width:2,color:V.e2d},Ie=function(e){function t(e,n){var r;return(0,p.Z)(this,t),(r=(0,d.Z)(this,(0,f.Z)(t).call(this,e,n))).sheet=e,r}return(0,v.Z)(t,e),(0,g.Z)(t,[{key:"execute",value:function(){var e=this._command,t=e.sourceRange,n=e.dragRange,r=e.direction,o=e.dragFilled,i=e.reverseAutoFill;if(!t||!n)return!1;var a=this.sheet,s=a.inject(M.Wph),l=a.inject(M.uTF),u=a.inject(M.waE),c=n.rowFrom()+n.rowCount()-1,d=n.colFrom()+n.colCount()-1,f=c+1,v=d+1;r===M._8N.Left?v=d=n.colFrom():r===M._8N.Up&&(f=c=n.rowFrom()),s.setSelRange(o?null:n);var p=l.mobileFilling?be:Te;if(s.setSelectionDashBorderStyle(p),o||t.contain(n))s.removeToolTips();else{var g=Ee(t,n,r);u.setSourceRange(t),u.setDirection(r),u.setReverseAutoFill(i),u.setFillRange(g),u.setFillType(M.Viq.Auto);for(var m=u.getFillDataViewIter(),_=null==m?void 0:m.next();null!=_;_=null==m?void 0:m.next()){var y=_,C=y.targetCell,S=y.calcItemResult,k=(0,h.Z)(C,2),E=k[0],T=k[1];if(E===c&&T===d){var b=Re(a,S)||"";s.setToolTipsText(b),s.setToolTipsCellPosition([f,v]);break}}}return!0}},{key:"commandName",get:function(){return he.DRAG_FILL}}]),t}(M.T_g);function Re(e,t){if(!e||!t)return"";var n=t.sourceCell,r=(0,h.Z)(n,2),o=r[0],i=r[1];if(e.hasFormula(o,i))return"";switch(t.type){case M.nKc.CopyOnly:return e.getText(o,i);case M.nKc.SerialNumber:var a=e.getCellFormatter(o,i);return a&&t.result?a.format(t.result):t.result.toString();case M.nKc.SerialCycle:case M.nKc.SerialText:return t.result.toString();case M.nKc.SerialSegmentArray:return t.result.join(" ");default:return e.getText(o,i)}}var we,Ae,Fe=function(e){function t(){return(0,p.Z)(this,t),(0,d.Z)(this,(0,f.Z)(t).apply(this,arguments))}return(0,v.Z)(t,e),(0,g.Z)(t,[{key:"canExecute",value:function(){var e=this._sheet,t=this.command,n=t.sourceRange,r=t.fillRange,o=t.fillDirection,i=r.toJSON(),a=i.row,s=i.col,l=i.rowCount,u=i.colCount,c=n.toJSON().colCount;return o===M._8N.Right&&0!==Math.floor(u/c)&&!e.checkRangesProtected(r)&&!(0,M.MUL)(e,a,s,l,u)&&!r.isIntersect(n)}},{key:"handleFillCalc",value:function(){var e=this._sheet,t=this.command,n=t.sourceRange,r=t.fillRange,o=t.fillDirection,i=r.toJSON(),a=i.row,s=i.col,l=i.rowCount,u=i.colCount,c=n.toJSON().colCount,h=Math.floor(u/c)*c;this._actualFillRange=new M.e6w(a,s,l,h,this._sheet);var d=e.inject(M.waE);d.setSourceRange(n),d.setDirection(o),d.setFillRange(this._actualFillRange),d.setFillType(M.Viq.CopyCells)}},{key:"updateSelectionAfterExecute",value:function(){var e=this.command.sourceRange;this.updateSelection(e.union(this._actualFillRange))}},{key:"commandName",get:function(){return he.FILL_HORIZONTAL}}]),t}(ve),De=function(e){function t(){return(0,p.Z)(this,t),(0,d.Z)(this,(0,f.Z)(t).apply(this,arguments))}return(0,v.Z)(t,e),(0,g.Z)(t,[{key:"canExecute",value:function(){var e=this._sheet,t=this.command,n=t.sourceRange,r=t.fillRange,o=t.fillDirection,i=r.toJSON(),a=i.row,s=i.col,l=i.rowCount,u=i.colCount,c=n.toJSON(),h=c.rowCount,d=c.colCount;return!(o!==M._8N.Range||0===Math.floor(l/h)&&0===Math.floor(u/d)||e.checkRangesProtected(r)||(0,M.MUL)(e,a,s,l,u))}},{key:"handleFillCalc",value:function(){}},{key:"executeFill",value:function(){var e=this;this.handleFillCalc();var t=this._sheet,n=t._spanModel,r=this.command,o=r.sourceRange,i=r.fillRange.toJSON(),a=i.rowCount,s=i.colCount,l=o.toJSON(),u=l.row,c=l.col,h=l.rowCount,d=l.colCount,f=Math.floor(a/h)*h,v=Math.floor(s/d)*d;this._actualFillRange=new M.e6w(u,c,f,v,t);var p=this.getSetCellAction(t,u,c,{ignoreFormulaData:!0,handleStyleRef:!1});this.preProcessFormulaInSetCellAction(p),this.preProcessPivotTableArea(p);var g=t.getColumnWidth(c),m=new Set;m.add(c);var _,y=(0,M.n1H)(t.id(),this._actualFillRange.toJSON()),C={styleRefIdCache:new M.GfN,dvJSONRefIdCache:new M.GfN,multipleRefIdsCache:new M.GfN,formulaDataRefIdCache:new M.GfN};n.getSpans(this._actualFillRange).forEach((function(t){var n=t.toJSON(),r=n.row,o=n.col;r===u&&o===c?_=t:e.saveNewRemoveSpanAction(t)})),(0,M.KxW)(this._actualFillRange,(function(t,n){if(_){var r=_.toJSON(),o=r.row,i=r.col,a=r.rowCount,s=r.colCount;(t-o)%a==0&&(n-i)%s==0&&e.saveNewSetSpansAction(t,n,a,s)}var l={targetCell:[t,n],calcItemResult:{type:M.nKc.CopyOnly,result:null,sourceCell:[u,c]}};e.saveSetRangeValuesAction(p,l,y,C),m.has(n)||(m.add(n),e.saveNewSetColumnWidthAction(n,g))}),this._isFilterRow.bind(this)),y&&((0,M.ciS)(y),this.command._changesets.unshift(y))}},{key:"updateSelectionAfterExecute",value:function(){this.updateSelection(this._actualFillRange)}},{key:"commandName",get:function(){return he.FILL_RANGE}}]),t}(ve),Ne=function(e){function t(){return(0,p.Z)(this,t),(0,d.Z)(this,(0,f.Z)(t).apply(this,arguments))}return(0,v.Z)(t,e),(0,g.Z)(t,[{key:"canExecute",value:function(){var e=this._sheet,t=this.command,n=t.sourceRange,r=t.fillRange,o=t.fillDirection,i=r.toJSON(),a=i.row,s=i.col,l=i.rowCount,u=i.colCount,c=n.toJSON().rowCount;return o===M._8N.Down&&0!==Math.floor(l/c)&&!e.checkRangesProtected(r)&&!(0,M.MUL)(e,a,s,l,u)&&!r.isIntersect(n)}},{key:"handleFillCalc",value:function(){var e=this._sheet,t=this.command,n=t.sourceRange,r=t.fillRange,o=t.fillDirection,i=r.toJSON(),a=i.row,s=i.col,l=i.rowCount,u=i.colCount,c=n.toJSON().rowCount,h=Math.floor(l/c)*c;this._actualFillRange=new M.e6w(a,s,h,u,this._sheet);var d=e.inject(M.waE);d.setSourceRange(n),d.setDirection(o),d.setFillRange(this._actualFillRange),d.setFillType(M.Viq.CopyCells)}},{key:"updateSelectionAfterExecute",value:function(){var e=this.command.sourceRange;this.updateSelection(e.union(this._actualFillRange))}},{key:"commandName",get:function(){return he.FILL_VERTICAL}}]),t}(ve),Pe=function(e){function t(){return(0,p.Z)(this,t),(0,d.Z)(this,(0,f.Z)(t).apply(this,arguments))}return(0,v.Z)(t,e),(0,g.Z)(t,[{key:"handleFillCalc",value:function(){var e=this._sheet,t=this.command,n=t.sourceRange,r=t.fillRange,o=t.fillDirection,i=e.inject(M.waE);i.setSourceRange(n),i.setDirection(o),i.setFillRange(r),i.setFillType(M.Viq.FillSeries)}},{key:"commandName",get:function(){return he.SERIES_FILL}}]),t}(ve),Oe=function(e){function t(){return(0,p.Z)(this,t),(0,d.Z)(this,(0,f.Z)(t).apply(this,arguments))}return(0,v.Z)(t,e),(0,g.Z)(t,[{key:"_collRangeInfo",value:function(e,t){var n;return this._beforeAction(e),n=this.command.fillRangeType===de.VALUE?this.collectRangeActions(e,t):this.collectRangeActions(e,t,{ignoreDataValidation:!1,ignoreValue:!1,ignoreFormulaData:!0,ignoreMultipleValues:!0,ignoreReminder:!0,ignorePivotTable:!0}),this._afterAction(e),n}},{key:"handleFillCalc",value:function(){var e=this._sheet,t=this.command,n=t.sourceRange,r=t.fillRange,o=e.inject(M.waE);o.setSourceRange(n),o.setDirection(M._8N.Down),o.setFillRange(r),o.setFillType(M.Viq.Auto)}},{key:"commandName",get:function(){return he.DB_CLICK}}]),t}(ve),Me=(r={},(0,c.Z)(r,he.DRAG_FILL,{canUndo:!1,execute:function(e,t,n,r){return(0,M.P0c)(e,Ie,t,n,r)}}),(0,c.Z)(r,he.AUTO_FILL,{canUndo:!0,execute:function(e,t,n,r){return(0,M.P0c)(e,pe,t,n,r)}}),(0,c.Z)(r,he.SERIES_FILL,{canUndo:!0,execute:function(e,t,n,r){return(0,M.P0c)(e,Pe,t,n,r)}}),(0,c.Z)(r,he.COPY_FILL,{canUndo:!0,execute:function(e,t,n,r){return(0,M.P0c)(e,ge,t,n,r)}}),(0,c.Z)(r,he.FILL_HORIZONTAL,{canUndo:!0,execute:function(e,t,n,r){return(0,M.P0c)(e,Fe,t,n,r)}}),(0,c.Z)(r,he.FILL_VERTICAL,{canUndo:!0,execute:function(e,t,n,r){return(0,M.P0c)(e,Ne,t,n,r)}}),(0,c.Z)(r,he.FILL_RANGE,{canUndo:!0,execute:function(e,t,n,r){return(0,M.P0c)(e,De,t,n,r)}}),(0,c.Z)(r,he.DB_CLICK,{canUndo:!0,execute:function(e,t,n,r){return(0,M.P0c)(e,Oe,t,n,r)}}),r),Le=function(e){var t=e.commandManager();for(var n in Me)t.register(n,Me[n])};function xe(e,t,n){var r,o;return null!==(r=null===(o=e._commandManager())||void 0===o?void 0:o.execute(Object.assign({cmd:t,sheetId:e.id(),sheetName:e.name()},n)))&&void 0!==r&&r}function Ve(e,t,n){var r=xe(e,t,n);return r&&function(e,t,n){(function(e,t){null!==e.iterReminder(t.rowFrom(),t.colFrom(),t.rowCount(),t.colCount()).next()&&O.Ps3.collectSuiteEvent("sheet_opration",{action:"add_reminder",source:"fill"})})(e,n),function(e,t){var n=t.rowFrom(),r=t.colFrom(),o=t.rowCount(),i=t.colCount(),a=!1,s=!1,l=!1,u=!1,c=!1,h=!1,d=!1,f=!1,v=0,p=[];e.iterDropdown(n,r,o,i).forEach((function(e){s=!0,e.isEnableOptionColor?d=!0:f=!0})),e.iterDataValidation(n,r,o,i).forEach((function(e){switch(e.type){case"list":case"listFromRange":e.options.supportMultipleValues?l=!0:s=!0,e.options.shouldHighlightValidData?d=!0:f=!0;break;case"checkbox":a=!0;break;case"date":c=!0;break;case"textLength":h=!0;break;case"number":u=!0}v++})),u&&p.push("number"),c&&p.push("date"),h&&p.push("text_length"),a&&p.push("checkbox"),s&&p.push("list_single"),l&&p.push("list_multiple"),(0,M.OlV)(a,s,l,d,f,"fill",v,p.join("-"))}(e,n),function(e,t){var n=t.rowFrom(),r=t.colFrom(),o=t.rowCount(),i=t.colCount();e._getModel().iterContent(n,r,o,i).forEach((function(e){if(e&&e.segmentArray){var t=!1;e.segmentArray.forEach((function(e){(0,O.S3_)(e)&&(t=!0)})),t&&O.Ps3.collectSuiteEvent("sheet_opration",{action:"upload_attachment",source:"fill"}),t&&O.Ps3.ccmEventTracking&&O.Ps3.ccmEventTracking("ccm_sheet_content_page_click",Object.assign({},(0,O.dK5)(),{click:"upload_attachment",target:"none",action_method:"fill"}))}}))}(e,n),function(e,t){function n(e){var t;null===(t=O.Ps3.collectSheetEvent)||void 0===t||t.call(O.Ps3,"ccm_sheet_content_page_click",{click:"auto_fill_type",target:"none",fill_type:e})}if(t!==he.FILL_HORIZONTAL&&t!==he.FILL_RANGE&&t!==he.FILL_VERTICAL){var r=e.inject(M.waE).getAutoFillItemTypeList();if(r.length>1)n("mix_type");else switch(r[0]){case M.nKc.SerialCycle:n("periodicity");break;case M.nKc.SerialText:n("char_num_mix");break;case M.nKc.SerialNumber:n("num");break;case M.nKc.SerialSegmentArray:n("advanced_computing_unit");break;case M.nKc.CopyOnly:n("only_copy_support")}}else n("only_copy_support")}(e,t),function(e){var t,n="";switch(e){case he.DB_CLICK:n="double_click";break;case he.AUTO_FILL:n="drop_down";break;case he.FILL_RANGE:n="shortcut_selection";break;case he.FILL_HORIZONTAL:n="shortcut_right";break;case he.FILL_VERTICAL:n="shortcut_down"}n&&(null===(t=O.Ps3.collectSheetEvent)||void 0===t||t.call(O.Ps3,"ccm_sheet_content_page_click",{click:"auto_fill_method",target:"none",fill_method:n}))}(t)}(e,t,n.sourceRange),r}function Ze(e,t){return xe(e,he.DRAG_FILL,t)}function Be(e,t){return Ve(e,he.AUTO_FILL,t)}function He(e,t){return Ve(e,he.SERIES_FILL,t)}function Ue(e,t){return Ve(e,he.COPY_FILL,t)}function je(e,t){return Ve(e,he.FILL_HORIZONTAL,t)}function Ge(e,t){return Ve(e,he.FILL_VERTICAL,t)}function Ke(e,t){return Ve(e,he.FILL_RANGE,t)}function We(e,t){return Ve(e,he.DB_CLICK,t)}!function(e){e[e.Fail=1]="Fail",e[e.Empty=2]="Empty",e[e.Range=3]="Range"}(we||(we={}));var ze=function(){function e(t){(0,p.Z)(this,e),this.sheet=t,this._selection=t.inject(M.Y19)}return(0,g.Z)(e,[{key:"getAutoFillRange",value:function(){var e=this.sheet._getActiveSelectedRange(),t=this._selection.getCellsInSpan(this.sheet.getSpans());if(!this.hasValueInRange(e,t,{isIncludeDropdown:!0,isIncludeSparkline:!0,isIncludeFormula:!0}))return{type:we.Fail,result:null};var n=this.expandFillRange(e),r=n.fillRange,o=n.fillRangeType;return r.rowTo()===e.rowTo()?{type:we.Empty,result:null}:{type:we.Range,result:{fillRange:new M.e6w(e.rowTo()+1,e.colFrom(),r.rowTo()-e.rowTo(),e.colCount(),this.sheet),fillRangeType:o}}}},{key:"expandFillRange",value:function(e,t){var n=this.sheet.getRowCount(),r=this.sheet.getColumnCount(),o=e.clone(),i=new Map,a=this._selection.getCellsInSpan(this.sheet.getSpans());if(!this.expandFillDown(o,a,n,t,!0))return{fillRange:o,fillRangeType:de.VALUE};for(var s=!0;s;){if(this.breakExpandFill(e,o,a,n,t,!0))return{fillRange:o,fillRangeType:de.EMPTY};s=(s=this._selection.expandDown(o,a,i,n,t,!0))||this.expandDiagonalLeft(o,a,i,t)||this._selection.expandUp(o,a,i,t)||this.expandDiagonalRight(o,a,i,r,t)}return{fillRange:o,fillRangeType:de.EMPTY}}},{key:"expandDiagonalRight",value:function(e,t,n,r,o){var i=e.colFrom()+e.colCount();return!(i>=r||!this._selection.hasValueInRowOrCol(t,{rowOrCol:"row",position:i},e.rowFrom()-1,e.rowFrom()+e.rowCount()+1,n,o)||(e.setColCount(e.colCount()+1),0))}},{key:"expandDiagonalLeft",value:function(e,t,n,r){var o=e.colFrom()-1;return!(o<0||!this._selection.hasValueInRowOrCol(t,{rowOrCol:"row",position:o},e.rowFrom()-1,e.rowFrom()+e.rowCount()+1,n,r)||(e.setColFrom(o),e.setColCount(e.colCount()+1),0))}},{key:"expandFillDown",value:function(e,t,n,r,o){for(var i=!1,a=!0;a;){var s=e.rowFrom()+e.rowCount();if(s>=n)return!1;if(o&&this.sheet._isRowFilterOut(s))e.setRowCount(e.rowCount()+1),a=!0;else{for(var l=e.colFrom(),u=e.colTo(),c=e.colCount(),h=0,d=l;d<=u&&this._selection.hasValue(t,s,d,r);d++)h++;if(h===c)e.setRowCount(e.rowCount()+1),i=!0;else{if(0!==h||i)return!1;a=!1}}}return!0}},{key:"breakExpandFill",value:function(e,t,n,r,o,i){var a=t.rowFrom()+t.rowCount();if(a>=r)return!1;if(i&&this.sheet._isRowFilterOut(a))return!1;for(var s=e.colFrom(),l=e.colTo(),u=s;u<=l;u++)if(this._selection.hasValue(n,a,u,o))return!0;return!1}},{key:"hasValueInRange",value:function(e,t,n){for(var r=e.rowFrom(),o=e.rowTo(),i=e.colFrom(),a=e.colTo(),s=r;s<=o;s++)for(var l=i;l<=a;l++)if(this._selection.hasValue(t,s,l,n))return!0;return!1}}]),e}(),Ye=function(e){function t(e,n){var r;return(0,p.Z)(this,t),(r=(0,d.Z)(this,(0,f.Z)(t).call(this,e.contentDoc(),e.getSheetView(),!0,(function(){}))))._sheet=n,r._continuePt=new x.FPoint(0,0),r.continueSelTimer=null,r}return(0,v.Z)(t,e),(0,g.Z)(t,[{key:"updateSheet",value:function(e){this._sheet=e}},{key:"start",value:function(e,t){var n=this._sheet._getActiveSelectedRange();this._start={row:n.rowFrom(),col:n.colFrom()};var r=new x.FPoint(e,t);return this._startPt=this.view().mapFromGlobal(r),this.continueSel(e,t)}},{key:"direction",value:function(){if(null===this._start||null===this._end)return null;var e=this._sheet._getActiveSelectedRange(),t=e.rowFrom(),n=e.colFrom(),r=e.rowFrom()+e.rowCount()-1,o=e.colFrom()+e.colCount()-1,i=this._end,a=i.row,s=i.col,l=a-r,u=s-o,c=t<=a&&a<=r,h=n<=s&&s<=o;return Math.abs(u)>Math.abs(l)&&!h||c?u>0?M._8N.Right:M._8N.Left:l>0?M._8N.Down:M._8N.Up}},{key:"clearContinueSelTimer",value:function(){this.continueSelTimer&&(clearTimeout(this.continueSelTimer),this.continueSelTimer=null)}},{key:"continueSel",value:function(e,t){var n=this;if(null===this._start||!this._sheetView)return null;if(null==this.view().parent())return null;var r=this._sheet.getSelections()[0];if(!r)return null;var o=r.rowFrom(),i=r.colFrom();o===this._start.row&&i===this._start.col||this.start(e,t);var a=this._end,s=new x.FPoint(e,t);if(this._end=this._sheetView.globalPoint2Cell(s),this._continueX=e,this._continueY=t,this._continuePt=this.view().mapFromGlobal(s),this._autoScrollIfOver&&this._tryOverScroll(this._continueX,this._continueY,this._sheetView)&&(this.clearContinueSelTimer(),this.continueSelTimer=setTimeout((function(){return n.continueSel(n._continueX,n._continueY)}),100)),!this.validateXY())return null;var l=this._composeRange(e,t),u=a===this._end||null!==a&&null!==this._end&&a.row===this._end.row&&a.col===this._end.col;return null!==l&&this._doSel&&!u&&this._doSel(l,this._customData,s),l}},{key:"validateXY",value:function(){return!(!this._start||!this._end||this._continuePt.x===this._startPt.x&&this._continuePt.y===this._startPt.y)}},{key:"_composeRange",value:function(e,n){var r=(0,u.Z)((0,f.Z)(t.prototype),"_composeRange",this).call(this,e,n);if(null===r)return null;var o=this._sheet._getActiveSelectedRange(),i=this.direction();return i===M._8N.Up||i===M._8N.Down?(r.setColFrom(o.colFrom()),r.setColCount(o.colCount())):(r.setRowFrom(o.rowFrom()),r.setRowCount(o.rowCount())),o.contain(r)?o:(i===M._8N.Up&&r.setRowCount(r.rowCount()+o.rowCount()-1),i===M._8N.Left&&r.setColCount(r.colCount()+o.colCount()-1),r)}}]),t}(V.mhL);!function(e){e.Auto="auto",e.CopyCells="copyCells",e.FillSeries="fillSeries",e.FillFormattingOnly="fillFormattingOnly",e.FillWithoutFormatting="fillWithoutFormatting"}(Ae||(Ae={}));function Je(e){var t=function(e){var t=e.split(",").map((function(e){return Number(e)})),n=(0,h.Z)(t,5),r=n[0],o=n[1],i=n[2],a=n[3],s=n[4];return{isRow:r===O.xj7.ROW,level:o,start:i,count:a,expanded:s===O.w2y.Expand}}(e),n=t.isRow,r=t.start,o=t.count;return(0,M.oYo)(r,o,n)}function qe(e){return e.type===O.xj7.ROW?{type:O.xj7.ROW,row:e.start,rowCount:e.count}:{type:O.xj7.COL,col:e.start,colCount:e.count}}var $e,Xe=function(){function e(t,n){(0,p.Z)(this,e),this.spread=t,this.commandManager=n,this.subsciption=new A.w,this.handleRowColChange=function(e,t,n){if(t&&t.length&&!(t.length>1)){var r=t[0],o=r.target,i=r.count,a=n.outlineGroupModel;if(("RowAdded"===e||"RowDeleted"===e?a.rowOutlineTree:a.colOutlineTree).length)switch(e){case"RowAdded":a.adjustOutlineAfterAddRowCol(O.xj7.ROW,o,i);break;case"RowDeleted":a.adjustOutlineAfterDelRowCol(O.xj7.ROW,o,i);break;case"ColumnAdded":a.adjustOutlineAfterAddRowCol(O.xj7.COL,o,i);break;case"ColumnDeleted":a.adjustOutlineAfterDelRowCol(O.xj7.COL,o,i)}}},this.bindEvents(!0)}return(0,g.Z)(e,[{key:"getActiveSheet",value:function(){return this.spread.getActiveSheet()}},{key:"checkEditable",value:function(e,t,n){var r=e.inject(Z.f3);if(n){if(!r.sheetBusinessEditable)return!1;var o=e.parent.permissionManager.hasPermission(e.id()),i=e.protectionModel.getRangePermissions(n).hasPermission;return!(!o||!i)||(e._raiseInvalidOperation(t,""),!1)}if(!r.sheetBusinessEditable)return!1;var a=r.protectionPermission;return!(!a.curSheetEditable||!a.curRangeEditable)||(e._raiseInvalidOperation(t,""),!1)}},{key:"checkEditableWithoutProtection",value:function(e){return e.inject(Z.f3).sheetBusinessEditable}},{key:"bindEvents",value:function(e){this.subsciption.unsubscribe(),e&&(this.subsciption=new A.w,this.subsciption.add(this.spread.subscribe({RowAdded:this.handleRowColChange.bind(this,"RowAdded"),RowDeleted:this.handleRowColChange.bind(this,"RowDeleted"),ColumnAdded:this.handleRowColChange.bind(this,"ColumnAdded"),ColumnDeleted:this.handleRowColChange.bind(this,"ColumnDeleted")})))}},{key:"addOutline",value:function(e){var t=this.getActiveSheet();if(!t)return!1;var n=(0,M.ENK)(t),r=n.multiSelectType,o=n.currentRgType;if(0!==r||o!==O.xj7.COL&&o!==O.xj7.ROW)return!1;var i=t.getSelections();if(!i||0===i.length)return!1;var a=i[0];if(!this.checkEditable(t,11,[a]))return!1;var s=function(e,t){return e.rowCount()===t.getRowCount()?{type:O.xj7.COL,col:e.colFrom(),colCount:e.colCount()}:e.colCount()===t.getColumnCount()?{type:O.xj7.ROW,row:e.rowFrom(),rowCount:e.rowCount()}:void 0}(a,t);if(!s)return!1;var l={cmd:O.rvF.ADD_OUTLINE,sheetId:t.id(),target:s,state:M.w2y.Expand};if(this.commandManager.execute(l),e){var u,c,h=t.outlineGroupModel;null===(u=this.collector)||void 0===u||null===(c=u.collectEventOnCreateGroup)||void 0===c||c.call(u,s,h,e)}return!0}},{key:"delOutline",value:function(e,t){var n,r=this,o=this.getActiveSheet();if(!o)return!1;if(e)n=[Je(e)];else{var i=(0,M.ENK)(o),a=i.multiSelectType,s=i.currentRgType;if(0===a){var l=o.getSelections()[0];l&&(s===O.xj7.ALL&&(n=[(0,M.oYo)(l.rowFrom(),l.rowCount(),!0),(0,M.oYo)(l.colFrom(),l.colCount(),!1)]),s===O.xj7.ROW&&(n=[(0,M.oYo)(l.rowFrom(),l.rowCount(),!0)]),s===O.xj7.COL&&(n=[(0,M.oYo)(l.colFrom(),l.colCount(),!1)]))}}if(!n||0===n.length)return!1;var u=n.map((function(e){return function(e,t){return e.type===O.xj7.ROW?new M.lq$(e.row,e.rowCount,t):new M.rvb(e.col,e.colCount,t)}(e,o)}));if(!this.checkEditable(o,11,u))return!1;if(n.map((function(e){return{cmd:O.rvF.DEL_OUTLINE,sheetId:o.id(),target:e}})).forEach((function(e){return r.commandManager.execute(e)})),t){var c,h,d=o.outlineGroupModel;null===(c=this.collector)||void 0===c||null===(h=c.collectEventOnDeleteSingleGroup)||void 0===h||h.call(c,n[0].type,t,d)}return!0}},{key:"delAllOutlines",value:function(e,t){var n,r,o=this,i=this.getActiveSheet();if(!i)return!1;var a=i.outlineGroupModel,s=e===O.xj7.ROW?a.rowOutlineTree:e===O.xj7.COL?a.colOutlineTree:a.rowOutlineTree.concat(a.colOutlineTree),l=s.map((function(e){return function(e,t){var n=e.type===O.xj7.ROW,r=e.start,o=e.count;return n?new M.lq$(r,o,t):new M.rvb(r,o,t)}(e,i)}));return!(0===s.length||!this.checkEditable(i,11,l))&&(s.map((function(e){return{cmd:O.rvF.DEL_OUTLINE,sheetId:i.id(),target:qe(e)}})).forEach((function(e){return o.commandManager.execute(e)})),t&&null!==(n=this.collector)&&void 0!==n&&null!==(r=n.collectEventOnDeleteMultiGroup)&&void 0!==r&&r.call(n,e,t,a),!0)}},{key:"toggleOutline",value:function(e,t,n){var r=this.getActiveSheet();if(!r||!this.checkEditableWithoutProtection(r))return!1;var o=e.type===O.xj7.ROW,i={cmd:O.rvF.UPDATE_OUTLINE,sheetId:r.id(),target:e,state:t};this.commandManager.execute(i);var a=o?new M.lq$(e.row,e.rowCount,r):new M.rvb(e.col,e.colCount,r),s=o?e.row:0,l=o?0:e.col;if(r.setSelections([a],{row:s,column:l}),n){var u,c,h,d,f=r.outlineGroupModel;t===M.w2y.Fold?null===(u=this.collector)||void 0===u||null===(c=u.collectEventOnCollapseSingleGroup)||void 0===c||c.call(u,e,n,f):null===(h=this.collector)||void 0===h||null===(d=h.collectEventOnExpandSingleGroup)||void 0===d||d.call(h,e,n,f)}return!0}},{key:"toggleLevel",value:function(e,t,n,r){var o,i,a,s,l=this,u=this.getActiveSheet();if(!u||!this.checkEditableWithoutProtection(u))return!1;var c=u.outlineGroupModel,h=(e===O.xj7.ROW?c.rowOutlineTree:c.colOutlineTree).filter((function(e){return e.level===t}));return 0!==h.length&&(h.map((function(e){return{cmd:O.rvF.UPDATE_OUTLINE,sheetId:u.id(),target:qe(e),state:n}})).forEach((function(e){return l.commandManager.execute(e)})),r&&(n===M.w2y.Fold?null===(o=this.collector)||void 0===o||null===(i=o.collectEventOnCollapseMultiGroup)||void 0===i||i.call(o,e,r,c):null===(a=this.collector)||void 0===a||null===(s=a.collectEventOnExpandMultiGroup)||void 0===s||s.call(a,e,r,c)),!0)}},{key:"toggleAllOutlines",value:function(e,t,n){var r,o,i,a,s=this,l=this.getActiveSheet();if(!l||!this.checkEditableWithoutProtection(l))return!1;var u=l.outlineGroupModel,c=(e===O.xj7.ROW?u.rowOutlineTree:e===O.xj7.COL?u.colOutlineTree:u.rowOutlineTree.concat(u.colOutlineTree)).filter((function(e){return e.state!==t})).map((function(e){return{cmd:O.rvF.UPDATE_OUTLINE,sheetId:l.id(),target:qe(e),state:t}}));return 0!==c.length&&(c.forEach((function(e){return s.commandManager.execute(e)})),n&&(t===M.w2y.Fold?null===(r=this.collector)||void 0===r||null===(o=r.collectEventOnCollapseMultiGroup)||void 0===o||o.call(r,e,n,u):null===(i=this.collector)||void 0===i||null===(a=i.collectEventOnExpandMultiGroup)||void 0===a||a.call(i,e,n,u)),!0)}},{key:"setCollector",value:function(e){this.collector=e}},{key:"destroy",value:function(){this.bindEvents(!1)}}]),e}();Xe=q([(0,b.b)(),$(0,(0,I.f)(M.Wje)),$(1,(0,I.f)(M.DsI))],Xe),function(e){e[e.Add=0]="Add",e[e.Remove=1]="Remove"}($e||($e={}));var Qe="controller/search/command",et=function(){function e(){var t=this;(0,p.Z)(this,e),this.commandName=O.rvF.SEARCH,this.canUndo=!1,this.execute=function(e,n,r,o){var i=n.sheetId,a=n.type,s=n.dirtyRect,l=n.needSort;if(!i)return!1;var u=e.getSheetFromId(i);if(!u)return!1;var c=u.inject(M.dP7);return 0===a?c.addSearchResult(n.items,s,l):1===a&&c.removeSearchResult(n.row,n.col,s),t.setBaseOptions(n,c),!0}}return(0,g.Z)(e,[{key:"undo",value:function(){return!1}},{key:"setBaseOptions",value:function(e,t){var n=e.activeColor,r=e.highlightColor,o=e.enabled,i=e.activeCell,a=e.dirtyRect;void 0!==o&&t.setEnable(o),n&&t.setActiveColor(n),r&&t.setHighlightColor(r),i&&t.setActiveCell(i[0],i[1]),t.setDirtyRect(a)}}]),e}();et=q([(0,b.b)()],et);var tt,nt,rt,ot,it="pivot-table-controller",at="pivot-table-manager-controller",st="pivot-table-render-controller";!function(e){e[e.rowGrandTotal=0]="rowGrandTotal",e[e.colGrandTotal=1]="colGrandTotal",e[e.rowSubtotal=2]="rowSubtotal",e[e.colSubtotal=3]="colSubtotal",e[e.rowLabel=4]="rowLabel",e[e.colLabel=5]="colLabel"}(tt||(tt={})),function(e){e.COVER_SHEET="coverSheet",e.OVER_FLOW="oveflow",e.COVER_PIVOT_TABLE="coverPivotTable",e.COVER_SOURCE="coverSource",e.HAS_STYLE="hasStyle",e.NO_PERMISSION="noPermission",e.VALID="valid"}(nt||(nt={})),function(e){e.Loading="Loading",e.Loaded="Loaded"}(rt||(rt={})),function(e){e.AddPivotTable="addPivotTable",e.MovePivotTable="movePivotTable",e.OperatePivotTablePanel="operatePivotTablePanel",e.Others="others"}(ot||(ot={}));var lt=function(){function e(){(0,p.Z)(this,e),this.ranges=[]}var t,n;return(0,g.Z)(e,[{key:"showModal",value:(n=(0,l.Z)(s().mark((function e(t){var n,r,o,i,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.parent.options.situation){e.next=2;break}return e.abrupt("return",!1);case 2:return r=O.Ps3.modalHelper.showCoverSheetContentConfirmModel(),o=r.closeFn,i=r.promise,this.closeModalFn=o,e.next=6,i;case 6:return a=e.sent,e.abrupt("return",(null!==(n=O.Ps3.collectSheetEvent)&&void 0!==n&&n.call(O.Ps3,"ccm_sheet_data_pivot_show_cover_modal",{action:a?1:0,from:ot.AddPivotTable}),this.closeModalFn=void 0,a));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"showModalWithClear",value:(t=(0,l.Z)(s().mark((function e(t,n,r,o){var i=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!t.parent.options.situation&&(this.curSheet===t&&this.curBlockToken===n||this.reset(),this.curSheet=t,this.curBlockToken=n,this.ranges.push(r),this.timer&&clearTimeout(this.timer),new Promise((function(e,r){i.timer=setTimeout((0,l.Z)(s().mark((function a(){var l,u,c,h,d,f,v,p;return s().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return d=O.Ps3.modalHelper.showCoverSheetContentConfirmModel(),f=d.closeFn,v=d.promise,i.closeModalFn=function(){f(),e()},a.next=4,v;case 4:p=a.sent,null!==(l=O.Ps3.collectSheetEvent)&&void 0!==l&&l.call(O.Ps3,"ccm_sheet_data_pivot_show_cover_modal",{action:p?1:0,from:o}),p?(t.formatPivotTableRange([i.ranges[0],i.ranges[1]],n,!0,!0),e()):(null!==(u=t.parent)&&void 0!==u&&null!==(c=u.undoManager)&&void 0!==c&&null!==(h=c.call(u))&&void 0!==h&&h.undo(),r()),i.reset();case 6:case"end":return a.stop()}}),a)}))))}))));case 1:case"end":return e.stop()}}),e,this)}))),function(e,n,r,o){return t.apply(this,arguments)})},{key:"closeModal",value:function(){return this.timer&&clearTimeout(this.timer),!!this.closeModalFn&&(this.closeModalFn(),!0)}},{key:"reset",value:function(){var e;null!==(e=this.closeModalFn)&&void 0!==e&&e.call(this),this.closeModalFn=void 0,this.curBlockToken=void 0,this.curSheet=void 0,this.ranges=[],this.timer&&clearTimeout(this.timer),this.timer=void 0}}]),e}(),ut=new lt;function ct(e,t,n,r){return r?new M.e6w(t,n,r.rowCount,r.colCount,e):new M.e6w(t,n,1,1,e)}function ht(e,t,n,r,o){return o?new M.e6w(r?t+r.rowCount+1:t,n,o.rowCount,o.colCount,e):new M.e6w(t+2,n,10,5,e)}function dt(e,t,n,r,o){if(o&&r)return{pageRange:new M.e6w(t,n,r.rowCount,r.colCount,e),contentRange:new M.e6w(t+r.rowCount+1,n,o.rowCount,o.colCount,e)};if(o&&!r)return{contentRange:new M.e6w(t,n,o.rowCount,o.colCount,e)};if(!o&&r)return{pageRange:new M.e6w(t,n,r.rowCount,r.colCount,e)};return{pageRange:new M.e6w(t,n,1,1,e),contentRange:new M.e6w(t+2,n,10,5,e),spanRange:new M.e6w(t+7,n+1,1,4,e)}}function ft(e,t,n,r,o,i){var a=e.inject(at);if(!a.hasPivotTable())return!1;var s,l=new M.e6w(t,n,r,o,e),u=Y(a.getPivotInfoMap());try{for(u.s();!(s=u.n()).done;){var c=(0,h.Z)(s.value,2),d=c[0],f=c[1];if(!(null!=i&&i.includes(d)||f.isHidden)){var v=f.contentRange,p=f.pageRange,g=f.row,m=f.col;if(l.containCell(g,m))return!0;if(null!=v&&v.isIntersect(l))return!0;if(null!=p&&p.isIntersect(l))return!0}}}catch(e){u.e(e)}finally{u.f()}return!1}function vt(e,t){var n=e.inject(at);if(n.hasPivotTable()){var r,o=Y(n.getPivotInfoMap());try{for(o.s();!(r=o.n()).done;){var i=(0,h.Z)(r.value,2)[1],a=i.pageRange,s=i.contentRange,l=i.row,u=i.col;if(null!=a&&a.contain(t)||null!=s&&s.contain(t)){var c=!(!a||!s),d=((null==a?void 0:a.rowCount())||0)+((null==s?void 0:s.rowCount())||0)+(c?1:0),f=Math.max((null==a?void 0:a.colCount())||0,(null==s?void 0:s.colCount())||0);return new M.e6w(l,u,d,f,e)}}}catch(e){o.e(e)}finally{o.f()}}}function pt(e,t,n,r){var o=e.inject(at),i=t.rowFrom(),a=t.colFrom();if(i<0||a<0)return{coverResult:nt.OVER_FLOW,overflowCol:0,overflowRow:0};var s=t.rowCount(!0),l=t.colCount(!0),u=e.getRowCount(),c=e.getColumnCount(),h=a+l>c?a+l-c:0,d=i+s>u?i+s-u:0,f=(0,O.$$w)();if((h||d)&&(u+d)*(c+h)>f)return{coverResult:nt.OVER_FLOW,overflowCol:h,overflowRow:d};if(s!==t.rowCount(!0)||l!==t.colCount(!0))return{coverResult:nt.OVER_FLOW,overflowCol:h,overflowRow:d};if(e.checkRangesProtected(t))return{coverResult:nt.NO_PERMISSION,overflowCol:h,overflowRow:d};var v=[n].filter(Boolean);if(ft(e,i,a,s,l,v))return{coverResult:nt.COVER_PIVOT_TABLE,overflowCol:h,overflowRow:d};var p=[t];if(n&&o.getPivotInfoByName(n)){var g;if(null!==(g=o.getSourceRange(n))&&void 0!==g&&g.isIntersect(t))return{coverResult:nt.COVER_SOURCE,overflowCol:h,overflowRow:d};if(!r){var m=o.getPivotInfoByName(n),_=[];m.pageRange&&_.push(m.pageRange),m.contentRange&&_.push(m.contentRange),p=(0,M.O6n)(t,_)}}var y=p.some((function(t){return e._getModel().iterContent(t.rowFrom(),t.colFrom(),t.rowCount(),t.colCount(),!0).next()})),C=p.some((function(t){return e._spanModel.iter(t.rowFrom(),t.colFrom(),t.rowTo(),t.colTo(),!0).next()})),S=p.some((function(t){return e._getModel().iterDataValidation(t.rowFrom(),t.colFrom(),t.rowCount(),t.colCount()).next()}));return{coverResult:y?nt.COVER_SHEET:C||S?nt.HAS_STYLE:nt.VALID,overflowCol:h,overflowRow:d}}function gt(e,t,n,r){var o=e.inject(at),i=t.rowFrom(),a=t.colFrom(),s=t.rowCount(!0),l=t.colCount(!0),u=e.getRowCount(),c=e.getColumnCount(),h=a+l>c?a+l-c:0,d=i+s>u?i+s-u:0,f=[t];if(n&&o.getPivotInfoByName(n)&&!r){var v=o.getPivotInfoByName(n),p=[];v.pageRange&&p.push(v.pageRange),v.contentRange&&p.push(v.contentRange),f=(0,M.O6n)(t,p)}var g=f.some((function(t){return e._getModel().iterContent(t.rowFrom(),t.colFrom(),t.rowCount(),t.colCount(),!0).next()})),m=f.some((function(t){return e._spanModel.iter(t.rowFrom(),t.colFrom(),t.rowTo(),t.colTo(),!0).next()})),_=f.some((function(t){return e._getModel().iterDataValidation(t.rowFrom(),t.colFrom(),t.rowCount(),t.colCount()).next()}));return{coverResult:g?nt.COVER_SHEET:m||_?nt.HAS_STYLE:nt.VALID,overflowCol:h,overflowRow:d}}function mt(e,t,n,r,o,i){return _t.apply(this,arguments)}function _t(){return(_t=(0,l.Z)(s().mark((function e(t,n,r,o,i,a){var l,u,c,h,d,f,v,p,g,m,_,y,C;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=ct(t,n,r,o),u=ht(t,n,r,o,i),!a.isIntersect(u)&&!a.isIntersect(l)){e.next=3;break}return e.abrupt("return",{status:!1,errorTip:z("CreationDoc_Sheets_PivotTable_PositionOverlapWithDataSource_Toast")});case 3:if(c=pt(t,l),h=c.coverResult,d=c.overflowCol,f=c.overflowRow,v=pt(t,u),p=v.coverResult,g=v.overflowCol,m=v.overflowRow,_=!1,"coverPivotTable"!==p&&"coverPivotTable"!==h){e.next=7;break}throw new Error(z("CreationDoc_Sheets_PivotTable_Failed_AlreadyHavePivot"));case 7:if("coverSheet"!==p&&"coverSheet"!==h){e.next=15;break}return e.next=10,ut.showModal(t);case 10:if(e.sent){e.next=12;break}return e.abrupt("return",{status:!1});case 12:_=!0,e.next=16;break;case 15:"hasStyle"!==p&&"hasStyle"!==h||(_=!0);case 16:return y=0,C=0,e.abrupt("return",((f||m)&&(y=Math.max(f,m)),(d||g)&&(C=Math.max(d,g)),{status:!0,shouldClear:_,defaultContentRange:u,defaultPageRange:l,addColCount:C,addRowCount:y}));case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function yt(e,t){if(!e.parent.permissionManager.hasSheetVisiblePermission(e.id()))return!1;var n=e.inject(at).getPivotInfoByName(t);if(n){var r=n.contentRange,o=n.pageRange;if(o&&e.checkRangesProtected(o))return!0;if(r&&e.checkRangesProtected(r))return!0}return!1}function Ct(e,t,n,r,o,i,a){var s=function(e,t,n){var r=e.inject(at),o=r.getPivotTableNameByCell(t,n),i=r.getPivotTableByName(o);if(!i||!e)return null;var a=i.getName(),s=e.getEmbeddedBlockByToken(a).position;return{offsetRow:t-s.row,offsetCol:n-s.col}}(e,n,r);if(!s)return[];var l=s.offsetRow,u=s.offsetCol;if(l<0||u<0)return[];var c=e.inject(at),h=c.getPivotTableNameByCell(n,r),d=c.getPivotTableByName(h),f=c.getViewDataModelByName(h);if(!d||!e||!f)return[];var v=d.getName(),p=e.getEmbeddedBlockByToken(v).position,g=function(e,t){var n=e.getPivotTableManagerV2(),r=n.getActivePivotTable(),o=t.sheetView();if(!r||!o)return null;var i=r.getName(),a=e.getEmbeddedBlockByToken(i).position,s=o.getVisibleRangeWithFrozen().toJSON(),l=n.getViewDataModelByToken(i),u=l.row,c=l.col,h=l.page,d=u.pivotInfos,f=c.pivotInfos,v=d.length,p=f.length,g=c.range.rowCount+h.range.rowCount+1,m=u.range.colCount;return{rowPivotInfosVisibleLength:Math.min(s.row+s.rowCount-a.row-g,v),colPivotInfosVisibleLength:Math.min(s.col+s.colCount-a.col-m,p)}}(e,t);if(!g)return[];var m=function(e,t,n,r,o,i,a){var s=t.offsetRow,l=t.offsetCol,u=e.row,c=e.col,h=e.page,d=e.getPositionAreaInfo(s,l).areaType,f=o.getFieldArea(r);if(void 0!==a)return function(e,t,n){var r=e.row,o=e.col,i=e.page,a=0===n||4===n||2===n,s=a?r.pivotInfos:o.pivotInfos,l=a?t.rowPivotInfosVisibleLength:t.colPivotInfosVisibleLength,u=o.range.rowCount+i.range.rowCount+1,c=[];switch(n){case 1:case 0:for(var h=l-1;h>-1;h--){if(0===s[h].level&&s[h].isSubTotal)for(var d=a?r.range.colCount+o.range.colCount:u+r.range.rowCount-1,f=a?0:i.range.rowCount+1;f<d;f++)c.push({offsetRow:a?u+h:f+1,offsetCol:a?f:r.range.colCount+h});if(s[h].level>0)break}break;case 3:case 2:for(var v=0;v<l;v++){var p=a?0:i.range.rowCount+1;if(0!==s[v].level&&s[v].isSubTotal)for(var g=a?r.range.colCount+o.range.colCount:u+r.range.rowCount-1,m=p;m<g;m++)c.push({offsetRow:a?u+v:m+1,offsetCol:a?m:r.range.colCount+v})}break;case 4:case 5:for(var _=0;_<l;_++){var y=a?0:i.range.rowCount+1;if(0!==s[_].level&&!s[_].isSubTotal)for(var C=a?r.range.colCount:u-1,S=y;S<C;S++)c.push({offsetRow:a?u+_:S+1,offsetCol:a?S:r.range.colCount+_})}}return c}(e,n,a);if(1!==f&&2!==f)return null;var v=o._isValueDimInRow(),p=o._isValueDimInCol(),g=c.pivotInfos,m=u.pivotInfos,_=c.range.rowCount+h.range.rowCount+1,y=u.range.colCount,C=[];switch(d){case"rowDim":if(1!==f)return null;for(var S=0,k=n.rowPivotInfosVisibleLength;S<k;S++){var E,T=m[S],b=T.fieldName,I=T.level,R=T.size;if(b.length){var w=m[S].valueFieldName;i&&!w&&(w=m[S].valueFieldName||(null===(E=o.valueFields[0])||void 0===E?void 0:E.fieldName)),b[I-1]===r&&i===w&&C.push({offsetRow:_+S-R+1,offsetCol:I-1})}}break;case"colDim":if(2!==f)return null;for(var A=o.valueFields.length,F=0,D=n.colPivotInfosVisibleLength;F<D;F++){var N,P=g[F],O=P.fieldName,M=P.level,L=P.size;if(O.length){var x=g[F].valueFieldName;i&&!x&&(x=g[F].valueFieldName||(null===(N=o.valueFields[0])||void 0===N?void 0:N.fieldName)),O[M-1]===r&&i===x&&C.push({offsetRow:M,offsetCol:y+F-L+(0===A?1:A)})}}break;case"value":for(var V=1===f,Z=V?m:g,B=V?n.rowPivotInfosVisibleLength:n.colPivotInfosVisibleLength,H=0;H<B;H++){var U=Z[H],j=U.fieldName,G=U.level,K=U.valueFieldName;if(j.length){var W=!1;switch(!0){case V&&!p&&!v:case!V&&!p&&!v:case V&&p:case!V&&v:W=j[G-1]===r;break;case V&&v:case!V&&p:W=j[G-1]===r&&i===K}W&&C.push({offsetRow:V?_+H:s,offsetCol:V?l:y+H})}}}return C}(f,s,g,o,d._fieldsModel,i,a);return m?(0,M.qBP)(m.map((function(t){return new M.e6w(t.offsetRow+p.row,t.offsetCol+p.col,1,1,e)}))):[]}function St(e,t,n,r,o){if(3===r)return e.parent.pivotService.getText("CreationDoc_Sheets_PivotTable_Blank")||z("CreationDoc_Sheets_PivotTable_Blank");if(2===r&&void 0!==t){var i=o.getFieldFormat(n);return i?(0,U.createFormatter)(e.formatterService,i||"").format(Number(t)):t}return t}function kt(e,t,n,r){var o=e.inject(at),i=o.getCellInfo(n,r);if(!i)return null;var a=[];if(function(e){return["value","colSummary","rowSummary","total"].includes(e)}(i.areaType)){var s=o.getPivotTableNameByCell(n,r),l=o.getViewDataModelByName(s),u=i.colItems,c=i.rowItems,h=i.rowFieldNameList,d=i.colFieldNameList,f=i.measureFieldName,v=i.rowTypes,p=i.colTypes;if(!f)return null;if(h.length){var g=h[h.length-1],_=d[d.length-1],y=u.length?St(e,u[u.length-1],_,p[u.length-1],l):g,C=Ct(e,t,n,r,g,f);a.push({itemName:y,fieldName:g,sortInfo:{sortMode:H.Zv.value,constraints:u,measureFieldName:f},highlightRanges:C})}if(d.length){var S=d[d.length-1],k=h[h.length-1],E=c.length?St(e,c[c.length-1],k,v[c.length-1],l):S,T=Ct(e,t,n,r,S,f);a.push({itemName:E,fieldName:S,sortInfo:{sortMode:H.Zv.value,constraints:c,measureFieldName:f},highlightRanges:T})}return a}if(function(e){return["colDim","rowDim"].includes(e)}(i.areaType)){var b=i.fieldName,I=i.measureFieldName,R=i.fieldNameList,w=i.value,A=i.items,F="object"==(0,m.Z)(w)?w.text:w;if(!b||b===I||void 0===F||R.includes(F)||!R.length&&!A.length)return null;var D=Ct(e,t,n,r,b,I);return a.push({itemName:b,fieldName:b,sortInfo:{sortMode:H.Zv.field},highlightRanges:D}),a}return null}function Et(e,t,n){var r=t.toJSON(),o=r.row,i=r.col,a=r.rowCount,s=r.colCount,l=e.inject(at),u=l.getPositionCell(n);if(u){for(var c=u.row,d=u.col,f=function(e,t,n,r,o,i){var a=e.inject(at);if(!a.hasPivotTable())return[];var s,l=[],u=new M.e6w(t,n,r,o,e),c=Y(a.getPivotInfoMap());try{for(c.s();!(s=c.n()).done;){var d=(0,h.Z)(s.value,2),f=d[0],v=d[1],p=v.pageRange,g=v.contentRange,m=v.row,_=v.col;f!==i&&(u.containCell(m,_)||(null==p?void 0:p.isIntersect(u))||(null==g?void 0:g.isIntersect(u)))&&l.push(f)}}catch(e){c.e(e)}finally{c.f()}return l}(e,o,i,a,s,n),v=0;v<f.length;v++){var p=f[v],g=l.getPivotInfoByName(p);if(g){var m=g.pageRange,_=g.contentRange;((null==_?void 0:_.containCell(c,d))||(null==m?void 0:m.containCell(c,d)))&&l.setErrorState(p,M.bfo.Cover)}}l.setErrorState(n,M.bfo.Cover)}}var Tt=function(e,t,n){var r=t.getFieldArea(n);if(null==r)return null;var o=e.inject(at);if([4,3].includes(r))return null;var a=t.getName(),s=o.getPivotInfoByName(a),l=o.getViewDataModelByName(a);if(!l)return null;if(0===r){var u;if(null==s||!s.pageRange)return null;var c=s.pageRange.rowFrom(),h=(null===(u=l.page)||void 0===u?void 0:u.dataTable)||{},d=Object.keys(h).find((function(e){var t,r;return(null===(t=h[e])||void 0===t||null===(r=t[0])||void 0===r?void 0:r.value)===n}));return null==d?null:{row:c+Number(d),col:s.pageRange.colFrom()+1}}if(null==s||!s.contentRange)return null;var f=s.contentRange.rowFrom(),v=s.contentRange.colFrom();if(1===r){var p=l.corner.dataTable||{},g=Math.max.apply(Math,(0,i.Z)(Object.keys(p).map(Number))),m=p[g]||{},_=Object.keys(m).find((function(e){var t;return(null===(t=m[e])||void 0===t?void 0:t.value)===n}));return"string"==typeof _?{row:f+g,col:v+Number(_)}:null}if(2===r){var y,C=l.col.dataTable[0]||{},S=Object.keys(C).find((function(e){var t;return(null===(t=C[e])||void 0===t?void 0:t.value)===n}));return null==S?null:{row:f,col:v+((null===(y=l.row.range)||void 0===y?void 0:y.colCount)||0)+Number(S)}}return null};function bt(e){for(var t=e.sheets,n=0,r=0;r<t.length;r++)n+=Object.keys(t[r].embeddedBlocksModel.getBlocksMap()).length;return n}var It=function(e,t){return"".concat(e,"-").concat(t,"-").concat((0,H.Ki)())},Rt=function(e){var t=localStorage.getItem("ShowPivotPanelKeyList");if(t)try{var n,r=Y(JSON.parse(t));try{for(r.s();!(n=r.n()).done;){var o=n.value,i=o.s_id,a=o.s;if(i===e)return a}}catch(e){r.e(e)}finally{r.f()}}catch(e){console.log("ShowPivotPanelKeyList not json")}else{var s=localStorage.getItem("ShowPivotPanelKey");if(null!=s){var l=[{s_id:e,s:s}];localStorage.removeItem("ShowPivotPanelKey");try{localStorage.setItem("ShowPivotPanelKeyList",JSON.stringify(l))}catch(e){console.log("localStorage is full")}return s}}},wt=function(e,t){var n=localStorage.getItem("ShowPivotPanelKeyList"),r=[];n&&(r=(JSON.parse(n)||[]).filter((function(t){return t.s_id!==e}))),r.push({s_id:e,s:t}),r.length>50&&r.shift();try{localStorage.setItem("ShowPivotPanelKeyList",JSON.stringify(r))}catch(e){console.log("localStorage is full")}};var At=function(e,t,n,r,o,i){[n,r].forEach((function(n){n&&(0,M.KST)(n,(function(n,r){e.deleteCellPivotCache(n,r,t)}))})),[o,i].forEach((function(n){n&&(0,M.KST)(n,(function(n,r){e.setCellPivotCache(n,r,t)}))}))},Ft=function(){function e(){var t=this;(0,p.Z)(this,e),this.shouldClear=!1,this.addRowCount=0,this.addColCount=0,this.dirtyRefsMap=new Map,this.initialCount=0,this.setShouldClear=function(e,n,r){void 0!==r&&(t.shouldClear=r),e>t.addRowCount&&(t.addRowCount=e),n>t.addColCount&&(t.addColCount=n)},this.handleAllEmbeddedBlockSet=function(e){var n=t.sheet;if(e.sheetId===n.id()){var r=n.embeddedBlocksModel.getBlocksMap();t.initialCount=r&&Object.keys(r).length}},this.handlePivotTablesLoaded=function(e){var n=t.sheet,r=t.pivotTableManagerV2;r.updatePivotTableInfo(e,{loaded:!0});var o=t.initialCount;if(!(o<=0)){var i,a=0,s=Y(r.getPivotInfoMap());try{for(s.s();!(i=s.n()).done;){(0,h.Z)(i.value,2)[1].loaded&&a++,a===o&&(n.dispatch("SheetAllPivotTableLoaded",{sheetId:n.id()}),t.initialCount=-1)}}catch(e){s.e(e)}finally{s.f()}}}}return(0,g.Z)(e,[{key:"addRefsToDirtyRefs",value:function(e,t){var n=t.filter(Boolean).reduce((function(e,t){return t&&!e.some((function(e){return(0,E.default)(e.toJSON(),t.toJSON())}))&&e.push(t),e}),[]);this.dirtyRefsMap.get(e)||this.dirtyRefsMap.set(e,new Set);for(var r=this.dirtyRefsMap.get(e),o=0;o<n.length;o++)r.add(n[o])}},{key:"clearDirtyRefs",value:function(e){this.dirtyRefsMap.delete(e)}},{key:"getDirtyRefs",value:function(e){return this.dirtyRefsMap.get(e)}},{key:"clearFormatInfo",value:function(){this.shouldClear=!1,this.addRowCount=0,this.addColCount=0}},{key:"_removeRangeListCache",value:function(e){var t=this,n=this.getDirtyRefs(e);n&&(n.forEach((function(e){t.sheet.removeComposedStyleCache(e.rowFrom(),e.colFrom(),e.rowCount(),e.colCount()),t.sheet.dispatch("PivotTableRangeChanged",{range:e})})),this.sheet.notifyShell(102))}},{key:"_markDirtyRangeList",value:function(e,t){var n=this,r=this.getDirtyRefs(e);r&&(t||r.forEach((function(t){var r=t.clone();r.isUnionable=function(){return!1},n.sheet.getCalcEngine().markDirty([r],{isDirtyAlwaysCalc:!1,pivotToken:e})})))}},{key:"applyDirtyRangeList",value:function(e,t){this._markDirtyRangeList(e,t),this._removeRangeListCache(e),this.clearDirtyRefs(e)}},{key:"handleRangeCoverResult",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=r.passive,i=r.sourceRangeChange,a=r.allowCoverPivot,s=o||i,l=n.coverResult,u=n.overflowRow,c=n.overflowCol;switch(l){case nt.NO_PERMISSION:if(s){var h=gt(this.sheet,t,e,null==r?void 0:r.checkOldRange);if((null==h?void 0:h.coverResult)===nt.COVER_SHEET||(null==h?void 0:h.coverResult)===nt.HAS_STYLE)return void this.setErrorState(e,M.bfo.Cover);break}return O.Ps3.Toast.warning({key:"pivot_no_perm",content:z("CreationDoc_Sheets_CellIsProtected")}),!0;case nt.COVER_PIVOT_TABLE:return s||a?void Et(this.sheet,t,e):(O.Ps3.Toast.warning({key:"cover_pivot_table",content:z("CreationDoc_Sheets_PivotTable_Failed_AlreadyHavePivot")}),!0);case nt.COVER_SHEET:return this.setErrorState(e,M.bfo.Cover),void(s||ut.showModalWithClear(this.sheet,e,t,void 0!==o?ot.OperatePivotTablePanel:ot.Others));case nt.HAS_STYLE:if(s)return void Et(this.sheet,t,e);this.setShouldClear(u,c,!0);break;case nt.OVER_FLOW:return!(0,O.pPK)()&&void this.setErrorState(e,M.bfo.Shrink);case nt.COVER_SOURCE:return s?void this.setErrorState(e,M.bfo.CoverSource):(O.Ps3.Toast.warning({key:"cover_source_range",content:z("CreationDoc_Sheets_PivotTable_PositionOverlapWithDataSource_Toast")}),!0);case nt.VALID:}return!1}},{key:"handlePageSizeChange",value:function(e,t,n){var r=this.pivotTableManagerV2.getPivotInfoByToken(t);if(!r)return!0;var o=this.sheet,i=null==n?void 0:n.checkOldRange,a=new M.e6w(r.row,r.col,e.rowCount,e.colCount,o),s=pt(o,a,t,i);if(s.coverResult===nt.VALID){var l=s.overflowRow,u=s.overflowCol;return this.setShouldClear(l,u),this.addRefsToDirtyRefs(t,[r.pageRange,a]),this.pivotTableManagerV2.updatePivotTableInfo(t,{pageRange:a}),this.setErrorState(t,M.bfo.None),!1}var c=this.handleRangeCoverResult(t,a,s,n);if(!1!==c)return c;var h=s.overflowRow,d=s.overflowCol;return this.setShouldClear(h,d),this.addRefsToDirtyRefs(t,[r.pageRange,a]),this.pivotTableManagerV2.updatePivotTableInfo(t,{pageRange:a}),this.setErrorState(t,M.bfo.None),!1}},{key:"handleContentSizeChange",value:function(e,t,n){var r=this.pivotTableManagerV2.getPivotInfoByToken(t);if(!r)return!0;var o=null==n?void 0:n.checkOldRange,i=r.row,a=r.col,s=r.spanRange,l=r.pageRange;s&&(this.sheet.removeEmptyPivotTableSpan(s),this.pivotTableManagerV2.updatePivotTableInfo(t,{spanRange:void 0}));var u=l?l.rowTo()+2:i,c=(null==l?void 0:l.colFrom())||a,h=new M.e6w(u,c,e.rowCount,e.colCount,this.sheet),d=pt(this.sheet,h,t,o);if(d.coverResult===nt.VALID){var f=d.overflowRow,v=d.overflowCol;return this.setShouldClear(f,v),this.addRefsToDirtyRefs(t,[r.contentRange,h]),this.pivotTableManagerV2.updatePivotTableInfo(t,{contentRange:h}),this.setErrorState(t,M.bfo.None),!1}var p=this.handleRangeCoverResult(t,h,d,n);if(!1!==p)return p;var g=d.overflowRow,m=d.overflowCol;return this.setShouldClear(g,m),this.addRefsToDirtyRefs(t,[r.contentRange,h]),this.pivotTableManagerV2.updatePivotTableInfo(t,{contentRange:h}),this.setErrorState(t,M.bfo.None),!1}},{key:"handleEmptyPageChange",value:function(e,t){var n=null==t?void 0:t.checkOldRange,r=this.pivotTableManagerV2.getPivotInfoByToken(e);if(!r)return!0;var o=ct(this.sheet,r.row,r.col),i=pt(this.sheet,o,e,n);if(i.coverResult===nt.VALID){var a=i.overflowRow,s=i.overflowCol;return this.setShouldClear(a,s),this.addRefsToDirtyRefs(e,[r.pageRange,o]),this.pivotTableManagerV2.updatePivotTableInfo(e,{pageRange:o}),!1}var l=this.handleRangeCoverResult(e,o,i,t);if(!1!==l)return l;var u=i.overflowRow,c=i.overflowCol;return this.setShouldClear(u,c),this.addRefsToDirtyRefs(e,[r.pageRange,o]),this.pivotTableManagerV2.updatePivotTableInfo(e,{pageRange:o}),!1}},{key:"handleEmptyContentChange",value:function(e,t){var n=this.pivotTableManagerV2.getPivotInfoByToken(e);if(!n)return!0;var r=null==t?void 0:t.checkOldRange,o=ht(this.sheet,n.row,n.col),i=pt(this.sheet,o,e,r);if(i.coverResult===nt.VALID){var a=i.overflowRow,s=i.overflowCol;this.setShouldClear(a,s);var l=n.spanRange;l&&this.sheet.removeEmptyPivotTableSpan(l);var u=new M.e6w(o.rowFrom()+5,o.colFrom()+1,1,4,this.sheet);return this.pivotTableManagerV2.updatePivotTableInfo(e,{spanRange:u}),this.sheet.setEmptyPivotTableSpan(u),this.addRefsToDirtyRefs(e,[n.contentRange,o]),this.pivotTableManagerV2.updatePivotTableInfo(e,{contentRange:o}),this.setErrorState(e,M.bfo.None),!1}var c=this.handleRangeCoverResult(e,o,i,t);if(!1!==c)return c;var h=i.overflowRow,d=i.overflowCol;this.setShouldClear(h,d);var f=n.spanRange;f&&this.sheet.removeEmptyPivotTableSpan(f);var v=new M.e6w(o.rowFrom()+5,o.colFrom()+1,1,4,this.sheet);return this.pivotTableManagerV2.updatePivotTableInfo(e,{spanRange:v}),this.sheet.setEmptyPivotTableSpan(v),this.addRefsToDirtyRefs(e,[n.contentRange,o]),this.pivotTableManagerV2.updatePivotTableInfo(e,{contentRange:o}),this.setErrorState(e,M.bfo.None),!1}},{key:"reRenderPivotTable",value:function(e){var t,n,r=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=o.passive,a=o.dontAddToCommandStack,s=o.dontMarkFormulaDirty,l=o.shouldAutoFitCol,u=void 0===l||l,c=this.pivotTableManagerV2,h=c.getPivotTablePreViewByToken(e)||c.getViewDataModelByName(e),d=this.dataSourceManager.getSourceRange(e);if(d){if(!d.isValid())return void this.setErrorState(e,M.bfo.LessThanTwo);var f=d.toJSON(),v=f.row,p=f.col,g=f.rowCount,m=f.colCount,_=d.sheet();if(_&&ft(_,v,p,g,m))return void this.setErrorState(e,M.bfo.SourceHasPivot)}var y=c.getPivotInfoByToken(e);if(y){var C=null===(t=y.contentRange)||void 0===t?void 0:t.clone(),S=null===(n=y.pageRange)||void 0===n?void 0:n.clone();if(h){if(!y.isHidden){var k=h.getRangeSize(),E=k.page,T=k.content;c.updatePivotTableInfo(e,{isEmpty:!E&&!T});var b=!1;if(E?b=this.handlePageSizeChange(E,e,o):T?(this.addRefsToDirtyRefs(e,[y.pageRange]),this.pivotTableManagerV2.updatePivotTableInfo(e,{pageRange:void 0})):b=this.handleEmptyPageChange(e,o),b)return this.clearDirtyRefs(e),this.clearFormatInfo(),!0;if(void 0!==b)return T?b=this.handleContentSizeChange(T,e,o):E?(y.spanRange&&(this.sheet.removeEmptyPivotTableSpan(y.spanRange),c.updatePivotTableInfo(e,{spanRange:void 0})),this.addRefsToDirtyRefs(e,[y.contentRange]),c.updatePivotTableInfo(e,{contentRange:void 0})):b=this.handleEmptyContentChange(e,o),b?(this.clearDirtyRefs(e),this.clearFormatInfo(),!0):void(void 0!==b?(h&&c.setViewDataModel(e,h),At(c,e,S,C,y.pageRange,y.contentRange),Promise.resolve().then((function(){if(i)(r.addRowCount||r.addColCount)&&r.sheet.formatPivotTableRange([void 0,void 0],e,!1,!1,r.addRowCount,r.addColCount,!0);else{var t=u&&!y.isEmpty;r.sheet.formatPivotTableRange([y.contentRange,y.pageRange],e,r.shouldClear,t,r.addRowCount,r.addColCount,a)}r.handlePivotTablesLoaded(e),r.applyDirtyRangeList(e,s),r.clearFormatInfo(),r._notifyRerender()}))):h&&c.setViewDataModel(e,h));c.getPivotTablePreViewByToken(e)&&c.setViewDataModel(e,h)}}else y.loaded&&y.errorState!==M.bfo.ServiceCalcLoading&&this.setErrorState(e,M.bfo.LessThanTwo)}}},{key:"_notifyRerender",value:function(){var e=this;Promise.resolve().then((function(){var t;null===(t=e.sheet.parent)||void 0===t||t.dispatch("PivotTableRerender",{sheetId:e.sheet.id()})}))}},{key:"setErrorState",value:function(e,t){var n,r,o=this.pivotTableManagerV2,i=o.getPivotInfoByToken(e);if(i&&(null==i?void 0:i.errorState)!==t){var a=null===(n=i.contentRange)||void 0===n?void 0:n.clone(),s=null===(r=i.pageRange)||void 0===r?void 0:r.clone();if(o.updatePivotTableInfo(e,{errorState:t}),t){var l,u=i.pageRange,c=i.contentRange,h=i.spanRange,d=i.row,f=i.col;u?(this.addRefsToDirtyRefs(e,[u.clone()]),u.setRowFrom(d),u.setColFrom(f),u.setRowCount(1),u.setColCount(1)):this.pivotTableManagerV2.updatePivotTableInfo(e,{pageRange:ct(this.sheet,d,f)}),c&&(this.addRefsToDirtyRefs(e,[c.clone()]),this.pivotTableManagerV2.updatePivotTableInfo(e,{contentRange:void 0})),h&&(this.sheet.removeEmptyPivotTableSpan(h),this.pivotTableManagerV2.updatePivotTableInfo(e,{spanRange:void 0})),At(this.pivotTableManagerV2,e,s,a,i.pageRange,i.contentRange),this.addRefsToDirtyRefs(e,[null===(l=i.pageRange)||void 0===l?void 0:l.clone()]),this.handlePivotTablesLoaded(e),this.applyDirtyRangeList(e,t===M.bfo.Circle),this._notifyRerender()}}}},{key:"dispose",value:function(){this.dataSourceManager=null,this.pivotTableManagerV2=null,this.sheet=null}}]),e}();q([(0,I.f)(M.SJM)],Ft.prototype,"sheet",void 0),q([(0,I.f)(M.THe)],Ft.prototype,"dataSourceManager",void 0),q([(0,I.f)(M.RSl)],Ft.prototype,"pivotTableManagerV2",void 0),Ft=q([(0,b.b)()],Ft);var Dt=function(){function e(t){var n=this;(0,p.Z)(this,e),this.sheet=t,this.getPivotInfoMap=function(){return n.basePivotTableManager.getPivotInfoMap()},this.getPivotTableByCell=function(e,t){return n.basePivotTableManager.getPivotTableByCell(e,t)},this.getPivotTableNameByCell=function(e,t){return n.basePivotTableManager.getPivotTableNameByCell(e,t)},this.getPositionCell=function(e){return n.basePivotTableManager.getPositionCell(e)},this.hasPivotTableAtCell=function(e,t){return n.basePivotTableManager.hasPivotTableAtCell(e,t)},this.getPivotErrorStateByCell=function(e,t){return n.basePivotTableManager.getPivotErrorStateByCell(e,t)},this.getViewDataModelByPosition=function(e,t){return n.basePivotTableManager.getViewDataModelByPosition(e,t)},this.getRepeatLabelInfo=function(e,t){return n.basePivotTableManager.getRepeatLabelInfo(e,t)},this.getCellInfo=function(e,t){return n.basePivotTableManager.getCellInfo(e,t)},this.getCellValue=function(e,t){return n.basePivotTableManager.getCellValue(e,t)},this.getCellStyle=function(e,t){return n.basePivotTableManager.getCellStyle(e,t)},this.getCellErrorInfo=function(e,t){return n.basePivotTableManager.getCellErrorInfo(e,t)},this.getFieldValueInfo=function(e,t,r){return n.basePivotTableManager.getFieldValueInfo(e,t,r)},this.isEmptyPivotTable=function(e){return n.basePivotTableManager.isEmptyPivotTable(e)},this.hasPivotTable=function(){return n.basePivotTableManager.hasPivotTable()},this.composePivotStyle=function(e,t,r){return n.basePivotTableManager.composePivotStyle(e,t,r)},this.getPivotInfoByName=function(e){return n.basePivotTableManager.getPivotInfoByName(e)},this.getViewDataModelByName=function(e){return n.basePivotTableManager.getViewDataModelByName(e)},this.getPivotTableByName=function(e){return n.basePivotTableManager.getPivotTableByName(e)},this.reRenderPivotTable=function(e,t){return n.pivotTableController.reRenderPivotTable(e,t)},this.addPivotTable=function(e){return n.pivotTableController.addPivotTable(e)},this.deletePivotTable=function(e,t){return n.pivotTableController.deletePivotTable(e,t)},this.getViewDataModelByToken=function(e){return n.pivotTableManagerV2.getViewDataModelByToken(e)},this.getSnapshotFromTempPivot=function(e,t){return n.pivotTableController.getSnapshotFromTempPivot(e,t)},this.getSourceRange=function(e){return n.sheet.parent.getPivotDataSourceManager().getSourceRange(e)},this.getSyncModelByBlockToken=function(e){return n.sheet.parent.getPivotSyncModelManager().getSyncModel(e)},this.setErrorState=function(e,t){n.pivotTableController.setErrorState(e,t)},this.renderPivotTableWithBlockToken=function(){var e=(0,l.Z)(s().mark((function e(t,r){var o,i=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=i.length>2&&void 0!==i[2]?i[2]:{},n.pivotTableController.renderPivotTableWithBlockToken(t,r,o);case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),this.markDirtyAllPivotTables=function(){n.pivotTableController.markDirtyAllPivotTables()},this.handlePivotBlockUpdate=function(e){n.pivotTableController.handlePivotBlockUpdate(e)},this.reRenderDeletePivotTable=function(e){n.pivotTableController.reRenderDeletePivotTable(e)},this.movePivotTable=function(){var e=(0,l.Z)(s().mark((function e(t,r,o,i){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.pivotTableController.movePivotTable(t,r,o,i));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r,o){return e.apply(this,arguments)}}(),this.updateSourceRange=function(e,t,r){n.pivotTableController.updateSourceRange(e,t,r)},this.getFilterSort=function(e,t){return n.pivotTableController.getFilterSort(e,t)},this.getCollapse=function(e,t){return n.pivotTableController.getCollapse(e,t)},this.setPivotTable=function(e,t){n.pivotTableManagerV2.setPivotTable(e,t)},this.deletePivotInfo=function(e){n.pivotTableManagerV2.deletePivotTableInfoByToken(e)},this.setPivotInfo=function(e,t){return n.pivotTableManagerV2.setPivotTableInfo(e,t)},this.setDataViewModel=function(e,t){n.pivotTableManagerV2.setViewDataModel(e,t)},this.setPreDataViewModel=function(e,t){n.pivotTableManagerV2.setPivotTablePreView(e,t)},this.isPivotTableLoaded=function(e){var t;return!(null===(t=n.getPivotInfoByName(e))||void 0===t||!t.loaded)},this.resetPivotTableCopyInfo=function(){var e,t=Y(n.getPivotInfoMap());try{for(t.s();!(e=t.n()).done;){var r=(0,h.Z)(e.value,1)[0];n.updatePivotTableInfo(r,{isCopy:!1})}}catch(e){t.e(e)}finally{t.f()}},this.getRenderManager=function(){return n.pivotTableController.renderManager},this.getDataSourceInfoFromSnapshot=function(e){var t;return null===(t=n.sheet.parent.getPivotSyncModelManager().getSnapshot(e))||void 0===t?void 0:t.cacheFieldInfo},this.basePivotTableManager=t.getPivotTableManager()}return(0,g.Z)(e,[{key:"getSheet",value:function(){return this.basePivotTableManager.getSheet()}},{key:"updatePivotTableInfo",value:function(e,t){this.pivotTableManagerV2.updatePivotTableInfo(e,t)}},{key:"setPivotTableInfoField",value:function(e,t,n){var r=this.getPivotInfoByName(e);r&&this.setPivotInfo(e,Object.assign({},r,(0,c.Z)({},t,n)))}}]),e}();function Nt(e,t){return e&&M.e6w.fromJSON(e,O.xj7.NORMAL,t)}function Pt(e){var t=e.spanRange,n=e.pageRange,r=e.contentRange,o=t&&t.toJSON(),i=n&&n.toJSON(),a=r&&r.toJSON();return Object.assign({},e,{spanRange:o,contentRange:a,pageRange:i})}q([(0,I.f)(it)],Dt.prototype,"pivotTableController",void 0),q([(0,I.f)(M.RSl)],Dt.prototype,"pivotTableManagerV2",void 0),Dt=q([(0,b.b)(),$(0,(0,I.f)(M.SJM))],Dt);var Ot={source:G.lU.SHEET,parent:G.lU.SHEET,cross:!1},Mt=function(){var e=(0,l.Z)(s().mark((function e(t){var n,r,o,i,a,l,u,c,h;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.spread,r=t.sheet,o=t.position,i=t.snapshot,a=t.dataSource,e.prev=1,u=r||n.getActiveSheet()){e.next=5;break}throw ReferenceError("no sheet found");case 5:if(null!==(l=n.sheetBlocksManager)&&void 0!==l&&l.modelManager){e.next=7;break}throw ReferenceError("no block manager");case 7:return c=G.kH.PIVOT_TABLE,e.next=10,n.sheetBlocksManager.modelManager.createBlock({type:c,snapshot:i,dataType:1,dataSource:a,circulationInfo:Ot});case 10:if(null!=(h=e.sent)&&h.token){e.next=13;break}throw ReferenceError("no block token");case 13:return e.abrupt("return",(u.addEmbeddedBlock({blockType:c,blockToken:h.token,position:o,blockSetting:{}}),h.token));case 16:throw e.prev=16,e.t0=e.catch(1),console.error("[PIVOT] add pivot error.",e.t0),e.t0;case 19:case"end":return e.stop()}}),e,null,[[1,16]])})));return function(t){return e.apply(this,arguments)}}(),Lt=function(e,t){return"".concat(e).concat("_").concat(t||(0,O.zsn)(10))},xt=function(e){return e.split("_")[0]};var Vt,Zt=function(e,t,n){var r,o;if(0===t.colCount()||0===t.rowCount())return console.error("[PIVOT] Invalid source range, row or col is empty."),"";var i=null===(r=t.sheet())||void 0===r?void 0:r.id();if(!i||!e.getSheetFromId(i))return"";var a=Lt(i),s=function(e,t){var n,r=null===(n=e.sheet())||void 0===n?void 0:n.id();if(r){var o=e.rgType,i=e.toJSON(),a=i.row,s=i.col,l=i.rowCount,u=i.colCount;switch(o){case O.xj7.ALL:return{sheetId:r,rangeId:t,type:o};case O.xj7.ROW:return{sheetId:r,rangeId:t,type:o,row:a,rowCount:l};case O.xj7.COL:return{sheetId:r,rangeId:t,type:o,col:s,colCount:u};case O.xj7.NORMAL:return{sheetId:r,rangeId:t,type:o,row:a,col:s,rowCount:l,colCount:u};case O.xj7.CELL:return{sheetId:r,rangeId:t,type:O.xj7.NORMAL,row:a,col:s,rowCount:1,colCount:1};case O.xj7.INVALID:default:return}}}(t,a);return s&&(null===(o=e.setDataRange)||void 0===o?void 0:o.call(e,[s],n))?a:""},Bt=function(e,t,n){var r,o;if(!t)return!1;var i=xt(t),a=e.getSheetFromId(i);if(!a)return!1;var s=null===(r=a.rangeModel.getRangesFromId([t]))||void 0===r?void 0:r[0];return(null===(o=e.delDataRange)||void 0===o?void 0:o.call(e,[s],n))||!1};!function(e){e.ERR_RCE_LIVE_SYNC="1009"}(Vt||(Vt={}));var Ht=function(){var e={},t={},n=[];return function(r,o){if(!r||!("startTrackChangesetAccept"in r))return Promise.reject("no dataDeps");if(o in t)return t[o]?Promise.resolve():Promise.reject("msg ".concat(o," has no ack"));if(!e[o]){var i=r.startTrackChangesetAccept(o),a=!1;i.then((function(){a=!0})).finally((function(){delete e[o],t[o]=a,n.push(o);var r=n.length-100;r<1||n.splice(0,r).forEach((function(e){delete t[e]}))})),e[o]=i}return e[o]}}(),Ut=function(){var e=(0,l.Z)(s().mark((function e(t,n,r,o){var i,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&"subscribeProduceChangesetEvent"in t){e.next=2;break}return e.abrupt("return",(console.log("[PIVOT] cannot find dataDeps, use defaultReturn: ".concat(o)),o));case 2:return i=1e3*r,e.next=5,new Promise((function(e,r){var o,a,s,l=function(){var e;null===(e=s)||void 0===e||e.unsubscribe()},u=window.setTimeout((function(){r(Error("get msgId timeout")),l()}),i);a=function(t){((null==t?void 0:t.content)||[]).filter((function(e){return"setDataRange"===(null==e?void 0:e.action)})).find((function(e){var t;return(null===(t=e.value)||void 0===t?void 0:t.range_id)===n}))&&(e(t.msg_id),l(),window.clearTimeout(u))},s=null===(o=t.subscribeProduceChangesetEvent)||void 0===o?void 0:o.call(t,a)}));case 5:return a=e.sent,e.abrupt("return",new Promise((function(e,n){var r=window.setTimeout((function(){n(Error("wait ACK timeout"))}),i);Ht(t,a).then(e).catch(n).finally((function(){window.clearTimeout(r)}))})));case 7:case"end":return e.stop()}}),e)})));return function(t,n,r,o){return e.apply(this,arguments)}}(),jt=function(){var e=(0,l.Z)(s().mark((function e(t,n){var r,o,i=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>2&&void 0!==i[2]?i[2]:10,o=!(i.length>3&&void 0!==i[3])||i[3],e.prev=2,e.next=5,Ut(t,n,r,o);case 5:if(e.sent){e.next=7;break}throw Error("server failed to receive");case 7:e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(2),Error("setDataRange send to server error: ".concat((null===e.t0||void 0===e.t0?void 0:e.t0.message)||"unknown"));case 12:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(t,n){return e.apply(this,arguments)}}();var Gt=function(){function e(){var t=this;(0,p.Z)(this,e),this.unwatchRangeByBlock={},this.spreadSubscriber=null,this._isInitialized=!1,this.handlePivotTableServiceStatusChanged=function(e){var n=e.pivotTableToken;"Loading"===e.status&&t.setErrorState(n,M.bfo.ServiceCalcLoading)},this.handlePivotBlockUpdate=function(e){var n=e.blockToken,r=e.position,o=r.row,i=r.col;t.pivotTableManagerV2.updatePivotTableInfo(n,{row:o,col:i}),t.reRenderPivotTable(n,{passive:!0}),t.reRenderErrorStatePivotTable()},this.reRenderErrorStatePivotTable=(0,k.default)((function(){var e=t.sheet;if(e){var n=t.pivotTableManagerV2;if(n.hasPivotTable()){var r,o=Y(n.getPivotInfoMap());try{for(o.s();!(r=o.n()).done;){var i=(0,h.Z)(r.value,2),a=i[0],s=i[1];if(s.errorState!==M.bfo.None){var l=n.getViewDataModelByToken(a);if(!l)return;var u=!0,c=l.getRangeSize(),d=c.page,f=c.content,v=[nt.COVER_PIVOT_TABLE,nt.COVER_SHEET,nt.OVER_FLOW,nt.NO_PERMISSION];if(d){var p=pt(e,new M.e6w(s.row,s.col,d.rowCount,d.colCount,e),a).coverResult;v.includes(p)&&(u=!1)}if(f&&u){var g=pt(e,new M.e6w(s.row,s.col,f.rowCount,f.colCount,e),a).coverResult;v.includes(g)&&(u=!1)}u&&t.reRenderPivotTable(a,{passive:!0})}}}catch(e){o.e(e)}finally{o.f()}}}}),50),this.markDirtyAllPivotTables=(0,k.default)((function(){var e,n=Y(t.pivotTableManagerV2.getPivotInfoMap());try{for(n.s();!(e=n.n()).done;){var r=(0,h.Z)(e.value,2),o=r[0],i=r[1],a=[];a.push(i.contentRange,i.pageRange),t.renderManager.addRefsToDirtyRefs(o,a),t.renderManager.applyDirtyRangeList(o)}}catch(e){n.e(e)}finally{n.f()}}),1e3),this.handleAllEmbeddedBlockSet=function(e){t.renderManager.handleAllEmbeddedBlockSet(e)}}var t;return(0,g.Z)(e,[{key:"init",value:function(e){this._isInitialized||(this.dataDeps=e.dataDeps,this.bindEvents(),this._isInitialized=!0)}},{key:"addPivotTable",value:(t=(0,l.Z)(s().mark((function e(t){var n,r,o,i,a,l,u,c,h,d,f,v,p,g,m,_,y,C,S;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.spread,r=this.sheet,!(bt(n)>=50)){e.next=3;break}throw{toastText:z("LarkCCM_Sheets_PivotTable_PivotTableReachMaxNum_Toast",{num:50})};case 3:return o=t.sourceRange,i=t.row,a=t.col,l=t.initSnapshot,u=t.dataViewModel,c=t.fromPaste,h=null==u?void 0:u.getRangeSize(),d=(null==h?void 0:h.page)||void 0,f=(null==h?void 0:h.content)||void 0,e.next=14,mt(r,i,a,d,f,o);case 14:if((v=e.sent).status){e.next=17;break}throw{toastText:v.errorTip};case 17:if(p=Zt(n,o),e.prev=18,p){e.next=21;break}throw Error("cannot create sourceRangeId");case 21:return m=v.defaultContentRange,_=v.defaultPageRange,y=v.shouldClear,C=It(r.id(),p),e.next=24,jt(this.dataDeps,p);case 24:return l&&(l.fields.cacheName=C),e.next=27,Mt({spread:n,sheet:r,dataSource:{objType:G.lU.SHEET,objToken:n._context.getToken(),rangeId:p},position:{row:i,col:a},snapshot:l?Object.assign({},l,{rangeId:p,cacheName:C}):M.Zpn.getDefaultSnapshot(p,[],C)});case 27:return S=e.sent,e.abrupt("return",(null!==(g=this.pivotTableManagerV2.getPivotTableByToken(S))&&void 0!==g&&g.setCacheName(C),c&&this.pivotTableManagerV2.updatePivotTableInfo(S,{fromPaste:c}),r.formatPivotTableRange([m,_],S,y,!1),this.renderManager.clearFormatInfo(),S));case 31:throw e.prev=31,e.t0=e.catch(18),Bt(n,p),n.pivotService.removeCache(p),e.t0;case 34:case"end":return e.stop()}}),e,this,[[18,31]])}))),function(e){return t.apply(this,arguments)})},{key:"movePivotTable",value:function(e,t,n,r){var o=this.sheet,i=this.pivotTableManagerV2.getPivotInfoByToken(e),a=this.dataSourceManager.getSourceRange(e);if(!i||!a)throw{toastText:"Info is not exist!"};var s=i.contentRange,l=i.pageRange,u=i.row,c=i.col;if(o.checkRangesProtected([s,l].filter(Boolean)))throw new Error(z("CreationDoc_Sheets_CellIsProtected"));var h=null==l?void 0:l.clone(),d=null==s?void 0:s.clone(),f=function(e,t,n,r,o,i,a,s){var l,u=!1,c=0,h=0,d=function(n){if(n){n.setRowFrom(n.rowFrom()+o),n.setColFrom(n.colFrom()+i);var r=pt(e,n,t),a=r.coverResult,d=r.overflowCol,f=r.overflowRow;switch(a){case nt.COVER_SHEET:if(s)break;u?u=!0:ut.showModalWithClear(e,t,n,ot.MovePivotTable);break;case nt.HAS_STYLE:u=!0;break;case nt.COVER_SOURCE:return l=z("CreationDoc_Sheets_PivotTable_PositionOverlapWithDataSource_Toast"),!1;case nt.NO_PERMISSION:return l=z("CreationDoc_Sheets_CellIsProtected"),!1}f>c&&(c=f),d>h&&(h=d)}return!0};return d(n)&&d(r)?{status:!0,shouldClear:u,addColCount:h,addRowCount:c}:{status:!1,errorTip:l}}(o,e,h,d,t,n,0,r);if(!f.status)throw{toastText:f.errorTip};var v=u+t,p=c+n;this.pivotTableManagerV2.updatePivotTableInfo(e,{row:v,col:p}),this.pivotTableManagerV2.deleteCellPivotCacheByToken(e),this.reRenderPivotTable(e,{passive:!0,allowCoverPivot:!0});var g=f.shouldClear,m=f.addColCount,_=f.addRowCount;return o.formatPivotTableRange([d,h],e,r||g,!1,_,m),this.renderManager.clearFormatInfo(),o.setEmbeddedBlock({blockType:G.kH.PIVOT_TABLE,blockToken:e,position:{row:v,col:p},blockSetting:{}}),r||g}},{key:"deletePivotTable",value:function(e,t){this.pivotTableManagerV2.getPivotTableByToken(e)&&this.sheet.delEmbeddedBlock({blockType:G.kH.PIVOT_TABLE,blockToken:e,reserveDepRanges:t})}},{key:"updateSourceRange",value:function(e,t,n){var r,o;if(this.pivotTableManagerV2.getPivotTableByToken(e)){var i=Zt(this.spread,t,n);if(i){var a=null!==(r=null===(o=this.sheet.parent.getPivotSyncModelManager().getSnapshot(e))||void 0===o?void 0:o.rangeId)&&void 0!==r?r:"";this.setPivotSourceRangeByRangeId(e,i,a,!1)}}}},{key:"setPivotInfoByJSON",value:function(e,t){var n=this.sheet;if(n&&e&&t){var r=Object.assign({},t,{pageRange:Nt(null==t?void 0:t.pageRange,n),contentRange:Nt(null==t?void 0:t.contentRange,n),spanRange:Nt(null==t?void 0:t.spanRange,n)});this.pivotTableManagerV2.setPivotTableInfo(e,r)}}},{key:"getSnapshotFromTempPivot",value:function(e,t){var n=this.spread.pivotService,r="temp_".concat(Math.random(),"_").concat(Date.now()),o=new j.Zw({cacheName:r,service:n});t(o);var i=o.toJSON();return i.cacheName="",i.fields.cacheName="",n.removeCache(r),i}},{key:"reRenderPivotTable",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.pivotTableManagerV2,o=r.getPivotInfoByToken(e);if(o){n.shouldAutoFitCol=null===(t=r.getPivotTableByToken(e))||void 0===t?void 0:t.getAutoFitCol();var i,a,s=this.renderManager.reRenderPivotTable(e,n);if(s)this.setPivotInfoByJSON(e,Pt(o));else null===(i=r.getPivotTableByToken(e))||void 0===i||null===(a=i.getBroadcaster())||void 0===a||a.broadcastImmediate({type:"PIVOT_TABLE_RENDERED",data:void 0});return r.deletePivotTablePreView(e),s}}},{key:"setErrorState",value:function(e,t){this.renderManager.setErrorState(e,t)}},{key:"renderPivotTableWithBlockToken",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=this.sheet,o=r.embeddedBlocksModel.getBlock(e),i=o.position,a=i.row,s=i.col;return this.renderPivotTableWithPosition(e,a,s,t,n)}},{key:"renderPivotTableWithPosition",value:function(e,t,n,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},i=this.sheet,a=this.pivotTableManagerV2;if(!r){var s,l={row:t,col:n,isEmpty:!0,themeName:"primary",errorState:M.bfo.None,loaded:!1};return a.setPivotTableInfo(e,l),void this.setErrorState(e,null!==(s=null==o?void 0:o.errorState)&&void 0!==s?s:M.bfo.Shrink)}var u=null;r instanceof j.b$?u=r:(u=new j.b$).fromJSON(r),a.setPivotTablePreView(e,u);var c=u.getRangeSize(),h=c.page,d=c.content,f=dt(i,t,n,h,d),v=f.pageRange,p=f.contentRange,g=f.spanRange;if(a.getPivotInfoByToken(e))a.updatePivotTableInfo(e,{row:t,col:n});else{var m={pageRange:v,contentRange:p,spanRange:g,row:t,col:n,isEmpty:!r,themeName:"primary",errorState:M.bfo.None,loaded:!1};a.setPivotTableInfo(e,m),g&&i.setEmptyPivotTableSpan(g)}return this.reRenderPivotTable(e,Object.assign({passive:!0,dontAddToCommandStack:!0},o))}},{key:"reRenderDeletePivotTable",value:function(e){var t=this.sheet,n=this.pivotTableManagerV2,r=n.getPivotInfoByToken(e),o=this.renderManager;if(r){r.spanRange&&t.removeEmptyPivotTableSpan(r.spanRange);var i=r.pageRange,a=r.contentRange;o.addRefsToDirtyRefs(e,[i,a]),At(n,e,i,a),n.deleteCellPivotCacheByToken(e)}var s=n.getPivotTableByToken(e);s&&(this.spread.pivotService.removeCache(s.getCacheName()),s.destroy()),this.dataSourceManager.deleteSourceDataRange(e),n.deletePivotTableInfoByToken(e),n.deletePivotTableByToken(e),n.deleteViewDataModel(e);var l=this.spread.sheetBlocksManager;l&&l.modelManager.destroyBlockModelByToken(e),(0,O.xEd)(e),o.applyDirtyRangeList(e),o._notifyRerender()}},{key:"shouldShowPivotTableBtn",value:function(e,t){var n=O.Ps3.browser.isIPad&&!O.Ps3.browser.isLark;return!(O.Ps3.browser.isMobile&&!n)&&this.pivotTableManagerV2.hasPivotTableAtCell(e,t)}},{key:"getFilterSort",value:function(e,t){if(this.shouldShowPivotTableBtn(e,t))return this.pivotTableManagerV2.getFilterSort(e,t)}},{key:"getCollapse",value:function(e,t){if(this.shouldShowPivotTableBtn(e,t))return this.pivotTableManagerV2.getCollapse(e,t)}},{key:"setPivotSourceRangeByRangeId",value:function(e,t,n,r){var o,i=this,a=this.spread,s=xt(t),l=a.getSheetFromId(s);if(l){var u;if(!r)null===(u=this.pivotTableManagerV2.getPivotTableByToken(e))||void 0===u||u.getBroadcaster().broadcast({type:"UPDATE_RANGE_ID",data:{oldRangeId:n,newRangeId:t}});null!==(o=this.unwatchRangeByBlock[e])&&void 0!==o&&o(),this.unwatchRangeByBlock[e]=l.rangeModel.watchRangeExists(t,(function(o){n!==t&&(!r&&Bt(a,n||""),i.dataSourceManager.updateSourceDataRange(e,o,r?M.kiZ.PASSIVE:M.kiZ.DATA_RANGE_SELECTOR))}))}}},{key:"getSpreadDepends",value:function(){return{AllEmbeddedBlockSet:this.handleAllEmbeddedBlockSet,PivotServiceCalcStatusChanged:this.handlePivotTableServiceStatusChanged}}},{key:"bindEvents",value:function(){this.spreadSubscriber=this.spread.subscribe(this.getSpreadDepends())}},{key:"unbindEvents",value:function(){var e;null!==(e=this.spreadSubscriber)&&void 0!==e&&e.unsubscribe(),this.spreadSubscriber=null}},{key:"dispose",value:function(){this.spread=null,this.sheet=null,this.renderManager=null,this.unwatchRangeByBlock=null,this.workerHelper=null,this.unbindEvents()}}]),e}();q([(0,I.f)(M.Wje)],Gt.prototype,"spread",void 0),q([(0,I.f)(M.SJM)],Gt.prototype,"sheet",void 0),q([(0,I.f)(M.THe)],Gt.prototype,"dataSourceManager",void 0),q([(0,I.f)(M.RSl)],Gt.prototype,"pivotTableManagerV2",void 0),q([(0,I.f)(st)],Gt.prototype,"renderManager",void 0),Gt=q([(0,b.b)()],Gt);var Kt=function e(t){if("object"!=(0,m.Z)(t)||null===t)return t;if(Array.isArray(t))return t.map(e);var n={};for(var r in t)n[r]=e(t[r]);return n},Wt=function(e){return"object"!=(0,m.Z)(e)||null===e?e:Array.isArray(e)?(0,i.Z)(e):Object.assign({},e)},zt=function(e){if("object"!=(0,m.Z)(e)||null===e)return e;var t={};for(var n in e){var r=e[n];t[n]="cacheFieldInfo"===n?Wt(r):Kt(r)}return t},Yt=function(e){return 1===e.version?[{p:["version"],action:{od:1,oi:1.1}}]:[]},Jt={0:["dim","page"],1:["dim","row"],2:["dim","col"],3:["dim","hide"],4:["measure"]},qt={ADD_FIELD:function(e){var t=e.data,n=t.field,r=t.fieldArea,o=t.index;return[{p:["fields"].concat((0,i.Z)(Jt[r]),[o]),action:{li:n}}]},REMOVE_FIELD:function(e){var t=e.data,n=t.field,r=t.fieldArea,o=t.index;return[{p:["fields"].concat((0,i.Z)(Jt[r]),[o]),action:{ld:n}}]},MOVE_FIELD:function(e){var t=e.data,n=t.from,r=t.to,o=Jt[n.fieldArea],a=Jt[r.fieldArea];return n.fieldArea!==r.fieldArea?[{p:["fields"].concat((0,i.Z)(o),[n.index]),action:{ld:n.field}},{p:["fields"].concat((0,i.Z)(a),[r.index]),action:{li:r.field}}]:n.index!==r.index?[{p:["fields"].concat((0,i.Z)(o),[n.index]),action:{lm:r.index}}]:[]},RENAME_FIELD:function(e){var t=e.data,n=t.fieldArea,r=t.index,o=t.oldFieldName,a=t.newFieldName;return[{p:["fields"].concat((0,i.Z)(Jt[n]),[r,"fieldName"]),action:{od:o,oi:a}}]},RENAME_FIELD_IN_HIDDEN_TOTAL_INFO:function(e,t){var n=e.data,r=n.oldFieldName,o=n.newFieldName,a=n.value;return[].concat((0,i.Z)(Yt(t)),[{p:["fields","hiddenTotalInfo","fields",r],action:{od:a}},{p:["fields","hiddenTotalInfo","fields",o],action:{oi:a}}])},RENAME_FIELD_IN_COLLAPSE_INFO:function(e){var t=e.data,n=t.oldFieldName,r=t.newFieldName,o=t.value;return[{p:["fields","collapseInfo",n],action:{od:o}},{p:["fields","collapseInfo",r],action:{oi:o}}]},SET_FIELD_SORT_INFO:function(e){var t=e.data,n=t.fieldArea,r=t.index,o=t.oldValue,a=t.newValue;if((0,E.default)(o,a))return[];var s={};return o&&(s.od=o),a&&(s.oi=a),[{p:["fields"].concat((0,i.Z)(Jt[n]),[r,"sortInfo"]),action:s}]},SET_FIELD_LABEL_FILTER:function(e,t){var n=e.data,r=n.fieldArea,o=n.index,a=n.oldValue,s=n.newValue;if((0,E.default)(a,s))return[];var l=["fields"].concat((0,i.Z)(Jt[r]),[o,"filterInfo"]),u=(0,S.default)(t,l);if(!u||!("labelFilter"in u))return s?[{p:l,action:{oi:{labelFilter:s}}}]:[];var c={};return a&&(c.od=a),s&&(c.oi=s),[{p:[].concat((0,i.Z)(l),["labelFilter"]),action:c}]},SET_FIELD_FORMAT:function(e){var t=e.data,n=t.fieldArea,r=t.index,o=t.oldValue,a=t.newValue;if((0,E.default)(o,a))return[];var s={};return(0,C.Z)(o)||(s.od=o),(0,C.Z)(a)||(s.oi=a),[{p:["fields"].concat((0,i.Z)(Jt[n]),[r,"format"]),action:s}]},SET_FIELD_SUMMARY_TYPE:function(e){var t=e.data,n=t.fieldArea,r=t.index,o=t.oldValue,a=t.newValue;if((0,E.default)(o,a))return[];var s={};return(0,C.Z)(o)||(s.od=o),(0,C.Z)(a)||(s.oi=a),[{p:["fields"].concat((0,i.Z)(Jt[n]),[r,"summaryType"]),action:s}]},SET_SUMMARY_MODE:function(e){var t=e.data,n=t.fieldArea,r=t.index,o=t.oldValue,a=t.newValue;if((0,E.default)(o,a))return[];var s={};return(0,C.Z)(o)||(s.od=o),(0,C.Z)(a)||(s.oi=a),[{p:["fields"].concat((0,i.Z)(Jt[n]),[r,"summaryMode"]),action:s}]},SET_FORMULA_SUMMARY_TYPE:function(e){var t=e.data,n=t.fieldArea,r=t.index,o=t.oldValue,a=t.newValue;if((0,E.default)(o,a))return[];var s={};return(0,C.Z)(o)||(s.od=o),(0,C.Z)(a)||(s.oi=a),[{p:["fields"].concat((0,i.Z)(Jt[n]),[r,"formulaSummaryType"]),action:s}]},SET_FIELD_SHOW_DATA_AS_INFO:function(e){var t=e.data,n=t.fieldArea,r=t.index,o=t.oldValue,a=t.newValue;if((0,E.default)(o,a))return[];var s={};return o&&(s.od=o),a&&(s.oi=a),[{p:["fields"].concat((0,i.Z)(Jt[n]),[r,"showDataAsInfo"]),action:s}]},SET_HIDDEN_TOTAL_INFO:function(e,t){var n=e.data,r=n.type,o=n.newValue,a=t.fields.hiddenTotalInfo,s=Yt(t);if("fields"===r){var l=e.data.fieldName;if(!a.fields)return[].concat((0,i.Z)(s),[{p:["fields","hiddenTotalInfo","fields"],action:{oi:{}}},{p:["fields","hiddenTotalInfo","fields",l],action:{oi:o}}]);var u={oi:o};return l in a.fields&&(u.od=a.fields[l]),[].concat((0,i.Z)(s),[{p:["fields","hiddenTotalInfo","fields",l],action:u}])}var c={};return r in a&&(c.od=a[r]),o&&(c.oi=o),"od"in c||"oi"in c?[].concat((0,i.Z)(s),[{p:["fields","hiddenTotalInfo",r],action:c}]):(0,i.Z)(s)},CLEAR_ALL_FIELDS_HIDDEN_TOTAL_INFO:function(e,t){var n=t.fields.hiddenTotalInfo,r=Yt(t);return"fields"in n?[].concat((0,i.Z)(r),[{p:["fields","hiddenTotalInfo","fields"],action:{od:n.fields}}]):(0,i.Z)(r)},CLEAR_FIELD_HIDDEN_TOTAL_INFO:function(e,t){var n,r=e.data.fieldName,o=null===(n=t.fields.hiddenTotalInfo.fields)||void 0===n?void 0:n[r],a=Yt(t);return"boolean"==typeof o?[].concat((0,i.Z)(a),[{p:["fields","hiddenTotalInfo","fields",r],action:{od:o}}]):(0,i.Z)(a)},SET_COLLAPSE_INFO:function(e,t){var n=e.data,r=n.fieldName,o=n.itemName,i=n.oldValue,a=n.newValue;if(i===a)return[];if(!t.fields.collapseInfo[r])return[{p:["fields","collapseInfo",r],action:{oi:(0,c.Z)({},o,a)}}];var s={oi:a};return(0,C.Z)(i)||(s.od=i),[{p:["fields","collapseInfo",r,o],action:s}]},CLEAR_FIELD_COLLAPSE_INFOS:function(e,t){var n=e.data.fieldName,r=t.fields.collapseInfo[n];return r?[{p:["fields","collapseInfo",n],action:{od:r}}]:[]},SET_REPEAT_LABEL_INFO:function(e,t){var n=e.data,r=n.type,o=n.newValue;if("fields"===r)return[];if(!t.fields.repeatLabelInfo)return o?[{p:["fields","repeatLabelInfo"],action:{oi:{}}},{p:["fields","repeatLabelInfo",r],action:{oi:!0}}]:[];var i=t.fields.repeatLabelInfo,a={};return r in i&&(a.od=i[r]),o&&(a.oi=o),"od"in a||"oi"in a?[{p:["fields","repeatLabelInfo",r],action:a}]:[]},UPDATE_CACHE_FIELD:function(e){var t=e.data;return[{p:["cacheFieldInfo"],action:{od:t.oldCacheField,oi:t.newCacheField}}]},UPDATE_VALUE_POSITION:function(e){var t=e.data,n=t.oldPosition,r=t.oldIndex,o=t.newIndex,i=t.newPosition,a=[];return n!==i&&a.push({p:["fields","valuePosition"],action:{od:n,oi:i}}),o&&o!==r&&a.push({p:["fields","valueIndex"],action:{od:r,oi:o}}),a},REMOVE_CACHE_FIELD_ITEM:function(e){var t=e.data;return[{p:["cacheFieldInfo",t.index],action:{ld:t.sourceInfo}}]},UPDATE_CACHE_FIELD_ITEM:function(e){var t=e.data;return[{p:["cacheFieldInfo",t.index],action:{ld:t.oldCacheFieldItem,li:t.newCacheFieldItem}}]},ADD_CACHE_FIELD_ITEM:function(e){var t=e.data;return[{p:["cacheFieldInfo",t.index],action:{li:t.sourceInfo}}]},UPDATE_RANGE_ID:function(e){var t=e.data,n=t.oldRangeId,r=t.newRangeId;return n===r?[]:[{p:["rangeId"],action:{od:n,oi:r}}]},DATA_VIEW_REFRESH_START:function(){return[]},DATA_VIEW_REFRESH:function(){return[]},DATA_VIEW_REFRESH_ERROR:function(){return[]},PIVOT_TABLE_RENDERED:function(){return[]},GROUP_SUCCESS:function(){return[]},AUTO_DATE_GROUP_SUCCESS:function(){return[]},ADD_FIELD_SUCCESS:function(){return[]},SET_AUTO_FIT_COL:function(e,t){var n=e.data.autoFitCol;return t.config?[{p:["config","autoFitCol"],action:{od:t.config.autoFitCol,oi:n}}]:[{p:["config"],action:{oi:{autoFitCol:n}}}]},VERSION_TOO_HIGH:function(){return[]},UPDATE_VERSION:function(e,t){var n=e.data.newVersion,r=t.version;return void 0===r||r<n?[{p:["version"],action:{od:r,oi:n}}]:[]}},$t=function(e,t){return(0,qt[t.type])(t,e)},Xt=function(e,t){if(t.length<1)return[];if(t.length<2)return $t(e,t[0]);var n=new K.default(null,zt(e));return t.flatMap((function(e){var t=$t(n.getSnapshot(),e);return n.apply(t),t}))},Qt=(new Set(["UPDATE_CACHE_FIELD","REMOVE_CACHE_FIELD_ITEM","ADD_CACHE_FIELD_ITEM"]),new Set(["ADD_FIELD","REMOVE_FIELD","MOVE_FIELD","RENAME_FIELD","SET_FIELD_LABEL_FILTER","SET_FIELD_SUMMARY_TYPE","UPDATE_VALUE_POSITION","UPDATE_CACHE_FIELD","REMOVE_CACHE_FIELD_ITEM"]),function(e,t){var n=e.inject(at).getPositionCell(t);if(!n)return!1;var r=n.row,o=n.col;return e.showCell(r,o),!0}),en=function(e,t,n,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:5e3,i=e.getNotExpendCellRect(t,n),a=e.tableViewRect(t,n);return a.x<=i.x&&i.x+i.width<=a.x+a.width&&a.y<=i.y&&i.y+i.height<=a.y+a.height?Promise.resolve():new Promise((function(i,a){var s,l=setTimeout((function(){var e;null!==(e=s)&&void 0!==e&&e.unsubscribe(),a()}),o),u=(0,k.default)((function(){var e;clearTimeout(l),i(),null===(e=s)||void 0===e||e.unsubscribe()}),100);s=r(u),e.showCell(t,n)}))},tn=function(e,t,n,r,o){t.setActiveCell(r,o);var i=t.getNotExpendCellRect(r,o),a=t.inject(at).getFilterSort(r,o);t._trigger(O.zW2.ShowFilterSort,{source:e,sheet:t,btnInfo:{status:a,fieldName:n,row:r,col:o},cellRect:{x:i.x,y:i.y,width:i.width,height:i.height}})},nn=function(e){e.bind(st).to(Ft).inSingletonScope(),e.bind(it).to(Gt).inSingletonScope(),e.bind(at).to(Dt).inSingletonScope()};function rn(e,t,n,r,o){var i=function(e,t,n){var r=e._getModel().getImmutableContent(t,n);if(null==r)return"";if(r.multipleValues)return e.getText(t,n);var o=e.getValue(t,n);if(!M.Gni._Types._isNullOrUndefined(o)){if((0,O.ali)(o))return"";var i=String(o);return(!!e.getActualFormatter(t,n)||i.includes("/OADate")||e.getReminder(t,n))&&(i=e.getText(t,n)),i}return""}(e,n,r);if(!e.getRowVisible(n)||!e.getColVisible(r))return{status:!1};if(void 0===o)return i&&-1!==(0,O.ATv)(i).toLowerCase().indexOf(t)?{status:!0,text:i}:{status:!1};var a=o.ranges,s=void 0===a?[]:a,l=o.matchCase,u=void 0===l||l,c=o.searchRegex,h=void 0!==c&&c,d=o.includeFormulas,f=void 0!==d&&d,v=o.matchEntireCell,p=void 0!==v&&v,g=0===s.length;for(var m in s){var _=s[m];if(n>=_.row&&n<_.row+_.rowCount&&r>=_.col&&r<_.col+_.colCount){g=!0;break}}if(g){var y=u?"igm":"gm",C=h?new RegExp(t,y):new RegExp(function(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}(t),y);f&&e.hasFormula(n,r)&&(i="="+e.getFormula(n,r));var S=i.match(C);if(p){if(null!==S&&S[0]===i)return{status:!0,text:i}}else if(null!==S)return{status:!0,text:i}}return{status:!1}}var on,an=function(e){function t(e,n,r){var o;return(0,p.Z)(this,t),(o=(0,d.Z)(this,(0,f.Z)(t).call(this))).sheet=e,o._ranges=n,o._size=r,o._idx=-1,o}return(0,v.Z)(t,e),(0,g.Z)(t,[{key:"next",value:function(){var e=this;if(this._iter){var t=this._iter.next();return null===t?(this._iter=null,this.next()):t}this._idx++;var n=this._ranges[this._idx];return n?(this._iter=this.sheet._getRowInfos().iterContinuousActualVisible(n[0],(0,M.uT_)(n)-1).map((function(t){return new sn([t.index,t.count],e._size)})).flatten(),this.next()):null}}]),t}(L.FIterator),sn=function(e){function t(e,n){var r;return(0,p.Z)(this,t),(r=(0,d.Z)(this,(0,f.Z)(t).call(this)))._size=n,r._from=e[0],r._end=(0,M.uT_)(e),r}return(0,v.Z)(t,e),(0,g.Z)(t,[{key:"next",value:function(){if(this._from>=this._end)return null;var e=this._from,t=Math.min(this._size,this._end-this._from);return this._from+=t,[e,t]}}]),t}(L.FIterator),ln=function(e){function t(e){var n;return(0,p.Z)(this,t),(n=(0,d.Z)(this,(0,f.Z)(t).call(this))).iter=e,n}return(0,v.Z)(t,e),(0,g.Z)(t,[{key:"next",value:function(){return this.iter.next()?[null,this.iter.position()]:null}}]),t}(L.FIterator),un=(0,B.getAlphaColor)((0,B.getThemeColorByToken)("B500-BG"),.2);!function(e){e.CURRENT_WORKSHEET="currentWorksheet",e.ALL_WORKSHEET="allWorksheet",e.CURRENT_RANGES="currentRanges"}(on||(on={}));var cn=function(){function e(t,n,r){var o=this;(0,p.Z)(this,e),this.spread=t,this._isSearchDone$=new w.X(!1),this._findScope$=new w.X(on.CURRENT_WORKSHEET),this._activeSearchItem$=new w.X(void 0),this._searchParams$=new w.X({}),this.sheetSearchRstMap=new Map,this.highlightColor=un,this.activeCellColor=un,this.needSheetActiveCell=!0,this.cellIterArray=[],this.execHighlightCommand=function(e){var t=e.sheetId,n=o.spread.getSheetFromId(t);n&&o.spread.commandManager().execute(Object.assign({cmd:O.rvF.SEARCH,sheetName:n.name()},e))},this.execReplaceCommand=function(e){o.spread.commandManager().execute(Object.assign({cmd:O.rvF.REPLACE},e))},this.commandManager=n,this.commandManager.register(O.rvF.SEARCH,r),this._activeSearchItem$.pipe((0,P.G)()).subscribe(this.setActiveCell.bind(this))}return(0,g.Z)(e,[{key:"setFindScope",value:function(e){this._findScope$.next(e)}},{key:"isSearchDone$",value:function(){return this._isSearchDone$.asObservable()}},{key:"init",value:function(e){e.highlightColor&&(this.highlightColor=e.highlightColor),e.activeCellColor&&(this.activeCellColor=e.activeCellColor)}},{key:"setNeedSheetActiveCell",value:function(e){this.needSheetActiveCell=e}},{key:"setActiveSearchItem",value:function(e){this._activeSearchItem$.next(e)}},{key:"setSearchParams",value:function(e){this._searchParams$.next(e?Object.assign({},this.searchParams,{},e):{})}},{key:"syncSearch",value:function(e,t,n,r){var o=this.spread.getSheetFromId(e),i=this.spread.permissionManager,a=(r||{}).ignoreCheckPermission;if(!o||!a&&!i.hasSheetVisiblePermission(o.id()))return null==n?void 0:n(e,[],!0);if(this.sheetSearchRstMap.has(e)&&this.clear(e),t){void 0===r&&void 0===this.searchParams&&(t=t.toLowerCase());var s=[0,o.getRowCount()];this.wholeSearch(e,t,s,r||this.searchParams,n)}else this.clear(e)}},{key:"asyncSearch",value:function(e,t,n,r,o,i,a,s){var l,u,c=this.spread.getSheetFromId(e),h=this.spread.permissionManager;if(!c||!h.hasSheetVisiblePermission(c.id()))return n(e,[],!0),Promise.resolve();if(!t)return this.clear(e),Promise.resolve();var d=o?o[1]:void 0;t=t.toLowerCase(),r?(u=function(e,t){var n=[],r=t[0],o=(0,M.uT_)(t);return o<e&&n.push([o,e-o]),r>0&&n.push([0,r]),n}(c.getRowCount(),r),this.wholeSearch(e,t,r,i||this.searchParams,(function(e,t){return n(e,t,!1)}))):u=o?[o[0]]:[[0,c.getRowCount()]];var f=null!==(l=i)&&void 0!==l?l:this.searchParams;return this.fragmentSearch({sheetId:e,keyword:t,rowInterval:u,colInterval:d,callback:n,condition:f,needSort:a,beforeSaveSearchResultHook:s})}},{key:"replace",value:function(e,t,n,r,o){var i=this,a=r.sheetId,s=[],l=this.spread.getSheetFromId(a);if(l){var u=!1;if(n&&this.findScope===on.ALL_WORKSHEET&&(u=this.spread.sheets.some((function(e){return i.getSearchItems(e.id()).some((function(t){return i.replaceCheckCellAndHandle(e,t.row,t.col,o)}))})),!u&&this.spread.sheets.forEach((function(e){return(0,O.hTd)(s,i.getSearchItems(e.id()))}))),n&&(this.findScope===on.CURRENT_WORKSHEET||this.findScope===on.CURRENT_RANGES)){var c=this.getSearchItems(l.id());s=c,u=c.some((function(e){return i.replaceCheckCellAndHandle(l,e.row,e.col,o)}))}n||(u=this.replaceCheckCellAndHandle(l,r.row,r.col,o)),u||this.execReplaceCommand({find:e,replace:t,items:n?s:[r],scope:this.findScope,condition:this.searchParams,sheetId:a})}}},{key:"getSearchNext",value:function(e,t){var n;return null===(n=this.sheetSearchRstMap.get(e))||void 0===n?void 0:n.getSearchNext(t)}},{key:"getSearchPrev",value:function(e,t){var n;return null===(n=this.sheetSearchRstMap.get(e))||void 0===n?void 0:n.getSearchPrev(t)}},{key:"getSearchLast",value:function(e){var t;return null===(t=this.sheetSearchRstMap.get(e))||void 0===t?void 0:t.getSearchLast()}},{key:"getSearchFirst",value:function(e){var t;return null===(t=this.sheetSearchRstMap.get(e))||void 0===t?void 0:t.getSearchFirst()}},{key:"getSearchRstLen",value:function(e){var t,n;return null!==(t=null===(n=this.sheetSearchRstMap.get(e))||void 0===n?void 0:n.getSearchResultLength())&&void 0!==t?t:0}},{key:"getSearchItem",value:function(e,t){var n;return null===(n=this.sheetSearchRstMap.get(e))||void 0===n?void 0:n.getSearchItem(t)}},{key:"getSearchItems",value:function(e){var t,n;return null!==(t=null===(n=this.sheetSearchRstMap.get(e))||void 0===n?void 0:n.getSearchItems())&&void 0!==t?t:[]}},{key:"getSearchPivotTableCount",value:function(e){var t,n;return null!==(t=null===(n=this.sheetSearchRstMap.get(e))||void 0===n?void 0:n.getSearchPivotTableCount())&&void 0!==t?t:0}},{key:"getSearchFormulaCount",value:function(e){var t,n;return null!==(t=null===(n=this.sheetSearchRstMap.get(e))||void 0===n?void 0:n.getSearchFormulaCount())&&void 0!==t?t:0}},{key:"getSearchResultCell",value:function(e,t,n){var r;return null===(r=this.sheetSearchRstMap.get(e))||void 0===r?void 0:r.getSearchResultCell(t,n)}},{key:"updateCellSearchStatus",value:function(e,t,n,r){var o=this.spread.getSheetFromId(e);if(!o||!t)return 0;var i=rn(o,t,n,r,this.searchParams),a=new x.FRect(r,n,1,1),s=this.getSearchResultCell(e,n,r);if(s&&i.status)return s.text=i.text,0;if(!s&&!i.status)return 0;if(!s&&i.status){var l=o.inject(at);return this.handleSaveSearchRst(e,[{row:n,col:r,index:0,text:i.text,hasFormula:o.hasFormula(n,r),sheetId:e,colCount:1,rowCount:1,key:(0,O.EsU)(),hasPivotTable:l.hasPivotTableAtCell(n,r)}],a,!0),1}return s&&!i.status?(this.removeSearchResult(e,n,r,a),-1):0}},{key:"removeSearchResult",value:function(e,t,n,r){this.execHighlightCommand({sheetId:e,type:1,row:t,col:n})}},{key:"clear",value:function(e){var t=this;e&&this.sheetSearchRstMap.get(e)?this.execHighlightCommand({enabled:!1,sheetId:e}):(this.cellIterArray.forEach((function(e){return e.abort()})),this.sheetSearchRstMap.forEach((function(e,n){t.execHighlightCommand({enabled:!1,sheetId:n})})),this.sheetSearchRstMap.clear(),this.cellIterArray.length=0)}},{key:"setIsSearchDone",value:function(e){this._isSearchDone$.next(e)}},{key:"isRangesExpectant",value:function(e,t,n){if(!e||0===e.length)return!0;var r=!1;for(var o in e){var i=e[o];if(t>=i.row&&t<i.row+i.rowCount&&n>=i.col&&n<i.col+i.colCount){r=!0;break}}return r}},{key:"wholeSearch",value:function(e,t,n,r,o){var i=this;this.setIsSearchDone(!1);var a=this.spread.getSheetFromId(e);if(a){var s=a._getModel(),l=[];s.iterContentWithPos(n[0],0,n[1],a.getColumnCount()).forEach((function(n){var o=(0,h.Z)(n,2)[1],s=o.row,u=o.col;if(void 0===r||i.isRangesExpectant(r.ranges,s,u)){var c=rn(a,t,s,u,r),d=a.inject(at);c.status&&l.push({row:s,col:u,index:0,text:c.text,hasFormula:a.hasFormula(s,u),sheetId:e,colCount:1,rowCount:1,key:(0,O.EsU)(),hasPivotTable:d.hasPivotTableAtCell(s,u)})}})),this.handleSaveSearchRst(e,l),o&&o(e,l,!0),this.setIsSearchDone(!0)}}},{key:"fragmentSearch",value:function(e){var t=this,n=e.sheetId,r=e.keyword,o=e.rowInterval,i=e.colInterval,a=e.callback,s=e.condition,l=e.needSort,u=e.beforeSaveSearchResultHook;this.setIsSearchDone(!1);var c=this.spread.getSheetFromId(n);if(!c)return Promise.resolve();var d=c._getModel(),f=[],v=[],p=i?i[0]:0,g=i?i[1]:d.getColumnCount(),m=Math.ceil(4e3/g),_=new an(c,o,m),y=null,C=_.map((function(e){var r=(0,h.Z)(e,2),o=r[0],i=r[1];return u&&v.forEach((function(e){var t=(0,h.Z)(e,2),r=t[0],o=t[1];u(n,r,o)})),y&&f.length&&(t.handleSaveSearchRst(n,f,y,l),a(n,f,!1)),y=new x.FRect(p,o,g,i),f.length=0,v.length=0,u?new ln(new M.zcn(o,p,i,g)):c._dataModel.iterContentWithPos(o,p,i,g)})).flatten().nonBlocking(c.parent.fIdleScheduler),S=C.forEach((function(e){var t=e[1],o=t.row,i=t.col,a=rn(c,r,o,i,s);if(a.status){var l=c.inject(at),u={row:o,col:i,rowCount:1,colCount:1,index:0,text:a.text,hasFormula:c.hasFormula(o,i),sheetId:n,key:(0,O.EsU)(),hasPivotTable:l.hasPivotTableAtCell(o,i)};f.push(u)}v.push([o,i])}));return S.then((function(){u&&v.forEach((function(e){var t=(0,h.Z)(e,2),r=t[0],o=t[1];u(n,r,o)})),y&&f.length&&t.handleSaveSearchRst(n,f,y,l),t.setIsSearchDone(!0),a(n,f,!0),y=null,f.length=0,v.length=0,C.abort()})).catch((function(e){return console.error(e),Promise.resolve(n)})),this.cellIterArray.push(C),S}},{key:"replaceCheckCellAndHandle",value:function(e,t,n,r){return!(0,M.vJj)(e.parent,e.id())||e.checkCellProtected(t,n)?(e._raiseInvalidOperation(8,"replace"),r&&r(e,t,n),!0):!!e.tabType.isConnectorTab()&&(e._raiseInvalidOperation(12,"replace"),r&&r(e,t,n),!0)}},{key:"setActiveCell",value:function(e){var t=(0,h.Z)(e,2),n=t[0],r=t[1];if(n||r)if(!n||r){var o=r.sheetId,i=r.row,a=r.col,s=this.spread.getSheetFromId(o);s&&(this.needSheetActiveCell&&this.findScope!==on.CURRENT_RANGES&&s.setActiveCell(i,a),n&&n.sheetId!==r.sheetId&&this.execHighlightCommand({activeCell:[-1,-1],sheetId:n.sheetId}),this.execHighlightCommand({activeCell:[i,a],sheetId:o}))}else this.execHighlightCommand({activeCell:[-1,-1],sheetId:n.sheetId})}},{key:"highlight",value:function(e,t,n,r){Array.isArray(t)&&0!==t.length?this.execHighlightCommand({type:0,items:t,highlightColor:this.highlightColor,activeColor:this.activeCellColor,enabled:!0,dirtyRect:n,sheetId:e,needSort:r}):this.execHighlightCommand({enabled:!1,sheetId:e})}},{key:"handleSaveSearchRst",value:function(e,t,n,r){var o=this.spread.getSheetFromId(e);o&&(this.sheetSearchRstMap.get(e)||this.sheetSearchRstMap.set(e,o.inject(M.dP7)),this.highlight(e,t,n,r))}},{key:"findScope",get:function(){return this._findScope$.getValue()}},{key:"isSearchDone",get:function(){return this._isSearchDone$.getValue()}},{key:"activeSearchItem",get:function(){return this._activeSearchItem$.getValue()}},{key:"searchParams",get:function(){return this._searchParams$.getValue()}}]),e}();cn=q([(0,b.b)(),$(0,(0,I.f)(M.Wje)),$(1,(0,I.f)(M.DsI)),$(2,(0,I.f)(Qe))],cn);var hn=function(){function e(t){(0,p.Z)(this,e),this.host=t}return(0,g.Z)(e,[{key:"isAddCell",value:function(){return"add"===this.host.command.type}}]),e}(),dn=function(e){return e.row+e.rowCount-1},fn=function(e){return e.col+e.colCount-1},vn=function(e,t,n){t.extra=t.extra||{},t.extra.commandType=n?"addCell":"delCell",e.hasEditedDataRange&&(t.extra.sideEffect="editDataRange")},pn=function(e){function t(){return(0,p.Z)(this,t),(0,d.Z)(this,(0,f.Z)(t).apply(this,arguments))}return(0,v.Z)(t,e),(0,g.Z)(t,[{key:"execute",value:function(){var e=this.host,t=e.sourceRange,n=e.targetRange,r=e.sheet.id(),o=this.host._moveRangeAction(r,r,t,n,O.xj7.NORMAL);vn(this.host,o,!0),this.host.command._changesets.push(o);var i=this.host._moveRangeAction(r,r,n,t,O.xj7.NORMAL);vn(this.host,i,!1),this.host.command._oldChangesets.unshift(i)}}]),t}(hn),gn=O.xj7.NORMAL,mn=function(e){return{type:e.type,row:e.row,row_count:e.rowCount,col:e.col,col_count:e.colCount}},_n=function(e){function t(e){var n;(0,p.Z)(this,t),(n=(0,d.Z)(this,(0,f.Z)(t).call(this,e))).allRanges=n.host.sheet.rangeModel.toJSON(),n.allRangeIds=Object.keys(n.allRanges),n.selection=n.host.selectionRange.toJSON(),n.changedRanges=[];var r=n.host.command.direction;return n.isRowOp="up"===r||"down"===r,n.isRowOp?(n.mainFrom="row",n.mainCount="rowCount",n.getMainTo=dn,n.crossFrom="col",n.crossCount="colCount",n.getCrossTo=fn):(n.mainFrom="col",n.mainCount="colCount",n.getMainTo=fn,n.crossFrom="row",n.crossCount="rowCount",n.getCrossTo=dn),n}return(0,v.Z)(t,e),(0,g.Z)(t,[{key:"handleAdd",value:function(){var e=this,t=this.selection,n=this.mainFrom,r=this.mainCount,o=this.crossFrom,i=this.getMainTo(t),a=this.getCrossTo(t);this.allRangeIds.forEach((function(s){var l=e.allRanges[s];if(l.type===gn){var u=e.getMainTo(l),h=e.getCrossTo(l),d=t[n]<=l[n]&&i>=u;t[o]<=l[o]&&a>=h&&(d?e.changedRanges.push({id:s,oldRange:l,newRange:Object.assign({},l,(0,c.Z)({},n,l[n]+t[r]))}):t[n]>u||(t[n]<=l[n]?e.changedRanges.push({id:s,oldRange:l,newRange:Object.assign({},l,(0,c.Z)({},n,l[n]+t[r]))}):e.changedRanges.push({id:s,oldRange:l,newRange:Object.assign({},l,(0,c.Z)({},r,l[r]+t[r]))})))}}))}},{key:"handleDelete",value:function(){var e=this,t=this.selection,n=this.mainFrom,r=this.mainCount,o=this.crossFrom,i=this.crossCount,a=this.getMainTo(t),s=this.getCrossTo(t);this.allRangeIds.forEach((function(l){var u,h=e.allRanges[l];if(h.type===gn){var d=e.getMainTo(h),f=e.getCrossTo(h),v=t[n]<=h[n]&&a>=d;if(t[o]<=h[o]&&s>=f)v?e.changedRanges.push({id:l,oldRange:h,newRange:null}):t[n]>d||(a>=d?e.changedRanges.push({id:l,oldRange:h,newRange:Object.assign({},h,(0,c.Z)({},r,h[r]-(d-t[n]+1)))}):a<h[n]?e.changedRanges.push({id:l,oldRange:h,newRange:Object.assign({},h,(0,c.Z)({},n,h[n]-t[r]))}):t[n]<=h[n]?e.changedRanges.push({id:l,oldRange:h,newRange:Object.assign({},h,(u={},(0,c.Z)(u,n,t[n]),(0,c.Z)(u,r,h[r]-(a-h[n]+1)),u))}):e.changedRanges.push({id:l,oldRange:h,newRange:Object.assign({},h,(0,c.Z)({},r,h[r]-t[r]))}));else{if(!v)return;var p=t[o]<=h[o]&&s>=h[o]&&s<f,g=s>=f&&t[o]>h[o]&&t[o]<=f;if(p||g){var m=Object.assign({},h);p?(m[o]=s+1,m[i]=f-m[o]+1):m[i]=t[o]-h[o],e.changedRanges.push({id:l,oldRange:h,newRange:m})}}}}))}},{key:"addChangeToChangeset",value:function(){var e=this.host.sheet.id(),t=this.host.command,n=t._oldChangesets,r=t._changesets;this.changedRanges.forEach((function(t){var o=t.id,i=t.oldRange,a=t.newRange;a?r.push({action:"setDataRange",sheet_id:e,target:mn(a),value:{range_id:o,usage_type:null==a?void 0:a.usageType}}):r.push({action:"delDataRange",sheet_id:e,value:{range_id:o}}),n.unshift({action:"setDataRange",sheet_id:e,target:mn(i),value:{range_id:o,usage_type:null==i?void 0:i.usageType}})}))}},{key:"execute",value:function(){this.isAddCell()?this.handleAdd():this.handleDelete(),this.host.hasEditedDataRange=this.changedRanges.length>0,this.addChangeToChangeset()}}]),t}(hn),yn=function(e){function t(e){var n;return(0,p.Z)(this,t),(n=(0,d.Z)(this,(0,f.Z)(t).call(this,e))).cs={moveRange:{cs:[],oldCs:[]},recover:{oldCs:[]},selectionEmpty:{cs:[]}},n.isMoveRow="up"===n.host.command.direction,n.isMoveRow?(n.mainTo=function(e){return e.rowTo()},n.mainCount=function(e){return e.rowCount()},n.setMainCount=function(e,t){return e.setRowCount(t)}):(n.mainTo=function(e){return e.colTo()},n.mainCount=function(e){return e.colCount()},n.setMainCount=function(e,t){return e.setColCount(t)}),n}return(0,v.Z)(t,e),(0,g.Z)(t,[{key:"moveRange",value:function(){var e=this.host,t=e.sourceRange,n=e.targetRange,r=e.sheet,o=e.selectionRange,i=r.id(),a=(this.isMoveRow?r.getRowCount():r.getColumnCount())-(this.mainTo(o)+1);if(!(a<1)){var s=t,l=n;a<this.mainCount(o)&&(s=t.clone(),this.setMainCount(s,a),l=n.clone(),this.setMainCount(l,a));var u=this.host._moveRangeAction(i,i,s,l,O.xj7.NORMAL);vn(this.host,u,!1),this.cs.moveRange.cs.push(u);var c=this.host._moveRangeAction(i,i,l,s,O.xj7.NORMAL);vn(this.host,c,!0),this.cs.moveRange.oldCs.push(c)}}},{key:"recoverSelectionRange",value:function(){for(var e=this.host.selectionRange.toJSON(),t=e.row,n=e.col,r=e.rowCount,o=e.colCount,i=t;i<t+r;i++)for(var a=n;a<n+o;a++){var s=this.host.pubGetSetCellAction(this.host.sheet,i,a,{needNote:!0});this.cs.recover.oldCs.push(s)}}},{key:"setSelectionRangeEmpty",value:function(){var e=this.host.sheet,t=this.host.selectionRange.toJSON(),n=t.row,r=t.col,o=t.rowCount,i=t.colCount,a=this.host._setRangeActionCore(e.id(),new M.e6w(n,r,o,i,e),{style:null,formula:null,value:null,multipleValues:null,reminder:null,dataValidation:null,note:null});a.extra=a.extra||{},a.extra.commandType="delCell",this.cs.selectionEmpty.cs.push(a)}},{key:"addChangesetByOrder",value:function(){var e=this.cs,t=e.moveRange,n=e.selectionEmpty,r=e.recover,o=this.host.command;(0,O.hTd)(o._changesets,n.cs,t.cs),(0,O.VB2)(o._oldChangesets,t.oldCs,r.oldCs)}},{key:"execute",value:function(){this.host.createSplitSpansAction(this.host.selectionRange),this.setSelectionRangeEmpty(),this.moveRange(),this.recoverSelectionRange(),this.addChangesetByOrder()}}]),t}(hn),Cn=function(e){function t(){return(0,p.Z)(this,t),(0,d.Z)(this,(0,f.Z)(t).apply(this,arguments))}return(0,v.Z)(t,e),(0,g.Z)(t,[{key:"getStyleAndDataValidation",value:function(e,t){var n=this.host.sheet,r=n.getImmutableStyle(e,t,!0),o={style:null,dataValidation:null};return o.style=r.toJSON(),o.dataValidation=n.dataValidationService.getDataValidationJSON(e,t,{needDeepClone:!0}),n.dataValidationService.hasCheckbox(e,t)&&(o.value=0),o}},{key:"inheritStyleAndDataValidation",value:function(e,t,n,r){var o=this.getStyleAndDataValidation(e,t),i=this.host,a=i.sheet,s=i.command,l=a.id();s._changesets.push(this.host._setRangeActionCore(l,new M.e6w(e,t,n,r,a),o)),s._oldChangesets.unshift(this.host._setRangeActionCore(l,new M.e6w(e,t,n,r,a),{value:null,dataValidation:null,style:null}))}},{key:"execute",value:function(){var e=this.host.command.direction,t=this.host.selectionRange.toJSON(),n=t.row,r=t.col,o=t.rowCount,i=t.colCount;if("right"===e)for(var a=n;a<n+o;a++)this.inheritStyleAndDataValidation(a,r,1,i);if("down"===e)for(var s=r;s<r+i;s++)this.inheritStyleAndDataValidation(n,s,o,1)}}]),t}(hn),Sn=function(e){function t(){return(0,p.Z)(this,t),(0,d.Z)(this,(0,f.Z)(t).apply(this,arguments))}return(0,v.Z)(t,e),(0,g.Z)(t,[{key:"getFloatImagesInRange",value:function(e){var t=[],n=this.host.selectionRange,r=this.host.command.direction,o=n.toJSON(),i=o.row,a=o.col,s=i+o.rowCount,l=a+o.colCount;for(var u in e){var c=e[u],h=c.floatImageSetting,d=h.row,f=h.col;"right"===r&&i<=d&&d<s&&f>=a&&t.push(c),"down"===r&&a<=f&&f<l&&d>=i&&t.push(c),"up"===r&&a<=f&&f<l&&d>=s&&t.push(c),"left"===r&&i<=d&&d<s&&f>=l&&t.push(c)}return t}},{key:"getNewFloatImageBlock",value:function(e){var t=this.host.sheet,n=this.host.selectionRange.toJSON(),r=n.rowCount,o=n.colCount,i=this.host.command.direction,a=e.sheetId,s=e.floatImageId,l=e.floatImageSetting,u=l.row,c=l.col,h=l.x,d=l.y,f=u,v=c,p={sheetId:a,floatImageId:s,floatImageSetting:(0,y.default)(l)};if("right"===i&&(v+=o,p.floatImageSetting.col=v),"down"===i&&(f+=r,p.floatImageSetting.row=f),"left"===i&&(v-=o,p.floatImageSetting.col=v),"up"===i&&(f-=r,p.floatImageSetting.row=f),"up"===i||"down"===i){var g=t.getRowHeight(p.floatImageSetting.row);g<d&&(p.floatImageSetting.y=g/2)}if("left"===i||"right"===i){var m=t.getColumnWidth(p.floatImageSetting.col);m<h&&(p.floatImageSetting.x=m/2)}return p}},{key:"createFloatImageActions",value:function(e,t){var n=this.host.sheet.id();this.host.command._changesets.push((0,M.B0I)(n,e)),this.host.command._oldChangesets.push((0,M.B0I)(n,t))}},{key:"execute",value:function(){var e=this,t=this.host.sheet.floatImageModel.getFloatImageMap();if(!(0,_.default)(t)){var n=this.getFloatImagesInRange(t);0!==n.length&&n.forEach((function(t){var n=e.getNewFloatImageBlock(t);e.createFloatImageActions(n,t)}))}}}]),t}(hn),kn=function(e){function t(){return(0,p.Z)(this,t),(0,d.Z)(this,(0,f.Z)(t).apply(this,arguments))}return(0,v.Z)(t,e),(0,g.Z)(t,[{key:"getCommentsInRange",value:function(e){var t=e.toJSON(),n=t.row,r=t.col,o=t.rowCount,i=t.colCount,a=n+o,s=r+i,l=this.host.sheet.getAllComments().filter((function(e){var t=e.row,o=e.col;return t>=n&&t<a&&o>=r&&o<s}));return(0,y.default)(l)}},{key:"execute",value:function(){var e=this;this.getCommentsInRange(this.host.selectionRange).forEach((function(t){var n=t.row,r=t.col,o=t.comments;e.host.command._oldChangesets.push(e.host.pubCellCommentsAction(n,r,o))}))}}]),t}(hn),En=function(e){return e.isFormula()&&e.isImportRange()},Tn=function(e){function t(){return(0,p.Z)(this,t),(0,d.Z)(this,(0,f.Z)(t).apply(this,arguments))}return(0,v.Z)(t,e),(0,g.Z)(t,[{key:"arrayFormulaAdjustOnAdd",value:function(){var e=this,t=this.host.sheet,n=this.host.sourceRange.toJSON(),r=n.row,o=n.col,i=n.rowCount,a=n.colCount,s=this.host.targetRange.toJSON(),l=s.row,u=s.col,c=(0,M.qRG)(t,r,o,t,l,u,i,a);t.iterContentWithPos(r,o,i,a,!0).forEach((function(n){var r=n[1],o=r.row,i=r.col;t.isProxyArrayFormula(o,i)?c.has(t.getVar(o,i).formula)||(e.createArrayFormulaAdjustDoActions(o,i),e.createArrayFormulaAdjustUndoActions(o,i)):En(t.getVar(o,i))&&e.importRangeAdjust(o,i)}))}},{key:"createArrayFormulaAdjustDoActions",value:function(e,t){var n=this.getTargetCellInfo(e,t);this.createArrayFormulaAdjustActions(n,{value:null},!1)}},{key:"createArrayFormulaAdjustActions",value:function(e,t,n){if(e){var r=e.row,o=e.col,i=this.host.sheet,a=this.host._setRangeActionCore(i.id(),new M.e6w(r,o,1,1,i),t,!0);n?this.host.command._oldChangesets.push(a):this.host.command._changesets.push(a)}}},{key:"createArrayFormulaAdjustUndoActions",value:function(e,t){var n,r,o=this.getMoveInArrayFormulaCellInfo(e,t);if(o){var i=o.row,a=o.col,s=o.isProxyArrayFormula,l={value:null===(n=this.host.pubGetSetCellAction(this.host.sheet,i,a))||void 0===n||null===(r=n.value)||void 0===r?void 0:r.value};s&&(l.value=null),this.createArrayFormulaAdjustActions(o,l,!0)}}},{key:"getMoveInArrayFormulaCellInfo",value:function(e,t){var n=this.host.selectionRange.toJSON(),r=n.row,o=n.col,i=n.rowCount,a=n.colCount,s=this.host.sourceRange.toJSON(),l=s.row,u=s.col,c=l+s.rowCount,h=u+s.colCount,d=e,f=t,v=this.host.command.direction;return"right"===v?f-=a:"down"===v?d-=i:"left"===v?f+=a:"up"===v&&(d+=i),d<0||f<0||d<r||f<o||d>c||f>h?null:{row:d,col:f,isProxyArrayFormula:this.host.sheet.isProxyArrayFormula(d,f)}}},{key:"importRangeAdjust",value:function(e,t){var n=this.host.sheet,r=this.host.pubGetSetCellAction(n,e,t);r.sheet_id=n.id();var o=(0,y.default)(r),i=this.getTargetCellInfo(e,t),a=i.row,s=i.col;o.target.row=a,o.target.col=s,this.host.command._changesets.push(o);var l=(0,y.default)(r);l.target.row=e,l.target.col=t,this.host.command._oldChangesets.push(l);var u=r.value.formulaData.externalDataReference;u&&(0,M.ohz)(u,n.parent,a,s)}},{key:"getTargetCellInfo",value:function(e,t){var n=this.host.selectionRange.toJSON(),r=n.rowCount,o=n.colCount,i=e,a=t,s=this.host.command.direction;return"right"===s?a+=o:"down"===s?i+=r:"left"===s?a-=o:"up"===s&&(i-=r),{row:i,col:a}}},{key:"createArrayFormulaAdjustDoActionsOnDelete",value:function(e,t,n){var r,o={value:null};n||(o=(null===(r=this.host.pubGetSetCellAction(this.host.sheet,e,t,{handleStyleRef:!1}))||void 0===r?void 0:r.value)||o);this.createArrayFormulaAdjustActions({row:e,col:t,isProxyArrayFormula:n},o,!0)}},{key:"arrayFormulaAdjustOnDelete",value:function(){for(var e=this.host.sheet,t=this.host.sourceRange.toJSON(),n=t.row,r=t.col,o=t.rowCount,i=t.colCount,a=this.host.targetRange.toJSON(),s=a.row,l=a.col,u=(0,M.qRG)(e,n,r,e,s,l,o,i),c=n;c<n+o;c++)for(var h=r;h<r+i;h++)e.isProxyArrayFormula(c,h)?(u.has(e.getVar(c,h).formula)||this.createArrayFormulaAdjustDoActions(c,h),this.createArrayFormulaAdjustDoActionsOnDelete(c,h,!0)):En(e.getVar(c,h))?this.importRangeAdjust(c,h):e.isArrayFormula(c,h)||this.createArrayFormulaAdjustDoActionsOnDelete(c,h,!1)}},{key:"execute",value:function(){this.isAddCell()?this.arrayFormulaAdjustOnAdd():this.arrayFormulaAdjustOnDelete()}}]),t}(hn),bn=function(e){function t(){return(0,p.Z)(this,t),(0,d.Z)(this,(0,f.Z)(t).apply(this,arguments))}return(0,v.Z)(t,e),(0,g.Z)(t,[{key:"getRangeInfo",value:function(e){var t=e.rowFrom(),n=e.rowCount(!0),r=t+n-1,o=e.colFrom(),i=e.colCount(!0);return{rowFrom:t,rowCount:n,rowTo:r,colFrom:o,colCount:i,colTo:o+i-1}}},{key:"createFilterActionWhenAdd",value:function(e,t,n,r){if(t){var o=this.host,i=o.sheet,a=o.selectionRange,s=this.host.command.direction,l=this.getRangeInfo(a),u=l.rowFrom,c=l.rowTo,h=l.colFrom,d=l.colTo,f=l.rowCount,v=l.colCount,p=this.getRangeInfo(t),g=p.rowFrom,m=p.rowTo,_=p.colFrom,y=p.colTo,C=p.colCount,S=p.rowCount,k=t.clone();if("right"===s){if(c<m)return;var E;if(u<=g){if(h>y)return;h>_?k.setColCount(C+v):k.setColFrom(_+v),c===m&&(E={movedColStart:-1,movedRowCount:0})}else{if(c===m)return;if(u>m+1)return;if(h>=_||d>=y)return;E={movedColStart:Math.max(d+1,_),movedRowCount:c-m}}if(Boolean(E)){for(var T=m+1,b=this.host.finalRowCount-T,I=0,R=E,w=R.movedColStart,A=R.movedRowCount,F=k.colCount(!0),D=k.colFrom(),N=k.colTo(!0)-w+1;I<b;I++){var P=T+I;if(I<A){if(i.iterContent(P,w-v,1,N).first())continue;break}if(!i.iterContent(P,D,1,F).first())break}k.setRowCount(S+I)}var M=this.saveSetFilterAction(k,r),L=this.getFilterUndoActions(t,r);return(0,O.hTd)(e.actions,M),void(0,O.hTd)(e.oldActions,L)}if(!(u>m||d<_||h>y)){var x;if(d<y){k.setRowCount(S+f);var V=Math.max(_,h);x={moveColStart:V,moveColCount:d-V+1}}else h<=_?u<=g?k.setRowFrom(g+f):k.setRowCount(S+f):(k.setRowCount(S+f),x={moveColStart:h,moveColCount:y-h+1});if(Boolean(x)){for(var Z=k.rowTo(!0)+1,B=this.host.finalRowCount-Z,H=x,U=H.moveColStart,j=H.moveColCount,G=U,K=j,W=_,z=U+j,Y=0;Y<B;Y++){var J=Z+Y;if(!i.iterContent(J-f,G,1,K).first()&&!(W<G&&i.iterContent(J,W,1,G-W).first()||d<y&&i.iterContent(J,z,1,y-z+1).first()))break}k.setRowCount(k.rowCount(!0)+Y)}var q=this.saveSetFilterAction(k,r),$=this.getFilterUndoActions(t,r);(0,O.hTd)(e.actions,q),(0,O.hTd)(e.oldActions,$)}}}},{key:"filterAdjustWhenAdd",value:function(){var e=this,t=this.host.sheet,n={actions:[],oldActions:[]},r=t.sheetFilterModel.filterRange;this.createFilterActionWhenAdd(n,r),(0,M.LxP)(t).forEach((function(t){var r=t.range,o=t.id,i=t.name;e.createFilterActionWhenAdd(n,r,i,o)})),(0,O.hTd)(this.host.command._changesets,n.actions),(0,O.hTd)(this.host.command._oldChangesets,n.oldActions)}},{key:"saveSetFilterAction",value:function(e,t){var n=this.host.sheet,r=[],o=(0,M.xD6)(e,!0);return o.row=Math.min(o.row,this.host.finalRowCount-1),o.col=Math.min(o.col,this.host.finalColCount-1),o.row_count=Math.min(o.row_count,this.host.finalRowCount-o.row),o.col_count=Math.min(o.col_count,this.host.finalColCount-o.col),t?r.push((0,O.eRv)(n.id(),{range:o,view_id:t})):r.push({action:"setFilter",sheet_id:n.id(),target:o,value:null}),r}},{key:"getFilterUndoActions",value:function(e,t){var n=this.host.sheet.id();if(t)return[(0,O.eRv)(n,{range:(0,M.xD6)(e),view_id:t})];var r=this.host.sheet.sheetFilterModel.getInfo();if(!r)return[];var o=r.range;return[{action:"setFilter",sheet_id:n,target:(0,M.xD6)(o),value:null}]}},{key:"createFilterActionWhenDelete",value:function(e,t,n,r){if(t){var o=this.host,i=o.sheet,a=o.selectionRange,s=this.host.command.direction,l=this.getRangeInfo(a),u=l.rowFrom,c=l.rowTo,h=l.colFrom,d=l.colTo,f=l.colCount,v=l.rowCount,p=this.getRangeInfo(t),g=p.rowFrom,m=p.rowTo,_=p.colFrom,y=p.colTo,C=p.rowCount,S=p.colCount;if(h<=_&&d>=y&&u<=g&&c>=m){var k=(0,M.o80)(i,t,n,r),E=k.actions,T=k.oldActions;return(0,O.hTd)(e.actions,E),void(0,O.hTd)(e.oldActions,T)}var b=t.clone();if("left"===s){if(c<m)return;var I;if(u<=g){if(h>y)return;h>_?b.setColCount(d<=y?S-f:h-_):d<_?b.setColFrom(_-f):(b.setColFrom(h),b.setColCount(y-d)),c===m&&(I={movedColStart:-1,movedRowCount:0})}else{if(c===m)return;if(u>m+1)return;if(h>=y+1)return;I={movedColStart:Math.max(h,_),movedRowCount:c-m}}if(Boolean(I)){for(var R=m+1,w=this.host.finalRowCount-R,A=0,F=I,D=F.movedColStart,N=F.movedRowCount,P=b.colCount(!0),L=b.colFrom(),x=b.colTo(!0)-D+1;A<w;A++){var V=R+A,Z=A<N;if(!Z||!i.iterContent(V,D+f,1,x).first()){var B=Z?D-L:P;if(!i.iterContent(V,L,1,B).first())break}}b.setRowCount(C+A)}var H=this.saveSetFilterAction(b,r),U=this.getFilterUndoActions(t,r);return(0,O.hTd)(e.actions,H),void(0,O.hTd)(e.oldActions,U)}if(!(u>m+1||d<_||h>y)){var j;if(u===m+1){var G=Math.max(_,h);j={moveColStart:G,moveColCount:Math.min(y,d)-G+1}}else if(d<y){var K=Math.max(_,h);j={moveColStart:K,moveColCount:d-K+1}}else if(h<=_)if(c<g)b.setRowFrom(g-v);else{if(u<=g){var W=(0,M.o80)(i,t,n,r),z=W.actions,Y=W.oldActions;return(0,O.hTd)(e.actions,z),void(0,O.hTd)(e.oldActions,Y)}c<m?b.setRowCount(C-v):(b.setRowCount(u-g),j={moveColStart:_,moveColCount:S})}else j={moveColStart:h,moveColCount:y-h+1};if(Boolean(j)){for(var J=b.rowTo(!0)+1+v,q=this.host.finalRowCount-J,$=j,X=$.moveColStart,Q=$.moveColCount,ee=X,te=Q,ne=_,re=X+Q,oe=0;oe<q;oe++){var ie=J+oe;if(!i.iterContent(ie,ee,1,te).first()){var ae=ie-v;if(!(ne<ee&&i.iterContent(ae,ne,1,ee-ne).first()||d<y&&i.iterContent(ae,re,1,y-re+1).first()))break}}b.setRowCount(b.rowCount(!0)+oe)}var se=this.saveSetFilterAction(b,r),le=this.getFilterUndoActions(t,r);(0,O.hTd)(e.actions,se),(0,O.hTd)(e.oldActions,le)}}}},{key:"filterAdjustWhenDelete",value:function(){var e=this,t=this.host.sheet,n={actions:[],oldActions:[]},r=t.sheetFilterModel.filterRange;this.createFilterActionWhenDelete(n,r),(0,M.LxP)(t).forEach((function(t){var r=t.range,o=t.id,i=t.name;e.createFilterActionWhenDelete(n,r,i,o)})),(0,O.hTd)(this.host.command._changesets,n.actions),(0,O.hTd)(this.host.command._oldChangesets,n.oldActions)}},{key:"execute",value:function(){this.isAddCell()?this.filterAdjustWhenAdd():this.filterAdjustWhenDelete()}}]),t}(hn),In=function(e){function t(){return(0,p.Z)(this,t),(0,d.Z)(this,(0,f.Z)(t).apply(this,arguments))}return(0,v.Z)(t,e),(0,g.Z)(t,[{key:"getFloatBlocksInRange",value:function(e){var t=[],n=this.host.selectionRange.toJSON(),r=n.row,o=n.col,i=r+n.rowCount,a=o+n.colCount,s=this.host.command.direction;for(var l in e){var u=e[l],c=u.blockSetting,h=c.row,d=c.col;"right"===s&&r<=h&&h<i&&d>=o&&t.push(u),"down"===s&&o<=d&&d<a&&h>=r&&t.push(u),"up"===s&&o<=d&&d<a&&h>=i&&t.push(u),"left"===s&&r<=h&&h<i&&d>=a&&t.push(u)}return t}},{key:"getNewFloatBlock",value:function(e){var t=this.host.sheet,n=this.host.selectionRange.toJSON(),r=n.rowCount,o=n.colCount,i=e.sheetId,a=e.blockToken,s=e.blockType,l=e.blockSetting,u=l.row,c=l.col,h=l.x,d=l.y,f=u,v=c,p={sheetId:i,blockToken:a,blockType:s,blockSetting:(0,y.default)(l)},g=this.host.command.direction;if("right"===g&&(v+=o,p.blockSetting.col=v),"down"===g&&(f+=r,p.blockSetting.row=f),"left"===g&&(v-=o,p.blockSetting.col=v),"up"===g&&(f-=r,p.blockSetting.row=f),"up"===g||"down"===g){var m=t.getRowHeight(p.blockSetting.row);m<d&&(p.blockSetting.y=m/2)}if("left"===g||"right"===g){var _=t.getColumnWidth(p.blockSetting.col);_<h&&(p.blockSetting.x=_/2)}return p}},{key:"getSetFloatBlockAction",value:function(e){var t=e.blockToken,n=e.blockType,r=e.blockSetting;return{action:"setFloatBlock",sheet_id:this.host.sheet.id(),value:Object.assign({},r,{blockToken:t,blockType:n})}}},{key:"createFloatBlockActions",value:function(e,t){var n=this.getSetFloatBlockAction(t);this.host.command._changesets.push(n);var r=this.getSetFloatBlockAction(e);this.host.command._oldChangesets.push(r)}},{key:"execute",value:function(){var e=this,t=this.host.sheet.floatBlocksModel.getFloatBlocksMap();if(!(0,_.default)(t)){var n=this.getFloatBlocksInRange(t);0!==n.length&&n.forEach((function(t){var n=e.getNewFloatBlock(t);e.createFloatBlockActions(t,n)}))}}}]),t}(hn),Rn=function(e){function t(){return(0,p.Z)(this,t),(0,d.Z)(this,(0,f.Z)(t).apply(this,arguments))}return(0,v.Z)(t,e),(0,g.Z)(t,[{key:"getPivotBlocksInRange",value:function(e){var t=this,n=this.host.selectionRange.toJSON(),r=n.row,o=n.col,i=n.rowCount,a=n.colCount,s=r+i,l=o+a;return Object.values(e).filter((function(e){var n=e.position,i=n.row,a=n.col;switch(t.host.command.direction){case"right":case"left":return r<=i&&s>i&&o<=a;case"up":case"down":return o<=a&&l>a&&r<=i}}))}},{key:"getNewEmbeddedBlock",value:function(e){var t=Object.assign({},e.position),n=this.host,r=n.command.direction,o=n.selectionRange;return"left"!==r&&"right"!==r||(t.col+=o.colCount()*("left"===r?-1:1)),"up"!==r&&"down"!==r||(t.row+=o.rowCount()*("up"===r?-1:1)),Object.assign({},e,{blockSetting:Object.assign({},e.blockSetting),position:t})}},{key:"createEmbeddedBlockActions",value:function(e,t){var n=this.getSetEmbeddedBlockAction(t);this.host.command._changesets.push(n);var r=this.getSetEmbeddedBlockAction(e);this.host.command._oldChangesets.push(r)}},{key:"getSetEmbeddedBlockAction",value:function(e){var t=e.blockToken,n=e.blockType,r=e.blockSetting;return{action:"setEmbeddedBlock",sheet_id:this.host.sheet.id(),target:Object.assign({},e.position),value:{blockSetting:Object.assign({},r),blockToken:t,blockType:n}}}},{key:"execute",value:function(){var e=this,t=this.host.sheet.embeddedBlocksModel.getBlocksMap();if(!(0,_.default)(t)){var n=this.getPivotBlocksInRange(t);if(!(n.length<1)){var r=function(e){switch(e){case"right":return function(e,t){return t.col-e.col};case"left":return function(e,t){return e.col-t.col};case"up":return function(e,t){return e.row-t.row};case"down":return function(e,t){return t.row-e.row}}}(this.host.command.direction);n.sort((function(e,t){return r(e.position,t.position)})),n.forEach((function(t){var n=e.getNewEmbeddedBlock(t);e.createEmbeddedBlockActions(t,n)}))}}}}]),t}(hn),wn=function(e){function t(e){var n;(0,p.Z)(this,t);var r=(n=(0,d.Z)(this,(0,f.Z)(t).call(this,e))).host.command.direction;return"up"===r||"down"===r?(n.mainFrom=function(e){return e.rowFrom()},n.mainTo=function(e){return e.rowTo()},n.mainCount=function(e){return e.rowCount()},n.setMainFrom=function(e,t){return e.setRowFrom(t)},n.setMainCount=function(e,t){return e.setRowCount(t)},n.crossFrom=function(e){return e.colFrom()},n.crossTo=function(e){return e.colTo()},n.crossCount=function(e){return e.colCount()},n.setCrossFrom=function(e,t){return e.setColFrom(t)},n.setCrossCount=function(e,t){return e.setColCount(t)}):(n.mainFrom=function(e){return e.colFrom()},n.mainTo=function(e){return e.colTo()},n.mainCount=function(e){return e.colCount()},n.setMainFrom=function(e,t){return e.setColFrom(t)},n.setMainCount=function(e,t){return e.setColCount(t)},n.crossFrom=function(e){return e.rowFrom()},n.crossTo=function(e){return e.rowTo()},n.crossCount=function(e){return e.rowCount()},n.setCrossFrom=function(e,t){return e.setRowFrom(t)},n.setCrossCount=function(e,t){return e.setRowCount(t)}),n}return(0,v.Z)(t,e),(0,g.Z)(t,[{key:"createConditionFormatActions",value:function(e,t,n){var r=e.toJSON();if(n.length<1){var o=this.getDelConditionFormatAction(r,t);this.host.command._changesets.push(o);var i=this.getAddConditionFormatAction(r,t);this.host.command._oldChangesets.push(i)}else{var a=this.getSetConditionFormatAction(r,n);this.host.command._changesets.push(a);var s=this.getSetConditionFormatAction(r);this.host.command._oldChangesets.push(s)}}},{key:"getSetConditionFormatAction",value:function(e,t){return{action:"setConditionalFormat",sheet_id:this.host.sheet.id(),value:Object.assign({},e,{ranges:t?t.map((function(e){return(0,M.z3T)(e,!0)})):e.ranges})}}},{key:"getAddConditionFormatAction",value:function(e,t){return{action:"addConditionalFormat",sheet_id:this.host.sheet.id(),value:Object.assign({},e,{index:t})}}},{key:"getDelConditionFormatAction",value:function(e,t){return{action:"delConditionalFormat",sheet_id:this.host.sheet.id(),value:{cfId:e.cfId,index:t}}}},{key:"getRangesGroupByCrossAxis",value:function(e){var t=this,n=new Map,r=[];e.forEach((function(e){var o=t.crossFrom(e);n.has(o)||(n.set(o,[]),r.push(o)),n.get(o).push(e)}));var o,i=Y(n.keys());try{for(i.s();!(o=i.n()).done;){var a=o.value,s=n.get(a);if(!(s.length<2)){s.sort((function(e,n){return t.mainFrom(e)-t.mainFrom(n)}));for(var l=[],u=s[0].clone(),c=1,h=s.length;c<h;c++){var d=s[c];this.crossCount(u)!==this.crossCount(d)||this.mainTo(u)+1!==this.mainFrom(d)?(l.push(u),u=d.clone()):this.setMainCount(u,this.mainCount(u)+this.mainCount(d))}l.push(u),n.set(a,l)}}}catch(e){i.e(e)}finally{i.f()}return r.sort((function(e,t){return e-t})),{groups:n,crossList:r}}},{key:"execute",value:function(){var e=this,t=this.host.sheet.conditionalFormatModel.getAllRules();if(!(t.length<1)){var n=[],r=this.host.selectionRange,o=this.mainFrom(r),a=this.crossFrom(r),s=this.mainTo(r),l=this.crossTo(r);t.forEach((function(t,i){var u=t.getBaseRanges(),c=[],h={crossAxisClose:[],mainAxisClose:[],cornerClose:[]},d=[],f=[],v=[];u.forEach((function(t){var n=e.mainFrom(t),i=e.crossFrom(t),u=e.mainTo(t),p=e.crossTo(t);if(p===a-1||i===l+1)return u===o-1?void h.cornerClose.push(t):void h.mainAxisClose.push(t);if(p<a-1||i>l+1)return u===o-1?void h.crossAxisClose.push(t):void d.push(t);if(u!==o-1)if(u<o-1)d.push(t);else{var g=t.clone();if(a>i){var m=g.clone();e.setCrossCount(m,a-i),h.mainAxisClose.push(m),e.setCrossFrom(g,a),e.setCrossCount(g,p-a+1)}if(l<p){var _=g.clone(),y=l+1;e.setCrossFrom(_,y),e.setCrossCount(_,p-y+1),h.mainAxisClose.push(_),e.setCrossCount(g,l-e.crossFrom(g)+1)}if(e.isAddCell()){if(o<=n)return e.setMainFrom(g,n+e.mainCount(r)),void c.push(g);var C=g.clone();return e.setMainCount(C,e.mainCount(C)+e.mainCount(r)),void f.push(C)}if(o>n){var S=g.clone();e.setMainCount(S,o-n),h.crossAxisClose.push(S),e.setMainFrom(g,o),e.setMainCount(g,u-o+1)}if(s>=n){var k=u-s;if(k<1)return void v.push(g);e.setMainFrom(g,s+1),e.setMainCount(g,k)}e.setMainFrom(g,e.mainFrom(g)-e.mainCount(r)),c.push(g)}else h.crossAxisClose.push(t)})),(c.length>0||f.length>0||v.length>0)&&n.push({rule:t,ruleIndex:i,rangesToMove:c,mayMergeRanges:h,unaffectedRanges:d,extendRanges:f})})),n.length<1||n.map((function(t){var n=t.rule,r=t.ruleIndex,o=t.rangesToMove,a=t.mayMergeRanges,s=t.unaffectedRanges,l=t.extendRanges,u=e.getRangesGroupByCrossAxis(a.mainAxisClose),c=a.cornerClose.reduce((function(t,n){var r=e.crossFrom(n);if(!u.groups.has(r))return t.push(n),t;var o=u.groups.get(r),i=o[0];if(e.mainTo(n)+1!==e.mainFrom(i)||e.crossCount(n)!==e.crossCount(i))return t.push(n),t;var a=i.clone();return e.setMainFrom(a,e.mainFrom(n)),e.setMainCount(a,e.mainCount(a)+e.mainCount(n)),o[0]=a,t}),[]);a.crossAxisClose.sort((function(t,n){return e.crossFrom(t)-e.crossFrom(n)}));var h=a.crossAxisClose;h.length>0&&(c=c.reduce((function(t,n){var r=h.length-1,o=e.crossFrom(h[0])===e.crossTo(n)+1,i=o?0:e.crossTo(h[r])+1===e.crossFrom(n)?r:-1;if(-1===i)return t.push(n),t;var a=h[i];if(e.mainCount(a)!==e.mainCount(n))return t.push(n),t;var s=a.clone();return e.setCrossCount(s,e.crossCount(s)+e.crossCount(n)),o&&e.setCrossFrom(s,e.crossFrom(n)),h[i]=s,t}),[]));var d=e.getRangesGroupByCrossAxis(o),f=new Map;if(h.length>0){for(var v=h[0].clone(),p=1,g=h.length;p<g;p++){var m=h[p];e.mainCount(v)!==e.mainCount(m)||e.crossTo(v)+1!==e.crossFrom(m)?(f.set(e.crossFrom(v),v),v=m.clone()):e.setMainCount(v,e.mainCount(v)+e.mainCount(m))}f.set(e.crossFrom(v),v);var _=e.mainTo(f.values().next().value)+1;d.crossList.forEach((function(t){var n=d.groups.get(t),r=n[0];if(e.mainFrom(r)===_&&f.has(t)){var o=f.get(t);if(e.crossCount(o)===e.crossCount(r)){var i=o.clone();e.setMainCount(i,e.mainCount(i)+e.mainCount(r)),n[0]=i,f.delete(t)}}}))}var y=new Map([].concat((0,i.Z)(u.groups),(0,i.Z)(d.groups))),C=d.crossList[0],S=u.crossList.findIndex((function(e){return e>C})),k=-1===S?[].concat((0,i.Z)(u.crossList),(0,i.Z)(d.crossList)):[].concat((0,i.Z)(u.crossList.slice(0,S)),(0,i.Z)(d.crossList),(0,i.Z)(u.crossList.slice(S))),E=[];return k.length>0&&function(){for(var t=y.get(k[0]),n=new Map(t.map((function(t){return[e.mainFrom(t),t.clone()]}))),r=1,o=k.length;r<o;r++){var i,a=k[r],s=Y(n.keys());try{for(s.s();!(i=s.n()).done;){var l=i.value,u=n.get(l);e.crossTo(u)<a-1&&(E.push(u),n.delete(l))}}catch(e){s.e(e)}finally{s.f()}y.get(a).forEach((function(t){var r=e.mainFrom(t);if(n.has(r)){var o=n.get(r);if(e.mainCount(o)!==e.mainCount(t))return E.push(o),void n.set(r,t.clone());e.setCrossCount(o,e.crossCount(o)+e.crossCount(t))}else n.set(r,t.clone())}))}(0,O.hTd)(E,n.values())}(),{rule:n,ruleIndex:r,allRanges:[].concat((0,i.Z)(s),(0,i.Z)(l),(0,i.Z)(c),(0,i.Z)(f.values()),E)}})).forEach((function(t){var n=t.rule,r=t.ruleIndex,o=t.allRanges;e.createConditionFormatActions(n,r,o)}))}}}]),t}(hn),An=function(e){function t(e){var n;(0,p.Z)(this,t);var r=(n=(0,d.Z)(this,(0,f.Z)(t).call(this,e))).host.command.direction;n.isRowOp="up"===r||"down"===r,n.isRowOp?(n.mainFrom="row",n.mainCount="rowCount",n.getMainTo=dn,n.crossFrom="col",n.crossCount="colCount",n.getCrossTo=fn):(n.mainFrom="col",n.mainCount="colCount",n.getMainTo=fn,n.crossFrom="row",n.crossCount="rowCount",n.getCrossTo=dn);var o=n.host.selectionRange.toJSON();return n.selectionMainFrom=o[n.mainFrom],n.selectionMainTo=n.getMainTo(o),n.selectionMainCount=o[n.mainCount],n.selectionCrossFrom=o[n.crossFrom],n.selectionCrossTo=n.getCrossTo(o),n}return(0,v.Z)(t,e),(0,g.Z)(t,[{key:"getProtectionsToUpdate",value:function(e){var t=this,n=this.host.sourceRange.union(this.host.targetRange),r=this.host.sheet.protectionModel.getProtectionsByRange(n),o=[];return r.forEach((function(n){var r=(0,M.__h)(n),i=r[O.xj7.NORMAL],a=r[O.xj7.ROW],s=r[O.xj7.COL];if(!(i.length<1)){var l=[],u=[],c=[];i.forEach((function(n){var r=t.getRangeAffectedResult(n);switch(r){case"DEL":return void c.push(n);case"KEPT":return void l.push(n);default:t.newRangeCountLimit(r,e,r[t.mainFrom]+r[t.mainCount]),u.push(r)}})),u.length<1&&c.length<1||o.push({protection:n,newCellRanges:[].concat(l,u),oldRowRanges:a,oldColumnRanges:s})}})),o}},{key:"newRangeCountLimit",value:function(e,t,n){"rowCount"===this.mainCount&&n>t.maxRowCount&&(e[this.mainCount]=t.maxRowCount-e[this.mainFrom]),"colCount"===this.mainCount&&n>t.maxColCount&&(e[this.mainCount]=t.maxColCount-e[this.mainFrom])}},{key:"getRangeAffectedResult",value:function(e){var t=e[this.mainFrom]>=this.selectionMainFrom&&this.getMainTo(e)<=this.selectionMainTo,n=e[this.crossFrom]>=this.selectionCrossFrom&&this.getCrossTo(e)<=this.selectionCrossTo;if(!t&&!n)return"KEPT";var r=this.isAddCell(),o=e[this.mainFrom];if(t&&n){if(r){var i=Object.assign({},e);return i[this.mainFrom]=o+this.selectionMainCount,i}return"DEL"}if(t){if(r)return"KEPT";var a=e[this.crossFrom],s=this.getCrossTo(e),l=a>=this.selectionCrossFrom&&a<=this.selectionCrossTo,u=s>=this.selectionCrossFrom&&s<=this.selectionCrossTo;if(!l&&!u)return"KEPT";var c=Object.assign({},e);return l?(c[this.crossFrom]=this.selectionCrossTo+1,c[this.crossCount]=s-c[this.crossFrom]+1):c[this.crossCount]=this.selectionCrossFrom-a,c}if(this.getMainTo(e)<this.selectionMainFrom)return"KEPT";var h=Object.assign({},e);if(o<this.selectionMainFrom){var d=e[this.mainCount];return h[this.mainCount]=r?d+this.selectionMainCount:this.selectionMainTo>this.getMainTo(e)?this.selectionMainFrom-o:d-this.selectionMainCount,h}return r?(h[this.mainFrom]=o+this.selectionMainCount,h):o>this.selectionMainTo?(h[this.mainFrom]=o-this.selectionMainCount,h):(h[this.mainFrom]=this.selectionMainFrom,h[this.mainCount]=this.getMainTo(e)-this.selectionMainTo,h)}},{key:"createSetRangeProtectionActions",value:function(e){var t=this.host.sheet.id(),n=e.protection,r=e.newCellRanges,o=e.oldRowRanges,a=e.oldColumnRanges,s=0===r.length?(0,M.CcX)(t,n):(0,M.l5Z)(t,Object.assign({},n,{ranges:[].concat((0,i.Z)(r),(0,i.Z)(o),(0,i.Z)(a))}));this.host.command._changesets.push(s);var l=(0,M.l5Z)(t,n);this.host.command._oldChangesets.push(l)}},{key:"execute",value:function(e){var t=this;this.getProtectionsToUpdate(e).forEach((function(e){return t.createSetRangeProtectionActions(e)}))}}]),t}(hn),Fn=function(e){function t(){return(0,p.Z)(this,t),(0,d.Z)(this,(0,f.Z)(t).apply(this,arguments))}return(0,v.Z)(t,e),(0,g.Z)(t,[{key:"doAddDelCell",value:function(){var e,t,n,r,o=this,i=this.host.sheet.getSparklineModel();this.host.selectionRange.toJSON();var a=this.getSparklineIterArea(),s=a.rowFrom,l=a.colFrom,u=a.rowCount,c=a.colCount;i.iter(s,l,u,c).forEach((function(a){var s=a.getPosition(),l=s.row,u=s.col,c=a.getId(),h=a.getGroupId(),d={position:{row:l,col:u},source:a.getSource()},f=i.getSparklineRawConfig(h),v=o.updatePosition(a,n,r),p=v.newPosition;n=v.deleteActionConfig,r=v.add;var g={};if(p){e||(e={}),t||(t={}),Object.assign(g,f||{},{position:p}),(0,M.ah$)(e,h,c,g);var m=i.getSparklineRawConfig(h);(0,M.ah$)(t,h,c,d),m&&(t[h].config=m)}}));var h=(0,M.aH0)(this.host.sheet,(function(){return{do:e,undo:t,add:r,delete:n}}));h.do&&this.host.command._changesets.push(h.do),h.undo&&this.host.command._oldChangesets.push(h.undo)}},{key:"updatePosition",value:function(e,t,n){var r,o=this.host.selectionRange.toJSON(),i=o.row,a=o.col,s=o.rowCount,l=o.colCount,u=i+s,c=a+l,h=this.host.command.direction,d=this.host.sheet.getSparklineModel(),f=e.getPosition(),v=f.row,p=f.col,g=e.getId(),m=e.getGroupId(),_={position:{row:v,col:p},source:e.getSource()},y=d.getSparklineRawConfig(m);return"right"===h&&i<=v&&u>v&&a<=p&&(r={row:v,col:p+l}),"down"===h&&i<=v&&a<=p&&c>p&&(r={row:v+s,col:p}),"up"===h&&(this.host.selectionRange.containCell(v,p)?(t||(t={}),n||(n={}),(0,M.ah$)(t,m,g,null),(0,M.ah$)(n,m,g,_),y&&(n[m].config=y)):u<=v&&a<=p&&c>p&&(r={row:v-s,col:p})),"left"===h&&(t||(t={}),n||(n={}),this.host.selectionRange.containCell(v,p)?((0,M.ah$)(t,m,g,null),(0,M.ah$)(n,m,g,_),y&&(n[m].config=y)):i<=v&&u>v&&a<=p&&(r={row:v,col:p-l})),{newPosition:r,deleteActionConfig:t,add:n}}},{key:"getSparklineIterArea",value:function(){var e,t,n,r,o=this.host.selectionRange.toJSON(),i=o.row,a=o.col,s=o.rowCount,l=o.colCount,u=this.host.command.direction;return"right"===u&&(e=i,t=a,n=s,r=this.host.sheet.getColumnCount()-t),"down"===u&&(e=i,t=a,n=this.host.sheet.getRowCount()-i,r=l),"up"===u&&(e=i,t=a,n=this.host.sheet.getRowCount()-i,r=l),"left"===u&&(e=i,t=a,n=s,r=this.host.sheet.getColumnCount()-t),{rowFrom:e,colFrom:t,rowCount:n,colCount:r}}},{key:"execute",value:function(){this.doAddDelCell()}}]),t}(hn),Dn=function(e){function t(e,n){var r;return(0,p.Z)(this,t),(r=(0,d.Z)(this,(0,f.Z)(t).call(this,e,n))).hasEditedDataRange=!1,r.addCellEffects=[_n,pn,Cn,Sn,Tn,bn,In,Fn,Rn,wn,An],r.delCellEffects=[_n,yn,Sn,Tn,bn,In,Fn,Rn,wn,kn,An],r.selectionRange=n.selectionRange,r.sourceRange=n.sourceRange,r.targetRange=n.targetRange,r.intersectMergeCells=n.intersectMergeCells,r._finalRowCount=r._sheet.getRowCount(),r._finalColCount=r._sheet.getColumnCount(),r}return(0,v.Z)(t,e),(0,g.Z)(t,[{key:"pubGetSetCellAction",value:function(){return this.getSetCellAction.apply(this,arguments)}},{key:"pubCellCommentsAction",value:function(){return this._cellCommentsAction.apply(this,arguments)}},{key:"execute",value:function(){return this.command.isFirstExecution?this.doAction():this.redoAction()}},{key:"doAction",value:function(){return!!this.generateActions()&&this.applyActions()}},{key:"redoAction",value:function(){return!0===this.checkRangeValid(this._sheet.parent,this.command._changesets)&&this._applyChangsetWithEvent(this.command._changesets,void 0,"redo")}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this.command._oldChangesets,!0,"undo")}},{key:"generateActions",value:function(){if(this.selectionRange&&this.sourceRange&&this.targetRange)return this.splitIntersectMergedCells(),this.addRowsOrCols(),this.addCellOrDelCell(),!!this.checkRangeValid(this._sheet.parent,this.command._changesets,!0);console.error("[ADD_DEL_CELL] missing range info")}},{key:"applyActions",value:function(){return 0!==this.command._changesets.length&&this.tryApplyActions(this._sheet.parent,this.command._changesets,!0)}},{key:"splitIntersectMergedCells",value:function(){var e=this;this.intersectMergeCells.size&&this.intersectMergeCells.forEach((function(t){e.createSplitSpansAction(t)}))}},{key:"judgeIsNeedAddRows",value:function(){var e=this._sheet.getRowCount();return this.targetRange.rowFrom()+this.targetRange.rowCount(!0)>e}},{key:"judgeIsNeedAddCols",value:function(){var e=this._sheet.getColumnCount();return this.targetRange.colFrom()+this.targetRange.colCount(!0)>e}},{key:"addRowsOrCols",value:function(){"add"===this.command.type&&("down"===this.command.direction&&this.judgeIsNeedAddRows()&&this.addRows(),"right"===this.command.direction&&this.judgeIsNeedAddCols()&&this.addCols())}},{key:"addRows",value:function(){var e=this._sheet.getRowCount(),t=e,n=this.targetRange.rowFrom()+this.targetRange.rowCount(!0),r=n-e;this._finalRowCount=n;var o=this._addRowsAction(t,r);o.extra=o.extra||{},o.extra.keepSelection=!0,this.command._changesets.push(o),this.command._oldChangesets.unshift(this._delRowsAction(t,r))}},{key:"addCols",value:function(){var e=this._sheet.getColumnCount(),t=e,n=this.targetRange.colFrom()+this.targetRange.colCount(!0),r=n-e;this._finalColCount=n;var o=this._addColsAction(t,r);o.extra=o.extra||{},o.extra.keepSelection=!0,this.command._changesets.push(o),this.command._oldChangesets.unshift(this._delColsAction(t,r))}},{key:"executeEffects",value:function(e){var t=this;e.forEach((function(e){new e(t).execute({maxRowCount:t._finalRowCount,maxColCount:t._finalColCount})}))}},{key:"addCellOrDelCell",value:function(){var e="add"===this.command.type?this.addCellEffects:this.delCellEffects;this.executeEffects(e)}},{key:"createSplitSpansAction",value:function(e){var t=this._sheet.getSpans(e);t.length>0&&(this._spanToChangeset(e,t,!0),this._spanToChangeset(e,null))}},{key:"getNewCommentItem",value:function(e,t,n){var r=(0,y.default)(e),o=t.toJSON(),i=o.row,a=o.col,s=n.toJSON(),l=s.row-i,u=s.col-a,c=e.col,h=e.row;return r.row=h+l,r.col=c+u,r}},{key:"commandName",get:function(){return O.rvF.ADD_OR_DELETE_CELL}},{key:"sheet",get:function(){return this._sheet}},{key:"finalRowCount",get:function(){return this._finalRowCount}},{key:"finalColCount",get:function(){return this._finalColCount}}]),t}(M.T_g),Nn="add-or-delete-cell-controller",Pn="add-or-delete-cell-biz-controller",On=function(){function e(t,n,r,o,i,a){(0,p.Z)(this,e),this.minRow=t,this.minCol=n,this.maxRow=r,this.maxCol=o,this.leftChild=i,this.rightChild=a}return(0,g.Z)(e,[{key:"hasChildren",value:function(){return this.leftChild||this.rightChild}}],[{key:"build",value:function(t,n){if(t.length<1)return null;if(t.length<2){var r=t[0];return new e(r.row,r.col,r.rowTo,r.colTo,null,null)}for(var o=[],i=[],a=n,s="row"===a?"rowTo":"colTo",l=0,u=0,c=t.length;u<c;u++){var h=t[u];l+=(h[a]+h[s])/2}for(var d=l/t.length,f=0,v=t.length;f<v;f++){var p=t[f];((p[a]+p[s])/2<=d?o:i).push(p)}var g,m,_,y,C="row"===n?"col":"row",S=e.build(o,C),k=e.build(i,C);if(S&&k)g=Math.min(S.minRow,k.minRow),m=Math.max(S.maxRow,k.maxRow),_=Math.min(S.minCol,k.minCol),y=Math.max(S.maxCol,k.maxCol);else{var E=S||k;g=E.minRow,m=E.maxRow,_=E.minCol,y=E.maxCol}return new e(g,_,m,y,S,k)}},{key:"isCellInNode",value:function(t,n,r){return!!t&&!(n<t.minRow||n>t.maxRow||r<t.minCol||r>t.maxCol)&&(!t.hasChildren()||e.isCellInNode(t.leftChild,n,r)||e.isCellInNode(t.rightChild,n,r))}}]),e}(),Mn=function(e,t){return e.row<=t.row&&e.rowTo>=t.rowTo&&e.col<=t.col&&e.colTo>=t.colTo},Ln=function(){function e(t){(0,p.Z)(this,e),this.root=t}return(0,g.Z)(e,[{key:"hasCell",value:function(e,t){return!!this.root&&On.isCellInNode(this.root,e,t)}}],[{key:"build",value:function(t){var n=function(e){for(var t=new Map,n=function e(n){var r="".concat((n.row+n.rowTo)/2,",").concat((n.col+n.colTo)/2);if(t.has(r)){var o=t.get(r);if(Mn(n,o))t.set(r,n);else if(!Mn(o,n)){var i=n.col<=o.col?[n,o]:[o,n],a=(0,h.Z)(i,2),s=a[0],l=a[1];t.set(r,s),e(Object.assign({},l,{rowTo:s.row-1})),e(Object.assign({},l,{row:s.rowTo+1}))}}else t.set(r,n)},r=0,o=e.length;r<o;r++)n(e[r]);return Array.from(t.values())}(t);return new e(On.build(n,"row"))}}]),e}(),xn=function(e,t){if(e.size<1)return null;var n=e.values().next().value;return e.forEach((function(e){"left"!==t&&"right"!==t||e.colFrom()<n.colFrom()&&(n=e),"down"!==t&&"up"!==t||e.rowFrom()<n.rowFrom()&&(n=e)})),n},Vn=function(){function e(t,n){(0,p.Z)(this,e),this.spread=t,this.commandManager=n,this.isCellHasVisibleValue=!1,this.isCellHasStrictValue=!1,this.intersectMergeCells=new Set,this.isMoveRow=!1,n.register(O.rvF.ADD_OR_DELETE_CELL,{canUndo:!0,execute:function(e,t,n,r){return(0,M.P0c)(e,Dn,t,n,r)}})}var t;return(0,g.Z)(e,[{key:"addCell",value:function(e,t,n,r){return this.addOrDelCellImpl(e,"add",t,n,r)}},{key:"delCell",value:function(e,t,n,r){return this.addOrDelCellImpl(e,"delete",t,n,r)}},{key:"addOrDelCellImpl",value:(t=(0,l.Z)(s().mark((function e(t,n,r,o,i){var a,l,u,c,h,d;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.sheet=o||this.spread.getActiveSheet(),this.sheet){e.next=2;break}return e.abrupt("return",void console.error("[ADD_DEL_CELL] sheet not found"));case 2:if(this.selectionRange=i||this.sheet.getSelections()[0],(null===(a=this.selectionRange)||void 0===a?void 0:a.sheet())===this.sheet){e.next=4;break}return e.abrupt("return",void console.error("[ADD_DEL_CELL] selection is not in current sheet"));case 4:if(this.isCellHasVisibleValue=!1,this.isCellHasStrictValue=!1,this.direction=t,this.isMoveRow="up"===t||"down"===t,this.type=n,this.getRangesInfo()){e.next=7;break}return e.abrupt("return",void console.error("[ADD_DEL_CELL] getRangeInfoSuccess failed"));case 7:if(u=this.sheet.inject(Pn),!this.hasDeniedProtectionInPath()){e.next=10;break}return e.abrupt("return",void u.showDeniedProtectionModal());case 10:if(this.getIntersectMergeCells(),!(c=(null===(l=null==r?void 0:r.checkMergeCell)||void 0===l||l)&&xn(this.intersectMergeCells,t))){e.next=18;break}return e.next=15,u.showSplitCellsModal(c,this.intersectMergeCells);case 15:if(d=e.sent,null!=r&&null!==(h=r.onModalClose)&&void 0!==h&&h.call(r),d.result){e.next=18;break}return e.abrupt("return");case 18:return e.abrupt("return",this.execAddDelCellCmd());case 19:case"end":return e.stop()}}),e,this)}))),function(e,n,r,o,i){return t.apply(this,arguments)})},{key:"getRangesInfo",value:function(){this.prepareForGetRangesInfo();var e=this.getDataRange(),t=e.strict,n=e.visible,r=this.isMoveRow?t.rowCount()<1:t.colCount()<1;if("add"===this.type&&r&&this.isSelectionStrictEmpty())return!1;var o=this.selectionRange.toJSON(),i=o.row,a=o.col,s=o.rowCount,l=o.colCount,u=n.toJSON(),c=u.rowCount,h=u.colCount,d=0,f=0,v=0,p=0,g=0,m=0,_=0,y=0;return"add"===this.type&&"right"===this.direction&&(g=d=i,m=(f=a)+l,_=v=s,y=p=l+h),"add"===this.type&&"down"===this.direction&&(g=(d=i)+s,m=f=a,_=v=s+c,y=p=l),"delete"===this.type&&"left"===this.direction&&(f=a+l,g=d=i,m=a,_=v=s,y=p=h>l?h:l),"delete"===this.type&&"up"===this.direction&&(d=i+s,g=i,m=f=a,_=v=c>s?c:s,y=p=l),this.sourceRange=new M.e6w(d,f,v,p,this.sheet),this.targetRange=new M.e6w(g,m,_,y,this.sheet),!0}},{key:"getDataRange",value:function(){var e=this.selectionRange.toJSON(),t=e.row,n=e.col,r=e.rowCount,o=e.colCount,i=0,a=0,s=0,l=0,u=0,c=0,h=this.getFinalRowOrCol(),d=h.strict,f=h.visible;if(this.isMoveRow){i=t+r,a=n,l=o;var v=d||i;s=this.isCellHasStrictValue?v-i+1:0,c=o;var p=f||i;u=this.isCellHasVisibleValue?p-i+1:0}else{i=t,a=n+o,s=r;var g=d||a;l=this.isCellHasStrictValue?g-a+1:0,u=r;var m=f||a;c=this.isCellHasVisibleValue?m-a+1:0}return{strict:new M.e6w(i,a,s,l,this.sheet),visible:new M.e6w(i,a,u,c,this.sheet)}}},{key:"getFinalRowOrCol",value:function(){var e=this.selectionRange.toJSON(),t=e.row,n=e.col,r=e.rowCount,o=e.colCount,i=this.sheet.getRowCount(),a=this.sheet.getColumnCount();if(this.isMoveRow){for(var s=t+r,l=i,u=n+o,c=s,h=s,d=n;d<u;d++){for(var f=c,v=h,p=h;p<l;p++){var g=this.hasData(p,d);g.visible&&(h=p,this.isCellHasVisibleValue=!0),g.strict&&(c=p,this.isCellHasStrictValue=!0)}if(f===c)for(var m=f;m<v;m++)this.hasData(m,d).strict&&(c=m,this.isCellHasStrictValue=!0)}return{strict:c,visible:h}}for(var _=t+r,y=n+o,C=a,S=y,k=y,E=t;E<_;E++){for(var T=S,b=k,I=k;I<C;I++){var R=this.hasData(E,I);R.visible&&(k=I,this.isCellHasVisibleValue=!0),R.strict&&(S=I,this.isCellHasStrictValue=!0)}if(T===S)for(var w=T;w<b;w++)this.hasData(E,w).strict&&(S=w,this.isCellHasStrictValue=!0)}return{strict:S,visible:k}}},{key:"isSelectionStrictEmpty",value:function(){for(var e=this.selectionRange.toJSON(),t=e.row,n=e.rowCount,r=e.col,o=t+n,i=r+e.colCount,a=t;a<o;a++)for(var s=r;s<i;s++)if(this.hasData(a,s).strict)return!1;return!0}},{key:"prepareForGetRangesInfo",value:function(){if(this.selectionService=this.sheet.inject(M.Y19),this.cellsInSpan=this.selectionService.getCellsInSpan(this.sheet.getSpans()),this.sheet.filterModel.hasFilter()){var e=this.sheet.filterModel.getFilterRange(),t=e.row,n=e.col,r=e.rowCount,o=e.colCount;this.filterRange={row:t,rowTo:t+r-1,col:n,colTo:n+o-1}}var i=this.sheet.conditionalFormatModel.getAllRules().flatMap((function(e){return e.getBaseRanges()})).map((function(e){return{row:e.rowFrom(),col:e.colFrom(),rowTo:e.rowTo(),colTo:e.colTo()}}));this.conditionFormatBVH=Ln.build(i);var a=this.sheet.floatImageModel.getFloatImageMap(),s=Object.values(a).map((function(e){var t=e.floatImageSetting,n=t.row,r=t.col;return{row:n,col:r,rowTo:n,colTo:r}}));this.floatImagesBVH=Ln.build(s);var l=this.sheet.floatBlocksModel.getFloatBlocksMap(),u=Object.values(l).map((function(e){var t=e.blockSetting,n=t.row,r=t.col;return{row:n,col:r,rowTo:n,colTo:r}}));this.floatBlocksBVH=Ln.build(u);var c=this.sheet.embeddedBlocksModel.getBlocksMap(),d=Object.values(c).map((function(e){var t=e.position,n=t.row,r=t.col;return{row:n,col:r,rowTo:n,colTo:r}}));this.embeddedBlocksBVH=Ln.build(d);var f=[],v=this.sheet.rangeModel.toJSON();for(var p in v){var g=v[p];if(g&&(g.type===O.xj7.NORMAL||g.type===O.xj7.CELL)){var m=g.row,_=g.col,y=g.rowCount,C=g.colCount;f.push({row:m,col:_,rowTo:m+y-1,colTo:_+C-1})}}this.dataRangesBVH=Ln.build(f);var S=[];try{var k,E=Y(this.sheet.parent.calcEngine.reactivitySpace.dependenciesWatch.refIter());try{for(E.s();!(k=E.n()).done;){var T=(0,h.Z)(k.value,1)[0];T instanceof M.W7I&&T.sheet()===this.sheet&&!(0,M.Lii)(T)&&S.push({row:T.rowFrom(),rowTo:T.rowTo(),col:T.colFrom(),colTo:T.colTo()})}}catch(e){E.e(e)}finally{E.f()}}catch(e){var b;null!==(b=O.Ps3.collectSheetEvent)&&void 0!==b&&b.call(O.Ps3,"ccm_sheet_add_del_cell_exception",{reason:"build formulaRefsBVH"}),console.error("[ADD_DEL_CELL] get formula refs error")}this.formulaRefsBVH=Ln.build(S)}},{key:"hasData",value:function(e,t){var n,r=this.selectionService.hasValue(this.cellsInSpan,e,t,{isIncludeStyle:!0,isIncludeEmptySpan:!0}),o=this.sheet.getVar(e,t),i=o.isFormula(),a=null===(n=o.isProxyArrayFormula)||void 0===n?void 0:n.call(o),s=Boolean((r||i)&&!a||this.isInFilter(e,t)||this.formulaRefsBVH.hasCell(e,t)||this.dataRangesBVH.hasCell(e,t)||this.sheet.getDataValidationJSON(e,t,{needDeepClone:!0})||this.hasComments(e,t)||this.hasNote(e,t)||this.conditionFormatBVH.hasCell(e,t)||this.floatImagesBVH.hasCell(e,t)||this.floatBlocksBVH.hasCell(e,t)||this.embeddedBlocksBVH.hasCell(e,t)||this.hasSparkline(e,t));return{strict:s,visible:s||Boolean(a)}}},{key:"isInFilter",value:function(e,t){return!!this.filterRange&&this.filterRange.row<=e&&this.filterRange.rowTo>=e&&this.filterRange.col<=t&&this.filterRange.colTo>=t}},{key:"hasComments",value:function(e,t){var n=this.sheet.getComments(e,t);return n&&n.length>0}},{key:"hasSparkline",value:function(e,t){return this.sheet.getSparklineModel().getSparklineByCell(e,t)}},{key:"hasNote",value:function(e,t){return this.sheet._getCellNote(e,t)}},{key:"hasDeniedProtectionInPath",value:function(){var e=this.sourceRange.union(this.targetRange);return this.sheet.protectionModel.getProtectionsByRange(e,"denied").length>0}},{key:"getIntersectMergeCells",value:function(){var e=this.sourceRange.toJSON(),t=e.row,n=e.col,r=e.rowCount,o=e.colCount,i=this.sheet._getSpanModel().getIntersectSpansInfo(t,n,r,o).hasPartSpans;this.intersectMergeCells=i}},{key:"execAddDelCellCmd",value:function(){return this.commandManager.execute({cmd:O.rvF.ADD_OR_DELETE_CELL,sheetId:this.sheet.id(),sheetName:this.sheet.name(),type:this.type,direction:this.direction,selectionRange:this.selectionRange,sourceRange:this.sourceRange,targetRange:this.targetRange,intersectMergeCells:this.intersectMergeCells})}}]),e}();Vn=q([(0,b.b)(),$(0,(0,I.f)(M.Wje)),$(1,(0,I.f)(M.DsI))],Vn);var Zn=function(e){function t(){return(0,p.Z)(this,t),(0,d.Z)(this,(0,f.Z)(t).apply(this,arguments))}return(0,v.Z)(t,e),(0,g.Z)(t,[{key:"execute",value:function(){return this._command.isFirstExecution?this._doAction():this._redoAction()}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this._command._oldChangesets,!0)}},{key:"_doAction",value:function(){return this.saveChangeSets(),this._applyChangsetWithEvent(this._command._changesets,!0)}},{key:"_redoAction",value:function(){return!0===this.checkRangeValid(this._sheet.parent,this._command._changesets)&&this._applyChangsetWithEvent(this._command._changesets)}}]),t}(M.T_g),Bn=function(e){function t(){return(0,p.Z)(this,t),(0,d.Z)(this,(0,f.Z)(t).apply(this,arguments))}return(0,v.Z)(t,e),(0,g.Z)(t,[{key:"saveChangeSets",value:function(){var e=this.command.value,t=this._createSparklineGroupAction(e,!0);(0,O.hTd)(this._command._oldChangesets,t);var n=this._createSparklineGroupAction(e);(0,O.hTd)(this._command._changesets,n)}},{key:"_createSparklineGroupAction",value:function(e,t){var n=this._sheet.getSparklineModel(),r=[],o={},i={},a=[],s=!1,l={action:"addSparklineGroup",extra:{commandType:"addSparkline"},sheet_id:this._sheet.id(),value:{}};for(var u in e){for(var c=e[u].sparklines||{},h=Object.keys(c),d=0,f=h;d<f.length;d++){var v=f[d];if(null===c[v]){var p=n.getSparklineById(v);if(p){var g=p.getPosition(),m=p.getSource();t?(0,M.ah$)(i,u,v,{position:g,source:m}):((0,M.ah$)(o,u,v,null),delete c[v],c&&0===Object.keys(c).length&&delete e[u])}}else a.push(u)}t&&h.length===n.getSparklinesByGroupId(u).length&&(s=!0,l.value[u]={config:n.getSparklineRawConfig(u)||void 0,sparklines:i[u].sparklines},delete i[u])}if(t){if(s&&r.push(l),Object.keys(i).length){var _={action:"updateSparklineGroup",extra:{commandType:"updateSparkline"},sheet_id:this._sheet.id(),value:i};r.push(_)}var y={action:"delSparklineGroup",extra:{commandType:"delSparkline"},sheet_id:this._sheet.id(),value:a};r.push(y)}else{if(Object.keys(o).length){var C={action:"updateSparklineGroup",extra:{commandType:"addSparkline"},sheet_id:this._sheet.id(),value:o};r.push(C)}var S={action:"addSparklineGroup",extra:{commandType:"addSparkline"},sheet_id:this._sheet.id(),value:e};r.push(S)}return r}},{key:"commandName",get:function(){return O.rvF.ADD_SPARKLINE_GROUP}}]),t}(Zn),Hn=function(e){function t(){return(0,p.Z)(this,t),(0,d.Z)(this,(0,f.Z)(t).apply(this,arguments))}return(0,v.Z)(t,e),(0,g.Z)(t,[{key:"saveChangeSets",value:function(){var e=this.command.groupId,t=this._sheet.getSparklineModel(),n=(Array.isArray(e)?e:[e]).reduce((function(e,n){var r=t.getGroupConfigJSON(n);return e[n]=r,e}),{}),r=this._createSparklineGroupAction(e,n);this._command._oldChangesets.push(r);var o=this._createSparklineGroupAction(e);this._command._changesets.push(o)}},{key:"_createSparklineGroupAction",value:function(e,t){return t?{action:"addSparklineGroup",extra:{commandType:"addSparkline"},sheet_id:this._sheet.id(),value:t}:{action:"delSparklineGroup",extra:{commandType:"delSparkline"},sheet_id:this._sheet.id(),value:e}}},{key:"commandName",get:function(){return O.rvF.DEL_SPARKLINE_GROUP}}]),t}(Zn),Un=function(e){function t(){return(0,p.Z)(this,t),(0,d.Z)(this,(0,f.Z)(t).apply(this,arguments))}return(0,v.Z)(t,e),(0,g.Z)(t,[{key:"saveChangeSets",value:function(){var e=this.command,t=e.groupId,n=e.id,r=e.value,o=this._createSparklineGroupAction(t,n,!0);this._command._oldChangesets.push(o);var i=this._createSparklineGroupAction(t,n,!1,r);this._command._changesets.push(i)}},{key:"_createSparklineGroupAction",value:function(e,t,n,r){var o=this._sheet.getSparklineModel(),i=t.reduce((function(t,r){var i,a=(null===(i=o.getSparklineById(r))||void 0===i?void 0:i.getGroupId())||"",s=o.getSparklineRawConfig(a);if(n)(0,M.ah$)(t,a,r,{}),s&&(t[a].config=s);else{var l=o.getSparklineRawConfig(e);(0,M.ah$)(t,e,r,{}),l&&(t[a].config=l)}return t}),{});return r&&(i[e].config=r),{action:"updateSparklineGroup",sheet_id:this._sheet.id(),extra:{commandType:"updateSparkline"},value:i}}},{key:"commandName",get:function(){return O.rvF.GROUP_SPARKLINE}}]),t}(Zn),jn=function(e){function t(){return(0,p.Z)(this,t),(0,d.Z)(this,(0,f.Z)(t).apply(this,arguments))}return(0,v.Z)(t,e),(0,g.Z)(t,[{key:"saveChangeSets",value:function(){var e=this.command.id,t=this._createSparklineGroupAction(e,!0);this._command._oldChangesets.push(t);var n=this._createSparklineGroupAction(e);this._command._changesets.push(n)}},{key:"_createSparklineGroupAction",value:function(e,t){var n=this._sheet.getSparklineModel(),r=e.reduce((function(e,r){var o=n.getSparklineById(r),i=(null==o?void 0:o.getGroupId())||"";if(o){var a=n.getSparklineRawConfig(i),s={position:o.getPosition(),source:o.getSource()};t?((0,M.ah$)(e,i,r,s),e[i].config=a):e[(0,M.mhf)()]={config:a,sparklines:(0,c.Z)({},r,s)}}return e}),{});return t?{action:"updateSparklineGroup",sheet_id:this._sheet.id(),value:r}:{action:"addSparklineGroup",extra:{commandType:"updateSparkline"},sheet_id:this._sheet.id(),value:r}}},{key:"commandName",get:function(){return O.rvF.UNGROUP_SPARKLINE}}]),t}(Zn),Gn=function(e){function t(){return(0,p.Z)(this,t),(0,d.Z)(this,(0,f.Z)(t).apply(this,arguments))}return(0,v.Z)(t,e),(0,g.Z)(t,[{key:"saveChangeSets",value:function(){var e=this.command.value,t=this._createSparklineGroupAction(e,!0);this._command._oldChangesets.push(t);var n=this._createSparklineGroupAction(e);this._command._changesets.push(n)}},{key:"getCommandType",value:function(e){for(var t=!0,n=!1,r=!0,o=0,i=Object.values(e);o<i.length;o++){var a=i[o].sparklines;if(n||!t&&!r)break;if(a)for(var s=0,l=Object.values(a);s<l.length;s++){var u=l[s];if(n||!t&&!r)break;null===u&&t&&(t=!1),null!==u&&r&&(r=!1,u.position&&u.sourceRange&&u.source||(n=!0))}}return!t||n||r?!r||n||t?{doCommandType:"updateSparkline",undoCommandType:"updateSparkline"}:{doCommandType:"delSparkline",undoCommandType:"addSparkline"}:{doCommandType:"addSparkline",undoCommandType:"delSparkline"}}},{key:"_createSparklineGroupAction",value:function(e,t){var n=this._sheet.getSparklineModel(),r=this.getCommandType(e),o=r.undoCommandType,i=r.doCommandType;if(t){for(var a={},s=0,l=Object.entries(e||{});s<l.length;s++){var u,c=(0,h.Z)(l[s],2),d=c[0],f=c[1],v=(0,y.default)(n.getGroupConfigJSON(d)||{}),p=(0,M.pOj)(null==v||null===(u=v.config)||void 0===u?void 0:u.themeType);if(f){var g=f.config,_=void 0===g?{}:g,C=f.sparklines,S={};for(var k in _){var E,T=null===(E=v.config)||void 0===E?void 0:E[k],b=_[k];if(void 0===T)S[k]=null;else if("object"==(0,m.Z)(b)&&b)for(var I in b){var R=T[I];(0,M.zgZ)(S,k,I,void 0!==R?R:p[k][I])}else S[k]=T;(0,M.zgZ)(a,d,"config",S)}for(var w in C){var A,F=C[w],D=(null===(A=v.sparklines)||void 0===A?void 0:A[w])||{};if(null===F)(0,M.ah$)(a,d,w,D),v.config&&"{}"!==JSON.stringify(v.config)&&(a[d].config=v.config);else if(n.getSparklineById(w)){if("object"==(0,m.Z)(F)){var N={};for(var P in F)N[P]=D[P];(0,M.ah$)(a,d,w,N)}}else(0,M.ah$)(a,d,w,null)}}}return{action:"updateSparklineGroup",extra:{commandType:o},sheet_id:this._sheet.id(),value:a}}return{action:"updateSparklineGroup",extra:{commandType:i},sheet_id:this._sheet.id(),value:e||{}}}},{key:"commandName",get:function(){return O.rvF.UPDATE_SPARKLINE_GROUP}}]),t}(Zn),Kn=(o={},(0,c.Z)(o,O.rvF.ADD_SPARKLINE_GROUP,{canUndo:!0,execute:function(e,t,n,r){return(0,M.P0c)(e,Bn,t,n,r)}}),(0,c.Z)(o,O.rvF.DEL_SPARKLINE_GROUP,{canUndo:!0,execute:function(e,t,n,r){return(0,M.P0c)(e,Hn,t,n,r)}}),(0,c.Z)(o,O.rvF.GROUP_SPARKLINE,{canUndo:!0,execute:function(e,t,n,r){return(0,M.P0c)(e,Un,t,n,r)}}),(0,c.Z)(o,O.rvF.UNGROUP_SPARKLINE,{canUndo:!0,execute:function(e,t,n,r){return(0,M.P0c)(e,jn,t,n,r)}}),(0,c.Z)(o,O.rvF.UPDATE_SPARKLINE_GROUP,{canUndo:!0,execute:function(e,t,n,r){return(0,M.P0c)(e,Gn,t,n,r)}}),o);function Wn(e,t,n){return t.reduce((function(t,r){var o=r.position,i=r.source,a=(0,M.Z7n)();t[e].sparklines[a]={position:o,source:i};var s=o.row,l=o.col,u=n.getSparklineByPosition(s,l);if(u){var h=u.getGroupId(),d=u.getId();t[h]?t[h].sparklines[d]=null:t[h]={sparklines:(0,c.Z)({},d,null)}}return t}),(0,c.Z)({},e,{sparklines:{}}))}var zn=function(){function e(t,n){(0,p.Z)(this,e),this.spread=t,this.commandManager=n,function(e){var t=e.commandManager();for(var n in Kn)t.register(n,Kn[n])}(this.spread.getActiveSheet().parent)}return(0,g.Z)(e,[{key:"createSparklineGroup",value:function(e){var t=this.spread.getActiveSheet(),n=t.getSparklineModel(),r=Wn((0,M.mhf)(),e,n),o={cmd:O.rvF.ADD_SPARKLINE_GROUP,sheetId:t.id(),value:r};return this.commandManager.execute(o)}},{key:"resetSparklineGroup",value:function(e,t){var n=this.spread.getActiveSheet(),r=n.getSparklineModel(),o=(0,M.mhf)(),i=Wn(o,t,r);i[o].config=r.getSparklineRawConfig(e),r.getSparklinesByGroupId(e).reduce((function(t,n){var r=n.getId();return t[e]?t[e].sparklines[r]=null:t[e]={sparklines:(0,c.Z)({},r,null)},t}),i);var a={cmd:O.rvF.UPDATE_SPARKLINE_GROUP,sheetId:n.id(),value:i};return this.commandManager.execute(a)}},{key:"delSparkline",value:function(e){var t=this.spread.getActiveSheet(),n=t.getSparklineModel(),r=e.reduce((function(e,t){var r,o=(null===(r=n.getSparklineById(t))||void 0===r?void 0:r.getGroupId())||"";return e[o]?e[o].sparklines?e[o].sparklines[t]=null:e[o].sparklines=(0,c.Z)({},t,null):e[o]={sparklines:(0,c.Z)({},t,null)},e}),{}),o={cmd:O.rvF.UPDATE_SPARKLINE_GROUP,sheetId:t.id(),value:r};return this.commandManager.execute(o)}},{key:"delSparklineGroup",value:function(e){var t=this.spread.getActiveSheet(),n={cmd:O.rvF.DEL_SPARKLINE_GROUP,sheetId:t.id(),groupId:e};return this.commandManager.execute(n)}},{key:"groupSparkline",value:function(e,t,n){var r=this.spread.getActiveSheet(),o={cmd:O.rvF.GROUP_SPARKLINE,sheetId:r.id(),id:e,groupId:t,value:n};return this.commandManager.execute(o)}},{key:"ungroupSparkline",value:function(e){var t=this.spread.getActiveSheet(),n={cmd:O.rvF.UNGROUP_SPARKLINE,sheetId:t.id(),id:e};return this.commandManager.execute(n)}},{key:"updateSparklineConfig",value:function(e){var t=Object.keys(e);if(t.length){var n=this.spread.getActiveSheet(),r={cmd:O.rvF.UPDATE_SPARKLINE_GROUP,sheetId:n.id(),groupId:t,value:e};this.commandManager.execute(r)}}},{key:"updateSparkline",value:function(e){var t=this.spread.getActiveSheet(),n=null==t?void 0:t.getSparklineModel(),r=Object.keys(e);if(r.length&&n&&t){var o=r.reduce((function(t,r){var o,i,a=e[r],s=null===(o=n.getSparklineById(r))||void 0===o?void 0:o.getGroupId();s&&a&&(null!==(i=t[s])&&void 0!==i&&i.sparklines?t[s].sparklines[r]=a:t[s]={sparklines:(0,c.Z)({},r,a)});var l=a.position,u=l&&n.getSparklineByPosition(l.row,l.col);if(u&&u.getId()!==r){var h,d=u.getGroupId();null!==(h=t[d])&&void 0!==h&&h.sparklines?t[d].sparklines[u.getId()]=null:t[d]={sparklines:(0,c.Z)({},u.getId(),null)}}return t}),{}),i={cmd:O.rvF.UPDATE_SPARKLINE_GROUP,sheetId:t.id(),id:r,value:o};return this.commandManager.execute(i)}}}]),e}();function Yn(e,t){for(var n=e.getSpans(t),r=[],o=0;o<n.length;o++){var i=n[o];t.contain(i)&&r.push(new M.e6w(i.rowFrom()-t.rowFrom(),i.colFrom()-t.colFrom(),i.rowCount(),i.colCount(),e))}return r}function Jn(e,t){for(var n=[],r=0;r<t.rowCount();r++){for(var o=[],i=0;i<t.colCount();i++){var a=t.rowFrom()+r,s=t.colFrom()+i,l=e.getStyleWithConditionalFormat(a,s);o.push(l?l.clone():null)}n.push(o)}return n}function qn(e,t){if(0!==t.rowFrom()||t.rowCount()!==e.getRowCount())return[];for(var n=[],r=0;r<t.colCount();r++)n.push(e.getColumnWidth(t.colFrom()+r));return n}function $n(e,t){if(0!==t.colFrom()||t.colCount()!==e.getColumnCount())return[];for(var n=[],r=0;r<t.rowCount();r++)n.push(e.getRowHeight(t.rowFrom()+r));return n}function Xn(e,t,n){var r=n;return!function(e){return 1===e.size()}(t)&&!function(e,t,n,r){return Qn(e,n)&&Qn(t,r)}(t,r,e.getSpans(t),e.getSpans(r))}function Qn(e,t){return 1===t.length&&e.equal(t[0])}zn=q([(0,b.b)(),$(0,(0,I.f)(M.Wje)),$(1,(0,I.f)(M.DsI))],zn);var er,tr,nr=function(){function e(t,n){(0,p.Z)(this,e),this.token=t,this.requestProvider=n}var t,n,r,o,i,a,u,c,h;return(0,g.Z)(e,[{key:"createDataConnectorTask",value:(h=(0,l.Z)(s().mark((function e(t,n,r,o){var i,a,l,u,c,h;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.requestProvider.apiUrls.DATA_CONNECTOR,a=this.requestProvider.postRequest(i,{spreadsheet_token:this.token,sheet_id:n,source:t,fields:r,client_token:(0,W.v4)().replace(/-/g,""),extra:JSON.stringify({template_id:o.templateId,template_version:o.templateVersion})},{headers:{"Content-Type":"application/json"}}),e.prev=1,e.next=4,a.promise;case 4:l=e.sent,e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(1),console.error("DataConnectorProvider create task error",e.t0),e.t0;case 10:if(l&&0===l.code){e.next=12;break}throw l;case 12:return u=(0,S.default)(l,"meta.originResponse.headers",{}),c=(0,S.default)(u,"x-sheet-connector-token",""),h=(0,S.default)(u,"x-sheet-connector-signature",""),e.abrupt("return",{data:l.data,authToken:c,encryptedConnectionToken:h});case 14:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(e,t,n,r){return h.apply(this,arguments)})},{key:"createDataConnectorTaskV2",value:(c=(0,l.Z)(s().mark((function e(t,n,r,o,i){var a,l,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="".concat(this.requestProvider.apiUrls.DATA_CONNECTOR,"/v2/"),l=this.requestProvider.postRequest(a,{spreadsheet_token:this.token,sheet_id:r,source:t,schedule:n,locale:i.locale,timezone:i.timezone,client_token:(0,W.v4)().replace(/-/g,""),extra:JSON.stringify({template_id:o.templateId,template_version:o.templateVersion})},{headers:{"Content-Type":"application/json"}}),e.prev=1,e.next=4,l.promise;case 4:u=e.sent,e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(1),console.error("DataConnectorProvider create task error",e.t0),e.t0;case 10:if(u&&0===u.code){e.next=12;break}throw u;case 12:return e.abrupt("return",{data:u.data});case 13:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(e,t,n,r,o){return c.apply(this,arguments)})},{key:"fetchDataConnectorTaskInfo",value:(u=(0,l.Z)(s().mark((function e(t,n){var r,o,i,a,l,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="".concat(this.requestProvider.apiUrls.DATA_CONNECTOR,"/").concat(t),o=this.requestProvider.getRequest(r,{baseURL:this.requestProvider.prependAPI("/"),params:{spreadsheet_token:this.token,sheet_id:n}}),e.prev=1,e.next=4,o.promise;case 4:i=e.sent,e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(1),console.error("DataConnectorProvider fetch task error",e.t0),e.t0;case 10:if(i&&0===i.code){e.next=12;break}throw i;case 12:return a=(0,S.default)(i,"meta.originResponse.headers",{}),l=(0,S.default)(a,"x-sheet-connector-token",""),u=(0,S.default)(a,"x-sheet-connector-signature",""),e.abrupt("return",{data:i.data,authToken:l,encryptedConnectionToken:u});case 14:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(e,t){return u.apply(this,arguments)})},{key:"fetchDataConnectorTaskInfoV2",value:(a=(0,l.Z)(s().mark((function e(t,n){var r,o,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="".concat(this.requestProvider.apiUrls.DATA_CONNECTOR,"/v2/").concat(t),o=this.requestProvider.getRequest(r,{baseURL:this.requestProvider.prependAPI("/"),params:{spreadsheet_token:this.token,sheet_id:n}}),e.prev=1,e.next=4,o.promise;case 4:i=e.sent,e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(1),console.error("DataConnectorProvider fetch task v2 error",e.t0),e.t0;case 10:if(i&&0===i.code){e.next=12;break}throw i;case 12:return e.abrupt("return",{data:i.data});case 13:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(e,t){return a.apply(this,arguments)})},{key:"fetchAllDataConnectorTasksInfo",value:(i=(0,l.Z)(s().mark((function e(t,n){var r,o,i,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.requestProvider.apiUrls.DATA_CONNECTOR,o=this.requestProvider.getRequest(r,{baseURL:this.requestProvider.prependAPI("/"),params:{spreadsheet_token:this.token,sheet_id:t,page_size:n||50,page_token:this.tokenRevEnd}}),e.prev=1,e.next=4,o.promise;case 4:i=e.sent,e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(1),console.error("DataConnectorProvider fetch all task error",e.t0),e.t0;case 10:if(i&&0===i.code){e.next=12;break}throw i;case 12:return a=i.data,e.abrupt("return",(this.tokenRevEnd=a.page_token,a));case 14:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(e,t){return i.apply(this,arguments)})},{key:"deleteDataConnectorTask",value:(o=(0,l.Z)(s().mark((function e(t,n){var r,o,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="".concat(this.requestProvider.apiUrls.DATA_CONNECTOR,"/").concat(t),o=this.requestProvider.deleteRequest(r,{baseURL:this.requestProvider.prependAPI("/"),params:{spreadsheet_token:this.token,sheet_id:n}}),e.prev=1,e.next=4,o.promise;case 4:i=e.sent,e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(1),console.error("DataConnectorProvider delete task error",e.t0),e.t0;case 10:if(i&&0===i.code){e.next=12;break}throw i;case 12:return e.abrupt("return",i.code);case 13:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(e,t){return o.apply(this,arguments)})},{key:"getCreateConnectorEnable",value:(r=(0,l.Z)(s().mark((function e(){var t,n,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="".concat(this.requestProvider.apiUrls.DATA_CONNECTOR_USAGE),n=this.requestProvider.getRequest(t,{baseURL:this.requestProvider.prependAPI("/"),params:{spreadsheet_token:this.token}}),e.prev=1,e.next=4,n.promise;case 4:r=e.sent,e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(1),console.error("DataConnectorProvider getCreateConnectorEnable error",e.t0),e.t0;case 10:if(r&&0===r.code){e.next=12;break}throw r;case 12:return e.abrupt("return",!r.data.total_is_exceeded);case 13:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(){return r.apply(this,arguments)})},{key:"getDataConnectorSourceObjects",value:(n=(0,l.Z)(s().mark((function e(t,n,r,o,i){var a,l,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="".concat(this.requestProvider.apiUrls.DATA_CONNECTOR_SOURCE,"/").concat(t,"/objects?spreadsheet_token=").concat(this.token),l=this.requestProvider.postRequest(a,{credential:{id:n},object_name:r,paths:o,search_key:i},{headers:{"Content-Type":"application/json"}}),e.prev=1,e.next=4,l.promise;case 4:u=e.sent,e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(1),console.error("DataConnectorProvider get data connector source objects error",e.t0),e.t0;case 10:if(u&&0===u.code){e.next=12;break}throw u;case 12:return e.abrupt("return",u.data.objects);case 13:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(e,t,r,o,i){return n.apply(this,arguments)})},{key:"getDataConnectorSourceFields",value:(t=(0,l.Z)(s().mark((function e(t,n,r){var o,i,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o="".concat(this.requestProvider.apiUrls.DATA_CONNECTOR_SOURCE,"/").concat(t,"/fields?spreadsheet_token=").concat(this.token),i=this.requestProvider.postRequest(o,{credential:{id:n},filter:{payload:r,should_interpret:!1}},{headers:{"Content-Type":"application/json"}}),e.prev=1,e.next=4,i.promise;case 4:a=e.sent,e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(1),console.error("DataConnectorProvider get data connector source fields error",e.t0),e.t0;case 10:if(a&&0===a.code){e.next=12;break}throw a;case 12:return e.abrupt("return",a.data.fields.schema_payload);case 13:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(e,n,r){return t.apply(this,arguments)})}]),e}();!function(e){e[e.NORMAL=1]="NORMAL",e[e.ABNORMAL=2]="ABNORMAL",e[e.DELETED=3]="DELETED"}(er||(er={})),function(e){e[e.DAILY=3]="DAILY",e[e.WEEKLY=2]="WEEKLY",e[e.MONTHLY=1]="MONTHLY"}(tr||(tr={}));var rr=function(e){return e.replace(/_([a-z])/g,(function(e,t){return t.toUpperCase()}))},or=function(e){return e.replace(/([A-Z])/g,"_$1").toLowerCase()};function ir(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t?rr:or;return Array.isArray(e)?e.map((function(e){return ir(e,t)})):null!=e&&"object"==(0,m.Z)(e)?Object.keys(e).reduce((function(r,o){return r[n(o)]=ir(e[o],t),r}),{}):e}var ar,sr,lr=function(){function e(t){(0,p.Z)(this,e),this.spread=t,this.dataConnectorTaskMap=new Map,this.dataConnectorFieldMap=new Map,this.dataObjectIdNameMap=new Map,this.isCreateEnable=!1}var t,n,r,o,i,a,u,c,h;return(0,g.Z)(e,[{key:"init",value:function(e){var t=this.spread.getService(Z.UU).token;this.dataConnectorProvider=new nr(t,e)}},{key:"setCreateEnable",value:function(e){this.isCreateEnable=e}},{key:"getCreateEnable",value:function(){return this.isCreateEnable}},{key:"transformDataConnectorTaskResData",value:function(e){return{connectorId:e.connector_id,sheetId:e.sheet_id,status:e.status,lastSyncTime:"0"!==e.last_sync_time?e.last_sync_time:e.create_time,version:e.version,fields:e.fields,createTime:e.create_time,createUserId:e.create_uid,updateTime:e.update_time,updateUserId:e.update_uid,sourceInfo:{appId:e.source.app_id,credential:e.source.credential}}}},{key:"transformDataConnectorTaskV2ResData",value:function(e){var t,n,r=e.source,o=e.schedule,i=r.object,a=r.app_id,s=r.credential,l=i.config,u=i.fields,c=i.object_cache,h=JSON.parse(l),d=JSON.parse(c);return{connectorId:e.connector_id,sheetId:e.sheet_id,status:e.status,lastSyncTime:"0"!==e.last_sync_time?e.last_sync_time:e.create_time,version:e.version,fields:u,createTime:e.create_time,createUserId:e.create_uid,updateTime:e.update_time,updateUserId:e.update_uid,sourceInfo:{appId:a,credential:s},sourceConfig:{selectedFields:u.selected,treeDataCache:d,fields:this.transformFields(u.schema_payload||"")},form:{dataObject:h.dataObject,dataTopic:null===(t=h.queryProperties)||void 0===t?void 0:t.dataTopic,advertiserIds:null===(n=h.queryProperties)||void 0===n?void 0:n.advertiserIds,appToken:h.appToken,tableId:h.tableId,syncDaysOfMonth:o.config.days_of_month,syncDaysOfWeek:o.config.days_of_week,syncFrequency:o.config.type,syncStartDate:o.start_time,syncTime:o.config.trigger_time}}}},{key:"setDataObjectIdNameMap",value:function(e){var t=this;e.map((function(e){var n=e.objectDisplayName,r=e.objectPayload;t.dataObjectIdNameMap.set(r,n)}))}},{key:"getDataObjectNameById",value:function(e){return this.dataObjectIdNameMap.get(JSON.stringify(e))}},{key:"getDataObjectNameByPayloadString",value:function(e){var t=this;return function(e){var t=JSON.parse(e),n=[];return function e(t){for(var r in t)if(t.hasOwnProperty(r)){var o=t[r];Array.isArray(o)?(0,O.hTd)(n,o):"object"==(0,m.Z)(o)&&null!==o?e(o):n.push(o)}}(t),n}(e).map((function(e){return t.dataObjectIdNameMap.get(JSON.stringify(e))?{value:e,label:t.dataObjectIdNameMap.get(JSON.stringify(e))}:null})).filter((function(e){return!!e}))}},{key:"transformFields",value:function(e){try{var t=JSON.parse(e);return t&&Array.isArray(t)?t.map((function(e){return e.extraSchema&&e.extraSchema.field_type?e:Object.assign({},e,{extraSchema:{field_type:"default",exclusion_fields:[]}})})):[]}catch(e){console.error("DataConnectorController parse data objects fields failed",e)}return[]}},{key:"fetchAllDataConnectorTask",value:(h=(0,l.Z)(s().mark((function e(t,n){var r,o,i,a,l,u,c,h;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.dataConnectorProvider.fetchAllDataConnectorTasksInfo(t,n);case 3:if(r=e.sent,this.dataConnectorTaskMap.clear(),o=r.connectors){i=Y(o);try{for(i.s();!(a=i.n()).done;)l=a.value,u=l.sheet_id,(c=this.dataConnectorTaskMap.get(u))||(c=new Map),h=this.transformDataConnectorTaskResData(l),c.set(l.connector_id,h),this.dataConnectorTaskMap.set(u,c)}catch(e){i.e(e)}finally{i.f()}}e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(0),console.error("DataConnectorController fetch all tasks error",e.t0),e.t0;case 12:case"end":return e.stop()}}),e,this,[[0,9]])}))),function(e,t){return h.apply(this,arguments)})},{key:"fetchDataConnectorTaskInfo",value:(c=(0,l.Z)(s().mark((function e(t,n){var r,o,i,a,l;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.dataConnectorProvider.fetchDataConnectorTaskInfo(t,n);case 3:return r=e.sent,o=r.data,i=r.authToken,a=r.encryptedConnectionToken,l=o.connector,e.abrupt("return",{connectorInfo:this.transformDataConnectorTaskResData(l),authToken:i,encryptedConnectionToken:a});case 11:throw e.prev=11,e.t0=e.catch(0),console.error("DataConnectorController fetch task error",e.t0),e.t0;case 14:case"end":return e.stop()}}),e,this,[[0,11]])}))),function(e,t){return c.apply(this,arguments)})},{key:"createDataConnectorTask",value:(u=(0,l.Z)(s().mark((function e(t,n,r,o){var i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.dataConnectorProvider.createDataConnectorTask({app_id:t.appId},n,r,o);case 3:return i=e.sent,e.abrupt("return",(this.getCreateConnectorEnable(),i));case 7:throw e.prev=7,e.t0=e.catch(0),console.error("DataConnectorController create task error",e.t0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(e,t,n,r){return u.apply(this,arguments)})},{key:"deleteConnectorTask",value:(a=(0,l.Z)(s().mark((function e(t,n){var r,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.dataConnectorProvider.deleteDataConnectorTask(t,n);case 3:return o=e.sent,e.abrupt("return",(o||null!==(r=this.dataConnectorTaskMap.get(n))&&void 0!==r&&r.delete(t),this.getCreateConnectorEnable(),o));case 7:throw e.prev=7,e.t0=e.catch(0),console.error("DataConnectorController delete task error",e.t0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(e,t){return a.apply(this,arguments)})},{key:"getSheetIsExitDataConnector",value:function(e){return!!this.dataConnectorTaskMap.get(e)}},{key:"getSheetDataConnectorTaskInfo",value:function(e){return this.dataConnectorTaskMap.get(e)}},{key:"getAllSheetIdsHasDataConnector",value:function(){return Array.from(this.dataConnectorTaskMap.keys())}},{key:"deleteSheetDataConnectorTaskInfo",value:function(e){this.dataConnectorTaskMap.get(e)&&this.dataConnectorTaskMap.delete(e)}},{key:"getSheetDataConnectorFieldsCount",value:function(e){var t=this.dataConnectorTaskMap.get(e);if(!t)return 0;var n=Array.from(t.keys())[0],r=t.get(n);return r?r.fields.count:0}},{key:"getDataConnectorTaskInfoList",value:function(){var e,t=[],n=Y(this.spread.getSheetIds());try{for(n.s();!(e=n.n()).done;){var r=e.value,o=this.dataConnectorTaskMap.get(r);o&&o.forEach((function(e){t.push(e)}))}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"getCreateConnectorEnable",value:(i=(0,l.Z)(s().mark((function e(){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.dataConnectorProvider.getCreateConnectorEnable();case 3:return t=e.sent,e.abrupt("return",(this.setCreateEnable(t),t));case 7:throw e.prev=7,e.t0=e.catch(0),console.error("DataConnectorController getCreateConnectorEnable error",e.t0),this.setCreateEnable(!0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(){return i.apply(this,arguments)})},{key:"getDataConnectorSourceObjects",value:(o=(0,l.Z)(s().mark((function e(t,n,r,o,i){var a,l;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.dataConnectorProvider.getDataConnectorSourceObjects(t,n,r,ir(o,!1),i);case 3:if(a=e.sent){e.next=6;break}return e.abrupt("return",[]);case 6:return l=ir(a,!0),e.abrupt("return",(this.setDataObjectIdNameMap(l),l));case 10:throw e.prev=10,e.t0=e.catch(0),console.error("DataConnectorController getDataConnectorSourceObjects error",e.t0),e.t0;case 13:case"end":return e.stop()}}),e,this,[[0,10]])}))),function(e,t,n,r,i){return o.apply(this,arguments)})},{key:"getDataConnectorSourceFields",value:(r=(0,l.Z)(s().mark((function e(t,n,r){var o,i,a,l,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=r,e.prev=1,!(i=this.dataConnectorFieldMap.get(o))){e.next=5;break}return e.abrupt("return",this.transformFields(i));case 5:return e.next=7,this.dataConnectorProvider.getDataConnectorSourceFields(t,n,r);case 7:return a=e.sent,l=JSON.parse(a),u=JSON.stringify(l.fieldSchemas),e.abrupt("return",(this.dataConnectorFieldMap.set(o,u),this.transformFields(u)));case 13:throw e.prev=13,e.t0=e.catch(1),console.error("DataConnectorController getDataConnectorSourceObjects error",e.t0),e.t0;case 16:case"end":return e.stop()}}),e,this,[[1,13]])}))),function(e,t,n){return r.apply(this,arguments)})},{key:"createDataConnectorTaskV2",value:(n=(0,l.Z)(s().mark((function e(t,n,r,o,i,a){var l,u,c,h,d,f,v,p,g,m;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=t.appId,u=t.dataObject,c=t.fieldsCount,h=t.selectedFields,d=t.credentialId,f=this.getDataObjectNameByPayloadString(a),v=a,p=a.slice(1,-1),this.dataConnectorFieldMap.forEach((function(e,t){var n=t.slice(1,-1);p.includes(n)&&(v=t)})),g={app_id:l,object:{object_name:u,fields:{count:c,selected:h,schema_payload:this.dataConnectorFieldMap.get(v)||""},config:a,object_cache:JSON.stringify(f)},credential:{id:d}},e.prev=5,e.next=8,this.dataConnectorProvider.createDataConnectorTaskV2(g,ir(n,!1),r,o,i);case 8:return m=e.sent,e.abrupt("return",(this.getCreateConnectorEnable(),m));case 12:throw e.prev=12,e.t0=e.catch(5),console.error("DataConnectorController create task v2 error",e.t0),e.t0;case 15:case"end":return e.stop()}}),e,this,[[5,12]])}))),function(e,t,r,o,i,a){return n.apply(this,arguments)})},{key:"fetchDataConnectorTaskInfoV2",value:(t=(0,l.Z)(s().mark((function e(t,n){var r,o,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.dataConnectorProvider.fetchDataConnectorTaskInfoV2(t,n);case 3:return r=e.sent,o=r.data,i=o.connector,e.abrupt("return",this.transformDataConnectorTaskV2ResData(i));case 9:throw e.prev=9,e.t0=e.catch(0),console.error("DataConnectorController fetch task info v2 error",e.t0),e.t0;case 12:case"end":return e.stop()}}),e,this,[[0,9]])}))),function(e,n){return t.apply(this,arguments)})},{key:"destroy",value:function(){this.dataConnectorTaskMap.clear(),this.dataConnectorFieldMap.clear(),this.dataObjectIdNameMap.clear()}}]),e}();q([(0,T.P)()],lr.prototype,"destroy",null),lr=q([(0,b.b)(),$(0,(0,I.f)(M.Wje))],lr),function(e){e.Qianchuan="dsrc_a471f3cccdf89347",e.OceanAdvertisement="dsrc_bc83932d7e550a54",e.Base="dsrc_a626f05addf8d010"}(ar||(ar={})),function(e){e.OceanAdvertisement="ccm_sheet_connector_juliang_ad_setting",e.Base="ccm_sheet_connector_base_setting"}(sr||(sr={}));var ur={dsrc_a471f3cccdf89347:{iconKey:"sheet.connector_qianchuan",templateId:"qianchuan-source_lark-sheet-internal",templateVersion:"1.0",name:z("LarkCCM_Sheets_DataConnect_Juliang_Menu"),appId:"dsrc_a471f3cccdf89347",reportName:"qianchuan",fg:"ccm.sheet.data_connector_oceanengine_shoppingads_enabled"},dsrc_bc83932d7e550a54:{iconKey:"sheet.connector_ads",templateId:"oceanengine-ads-source_lark-sheet-internal",templateVersion:"1.0",name:z("LarkCCM_Sheets_DataConnect_JuliangAds_Menu"),appId:"dsrc_bc83932d7e550a54",reportName:"guanggao",templateKey:"ccm_sheet_connector_juliang_ad_setting",fg:"ccm.sheet.data_connector_oceanengine_ads_enabled"},dsrc_a626f05addf8d010:{iconKey:"sheet.connector_gradient_base",templateId:"lark-base-internal-source_lark-sheet-internal",templateVersion:"1.0",name:z("CreationDoc_Sheets_ConvertToBitable_Bitable"),appId:"dsrc_a626f05addf8d010",reportName:"base",templateKey:"ccm_sheet_connector_base_setting",fg:"ccm.sheet.data_connector_base_enabled"}},cr=["dsrc_a471f3cccdf89347","dsrc_bc83932d7e550a54","dsrc_a626f05addf8d010"],hr="workbook/protect-permission-controller",dr=function(){function e(t){(0,p.Z)(this,e),this.spread=t}var t,n,r;return(0,g.Z)(e,[{key:"requestProtectionId",value:(r=(0,l.Z)(s().mark((function e(t){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.Ps3.serverApi.protectionRange.createZone(this.spread._context.token,t||[]);case 2:return n=e.sent,e.abrupt("return",((0,M.JPx)(n,4,!1,!0),n));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"setProtectionPermission",value:(n=(0,l.Z)(s().mark((function e(t,n){var r,o,i,a,l;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.spread._context.token,o=n.addUsers,i=void 0===o?[]:o,a=n.delUsers,l=void 0===a?[]:a,e.t0=i.length>0,!e.t0){e.next=5;break}return e.next=5,O.Ps3.serverApi.protectionRange.addUserToPerm(r,t,i);case 5:if(e.t1=l.length>0,!e.t1){e.next=9;break}return e.next=9,O.Ps3.serverApi.protectionRange.removeUserFromPerm(r,t,l);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"replaceProtectionPermission",value:(t=(0,l.Z)(s().mark((function e(t,n,r,o){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.Ps3.serverApi.protectionRangeV2.replacePermUser(this.spread._context.token,t,n,r,o);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,n,r,o){return t.apply(this,arguments)})}]),e}();dr=q([(0,b.b)(),$(0,(0,I.f)(M.Wje))],dr);var fr=function(e){var t=e.toJSON();switch(e.rgType){case O.xj7.CELL:case O.xj7.NORMAL:return{row:t.row,row_count:t.rowCount,col:t.col,col_count:t.colCount,type:O.xj7.NORMAL};case O.xj7.ROW:return{row:t.row,row_count:t.rowCount,type:O.xj7.ROW};case O.xj7.COL:return{col:t.col,col_count:t.colCount,type:O.xj7.COL};default:throw Error("Unsupported range type: ".concat(e.rgType))}};function vr(e){return e.ranges.map((function(e){switch(e.type){case O.xj7.NORMAL:return{row:e.row,row_count:e.rowCount,col:e.col,col_count:e.colCount,type:O.xj7.NORMAL};case O.xj7.ROW:return{row:e.row,row_count:e.rowCount,type:O.xj7.ROW};case O.xj7.COL:return{col:e.col,col_count:e.colCount,type:O.xj7.COL};default:throw Error("Unsupported range:".concat(JSON.stringify(e)," in model"))}}))}var pr=function(e){function t(e,n){return(0,p.Z)(this,t),(0,d.Z)(this,(0,f.Z)(t).call(this,e,n))}return(0,v.Z)(t,e),(0,g.Z)(t,[{key:"execute",value:function(){return this.command.isFirstExecution?this.doAction():this.redoAction()}},{key:"doAction",value:function(){var e=this.command,t=e.id,n=e.detail,r=e.prevInfo,o=n.ranges.map(fr);if(this.command._changesets.push({action:"setRangeProtection",sheet_id:this._sheetId,value:{ranges:o,description:n.description,creator_id:n.creatorId,id:t}}),r){var i=r.sheet,a=r.protection,s=vr(a);this.command._oldChangesets.push({action:"setRangeProtection",sheet_id:i.id(),value:{ranges:s,description:a.description,creator_id:a.creatorId,id:t}})}else this.command._oldChangesets.push({action:"delRangeProtection",sheet_id:this._sheetId,value:{id:t}});return this.applyActions(this.command._changesets)}},{key:"redoAction",value:function(){return this.applyActions(this.command._changesets,"redo")}},{key:"undo",value:function(){return this.undoAction()}},{key:"undoAction",value:function(){return this.applyActions(this.command._oldChangesets,"undo")}},{key:"applyActions",value:function(e,t){return 0!==this.command._changesets.length&&this.tryApplyActions(this._sheet.parent,e,!0,void 0,t)}},{key:"commandName",get:function(){return O.rvF.SET_RANGE_PROTECTION}}]),t}(M.T_g),gr=function(e){function t(e,n){return(0,p.Z)(this,t),(0,d.Z)(this,(0,f.Z)(t).call(this,e,n))}return(0,v.Z)(t,e),(0,g.Z)(t,[{key:"execute",value:function(){return this.command.isFirstExecution?this.doAction():this.redoAction()}},{key:"doAction",value:function(){var e=this.command,t=e.id,n=e.detail,r=vr(n),o=JSON.parse(JSON.stringify(r));return this.command._changesets.push({action:"delRangeProtection",sheet_id:this._sheetId,value:{id:t}}),this.command._oldChangesets.push({action:"setRangeProtection",sheet_id:this._sheetId,value:{ranges:o,description:n.description,creator_id:n.creatorId,id:t}}),this.applyActions(this.command._changesets)}},{key:"redoAction",value:function(){return this.applyActions(this.command._changesets,"redo")}},{key:"undo",value:function(){return this.undoAction()}},{key:"undoAction",value:function(){return this.applyActions(this.command._oldChangesets,"undo")}},{key:"applyActions",value:function(e,t){return 0!==this.command._changesets.length&&this.tryApplyActions(this._sheet.parent,e,!0,void 0,t)}},{key:"commandName",get:function(){return O.rvF.DEL_RANGE_PROTECTION}}]),t}(M.T_g),mr="workbook/protection-controller",_r=function(){function e(t,n,r){(0,p.Z)(this,e),this.spread=t,this.commandManager=n,this.protectPermissionController=r,n.register(O.rvF.SET_RANGE_PROTECTION,{canUndo:!0,execute:function(e,t,n,r){return(0,M.P0c)(e,pr,t,n,r)}}),n.register(O.rvF.DEL_RANGE_PROTECTION,{canUndo:!0,execute:function(e,t,n,r){return(0,M.P0c)(e,gr,t,n,r)}})}var t,n;return(0,g.Z)(e,[{key:"addProtectionV2",value:(n=(0,l.Z)(s().mark((function e(t){var n,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.ranges,r=t.id,e.abrupt("return",r&&this.isRangesValid(n)?(this.execSetProtectionCmd(r,t,void 0),r):null);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"addProtection",value:(t=(0,l.Z)(s().mark((function e(t){var n,r,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.ranges,r=t.id,this.isRangesValid(n)){e.next=3;break}return e.abrupt("return",null);case 3:if(e.prev=3,e.t0=r,e.t0){e.next=9;break}return e.next=8,this.protectPermissionController.requestProtectionId();case 8:e.t0=e.sent;case 9:o=e.t0,e.next=15;break;case 12:return e.prev=12,e.t1=e.catch(3),e.abrupt("return",null);case 15:return e.abrupt("return",(this.execSetProtectionCmd(o,t,void 0),o));case 16:case"end":return e.stop()}}),e,this,[[3,12]])}))),function(e){return t.apply(this,arguments)})},{key:"isRangesValid",value:function(e){return!(e.length<1||e.some(M.PuS))}},{key:"execSetProtectionCmd",value:function(e,t,n){var r=t.ranges[0].sheet();if(!r)return!1;var o={cmd:O.rvF.SET_RANGE_PROTECTION,sheetId:r.id(),sheetName:r.name(),id:e,prevInfo:n,detail:t};return this.commandManager.execute(o)}},{key:"getProtectionInfoById",value:function(e){for(var t,n,r=this.spread.sheets,o=0,i=r.length;o<i;o++){var a=r[o],s=a.protectionModel.getProtectionById(e);if(s){t=a,n=s;break}}return t&&n?{sheet:t,protection:n}:void 0}},{key:"updateProtection",value:function(e,t){var n=this.getProtectionInfoById(e);if(!n)return!1;var r=t.ranges;return!!this.isRangesValid(r)&&this.execSetProtectionCmd(e,t,n)}},{key:"delProtection",value:function(e){var t=this.getProtectionInfoById(e);return!!t&&this.execDelProtectionCmd(e,t)}},{key:"execDelProtectionCmd",value:function(e,t){var n=t.sheet,r=t.protection,o={cmd:O.rvF.DEL_RANGE_PROTECTION,sheetId:n.id(),sheetName:n.name(),id:e,detail:r};return this.commandManager.execute(o)}}]),e}();function yr(e){for(var t,n=null===(t=Array.from(new Set(e.split(/\s+/))))||void 0===t?void 0:t.filter((function(e){return""!==e})),r=(0,i.Z)(n),o=0;o<n.length;o++){var a=n[o];if(r[o])for(var s=0;s<n.length;s++){var l=n[s];a===l||-1===a.indexOf(l)&&-1===l.indexOf(a)||(r[a.length>l.length?o:s]="")}}return r=r.filter((function(e){return""!==e})),[n,r]}_r=q([(0,b.b)(),$(0,(0,I.f)(M.Wje)),$(1,(0,I.f)(M.DsI)),$(2,(0,I.f)(hr))],_r)},vsh_55478:function(e,t,n){n.d(t,{G7:function(){return Be},_q:function(){return o},ju:function(){return p},pq:function(){return $},A6:function(){return h},bY:function(){return ye},Zv:function(){return s},Zw:function(){return Ze},b$:function(){return xe},Tj:function(){return r},bI:function(){return H},L9:function(){return Te},o_:function(){return Ae},Mp:function(){return ke},J0:function(){return Ee},Ls:function(){return Me},sy:function(){return Oe},MP:function(){return De},ak:function(){return Ie},Hi:function(){return te},NK:function(){return Re},iT:function(){return z}});var r,o,i,a,s,l,u,c,h,d,f,v,p,g=n("vsh_26278"),m=n("vsh_12064"),_=n("vsh_56589"),y=n("vsh_22462"),C=n("vsh_73455"),S=n("vsh_1139"),k=n("vsh_98652"),E=n("vsh_19264"),T=n("vsh_4175"),b=n("vsh_65498"),I=n("vsh_22023"),R=n("vsh_7459"),w=n("vsh_22485"),A=n("vsh_24627"),F=n("vsh_63738"),D=n("vsh_73043"),N=["showDataAsInfo"];function P(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return O(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return O(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function M(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==("undefined"==typeof Reflect?"undefined":(0,b.Z)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a}"function"==typeof SuppressedError&&SuppressedError,function(e){e[e.hidden=0]="hidden",e[e.page=1]="page",e[e.dim=2]="dim",e[e.measure=3]="measure"}(r||(r={})),function(e){e[e.page=0]="page",e[e.corner=1]="corner",e[e.cornerBottom=2]="cornerBottom",e[e.row=3]="row",e[e.rowWithButton=4]="rowWithButton",e[e.rowFields=5]="rowFields",e[e.rowCollapseFields=6]="rowCollapseFields",e[e.col=7]="col",e[e.colFields=8]="colFields",e[e.colBottomField=9]="colBottomField",e[e.value=10]="value",e[e.rowSummary=11]="rowSummary",e[e.bottomRowTotal=12]="bottomRowTotal",e[e.rowRepeatLabel=13]="rowRepeatLabel",e[e.colRepeatLabel=14]="colRepeatLabel"}(o||(o={})),function(e){e.page="page",e.corner="corner",e.cornerBottom="cornerBottom",e.row="row",e.rowWithButton="rowWithButton",e.rowFields="rowFields",e.rowCollapseFields="rowCollapseFields",e.col="col",e.colFields="colFields",e.colBottomField="colBottomField",e.value="value",e.rowSummary="rowSummary",e.bottomRowTotal="bottomRowTotal"}(i||(i={})),function(e){e[e.Normal=0]="Normal",e[e.Condition=1]="Condition"}(a||(a={})),function(e){e.field="field",e.value="value"}(s||(s={})),function(e){e.normal="normal",e.rowSummary="rowSummary",e.colSummary="colSummary",e.total="total"}(l||(l={})),function(e){e[e.number=0]="number",e[e.date=1]="date",e[e.string=2]="string"}(u||(u={})),function(e){e[e.None=16]="None",e[e.Span=1]="Span",e[e.Blank=2]="Blank",e[e.CalcError=4]="CalcError",e[e.ImgOrAttach=8]="ImgOrAttach"}(c||(c={})),function(e){e.none="none",e.corner="corner",e.rowDim="rowDim",e.colDim="colDim",e.value="value",e.colSummary="colSummary",e.rowSummary="rowSummary",e.total="total",e.page="page"}(h||(h={})),function(e){e[e.SigmaValue=0]="SigmaValue",e[e.PageAll=1]="PageAll",e[e.PageMultiple=2]="PageMultiple",e[e.TotalText=3]="TotalText",e[e.Blank=4]="Blank",e[e.ErrorNumber=5]="ErrorNumber"}(d||(d={})),function(e){e[e.ROW=0]="ROW",e[e.COL=1]="COL"}(f||(f={})),function(e){e[e.Successful=0]="Successful",e[e.CalcError=1]="CalcError"}(v||(v={})),function(e){e.ADD_FIELD="ADD_FIELD",e.REMOVE_FIELD="REMOVE_FIELD",e.MOVE_FIELD="MOVE_FIELD",e.RENAME_FIELD="RENAME_FIELD",e.RENAME_FIELD_IN_HIDDEN_TOTAL_INFO="RENAME_FIELD_IN_HIDDEN_TOTAL_INFO",e.RENAME_FIELD_IN_COLLAPSE_INFO="RENAME_FIELD_IN_COLLAPSE_INFO",e.SET_FIELD_SORT_INFO="SET_FIELD_SORT_INFO",e.SET_FIELD_LABEL_FILTER="SET_FIELD_LABEL_FILTER",e.SET_FIELD_FORMAT="SET_FIELD_FORMAT",e.SET_FIELD_SUMMARY_TYPE="SET_FIELD_SUMMARY_TYPE",e.SET_FIELD_SHOW_DATA_AS_INFO="SET_FIELD_SHOW_DATA_AS_INFO",e.SET_SUMMARY_MODE="SET_SUMMARY_MODE",e.SET_FORMULA_SUMMARY_TYPE="SET_FORMULA_SUMMARY_TYPE",e.SET_HIDDEN_TOTAL_INFO="SET_HIDDEN_TOTAL_INFO",e.CLEAR_ALL_FIELDS_HIDDEN_TOTAL_INFO="CLEAR_ALL_FIELDS_HIDDEN_TOTAL_INFO",e.CLEAR_FIELD_HIDDEN_TOTAL_INFO="CLEAR_FIELD_HIDDEN_TOTAL_INFO",e.SET_COLLAPSE_INFO="SET_COLLAPSE_INFO",e.CLEAR_FIELD_COLLAPSE_INFOS="CLEAR_FIELD_COLLAPSE_INFOS",e.SET_REPEAT_LABEL_INFO="SET_REPEAT_LABEL_INFO",e.UPDATE_VALUE_POSITION="UPDATE_VALUE_POSITION",e.UPDATE_CACHE_FIELD="UPDATE_CACHE_FIELD",e.REMOVE_CACHE_FIELD_ITEM="REMOVE_CACHE_FIELD_ITEM",e.ADD_CACHE_FIELD_ITEM="ADD_CACHE_FIELD_ITEM",e.UPDATE_CACHE_FIELD_ITEM="UPDATE_CACHE_FIELD_ITEM",e.FROM_JSON="FROM_JSON",e.UPDATE_RANGE_ID="UPDATE_RANGE_ID",e.DATA_VIEW_REFRESH="DATA_VIEW_REFRESH",e.DATA_VIEW_REFRESH_START="DATA_VIEW_REFRESH_START",e.DATA_VIEW_REFRESH_ERROR="DATA_VIEW_REFRESH_ERROR",e.PIVOT_TABLE_RENDERED="PIVOT_TABLE_RENDERED",e.ADD_FIELD_SUCCESS="ADD_FIELD_SUCCESS",e.GROUP_SUCCESS="GROUP_SUCCESS",e.AUTO_DATE_GROUP_SUCCESS="AUTO_DATE_GROUP_SUCCESS",e.SET_AUTO_FIT_COL="SET_AUTO_FIT_COL",e.VERSION_TOO_HIGH="VERSION_TOO_HIGH",e.UPDATE_VERSION="UPDATE_VERSION"}(p||(p={}));var L=function(){function e(t,n,r){(0,E.Z)(this,e),this._cacheFieldId=t,this.sourceName=n,this.fieldName=r}return(0,T.Z)(e,[{key:"getFormat",value:function(){return this.format}},{key:"setFormat",value:function(e){this.format=e}},{key:"getCacheFieldId",value:function(){return this._cacheFieldId}},{key:"getShowDataAsInfoJSON",value:function(){if(!this._showDataAsInfo)return this._showDataAsInfo;var e=Object.assign({},this._showDataAsInfo);return delete e.baseItemsMap,e}},{key:"getFilterInfo",value:function(){if(this.filterInfo)return Object.assign({},this.filterInfo)}},{key:"getSortInfo",value:function(){if(this.sortInfo)return Object.assign({},this.sortInfo)}},{key:"toJSON",value:function(){var e={cacheFieldId:this._cacheFieldId,sourceName:this.sourceName,fieldName:this.fieldName,fieldType:this.fieldType};return void 0!==this.sortInfo&&(e.sortInfo=this.getSortInfo()),void 0!==this.filterInfo&&(e.filterInfo=this.getFilterInfo()),void 0!==this._showDataAsInfo&&(e.showDataAsInfo=this.getShowDataAsInfoJSON()),void 0!==this.summaryType&&(e.summaryType=this.getSummaryType()),void 0!==this.format&&(e.format=this.format),this.summaryMode&&(e.summaryMode=this.summaryMode),void 0!==this.formulaSummaryType&&(e.formulaSummaryType=this.formulaSummaryType),e}},{key:"fromJSON",value:function(e){var t,n=e.fieldName,r=e.sortInfo,o=e.filterInfo,i=e.fieldType,a=e.showDataAsInfo,s=e.summaryType,l=e.cacheFieldId,u=e.format,c=e.summaryMode,h=e.formulaSummaryType;this.fieldName=n,this.cacheFieldId=l,this.sortInfo=r,this.filterInfo=o,this.fieldType=i,this.summaryMode=null!==(t=c)&&void 0!==t?t:R.t3.Normal,a&&(this._showDataAsInfo=a),void 0!==s&&this.setSummaryType(s),u&&this.setFormat(u),void 0!==h&&this.setFormulaSummaryType(h)}},{key:"clone",value:function(){var t=new e(this._cacheFieldId,this.sourceName,this.fieldName);return this.sortInfo&&t.setSortInfo(this.getSortInfo()),this.filterInfo&&(t.filterInfo=this.getFilterInfo()),t.fieldType=this.fieldType,void 0!==this.format&&t.setFormat(this.format),void 0!==this.summaryType&&t.setSummaryType(this.getSummaryType()),this._showDataAsInfo&&t.setShowDataAsInfo(Object.assign({},this.getShowDataAsInfo())),void 0!==this.summaryMode&&t.setSummaryMode(this.summaryMode),void 0!==this.formulaSummaryType&&t.setFormulaSummaryType(this.formulaSummaryType),t}},{key:"setFieldName",value:function(e){this.fieldName=e}},{key:"getSummaryType",value:function(){return this.summaryType}},{key:"setSummaryMode",value:function(e){this.summaryMode=e}},{key:"getSummaryMode",value:function(){return this.summaryMode}},{key:"setFormulaSummaryType",value:function(e){this.formulaSummaryType=e}},{key:"getFormulaSummaryType",value:function(){return this.formulaSummaryType}},{key:"setSummaryType",value:function(e){this.summaryType=e}},{key:"getShowDataAsInfo",value:function(){return this._showDataAsInfo}},{key:"setShowDataAsInfo",value:function(e){this._showDataAsInfo=e}},{key:"setShowDataAsBaseItems",value:function(e,t){this._showDataAsInfo&&(this._showDataAsInfo.baseItemsMap||(this._showDataAsInfo.baseItemsMap={}),this._showDataAsInfo.baseItemsMap[e]=t)}},{key:"getDimQueryInfo",value:function(e){var t={pivotCacheFieldId:this._cacheFieldId,fieldName:this.fieldName,cacheFieldName:this.sourceName,isRow:!!e,isDim:this.fieldType===r.dim};return this.fieldType!==r.measure&&(t.filterInfo=this.filterInfo),this.fieldType===r.dim&&(t.sortInfo=this.sortInfo),t}},{key:"setLabelFilter",value:function(e){var t;e?(this.filterInfo||(this.filterInfo={}),this.filterInfo.labelFilter=e):(null===(t=this.filterInfo)||void 0===t?void 0:t.labelFilter)&&delete this.filterInfo.labelFilter}},{key:"getLabelFilter",value:function(){var e;return null===(e=this.filterInfo)||void 0===e?void 0:e.labelFilter}},{key:"getMeasureInfo",value:function(){var e;return this.summaryMode===R.t3.Formula?{summaryMode:this.summaryMode,pivotCacheFieldId:this._cacheFieldId,formulaSummaryType:this.formulaSummaryType,showDataAsInfo:this._showDataAsInfo}:{summaryMode:null!==(e=this.summaryMode)&&void 0!==e?e:R.t3.Normal,pivotCacheFieldId:this._cacheFieldId,summaryType:this.summaryType,showDataAsInfo:this._showDataAsInfo}}},{key:"setSortInfo",value:function(e){this.sortInfo=e||void 0}}]),e}();var x=function e(t){if("object"!=(0,b.Z)(t)||null===t)return t;if(Array.isArray(t))return t.map(e);var n={};for(var r in t)n[r]=e(t[r]);return n};function V(e){return null==e?e:A.Ps3.encryptTea(e)}var Z="sourceName not exist",B="field  not found",H="$!$-Sigma-Value-$!$",U="-$-&&-$-",j=function(){},G=function(){function e(){(0,E.Z)(this,e),this._broadcastMsgList=[],this._listenerList=[],this._immediateListenerList=[],this._recoverBroadcastFunc=null}return(0,T.Z)(e,[{key:"broadcast",value:function(e){e&&this._broadcastMsgList.push(e),this._isBroadcastSuspended||this._consumeMsgList()}},{key:"broadcastImmediate",value:function(e){e&&this._consumeImmediateMsgList(e)}},{key:"_consumeMsgList",value:function(){if(!(this._broadcastMsgList.length<1)){var e=this._broadcastMsgList;this._broadcastMsgList=[],this._listenerList.forEach((function(t){try{t(e)}catch(e){console.error("[PIVOT] broadcaster listener error",e)}}))}}},{key:"_consumeImmediateMsgList",value:function(e){this._immediateListenerList.forEach((function(t){try{t([e])}catch(e){console.error("[PIVOT] broadcaster listener error",e)}}))}},{key:"addListener",value:function(e){this._listenerList.push(e)}},{key:"removeListener",value:function(e){this._listenerList=this._listenerList.filter((function(t){return t!==e}))}},{key:"clearAllListener",value:function(){this._listenerList=[]}},{key:"addImmediateListener",value:function(e){this._immediateListenerList.push(e)}},{key:"removeImmediateListener",value:function(e){this._immediateListenerList=this._immediateListenerList.filter((function(t){return t!==e}))}},{key:"suspendBroadcast",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._recoverBroadcastFunc?j:(e&&this._consumeMsgList(),this._recoverBroadcastFunc=this._recoverBroadcastFactory(),this._recoverBroadcastFunc)}},{key:"getBroadcastMsgList",value:function(){return(0,k.Z)(this._broadcastMsgList)}},{key:"dangerouslySetBroadcastList",value:function(e){this._broadcastMsgList=(0,k.Z)(e)}},{key:"_recoverBroadcastFactory",value:function(){var e=this;return function t(){var n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e._recoverBroadcastFunc===t&&(e._recoverBroadcastFunc=null,n&&e._consumeMsgList())}}},{key:"clearBroadcastList",value:function(){this._broadcastMsgList=[]}},{key:"resetBroadcastStatus",value:function(){this.clearBroadcastList(),this._recoverBroadcastFunc=null}},{key:"_isBroadcastSuspended",get:function(){return Boolean(this._recoverBroadcastFunc)}}]),e}(),K=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"_broadcaster";return function(t,n,r){var o=r.value;r.value=function(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];var a=null===(t=this[e])||void 0===t?void 0:t.suspendBroadcast(),s=o.apply(this,r);return null!=a&&a(),s}}},W=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"_broadcaster";return function(n,r,o){var i=o.value;o.value=function(){var n=this[t],r=null==n?void 0:n.suspendBroadcast();try{for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];return i.apply(this,a)}catch(t){throw"abort"===e&&null!=n&&n.clearBroadcastList(),t}finally{null==r||r()}}}},z=function(e,t){if(!e)return t();var n=e.suspendBroadcast(!1),r=e.getBroadcastMsgList(),o=t();return e.dangerouslySetBroadcastList(r),n(!1),o},Y=function(e){switch(e){case 2:case 1:return r.dim;case 3:return r.hidden;case 0:return r.page;case 4:return r.measure;default:return console.log("unknown type for getFieldType"),r.hidden}},J=function(e){var t,n=[],r=P(e);try{for(r.s();!(t=r.n()).done;){var o=t.value;n.push(o.toJSON())}}catch(e){r.e(e)}finally{r.f()}return n},q=function(e,t,n,r){var o,i=P(e);try{for(i.s();!(o=i.n()).done;){var a=o.value;if(a){var s=a.sourceName,l=new L(a.cacheFieldId,s,a.fieldName);l.fromJSON(a),t.push(l),n[l.fieldName]=r}}}catch(e){i.e(e)}finally{i.f()}},$=function(){function e(t,n){(0,E.Z)(this,e),this._suspend=0,this.hideFields=[],this.pageFields=[],this.rowFields=[],this.colFields=[],this.valueFields=[],this.collapseInfo={},this.hiddenTotalInfo={},this.repeatLabelInfo={},this.valueIndex=0,this.valuePosition=1,this._fieldMap={},this._host=t,this._cacheName=n,this._isQueryCubeDirty=!0}return(0,T.Z)(e,[{key:"clone",value:function(t){var n=new e(this._host,this._cacheName);return n.valuePosition=this.valuePosition,n.valueIndex=this.valueIndex,n.hiddenTotalInfo=x(this.hiddenTotalInfo),n.collapseInfo=x(this.collapseInfo),n.repeatLabelInfo=x(this.repeatLabelInfo),this.hideFields.forEach((function(e){(null==t?void 0:t.getCacheFieldByName(e.sourceName))&&n.hideFields.push(e)})),this.pageFields.forEach((function(e){(null==t?void 0:t.getCacheFieldByName(e.sourceName))&&n.pageFields.push(e)})),this.colFields.forEach((function(e){(null==t?void 0:t.getCacheFieldByName(e.sourceName))&&n.colFields.push(e)})),this.rowFields.forEach((function(e){(null==t?void 0:t.getCacheFieldByName(e.sourceName))&&n.rowFields.push(e)})),this.valueFields.forEach((function(e){(null==t?void 0:t.getCacheFieldByName(e.sourceName))&&(null==t?void 0:t.getCacheFieldById(e.getCacheFieldId()))&&n.valueFields.push(e)})),n}},{key:"fromJSON",value:function(e){var t=e.dim,n=e.measure,r=e.cacheName,o=e.valuePosition,i=e.valueIndex,a=e.hiddenTotalInfo,s=e.collapseInfo,l=e.repeatLabelInfo;this._cacheName=r,this._fieldMap={},this.hideFields=[],this.pageFields=[],this.colFields=[],this.rowFields=[],this.valueFields=[],q(t.hide,this.hideFields,this._fieldMap,3),q(t.page,this.pageFields,this._fieldMap,0),q(t.row,this.rowFields,this._fieldMap,1),q(t.col,this.colFields,this._fieldMap,2),q(n,this.valueFields,this._fieldMap,4),this.valuePosition=o,this.valueIndex=i,this.hiddenTotalInfo=x(a),this.collapseInfo=x(s),this.repeatLabelInfo=x(l||{})}},{key:"toJSON",value:function(){return{dim:{hide:J(this.hideFields),page:J(this.pageFields),row:J(this.rowFields),col:J(this.colFields)},cacheName:this._cacheName,measure:J(this.valueFields),valuePosition:this.valuePosition,valueIndex:this.valueIndex,hiddenTotalInfo:x(this.hiddenTotalInfo),collapseInfo:x(this.collapseInfo),repeatLabelInfo:x(this.repeatLabelInfo)}}},{key:"getCacheName",value:function(){return this._cacheName}},{key:"getQueryCube",value:function(){if(this._isQueryCubeDirty){var e=this.toDimQuery(),t=this.toMeasureQuery(),n=this._host.service,r=n.getDependMap(this._host.getName(),this._cacheName,this.valueFields);this._queryCubeCache=n.getCube(this._cacheName,e,t,r),this._isQueryCubeDirty=!1}return this._queryCubeCache}},{key:"dirtyCube",value:function(e){this._isQueryCubeDirty=e}},{key:"getDataSourceInfo",value:function(e){return this._host.service.getDataSourceInfo(this._cacheName,e)}},{key:"query",value:function(){return this.getQueryCube()}},{key:"toDimQuery",value:function(){var e,t=[],n=P(this.hideFields);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push(r.getDimQueryInfo())}}catch(e){n.e(e)}finally{n.f()}var o,i=P(this.pageFields);try{for(i.s();!(o=i.n()).done;){var a=o.value;this.getCacheFieldBySourceName(a.sourceName)&&t.push(a.getDimQueryInfo())}}catch(e){i.e(e)}finally{i.f()}var s,l=P(this.rowFields);try{for(l.s();!(s=l.n()).done;){var u=s.value;t.push(u.getDimQueryInfo(!0))}}catch(e){l.e(e)}finally{l.f()}var c,h=P(this.colFields);try{for(h.s();!(c=h.n()).done;){var d=c.value;t.push(d.getDimQueryInfo())}}catch(e){h.e(e)}finally{h.f()}return t}},{key:"toMeasureQuery",value:function(){var e,t=[],n=P(this.valueFields);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push(r.getMeasureInfo())}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"addField",value:function(e,t,n,r){var o,i;t=String(t);var a,s=this._host.service.getCacheByName(this._cacheName),l=s.getCacheFieldByName(e);if(!l)throw Z;if(4===n){if((0,R.gn)(l)){var u=l.getOriginalCacheFieldId();if(!(l=s.getCacheFieldById(u)))throw Z;t=l.getName()}var c=this._fieldMap;a=(0,R.Zu)(t,(function(e){return Boolean(c[e])}))}else{if(void 0!==this._fieldMap[t])throw Z;a=t}var h=new L(l.getId(),l.getName(),a);h.fieldType=Y(n),this._isQueryCubeDirty=!0;var d=this._addFieldByArea(h,n,r),f=d.field,v=d.correctedIndex;return null!==(o=this._broadcaster)&&void 0!==o&&o.broadcast({type:"ADD_FIELD",data:{field:f.toJSON(),fieldArea:n,index:v}}),null!==(i=this._broadcaster)&&void 0!==i&&i.broadcastImmediate({type:"ADD_FIELD_SUCCESS",data:{sourceName:f.sourceName}}),{successful:!0,viewFieldAdded:f,originalCacheField:l}}},{key:"_setFormulaSummaryType",value:function(e,t){var n,r,o=this.getFieldIndexByName(e),i=this.getFieldArea(e);if(4!==i)return{successful:!1};var a=this.getFieldByName(e);if(!a)return{successful:!1};if(a.getSummaryMode()!==R.t3.Formula)return{successful:!1};var s=a.getFormulaSummaryType();return a.setFormulaSummaryType(t),null!==(n=this._broadcaster)&&void 0!==n&&n.broadcast({type:"SET_FORMULA_SUMMARY_TYPE",data:{fieldArea:i,index:o,fieldName:e,oldValue:null!==(r=s)&&void 0!==r?r:void 0,newValue:t}}),{successful:!0}}},{key:"setSummaryMode",value:function(e,t){var n,r,o=this.getFieldArea(e),i=this.getFieldIndexByName(e);if(4!==o)return{successful:!1};var a=this.getFieldByName(e);if(!a)return{successful:!1};var s=a.getSummaryMode();return a.setSummaryMode(t),null!==(n=this._broadcaster)&&void 0!==n&&n.broadcast({type:"SET_SUMMARY_MODE",data:{fieldArea:o,index:i,fieldName:e,oldValue:null!==(r=s)&&void 0!==r?r:void 0,newValue:t}}),{successful:!0}}},{key:"setCollapse",value:function(e,t,n){var r;this.collapseInfo[e]||(this.collapseInfo[e]={});var o=this.collapseInfo[e][t];this.collapseInfo[e][t]=n,null===(r=this._broadcaster)||void 0===r||r.broadcast({type:"SET_COLLAPSE_INFO",data:{fieldName:e,itemName:t,oldValue:o,newValue:n}})}},{key:"clearFieldCollapseInfos",value:function(e,t){var n;void 0!==this.collapseInfo[e]&&(delete this.collapseInfo[e],null===(n=this._broadcaster)||void 0===n||n.broadcast({type:"CLEAR_FIELD_COLLAPSE_INFOS",data:{fieldName:e}}))}},{key:"getCollapse",value:function(e,t){var n=this.collapseInfo[e];return!!n&&!!n[t]}},{key:"clearAllFieldsHiddenTotalInfo",value:function(){var e;"fields"in this.hiddenTotalInfo&&(this._host.markHiddenTotalInfoEdited(),delete this.hiddenTotalInfo.fields,null===(e=this._broadcaster)||void 0===e||e.broadcast({type:"CLEAR_ALL_FIELDS_HIDDEN_TOTAL_INFO",data:void 0}))}},{key:"clearFieldHiddenTotalInfo",value:function(e){var t,n;void 0!==(null===(t=this.hiddenTotalInfo.fields)||void 0===t?void 0:t[e])&&(this._host.markHiddenTotalInfoEdited(),delete this.hiddenTotalInfo.fields[e],null===(n=this._broadcaster)||void 0===n||n.broadcast({type:"CLEAR_FIELD_HIDDEN_TOTAL_INFO",data:{fieldName:e}}))}},{key:"setGrandTotalHiddenInfo",value:function(e,t){var n,r=this.hiddenTotalInfo[e];r!==t&&(this._host.markHiddenTotalInfoEdited(),t?this.hiddenTotalInfo[e]=!0:delete this.hiddenTotalInfo[e],null===(n=this._broadcaster)||void 0===n||n.broadcast({type:"SET_HIDDEN_TOTAL_INFO",data:{type:e,oldValue:r,newValue:t}}))}},{key:"getGrandTotalHiddenInfo",value:function(e){return Boolean(this.hiddenTotalInfo[e])}},{key:"setSubTotalHiddenInfo",value:function(e){var t,n=this.hiddenTotalInfo.fieldDefault;n!==e&&(this._host.markHiddenTotalInfoEdited(),e?this.hiddenTotalInfo.fieldDefault=!0:delete this.hiddenTotalInfo.fieldDefault,this.clearAllFieldsHiddenTotalInfo(),null===(t=this._broadcaster)||void 0===t||t.broadcast({type:"SET_HIDDEN_TOTAL_INFO",data:{type:"fieldDefault",oldValue:n,newValue:e}}))}},{key:"getSubTotalHiddenInfo",value:function(){return Boolean(this.hiddenTotalInfo.fieldDefault)}},{key:"setFieldTotalHiddenInfo",value:function(e,t){var n,r,o=null===(n=this.hiddenTotalInfo.fields)||void 0===n?void 0:n[e];o!==t&&(this._host.markHiddenTotalInfoEdited(),this.hiddenTotalInfo.fields||(this.hiddenTotalInfo.fields={}),this.hiddenTotalInfo.fields[e]=t,null===(r=this._broadcaster)||void 0===r||r.broadcast({type:"SET_HIDDEN_TOTAL_INFO",data:{type:"fields",fieldName:e,oldValue:o,newValue:t}}))}},{key:"getFieldTotalHiddenInfo",value:function(e){var t,n=null===(t=this.hiddenTotalInfo.fields)||void 0===t?void 0:t[e];return"boolean"==typeof n?n:this.getSubTotalHiddenInfo()}},{key:"setDimRepeatLabelInfo",value:function(e,t){if(t?!this.repeatLabelInfo[e]:e in this.repeatLabelInfo){var n=Boolean(this.repeatLabelInfo[e]);t?this.repeatLabelInfo[e]=!0:delete this.repeatLabelInfo[e],this._broadcaster.broadcast({type:"SET_REPEAT_LABEL_INFO",data:{type:e,oldValue:n,newValue:t}})}}},{key:"getDimRepeatLabelInfo",value:function(e){return Boolean(this.repeatLabelInfo[e])}},{key:"setFieldRepeatLabelInfo",value:function(e,t){}},{key:"getFieldRepeatLabelInfo",value:function(e){var t,n=null===(t=this.repeatLabelInfo.fields)||void 0===t?void 0:t[e];if("boolean"==typeof n)return n;var r=this.getFieldArea(e);return 1===r?this.getDimRepeatLabelInfo("row"):2===r&&this.getDimRepeatLabelInfo("col")}},{key:"getFieldArea",value:function(e){return this._fieldMap[e]}},{key:"_getFieldByArea",value:function(e){var t;switch(e){case 0:t=this.pageFields;break;case 1:t=this.rowFields;break;case 2:t=this.colFields;break;case 3:t=this.hideFields;break;case 4:t=this.valueFields}return t}},{key:"getFieldByName",value:function(e,t,n){if(!t)return[].concat(this.pageFields,this.valueFields,this.rowFields,this.colFields).find((function(t){return t.fieldName===e}));var r=this._getFieldByArea(t);return void 0===n?r.find((function(t){return t.fieldName===e})):r[n]}},{key:"getViewFieldBySourceName",value:function(e,t){var n=[];return(n=t?n.concat(this.pageFields,this.valueFields,this.rowFields,this.colFields):n.concat(this.pageFields,this.rowFields,this.colFields)).find((function(t){return t.sourceName===e}))}},{key:"getViewFieldListBySourceName",value:function(e,t){var n=[];return(n=t?n.concat(this.pageFields,this.valueFields,this.rowFields,this.colFields):n.concat(this.pageFields,this.rowFields,this.colFields)).filter((function(t){return t.sourceName===e}))}},{key:"getFieldIndexByName",value:function(e){for(var t=this._getFieldByArea(this._fieldMap[e])||[],n=0;n<t.length;++n)if(t[n].fieldName===e)return n;return-1}},{key:"_addFieldByArea",value:function(e,t,n){var r=this._getFieldByArea(t),o=n;return o=Math.min(r.length,o),o=Math.max(0,o),r.splice(o,0,e),this._fieldMap[e.fieldName]=t,this.updateValuePositionWhenAddOrRemove(),{field:e,correctedIndex:o}}},{key:"_isValueDimInRow",value:function(){return this.valueFields.length>1&&0===this.valuePosition}},{key:"_isValueDimInCol",value:function(){return this.valueFields.length>1&&1===this.valuePosition}},{key:"updateValuePosition",value:function(e,t){var n,r=this.getValuePosition(),o=r.position,i=r.index;this.valuePosition=e,void 0!==t&&(this.valueIndex=t),o===e&&i===t||null===(n=this._broadcaster)||void 0===n||n.broadcast({type:"UPDATE_VALUE_POSITION",data:{oldPosition:o,oldIndex:i,newPosition:e,newIndex:t}})}},{key:"getFieldFormat",value:function(e){var t;return null===(t=this.getFieldByName(e))||void 0===t?void 0:t.getFormat()}},{key:"setFieldFormat",value:function(e,t){var n,r=this.getFieldArea(e),o=this.getFieldIndexByName(e),i=this.getFieldByName(e,r,o);if(i){var a=i.getFormat();i.setFormat(t),null===(n=this._broadcaster)||void 0===n||n.broadcast({type:"SET_FIELD_FORMAT",data:{fieldArea:r,index:o,fieldName:e,oldValue:a,newValue:t}})}}},{key:"getValuePosition",value:function(){return{display:this.valueFields.length>1,index:this.valueIndex,position:this.valuePosition}}},{key:"removeField",value:function(e){var t,n,r,o=this,i=this._fieldMap[e],a=this._getFieldByArea(i)||[],s=null,l=null,u=P(a.entries());try{for(u.s();!(r=u.n()).done;){var c=(0,S.Z)(r.value,2),h=c[0],d=c[1];if(e===d.fieldName){s=h,l=d.clone();break}}}catch(e){u.e(e)}finally{u.f()}if(null===s||null===l||void 0===s)return{successful:!1};a.splice(s,1),4!==this._fieldMap[e]?this._isQueryCubeDirty=!0:this.checkValueSortInfo(e,(function(e){o.setSortInfo(e,void 0)}));var f=null===(t=this.hiddenTotalInfo.fields)||void 0===t?void 0:t[e];return delete this._fieldMap[e],this.clearFieldHiddenTotalInfo(e),this.clearFieldCollapseInfos(e),this.updateValuePositionWhenAddOrRemove(),this.removeGroupedCacheFieldById(l),null!==(n=this._broadcaster)&&void 0!==n&&n.broadcast({type:"REMOVE_FIELD",data:{field:l.toJSON(),fieldArea:i,index:s}}),{successful:!0,viewFieldToRemove:l,removedFieldInfo:{area:i,index:s,hiddenTotal:f,sortInfo:l.sortInfo}}}},{key:"removeGroupedCacheFieldById",value:function(e){var t,n=this._host.service.getCacheByName(this._cacheName),r=n.getCacheFieldById(e.getCacheFieldId());if(r&&(0,R.gn)(r)){this._isQueryCubeDirty=!0;var o=n.getFieldIndex(r.getId()),i=r.getFieldSourceInfo(!1);n.removeField(r.getId()),null===(t=this._broadcaster)||void 0===t||t.broadcast({type:"REMOVE_CACHE_FIELD_ITEM",data:{index:o,sourceInfo:i}})}}},{key:"updateValuePositionWhenAddOrRemove",value:function(){this.valueFields.length>1&&0===this.rowFields.length&&this.colFields.length>0?this.updateValuePosition(0,0):this.updateValuePosition(1,this.colFields.length)}},{key:"removeFieldsByCacheFieldName",value:function(e){var t,n=P([].concat((0,k.Z)(this.pageFields),(0,k.Z)(this.valueFields),(0,k.Z)(this.rowFields),(0,k.Z)(this.colFields)).filter((function(t){return t.sourceName===e})));try{for(n.s();!(t=n.n()).done;){var r=t.value;this.removeField(r.fieldName)}}catch(e){n.e(e)}finally{n.f()}this._isQueryCubeDirty=!0}},{key:"clearFieldsNotExistInCache",value:function(e){var t=this,n=new Map;(e||[]).forEach((function(e){var t=e.id,r=e.fieldName;n.set(r,t)})),[].concat((0,k.Z)(this.pageFields),(0,k.Z)(this.valueFields),(0,k.Z)(this.rowFields),(0,k.Z)(this.colFields)).forEach((function(e){void 0===n.get(e.sourceName)&&t.removeField(e.fieldName)})),this._isQueryCubeDirty=!0}},{key:"renameField",value:function(e,t){var n,r=this,o=this._fieldMap[e],i=this._getFieldByArea(o),a=i.findIndex((function(t){return t.fieldName===e}));if(-1!==a){var s=i[a];4!==o?this.updateDisplayNameInCache(s,t):this.checkValueSortInfo(e,(function(e,n){r.setSortInfo(e,Object.assign({},n,{measureFieldName:t}))})),s.setFieldName(t),this._updateNameHandler(e,t),this._isQueryCubeDirty=!0,null===(n=this._broadcaster)||void 0===n||n.broadcast({type:"RENAME_FIELD",data:{fieldArea:o,index:a,oldFieldName:e,newFieldName:t}})}}},{key:"checkValueSortInfo",value:function(e,t){[].concat((0,k.Z)(this.rowFields),(0,k.Z)(this.colFields),(0,k.Z)(this.pageFields)).forEach((function(n){var r=n.sortInfo;(null==r?void 0:r.sortMode)===s.value&&e===r.measureFieldName&&t(n.fieldName,r)}))}},{key:"updateDisplayNameInCache",value:function(e,t){var n,r,o=this._host.service.getCacheByName(this._cacheName),i=o.getDataSourceInfo(!1);null===(n=o.getCacheFieldById(e.getCacheFieldId()))||void 0===n||n.setDisplayName(t);var a=o.getDataSourceInfo(!1);null===(r=this._broadcaster)||void 0===r||r.broadcast({type:"UPDATE_CACHE_FIELD",data:{oldCacheField:i,newCacheField:a,ignoreUndo:!1}})}},{key:"_updateNameHandler",value:function(e,t){var n,r,o;this._host.markHiddenTotalInfoEdited();var i=this._fieldMap[e];delete this._fieldMap[e],this._fieldMap[t]=i;var a=null===(n=this.hiddenTotalInfo.fields)||void 0===n?void 0:n[e];"boolean"==typeof a&&(delete this.hiddenTotalInfo.fields[e],this.hiddenTotalInfo.fields[t]=a,null===(r=this._broadcaster)||void 0===r||r.broadcast({type:"RENAME_FIELD_IN_HIDDEN_TOTAL_INFO",data:{oldFieldName:e,newFieldName:t,value:a}}));var s=this.collapseInfo[e];s&&(delete this.collapseInfo[e],this.collapseInfo[t]=s,null===(o=this._broadcaster)||void 0===o||o.broadcast({type:"RENAME_FIELD_IN_COLLAPSE_INFO",data:{oldFieldName:e,newFieldName:t,value:s}}))}},{key:"moveField",value:function(e,t,n){var r,o=this._fieldMap[e],i=this._getFieldByArea(o),a=i.findIndex((function(t){return t.fieldName===e}));if(-1!==a){var s=i.splice(a,1)[0],l=s.toJSON();o!==t&&delete this._fieldMap[e];var u=this._addFieldByArea(s,t,n).correctedIndex;s.fieldType=Y(t),[o,t].every((function(e){return[2,1].includes(e)}))||(this._isQueryCubeDirty=!0),null===(r=this._broadcaster)||void 0===r||r.broadcast({type:"MOVE_FIELD",data:{from:{field:l,fieldArea:o,index:a},to:{field:s.toJSON(),fieldArea:t,index:u}}})}}},{key:"getSummaryType",value:function(e){var t=this.getFieldByName(e);return t?t.summaryType:null}},{key:"setSummaryType",value:function(e,t){var n,r,o=this.getFieldArea(e),i=this.getFieldIndexByName(e),a=this.getFieldByName(e);if(a){var s=this.getSummaryType(e);a.setSummaryType(t),(t===R.wl.distinct&&s!==R.wl.distinct||t===R.wl.mid&&s!==R.wl.mid)&&(this._isQueryCubeDirty=!0),null===(n=this._broadcaster)||void 0===n||n.broadcast({type:"SET_FIELD_SUMMARY_TYPE",data:{fieldArea:o,index:i,fieldName:e,oldValue:null!==(r=s)&&void 0!==r?r:void 0,newValue:t}})}}},{key:"removeCalculateField",value:function(e){return this.removeField(e)}},{key:"addCalculateField",value:function(e,t,n){var r=this._host.service.getCacheByName(this._cacheName).getCalculateCacheFieldByName(e);if(!r)return{successful:!1};var o=this.addField(e,t,4,n);if(!o.successful)return{successful:!1};if(!this.setSummaryMode(t,R.t3.Formula).successful)return{successful:!1};var i=r.getFormulaSummaryType();return this._setFormulaSummaryType(t,i).successful?(this._updateSnapshotVersion(2.1),{successful:!0,viewFieldAdded:o.viewFieldAdded,originalCacheField:o.originalCacheField}):{successful:!1}}},{key:"_updateSnapshotVersion",value:function(e){var t;null===(t=this._broadcaster)||void 0===t||t.broadcast({type:"UPDATE_VERSION",data:{newVersion:e}})}},{key:"setFormulaSummaryType",value:function(e,t){return this._setFormulaSummaryType(e,t)}},{key:"setCalculateCacheField",value:function(e,t){var n=this._host.service.getCacheByName(this._cacheName),r=n.getCalculateCacheFieldByName(e);if(r){var o=r.getCalculateFieldInfo();if((0,I.default)(o,t))return{successful:!1};var i=n.getDataSourceInfo(!1);r.setCalculateFieldInfo(t);var a=n.getDataSourceInfo(!1);return this._broadcaster.broadcast({type:"UPDATE_CACHE_FIELD",data:{oldCacheField:i,newCacheField:a,ignoreUndo:!1}}),{successful:!0,calculateField:r}}var s,l=this._addCalculateFieldImp(e,t),u=n.getNormalFieldDisplayNameList();return this._compileCalculateFormula(e,u),null!==(s=this._broadcaster)&&void 0!==s&&s.broadcast({type:"ADD_CACHE_FIELD_ITEM",data:{index:n.getFieldCount()-1,sourceInfo:l.getFieldSourceInfo(!1)}}),{successful:!0,calculateField:l}}},{key:"_addCalculateFieldImp",value:function(e,t){var n=this._host.service.getCacheByName(this._cacheName),r=(0,R.Zu)(e,(function(e){return void 0!==n.getCacheFieldByName(e)})),o=n.addCalculateCacheFieldImp(t,r);return o.setDisplayName(r),o}},{key:"removeCalculateCacheField",value:function(e){var t,n=this._host.service.getCacheByName(this._cacheName),r=n.getCalculateCacheFieldByName(e);if(r){this._isQueryCubeDirty=!0;var o=n.getFieldIndex(r.getId()),i=r.getFieldSourceInfo(!1);n.removeField(e),null===(t=this._broadcaster)||void 0===t||t.broadcast({type:"REMOVE_CACHE_FIELD_ITEM",data:{index:o,sourceInfo:i}})}}},{key:"_compileCalculateFormula",value:function(e,t){var n=this._host,r=n.service,o=n.getName(),i=n.service.getCacheByName(this._cacheName),a=r.getFormulaService();if(!a)throw new Error("no init pivot formula service");var s=i.getCalculateCacheFieldByName(e);if(s){var l=s.getCalculateFieldInfo().formula;a.initFormula(o,e,l,t)}}},{key:"setSortInfo",value:function(e,t){var n,r=this.getFieldArea(e),o=this.getFieldIndexByName(e),i=this.getFieldByName(e,r,o);if(i){var a=x(i.sortInfo);i.setSortInfo(t),null===(n=this._broadcaster)||void 0===n||n.broadcast({type:"SET_FIELD_SORT_INFO",data:{fieldArea:r,index:o,fieldName:e,oldValue:a,newValue:t}})}}},{key:"getSortInfo",value:function(e){var t=this.getFieldByName(e);if(t)return t.sortInfo}},{key:"setLabelFilter",value:function(e,t){var n,r=this.getFieldArea(e),o=this.getFieldIndexByName(e),i=this.getFieldByName(e,r,o);if(i){var a=x(i.getLabelFilter());i.setLabelFilter(t),this._isQueryCubeDirty=!0,null===(n=this._broadcaster)||void 0===n||n.broadcast({type:"SET_FIELD_LABEL_FILTER",data:{fieldArea:r,index:o,fieldName:e,oldValue:a,newValue:t}})}}},{key:"getLabelFilter",value:function(e){var t=this.getFieldByName(e);if(t)return t.getLabelFilter()}},{key:"checkFieldNameExistInField",value:function(e){var t=this.getFieldByName(e);return Boolean(t)}},{key:"checkFieldNameExistInDataSource",value:function(e,t){if(!this.getFieldByName(e))return!1;var n=this.getDataSourceInfo(!1).find((function(e){return e.displayName===t}));return Boolean(n)}},{key:"setShowDataAsInfo",value:function(e,t){var n,r=this.getFieldArea(e),o=this.getFieldIndexByName(e),i=this.getFieldByName(e,r,o);if(i){var a=x(i._showDataAsInfo);i.setShowDataAsInfo(t),null===(n=this._broadcaster)||void 0===n||n.broadcast({type:"SET_FIELD_SHOW_DATA_AS_INFO",data:{fieldArea:r,index:o,fieldName:e,oldValue:a,newValue:t}})}}},{key:"_groupImp",value:function(e,t,n,r){var o,i=e.getFieldNameByGroupRule(t.getDisplayName(),n),a=(0,R.Zu)(i,(function(t){return e.isDisplayNameExist(t)})),s=e.addGroupedCacheField(t,n);s.setDisplayName(a),null===(o=this._broadcaster)||void 0===o||o.broadcast({type:"ADD_CACHE_FIELD_ITEM",data:{index:e.getFieldCount()-1,sourceInfo:s.getFieldSourceInfo(!1)}});var l=r.area,u=r.index,c=r.hiddenTotal,h=r.sortInfo,d=s.getName(),f=this.addField(d,s.getDisplayName(),l,u);if(!f.successful)return{successful:!1};var v=f.viewFieldAdded,p=v.fieldName;return"boolean"==typeof c&&this.setFieldTotalHiddenInfo(p,c),this.setSortInfo(p,h),{successful:!0,groupedViewField:v,groupRule:n}}},{key:"group",value:function(e,t){var n,r=this.getFieldByName(e);if(!r)return{successful:!1};var o=this._host.service.getCacheByName(this._cacheName);if(!o)return{successful:!1};var i,a,s=o.getCacheFieldById(r.getCacheFieldId());if(!s)return{successful:!1};if((0,R.WH)(s))return{successful:!1};if((0,R.gn)(s)){var l=s.getGroupRule();if((0,I.default)(l,t))return{successful:!1};var u=s.getOriginalCacheFieldId();if(!(s=o.getCacheFieldById(u))||!(0,R.ic)(s))return{successful:!1};i=s;var c=this.removeField(r.fieldName);if(!c.successful)return{successful:!1};a=c.removedFieldInfo}else{var h;i=s;var d=r.fieldName;if(!(a={area:this.getFieldArea(d),index:this.getFieldIndexByName(d),hiddenTotal:null===(h=this.hiddenTotalInfo.fields)||void 0===h?void 0:h[d],sortInfo:r.sortInfo},function(e){return"element"===e}(t.type)||this.removeField(d).successful))return{successful:!1}}var f=this._groupImp(o,i,function(e){if(function(e){return"number"===e}(e.type)){var t=e.type,n=e.groupInterval,r=e.startNum,o=e.endNum;return{type:t,groupInterval:"number"==typeof n?(0,w.convertTo15Digits)(n):n,startNum:"number"==typeof r?(0,w.convertTo15Digits)(r):r,endNum:"number"==typeof o?(0,w.convertTo15Digits)(o):o}}return e}(t),a);return this._isQueryCubeDirty=!0,f.successful&&null!==(n=this._broadcaster)&&void 0!==n&&n.broadcastImmediate({type:"GROUP_SUCCESS",data:{groupRule:t,sourceName:f.groupedViewField.sourceName}}),f}},{key:"ungroup",value:function(e){var t=this.getFieldByName(e);if(!t)return{successful:!1};var n=this._host.service.getCacheByName(this._cacheName);if(!n)return{successful:!1};var r=n.getCacheFieldById(t.getCacheFieldId());if(!r||!(0,R.gn)(r))return{successful:!1};var o=r.getOriginalCacheFieldId(),i=n.getCacheFieldById(o);if(!i)return{successful:!1};var a=this.removeField(t.fieldName);if(!a.successful)return{successful:!1};var s=this._getOriginalViewFieldInPageRowColDim(o);if(null===s){var l=a.removedFieldInfo,u=l.area,c=l.index,h=l.hiddenTotal,d=l.sortInfo,f=this.addField(i.getName(),i.getDisplayName(),u,c);if(!f.successful)return{successful:!1};var v=(s=f.viewFieldAdded).fieldName;"boolean"==typeof h&&this.setFieldTotalHiddenInfo(v,h),this.setSortInfo(v,d)}return this._isQueryCubeDirty=!0,{successful:!0}}},{key:"updateCache",value:function(e,t,n,r,o,i){var a=this._host.service.getCacheByName(e),s=a.getDataSourceInfo(!1),l=(0,R._R)(t,n,r,o,this._host.service.getText.bind(this._host.service));a.refresh(l,t.slice(1),o);var u=a.getDataSourceInfo(!1);i||this.clearLossFields(s,u)}},{key:"refreshGroup",value:function(e){var t;null===(t=this._host.service.getCacheByName(this._cacheName))||void 0===t||t.refreshGroup(e)}},{key:"refreshCalculateField",value:function(e,t){var n=this._host.service.getCacheByName(this._cacheName);if(n){var r=n.getDataSourceInfo(!1);n.refreshCalculateField(e);for(var o=n.getDataSourceInfo(!1),i=n.getCalculateCacheFieldList(),a=n.getNormalFieldDisplayNameList(),s=0;s<i.length;s++){var l=i[s];this._compileCalculateFormula(l.getName(),a)}t||this.clearLossFields(r,o,!1)}}},{key:"clearLossFields",value:function(e,t){var n,r=this,o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!(0,I.default)(e,t)){null===(n=this._broadcaster)||void 0===n||n.broadcast({type:"UPDATE_CACHE_FIELD",data:{oldCacheField:e,newCacheField:t,ignoreUndo:o}});var i,a=e.map((function(e){return e.fieldName})),s=P(a);try{var l=function(){var e=i.value;t.every((function(t){return t.fieldName!==e}))&&r.removeFieldsByCacheFieldName(e)};for(s.s();!(i=s.n()).done;)l()}catch(e){s.e(e)}finally{s.f()}}}},{key:"getGroupRuleByFieldName",value:function(e,t){var n=this.getFieldByName(e);if(!n)return null;var r=this._host.service.getCacheByName(this._cacheName);return r?r.getGroupRuleByFieldId(n.getCacheFieldId(),t):null}},{key:"getCacheFieldBySourceName",value:function(e){var t=this._host.service.getCacheByName(this._cacheName);return t&&t.getCacheFieldByName(e)||null}},{key:"getCacheFieldByFieldName",value:function(e){var t=this.getFieldByName(e);if(!t)return null;var n=this._host.service.getCacheByName(this._cacheName);return n&&n.getCacheFieldById(t.getCacheFieldId())||null}},{key:"_getOriginalViewFieldInPageRowColDim",value:function(e){var t,n=P(this.pageFields);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.getCacheFieldId()===e)return r}}catch(e){n.e(e)}finally{n.f()}var o,i=P(this.rowFields);try{for(i.s();!(o=i.n()).done;){var a=o.value;if(a.getCacheFieldId()===e)return a}}catch(e){i.e(e)}finally{i.f()}var s,l=P(this.colFields);try{for(l.s();!(s=l.n()).done;){var u=s.value;if(u.getCacheFieldId()===e)return u}}catch(e){l.e(e)}finally{l.f()}return null}},{key:"_iterFieldInDims",value:function(e,t){var n,r=P(t);try{for(r.s();!(n=r.n()).done;){var o,i=P(n.value);try{for(i.s();!(o=i.n()).done;){if(!e(o.value))return}}catch(e){i.e(e)}finally{i.f()}}}catch(e){r.e(e)}finally{r.f()}}},{key:"getCalcCacheFieldCount",value:function(){var e=new Map,t=this._host.service.getCacheByName(this._cacheName);if(!t)return e;var n,r=P(this.valueFields);try{for(r.s();!(n=r.n()).done;){var o=n.value,i=o.getCacheFieldId(),a=t.getCacheFieldById(i);if(a&&(0,R.WH)(a)){var s=o.getCacheFieldId(),l=e.get(s)||0;e.set(s,l+1)}}}catch(e){r.e(e)}finally{r.f()}return e}},{key:"getNormalCacheFieldCount",value:function(){var e=new Map,t=this._host.service.getCacheByName(this._cacheName);return t?(this._iterFieldInDims((function(n){var r=n.getCacheFieldId(),o=t.getCacheFieldById(r);if(o){if((0,R.ic)(o)){var i=e.get(r)||0;e.set(r,i+1)}if((0,R.gn)(o)){var a=o.getOriginalCacheFieldId(),s=e.get(a)||0;e.set(a,s+1)}}return!0}),[this.pageFields,this.rowFields,this.colFields,this.valueFields]),e):e}},{key:"removeAllFieldByCacheFieldId",value:function(e){var t=this._host.service.getCacheByName(this._cacheName);if(t){var n=[];for(this._iterFieldInDims((function(r){var o=r.getCacheFieldId(),i=t.getCacheFieldById(o);return i&&((0,R.ic)(i)&&i.getId()===e&&n.push(r.fieldName),(0,R.WH)(i)&&i.getId()===e&&n.push(r.fieldName),(0,R.gn)(i)&&i.getOriginalCacheFieldId()===e&&n.push(r.fieldName)),!0}),[this.pageFields,this.rowFields,this.colFields,this.valueFields]);n.length>0;){var r=n.pop();r&&this.removeField(r)}}}},{key:"getDateGroupedFieldInPageRowColDim",value:function(e){var t=this,n=null;return this._iterFieldInDims((function(r){var o=t._getCacheFieldByViewFieldName(r.fieldName);return!o||!(0,R.gn)(o)||"date"!==o.getGroupRule().type||o.getOriginalCacheFieldId()!==e||(n=r,!1)}),[this.pageFields,this.rowFields,this.colFields]),n}},{key:"getGroupedFieldInPageRowColDim",value:function(e){var t=this,n=null;return this._iterFieldInDims((function(r){var o=t._getCacheFieldByViewFieldName(r.fieldName);return!o||!(0,R.gn)(o)||o.getOriginalCacheFieldId()!==e||(n=r,!1)}),[this.pageFields,this.rowFields,this.colFields]),n}},{key:"getAllGroupedRulesInPageRowColDim",value:function(e){var t=this,n=[];return this._iterFieldInDims((function(r){var o=t._getCacheFieldByViewFieldName(r.fieldName);return o&&(0,R.gn)(o)&&o.getOriginalCacheFieldId()===e&&n.push(o.getGroupRule()),!0}),[this.pageFields,this.rowFields,this.colFields]),n}},{key:"createFieldDateGroupMap",value:function(){var e=this,t={};return this._iterFieldInDims((function(n){var r=e._getCacheFieldByViewFieldName(n.fieldName);if(r&&(0,R.gn)(r)){var o=r.getGroupRule().groupBy;o&&(t[n.fieldName]=o)}return!0}),[this.pageFields,this.rowFields,this.colFields]),t}},{key:"_getCacheFieldByViewFieldName",value:function(e){var t=this.getFieldByName(e);if(!t)return null;var n=this._host.service.getCacheByName(this._cacheName);return n&&n.getCacheFieldById(t.getCacheFieldId())||null}},{key:"getFieldDataType",value:function(e){var t=this._getCacheFieldByViewFieldName(e);return t?t.getDataType():null}},{key:"autoDateGroupImpl",value:function(e){var t=this._getCacheFieldByViewFieldName(e);if(!t)return{successful:!1};var n=t.getMinDate(),r=t.getMaxDate();return null===n||null===r?{successful:!1}:r.getUTCFullYear()!==n.getUTCFullYear()?this.group(e,{type:"date",groupBy:"year"}):Math.floor(r.getUTCMonth()/3)!==Math.floor(n.getUTCMonth()/3)?this.group(e,{type:"date",groupBy:"yearQuarter"}):r.getUTCMonth()!==n.getUTCMonth()?this.group(e,{type:"date",groupBy:"yearMonth"}):(r.getUTCDate(),n.getUTCDate(),{successful:!1})}},{key:"autoDateGroup",value:function(e){var t,n=this.autoDateGroupImpl(e);return n.successful&&null!==(t=this._broadcaster)&&void 0!==t&&t.broadcastImmediate({type:"AUTO_DATE_GROUP_SUCCESS",data:{sourceName:n.groupedViewField.sourceName}}),n}},{key:"_broadcaster",get:function(){return this._host.getBroadcaster&&this._host.getBroadcaster()}}]),e}();M([K()],$.prototype,"addField",null),M([K()],$.prototype,"setSubTotalHiddenInfo",null),M([K()],$.prototype,"removeField",null),M([K()],$.prototype,"renameField",null),M([W("send")],$.prototype,"addCalculateField",null),M([W("send")],$.prototype,"setFormulaSummaryType",null),M([W("send")],$.prototype,"setCalculateCacheField",null),M([W("send")],$.prototype,"removeCalculateCacheField",null),M([W("send")],$.prototype,"group",null),M([W("send")],$.prototype,"ungroup",null),M([W("send")],$.prototype,"removeAllFieldByCacheFieldId",null);var X,Q=function(){function e(t,n,r,o,i){(0,E.Z)(this,e),this.fieldName=t,this.itemName=n,this.type=r,void 0!==o&&(this.originCellValue=o),void 0!==i&&(this.sortPriority=i),this.children=[],this._pathPool={}}return(0,T.Z)(e,[{key:"hasChild",value:function(e){return void 0!==this._pathPool[e]}},{key:"addChild",value:function(e){var t=this.children.push(e)-1;this._pathPool[e.itemName]=t}},{key:"getChildByName",value:function(e){var t=this._pathPool[e];return this.children[t]}},{key:"setSubtotalIndex",value:function(e){this.subtotalIndex=e}},{key:"setParentSubtotalIndex",value:function(e){this.parentSubtotalIndex=e}}]),e}(),ee=function(){function e(t,n,r,o){(0,E.Z)(this,e),this.sortMode=t,this.baseField=n,this.direction=r,this.sortType=o,this._sortNodeMap=new Map,this._nodeValueSet=new Set,this._nodePath2nodeValueMap=new Map,this._nodeValueSortPriorityMap=new Map,this._nodeValueDataTypeMap=new Map}return(0,T.Z)(e,[{key:"isAscSort",value:function(){return"asc"===this.sortType}},{key:"addSortNode",value:function(e,t){this._sortNodeMap.get(e)||this._sortNodeMap.set(e,t)}},{key:"getSortNodeList",value:function(){return this._sortNodeMap}},{key:"sort",value:function(){var e=this,t=this._nodeValueSet,n=this._nodePath2nodeValueMap,r=Array.from(t);r.sort((function(t,n){return e._compareFn(t,n)}));for(var o=new Map,i=0;i<r.length;i++)o.set(r[i],i);var a,s=P(this._sortNodeMap);try{for(s.s();!(a=s.n()).done;){var l,u=(0,S.Z)(a.value,2),c=u[0],h=u[1],d=[],f={},v=P(h.children);try{for(v.s();!(l=v.n()).done;){var p=l.value,g=""===c?p.itemName:c+R.ar+p.itemName,m=n.get(g),_=o.get(m);void 0!==_&&(void 0===f[_]&&(f[_]=[]),f[_].push(p),void 0===d[_]&&(d[_]=p))}}catch(e){v.e(e)}finally{v.f()}for(var y=[],C=0;C<d.length;C++)if(void 0!==d[C]){var E=f[C];y.push.apply(y,(0,k.Z)(E))}h.children=y}}catch(e){s.e(e)}finally{s.f()}}}]),e}();function te(e){X=e}var ne,re,oe=function(e){function t(e){return(0,E.Z)(this,t),(0,m.Z)(this,(0,y.Z)(t).call(this,s.field,e.baseField,e.direction,e.sortType))}return(0,C.Z)(t,e),(0,T.Z)(t,[{key:"_getItemNameType",value:function(e,t){return 2===t?1:isNaN(Number(e))?2:0}},{key:"addSortValueInfo",value:function(e,t,n,r){var o=t;3===r&&(o=""),this._nodeValueSet.add(o),this._nodePath2nodeValueMap.set(Ce(e,t),o),void 0!==n&&this._nodeValueSortPriorityMap.set(t,n),void 0!==r&&this._nodeValueDataTypeMap.set(t,r)}},{key:"_compareFn",value:function(e,t){var n=this.isAscSort(),r=this._nodeValueSortPriorityMap.get(e),o=this._nodeValueSortPriorityMap.get(t);if(void 0===r){if(void 0!==o)return n?1:-1}else{if(void 0===o)return n?-1:1;var i=n?r-o:o-r;if(0!==i)return i}if(""===e)return 1;if(""===t)return-1;var a=this._getItemNameType(e,this._nodeValueDataTypeMap.get(e)),s=this._getItemNameType(t,this._nodeValueDataTypeMap.get(e));if(a!==s)return n?a-s:s-a;if(0===a){var l=Number(e),u=Number(t);return n?l-u:u-l}if(1===a){var c=isNaN(Number(e))?new Date(e).getTime():Number(e),h=isNaN(Number(t))?new Date(e).getTime():Number(t);return n?c-h:h-c}var d=e.toLowerCase(),f=t.toLowerCase();if(d===f)return 0;var v=X().compare(d,f,!1);return n?v:-v}},{key:"sort",value:function(){(0,_.Z)((0,y.Z)(t.prototype),"sort",this).call(this),X().clearPinyinCache()}}]),t}(ee);!function(e){e.Total="total",e.ColTotal="colTotal",e.RowTotal="rowTotal",e.ParentColTotal="parentColTotal",e.ParentRowTotal="parentRowTotal",e.BaseFieldOnly="baseFieldOnly"}(ne||(ne={})),function(e){e.BaseFieldAndItem="baseFieldAndItem",e.BaseFieldAndNextItem="baseFieldAndItemNext",e.BaseFieldAndBeforeItem="baseFieldAndItemBefore"}(re||(re={}));var ie=function(){function e(){(0,E.Z)(this,e),this._pool={}}return(0,T.Z)(e,[{key:"_genPathStr",value:function(t){return t.map((function(t){return""===t?e.PlaceholderStr:t})).join(R.ar)}},{key:"add",value:function(e,t){var n=this._genPathStr(e);this._pool[n]=t}},{key:"get",value:function(e){var t;if(!e)return-1;var n=this._genPathStr(e);return null!==(t=this._pool[n])&&void 0!==t?t:1/0}}]),e}();ie.PlaceholderStr="*";var ae=function(){function e(t,n,r){(0,E.Z)(this,e),this.rowOrderIndexMap=t,this.rowDeep=n,this.colDeep=r}return(0,T.Z)(e,[{key:"isLeafField",value:function(e){var t=this.rowDeep,n=this.colDeep,r=this.getFieldItemIndex(e);return r===t-1||r===t+n-1}},{key:"isLeafNode",value:function(e){var t=this.rowDeep,n=e.slice(0,t),r=e.slice(t),o=n.findIndex((function(e){return e===ie.PlaceholderStr})),i=r.findIndex((function(e){return e===ie.PlaceholderStr}));return-1===o||-1===i}},{key:"getBaseFieldDirection",value:function(e){var t=this.rowDeep;return this.getFieldItemIndex(e)<t?0:1}},{key:"getTotalIdxFromDirection",value:function(e,t){if(!e||!e.length||null==t)return-1;var n=this.rowDeep,r=e.slice(0,n),o=e.slice(n);return 0===t?r.findIndex((function(e){return e===ie.PlaceholderStr})):o.findIndex((function(e){return e===ie.PlaceholderStr}))}},{key:"getTotalIdxFromBaseField",value:function(e,t){var n=this.getBaseFieldDirection(t);return this.getTotalIdxFromDirection(e,n)}},{key:"getFieldItemIndex",value:function(e){var t;return e&&null!==(t=this.rowOrderIndexMap[e])&&void 0!==t?t:-1}},{key:"getFieldItemIndexByDirection",value:function(e){if(!e||void 0===this.rowOrderIndexMap[e])return-1;var t=this.rowDeep;return 0===this.getBaseFieldDirection(e)?this.rowOrderIndexMap[e]:this.rowOrderIndexMap[e]-t}},{key:"_genBaseItemPaths",value:function(e,t,n){var r=this.rowDeep,o=this.colDeep,i=n||{},a=i.baseField,s=i.baseItem,l=i.baseItemType,u=i.baseItemsMap;switch(e){case"total":var c=r+o;return ie.PlaceholderStr.repeat(c).split("");case"rowTotal":var h=t.slice(0,r),d=ie.PlaceholderStr.repeat(o).split("");return h.concat(d);case"colTotal":var f=ie.PlaceholderStr.repeat(r).split(""),v=t.slice(r);return f.concat(v);case"parentRowTotal":if(0===r)return null;var p=t.slice(0,r),g=t.slice(r),m=p.findIndex((function(e){return e===ie.PlaceholderStr})),_=-1===m?r-1:m-1;return _>=0&&(p[_]=ie.PlaceholderStr),p.concat(g);case"parentColTotal":if(0===o)return null;var y=t.slice(0,r),C=t.slice(r),S=C.findIndex((function(e){return e===ie.PlaceholderStr})),k=-1===S?o-1:S-1;return k>=0&&(C[k]=ie.PlaceholderStr),y.concat(C);case"baseFieldOnly":if(!a)return null;var E=this.getBaseFieldDirection(a),T=this.getFieldItemIndex(a),b=this.getTotalIdxFromDirection(t,E);if(0===E?b=-1===b?this.rowDeep:b:(b=-1===b?this.colDeep:b,T-=this.rowDeep),b<T+1)return null;if(b===T+1)return t;var I=Array.from(t);return I[this.getFieldItemIndex(a)+1]=ie.PlaceholderStr,I;case"baseFieldAndItem":if(!a||!s||0!==l)return null;var R=this.getFieldItemIndex(a),w=Array.from(t);return-1===R||t[R]===ie.PlaceholderStr?null:(w[R]=s,w);case"baseFieldAndItemBefore":if(!a||!u||2!==l)return null;var A=this.getFieldItemIndex(a);if(-1===A||t[A]===ie.PlaceholderStr)return null;var F=this.getBaseItems(u,t,a),D=Array.from(t),N=Math.max(0,F.findIndex((function(e){return e===t[A]}))-1);return D[A]=F[N],D;case"baseFieldAndItemNext":if(!a||!u||1!==l)return null;var P=this.getFieldItemIndex(a);if(-1===P||t[P]===ie.PlaceholderStr)return null;var O=this.getBaseItems(u,t,a),M=Array.from(t),L=Math.min(O.length-1,O.findIndex((function(e){return e===t[P]}))+1);return M[P]=O[L],M}}},{key:"genBaseItemPaths",value:function(e,t,n){return t.length!==this.rowDeep+this.colDeep?null:this._genBaseItemPaths(e,t,n)||null}},{key:"getBaseItems",value:function(e,t,n){var r=this.getFieldItemIndexByDirection(n);return e[(0===this.getBaseFieldDirection(n)?t.slice(0,this.rowDeep):t.slice(this.rowDeep))[r-1]||""]||[]}}]),e}(),se=function(){function e(t,n,r){(0,E.Z)(this,e),this._axisPool=new ie,this._calcBasePaths=new ae(t,n,r)}return(0,T.Z)(e,[{key:"getAxisPool",value:function(){return this._axisPool}},{key:"getCalcBasePaths",value:function(){return this._calcBasePaths}},{key:"addPath2Index",value:function(e,t){this._axisPool.add(e,t)}},{key:"getIndexFromPaths",value:function(e){return this._axisPool.get(e)}},{key:"getBaseIndexFromPaths",value:function(e,t,n){var r=this._calcBasePaths.genBaseItemPaths(e,t,n);return r?this.getIndexFromPaths(r):-1}},{key:"getIndexGroupFromField",value:function(t,n){var r=n.baseField,o=n.baseItemsMap;if(!r||!o)return[];if(t[this._calcBasePaths.getFieldItemIndex(r)]===e.PlaceholderStr)return[];var i=this._calcBasePaths.getBaseItems(o,t,r);return this.getIndexGroup(t,r,i)}},{key:"getIndexGroup",value:function(e,t,n){for(var r=this._calcBasePaths.getFieldItemIndex(t),o=[],i=0;i<n.length;i++){var a=n[i],s=Array.from(e);s[r]=a;var l=this.getIndexFromPaths(s);o.push(l)}return o}}]),e}();se.PlaceholderStr=ie.PlaceholderStr;var le,ue=function(e){function t(e,n){var r;return(0,E.Z)(this,t),(r=(0,m.Z)(this,(0,y.Z)(t).call(this,s.value,e.baseField,e.direction,e.sortType)))._showDataManager=n,r._sortValueSet=new Set,r._sortByPathsWithPlaceholder=e.sortByPaths,r.measureFieldName=e.measureFieldName,r._axisPoolManager=n.axisPoolManager,r.baseFieldIndex=r._axisPoolManager.getCalcBasePaths().getFieldItemIndex(e.baseField),r}return(0,C.Z)(t,e),(0,T.Z)(t,[{key:"getPathsWithPlaceholder",value:function(e){var t=this._axisPoolManager.getCalcBasePaths(),n=t.isLeafField(this.baseField),r=e.split(R.ar).filter(Boolean).concat(this.baseField),o=t.rowDeep,i=t.colDeep,a=0===this.direction;switch(!0){case a&&n:var s=r,l=this._sortByPathsWithPlaceholder;return s.concat(l);case a&&!n:var u=r,c=o-u.length,h=u.concat(se.PlaceholderStr.repeat(c).split("")),d=this._sortByPathsWithPlaceholder;return h.concat(d);case!a&&n:var f=r;return this._sortByPathsWithPlaceholder.concat(f);case!a&&!n:var v=r,p=i-v.length,g=v.concat(se.PlaceholderStr.repeat(p).split(""));return this._sortByPathsWithPlaceholder.concat(g)}return se.PlaceholderStr.repeat(o+i).split("")}},{key:"addSortValueInfo",value:function(e,t){var n=this.isAscSort(),r=this.getPathsWithPlaceholder(e);r[this.baseFieldIndex]=t;var o=this._showDataManager.axisPoolManager.getBaseIndexFromPaths("baseFieldAndItem",r,{baseField:this.baseField,baseItem:t,baseItemType:0}),i=this._showDataManager.getValueByMeasureFieldName(this.measureFieldName,o);null==i&&(i=n?1/0:-1/0),this._nodeValueSet.add(i),this._nodePath2nodeValueMap.set(Ce(e,t),i)}},{key:"_compareFn",value:function(e,t){return this.isAscSort()?e-t:t-e}}]),t}(ee),ce=function(){function e(t,n,r){(0,E.Z)(this,e),this._showDataManager=n,this._rowIndexOrder=r,this._SortMap=new Map;var o=n.axisPoolManager.getCalcBasePaths(),i=o.rowDeep,a=o.colDeep,s=o.rowOrderIndexMap;this._rowDeep=i,this._colDeep=a,this._rowOrderIndexMap=s,this._createSortInstanceList(t)}return(0,T.Z)(e,[{key:"_createSortInstanceList",value:function(e){for(var t=0,n=e.length;t<n;t++){var r=e[t],o=r.fieldName,i=r.isRow,a=r.isDim,s=Boolean(i);if(a){var l=r.sortInfo;l||(l={sortMode:R.Zv.field,sortType:"asc"});var u=s?0:1,c=this._getParentFieldName(o);if(!this._getSortInstance(c,u)){this._SortMap.get(u)||this._SortMap.set(u,new Map);var h=this._SortMap.get(u);if(l.sortMode===R.Zv.field)h.set(c,new oe({sortMode:R.Zv.field,direction:u,baseField:o,sortType:l.sortType}));else if(l.sortMode===R.Zv.value){var d=l,f=d.constraints,v=d.measureFieldName,p=this._constraints2SortByPaths(f,u);h.set(c,new ue({sortMode:R.Zv.value,direction:u,baseField:o,sortType:l.sortType,sortByPaths:p,measureFieldName:v},this._showDataManager))}}}}}},{key:"_getParentFieldName",value:function(e){var t=this._rowOrderIndexMap[e]-1;return-1===t||t===this._rowDeep-1?"":this._rowIndexOrder[t].fieldName}},{key:"_constraints2SortByPaths",value:function(e,t){var n=0===t?Math.max(0,this._colDeep-e.length):Math.max(0,this._rowDeep-e.length);return e.concat(se.PlaceholderStr.repeat(n).split(""))}},{key:"_getSortInstance",value:function(e,t){var n=this._SortMap.get(t),r=n&&n.get(e);return r&&r.direction===t?r:null}},{key:"checkSort",value:function(e,t,n){var r=n?0:1,o=this._getSortInstance(e.fieldName,r);if(o&&o.direction===r){o.addSortNode(t,e);for(var i=e.children,a=0;a<i.length;a++){var s=i[a],l=s.itemName;o.addSortValueInfo(t,l,s.sortPriority,s.type)}}}},{key:"handleSort",value:function(e){var t,n=P(this._SortMap);try{for(n.s();!(t=n.n()).done;){var r,o=P((0,S.Z)(t.value,2)[1]);try{for(o.s();!(r=o.n()).done;){var i=(0,S.Z)(r.value,2)[1];i.sort(),e&&e(i)}}catch(e){o.e(e)}finally{o.f()}}}catch(e){n.e(e)}finally{n.f()}}}]),e}(),he=function(e){return"number"==typeof e};!function(e){e.Valid="valid",e.Empty="empty",e.Error="error"}(le||(le={}));var de=function(){function e(t,n,r){(0,E.Z)(this,e),this.axisPoolManager=t,this._subtotalList=n,this._valueFieldMap=r}return(0,T.Z)(e,[{key:"_getQueryCubeItem",value:function(e){return this._subtotalList[e]||null}},{key:"_getPercentValue",value:function(t,n){if(null==t||null==n)return this._getValidResult(e.ZERO_NUMBER);if("number"!=typeof t||"number"!=typeof n)return this._getValidResult(t);var r=R.FB.divide(t,n);return this._getValidResult(r)}},{key:"_getDifference",value:function(t,n){if(null==t||null==n)return this._getValidResult(e.ZERO_NUMBER);if("number"!=typeof t||"number"!=typeof n)return this._getValidResult(t);var r=R.FB.minus(t,n);return this._getValidResult(r)}},{key:"_getPercentDifference",value:function(t,n){if(null==t||null==n)return this._getValidResult(e.ZERO_NUMBER);if("number"!=typeof t||"number"!=typeof n)return this._getValidResult(t);var r=R.FB.divide(R.FB.minus(t,n),n);return this._getValidResult(r)}},{key:"_getIndexValue",value:function(t,n,r,o){if(null==r||null==o)return this._getValidResult(e.ZERO_NUMBER);if("number"!=typeof t||"number"!=typeof n||"number"!=typeof r||"number"!=typeof o)return this._getValidResult(t);var i=R.FB.divide(R.FB.multiply(t,n),R.FB.multiply(r,o));return this._getValidResult(i)}},{key:"_getItemSummaryValue",value:function(e,t,n){var r=this._getQueryCubeItem(e);if(r){var o=r.summary;return o&&o[t]&&o[t][n]}}},{key:"_getItemFormulaSummaryValue",value:function(e,t,n){var r=this._getQueryCubeItem(e);if(r){var o=r.formulaSummary;return o&&o[t]&&o[t][n]}}},{key:"getValueByValueFieldInfo",value:function(e,t){var n=e.summaryMode,r=e.cacheName,o=e.formulaSummaryType,i=e.summaryType;return n===R.t3.Formula?this._getItemFormulaSummaryValue(t,r,o):this._getItemSummaryValue(t,r,i)}},{key:"getValueByMeasureFieldName",value:function(e,t){var n=this._valueFieldMap[e];if(n)return n.getSummaryMode()===R.t3.Formula?this._getItemFormulaSummaryValue(t,n.sourceName,n.formulaSummaryType):this._getItemSummaryValue(t,n.sourceName,n.summaryType)}},{key:"_getEmptyResult",value:function(){return{type:"empty",value:void 0}}},{key:"_getErrorResult",value:function(){return{type:"error",value:void 0}}},{key:"_getValidResult",value:function(e){return{type:"valid",value:e}}},{key:"_isValidBaseField",value:function(e){return-1!==this.axisPoolManager.getCalcBasePaths().getFieldItemIndex(e)}},{key:"_getInvaildResult",value:function(e,t){var n=e.baseField,r=e.baseItem,o=e.baseItemType;return n&&!this._isValidBaseField(n)?this._getErrorResult():n&&t===1/0&&r&&0===o||-1===t?this._getEmptyResult():null}},{key:"_getShowDataAsValue",value:function(t,n,r){var o=this,i=t.showDataAsInfo,a=i||{},s=a.type,l=a.baseField,u=a.baseItem,c=a.baseItemType,h=a.baseItemsMap;if(l&&!this._isValidBaseField(l))return this._getErrorResult();var d=this.getValueByValueFieldInfo(t,n),f={0:"baseFieldAndItem",2:"baseFieldAndItemBefore",1:"baseFieldAndItemNext"};switch(s){case R.gK.percentOfTotal:var v=this.axisPoolManager.getBaseIndexFromPaths("total",r),p=this.getValueByValueFieldInfo(t,v);return this._getPercentValue(d,p);case R.gK.percentOfCol:var g=this.axisPoolManager.getBaseIndexFromPaths("colTotal",r),m=this.getValueByValueFieldInfo(t,g);return this._getPercentValue(d,m);case R.gK.percentOfRow:var _=this.axisPoolManager.getBaseIndexFromPaths("rowTotal",r),y=this.getValueByValueFieldInfo(t,_);return this._getPercentValue(d,y);case R.gK.percentOfParentRow:var C=this.axisPoolManager.getBaseIndexFromPaths("parentRowTotal",r),S=this.getValueByValueFieldInfo(t,C);return this._getPercentValue(d,S);case R.gK.percentOfParentCol:var k=this.axisPoolManager.getBaseIndexFromPaths("parentColTotal",r),E=this.getValueByValueFieldInfo(t,k);return this._getPercentValue(d,E);case R.gK.percentOfParent:if(!l||!h)return this._getEmptyResult();var T=this.axisPoolManager.getBaseIndexFromPaths("baseFieldOnly",r,{baseField:l,baseItemsMap:h}),b=this._getInvaildResult(i,T);if(b)return b;var I=this.getValueByValueFieldInfo(t,T);return this._getPercentValue(d,I);case R.gK.index:var w=this.axisPoolManager.getBaseIndexFromPaths("total",r),A=this.axisPoolManager.getBaseIndexFromPaths("rowTotal",r),F=this.axisPoolManager.getBaseIndexFromPaths("colTotal",r),D=this.getValueByValueFieldInfo(t,w),N=this.getValueByValueFieldInfo(t,A),P=this.getValueByValueFieldInfo(t,F);return this._getIndexValue(d,D,N,P);case R.gK.percent:if(!l||!h||null==c)return this._getEmptyResult();var O=this.axisPoolManager.getBaseIndexFromPaths(f[c],r,{baseField:l,baseItemsMap:h,baseItem:u,baseItemType:c});if(0!==c&&O===1/0)return this._getPercentValue(d,d);var M=this._getInvaildResult(i,O);if(M)return M;var L=this.getValueByValueFieldInfo(t,O);return this._getPercentValue(d,L);case R.gK.difference:if(!l||!h||!u||null==c)return this._getEmptyResult();var x=this.axisPoolManager.getBaseIndexFromPaths(f[c],r,{baseField:l,baseItemsMap:h,baseItem:u,baseItemType:c});if(0!==c&&x===1/0)return this._getDifference(d,d);var V=this._getInvaildResult(i,x);if(V)return V;var Z=this.getValueByValueFieldInfo(t,x);return this._getDifference(d,Z);case R.gK.percentDiff:if(!l||!h||!u||null==c)return this._getEmptyResult();var B=this.axisPoolManager.getBaseIndexFromPaths(f[c],r,{baseField:l,baseItemsMap:h,baseItem:u,baseItemType:c});if(0!==c&&B===1/0)return this._getPercentDifference(d,d);var H=this._getInvaildResult(i,B);if(H)return H;var U=this.getValueByValueFieldInfo(t,B);return this._getPercentDifference(d,U);case R.gK.runTotal:if(!l||!h)return this._getEmptyResult();for(var j=this.axisPoolManager.getCalcBasePaths(),G=0,K=this.axisPoolManager.getIndexGroupFromField(r,{baseField:l,baseItemsMap:h}),W=r[j.getFieldItemIndex(l)],z=j.getBaseItems(h,r,l).indexOf(W),Y=0;Y<=z;Y++){var J=K[Y],q=this.getValueByValueFieldInfo(t,J)||e.ZERO_NUMBER;G+=he(q)?q:0}return this._getValidResult(G);case R.gK.percentOfRunningTotal:if(!l||!h)return this._getEmptyResult();for(var $=this.axisPoolManager.getCalcBasePaths(),X=0,Q=this.axisPoolManager.getIndexGroupFromField(r,{baseField:l,baseItemsMap:h}),ee=$.getFieldItemIndex(l),te=r[ee],ne=$.getBaseItems(h,r,l).indexOf(te),re=0;re<=ne;re++){var oe=Q[re],ie=this.getValueByValueFieldInfo(t,oe)||e.ZERO_NUMBER;X+=he(ie)?ie:0}var ae=Array.from(r);ae[ee]=se.PlaceholderStr;var le=this.axisPoolManager.getIndexFromPaths(ae),ue=this.getValueByValueFieldInfo(t,le);return this._getPercentValue(X,ue);case R.gK.rankAscending:if(!l||!h)return this._getEmptyResult();var ce=this.axisPoolManager.getIndexGroupFromField(r,{baseField:l,baseItemsMap:h}).map((function(e){return o.getValueByValueFieldInfo(t,e)})).filter(he).sort((function(e,t){return e-t})).findIndex((function(e){return e===d}))+1;return 0===ce?this._getEmptyResult():this._getValidResult(ce);case R.gK.rankDescending:if(!l||!h)return this._getEmptyResult();var de=this.axisPoolManager.getIndexGroupFromField(r,{baseField:l,baseItemsMap:h}).map((function(e){return o.getValueByValueFieldInfo(t,e)})).filter(he).sort((function(e,t){return t-e})).findIndex((function(e){return e===d}))+1;return 0===de?this._getEmptyResult():this._getValidResult(de);default:return this._getValidResult(d)}}},{key:"getContentValue",value:function(e,t,n){var r=this.getValueByValueFieldInfo(e,t);return e.showDataAsInfo&&he(r)?this._getShowDataAsValue(e,t,n):this._getValidResult(r)}}]),e}();de.ZERO_NUMBER=0;var fe=function(e,t){console.log("[PIVOT FORMULA CALC] no init getFormulaValue function")},ve=function(){function e(t,n,r,o,i){(0,E.Z)(this,e),this._rowIndexFieldShowDataAsMap={},this._rowTotalNodePathIndexMap=new Map,this.subtotalList=t._itemList.concat([]),this.measureIndexes=this.createMeasureIndexes(o),this._leafItemLength=this.subtotalList.length,this.indexCursor=this.subtotalList.length;var a=this.getPathIndexOrder(t,n),s=a.rowOrder,l=a.colOrder;this._rowDeep=s.length,this._colDeep=l.length,this._rowIndexOrder=s.concat(l),this._colIndexOrder=l.concat(s),this._rowHiddenSubtotalInfo=this.buildHiddenTotalInfoByOrder(r,!0),this._colHiddenSubtotalInfo=this.buildHiddenTotalInfoByOrder(r,!1),this._indexOrderLength=this._rowIndexOrder.length,this._valueFieldMap=this.buildValueFieldMap(o),this._valueFields=o,this._rowOrderIndexMap=this._getRowOrderIndexMap(),this.axisPoolManager=new se(this._rowOrderIndexMap,this._rowDeep,this._colDeep),this.showDataManager=new de(this.axisPoolManager,this.subtotalList,this._valueFieldMap),this._showDataAsStateValue=i,this._sortManager=new ce(n,this.showDataManager,this._rowIndexOrder)}return(0,T.Z)(e,[{key:"createMeasureIndexes",value:function(e){var t,n=[],r=new Map,o=P(e);try{var i=function(){var e=t.value,o=e.sourceName,i=e.getSummaryMode(),a=e.getSummaryType(),s=e.getFormulaSummaryType(),l=r.get(o),u=i===R.t3.Formula;if(void 0===l){var c=n.push({cacheFieldName:o,summaryTypes:u?[]:[a],summaryMode:u?R.t3.Formula:R.t3.Normal,formulaSummaryTypes:u?[s]:[]});r.set(o,c-1)}else if(u){var h=n[l].formulaSummaryTypes;-1===h.findIndex((function(e){return e===s}))&&h.push(s)}else{var d=n[l].summaryTypes;-1===d.findIndex((function(e){return e===a}))&&d.push(a)}};for(o.s();!(t=o.n()).done;)i()}catch(e){o.e(e)}finally{o.f()}return n}},{key:"buildValueFieldMap",value:function(e){var t,n={},r=P(e);try{for(r.s();!(t=r.n()).done;){var o=t.value;n[o.fieldName]=o}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"_getRowOrderIndexMap",value:function(){var e=this._rowIndexOrder,t={};return e.forEach((function(e,n){t[e.fieldName]=n})),t}},{key:"getIndex",value:function(){var e=this.indexCursor;return this.indexCursor++,e}},{key:"getPathIndexOrder",value:function(e,t){var n={};e.indexOrder.map((function(e,t){var r=e.fieldName;n[r]=t}));var r,o=[],i=[],a=P(t);try{for(a.s();!(r=a.n()).done;){var s=r.value,l=s.fieldName,u=s.isRow,c=s.isDim,h=s.cacheFieldName;u?o.push({fieldName:l,index:n[h]}):c&&i.push({fieldName:l,index:n[h]})}}catch(e){a.e(e)}finally{a.f()}return{rowOrder:o,colOrder:i}}},{key:"getFieldShowDataAs",value:function(e){if(this._rowIndexFieldShowDataAsMap[e])return this._rowIndexFieldShowDataAsMap[e];var t,n=this._valueFields,r=this._rowOrderIndexMap,o=P(n);try{for(o.s();!(t=o.n()).done;){var i=t.value,a=i._showDataAsInfo;if(a&&a.baseField){var s,l=null!==(s=r[a.baseField])&&void 0!==s?s:-1;if(-1!==l&&(this._rowIndexFieldShowDataAsMap[l]=i),l===e)return i}}}catch(e){o.e(e)}finally{o.f()}return null}},{key:"buildHiddenTotalInfoByOrder",value:function(e,t){var n=t?this._rowIndexOrder:this._colIndexOrder,r={},o=t?e.row:e.col,i=t?this._rowDeep:this._colDeep;r[0]=0!==i&&Boolean(o);var a,s=P(n.entries());try{for(s.s();!(a=s.n()).done;){var l,u,c=(0,S.Z)(a.value,2),h=c[0],d=c[1].fieldName;if(0!==h){var f=null===(l=e.fields)||void 0===l?void 0:l[d],v=Boolean(null!==(u=f)&&void 0!==u?u:e.fieldDefault);r[h]=v}}}catch(e){s.e(e)}finally{s.f()}return r}},{key:"buildSizeForTabular",value:function(e,t,n,r,o,i,a,s){if(a&&e.level<=this._rowDeep&&this._sortManager.checkSort(e,s.join(R.ar),!0),!a&&e.level<=this._colDeep&&this._sortManager.checkSort(e,s.join(R.ar),!1),-1===t&&(r=1),e.level<n){var l=0,u=0,c=3===e.type?"":e.itemName,h=!!i[e.fieldName]&&i[e.fieldName][c];if(e.isCollapse=h,!h){var d,f=P(e.children);try{for(f.s();!(d=f.n()).done;){var v=d.value,p=this.buildSizeForTabular(v,t,n,r,o,i,a,s.concat(v.itemName));l+=p.itemSize,u+=p.totalSize}}catch(e){f.e(e)}finally{f.f()}}t>e.level&&(l+=0,!e.isCollapse&&o[e.level]||(u+=r)),t===e.level&&(l*=r,u*=r,!e.isCollapse&&o[e.level]||(u+=r)),t<e.level&&(l+=0,o[e.level]&&!e.isCollapse||(u+=1)),e.itemSize=l,e.totalSize=u}return e.level===n&&(t===e.level&&(e.itemSize=r,e.totalSize=0),t<e.level&&(e.itemSize=1,e.totalSize=0)),{itemSize:e.itemSize||0,totalSize:e.totalSize||0}}},{key:"buildNode",value:function(){var e=this.createNode("","",1,0,void 0),t=this.createNode("","",1,0,void 0);e.isRoot=!0,t.isRoot=!0,e.setParentSubtotalIndex(e.subtotalIndex),t.setParentSubtotalIndex(t.subtotalIndex),this.rowRootNode=e,this.colRootNode=t;for(var n=0;n<this._leafItemLength;n++){var r=this.subtotalList[n],o=r.path,i=void 0===o?[]:o,a=r.type,s=r.sortPriorityMap,l=void 0===s?{}:s,u=r.groupOriginValues,c=this.updateDataToNode(e,i,a,l,u,!0),h=this.updateDataToNode(t,i,a,l,u,!1);c.setSubtotalIndex(n),h.setSubtotalIndex(n)}var d=se.PlaceholderStr.repeat(this._rowDeep+this._colDeep).split("");return this.axisPoolManager.addPath2Index(d,e.subtotalIndex),{rowRootNode:e,colRootNode:t}}},{key:"reduceRowNode",value:function(e,t){if(e.level<this._indexOrderLength){var n,r=[],o=P(e.children);try{for(o.s();!(n=o.n()).done;){var i=n.value,a=this.reduceRowNode(i,t.concat(i.itemName)),s=a.subtotalIndex;a.itemName;r.push(s)}}catch(e){o.e(e)}finally{o.f()}this.reduceUnit(r,e.subtotalIndex)}else this.calcSubtotal(e.subtotalIndex),this.axisPoolManager.addPath2Index(t,e.subtotalIndex);return{subtotalIndex:e.subtotalIndex,itemName:e.itemName}}},{key:"reduceColNode",value:function(e,t){var n=e.level;if(n<this._indexOrderLength){var r,o=[],i=P(e.children);try{for(i.s();!(r=i.n()).done;){var a=r.value;o.push(this.reduceColNode(a,t.concat(a.itemName)))}}catch(e){i.e(e)}finally{i.f()}this.reduceUnit(o,e.subtotalIndex)}else this.calcSubtotal(e.subtotalIndex);if(n<=this._colDeep){var s={};if(n===this._colDeep)this.buildRowNodePathIndexMap(e,s,""),this._rowTotalNodePathIndexMap.set(e.subtotalIndex,s);else{var l,u={},c=P(e.children);try{for(c.s();!(l=c.n()).done;){var h=l.value,d=this.getRowTotalNodePathIndexMapByIndex(h.subtotalIndex);if(d)for(var f in d)u[f]||(u[f]=[]),u[f].push(d[f])}}catch(e){c.e(e)}finally{c.f()}for(var v in u)if(void 0===s[v]){var p=this.getIndex();this.reduceUnit(u[v],p);var g=[t.join(R.ar)].concat(se.PlaceholderStr.repeat(this._colDeep-1).split("")).map((function(e){return""===e?se.PlaceholderStr:e})),m=v.split(R.ar),_=Math.max(0,this._rowDeep-m.length),y=m.concat(se.PlaceholderStr.repeat(_).split(""));this.axisPoolManager.addPath2Index(y.concat(g),p),s[v]=p}this._rowTotalNodePathIndexMap.set(e.subtotalIndex,s)}}return e.subtotalIndex}},{key:"getRowTotalNodePathIndexMapByIndex",value:function(e){return this._rowTotalNodePathIndexMap.get(e)}},{key:"buildRowNodePathIndexMap",value:function(e,t,n){if(!e.isLeaf){e.level>=this._colDeep&&(t[n]=e.subtotalIndex);var r,o=P(e.children);try{for(o.s();!(r=o.n()).done;){var i=r.value,a=i.itemName||U,s=Ce(n,i.level>this._colDeep?a:"");this.buildRowNodePathIndexMap(i,t,s)}}catch(e){o.e(e)}finally{o.f()}}}},{key:"reduceUnit",value:function(e,t){var n=this,r=this.subtotalList;if(void 0===this.subtotalList[t]&&(this.subtotalList[t]={}),r&&r.length>0){var o,i=P(this.measureIndexes);try{var a=function(){var r=o.value,i=r.cacheFieldName,a=r.summaryTypes,s=r.formulaSummaryTypes,l=r.summaryMode;if(l!==R.t3.Formula){var u,c=0,h=0,d=0,f=0,v=1,p=-1/0,g=1/0,m=null,_=null,y=P(e);try{for(y.s();!(u=y.n()).done;){var C=u.value,S=n.subtotalList[C].unit[i].value;c=R.FB.add(S.sum,c),h=R.FB.add(S.count,h),d=R.FB.add(S.countNums,d),f=R.FB.add(S.sumx2,f),v=R.FB.multiply(v,S.product),p=Math.max(S.max,p),g=Math.min(S.min,g),null!==S.dis&&(m=m?Object.assign({},m,{},S.dis):Object.assign({},S.dis)),S.mid&&(_=_?_.concat(S.mid):S.mid.concat())}}catch(e){y.e(e)}finally{y.f()}var k=n.subtotalList[t],E=k.unit;E||(k.unit=E={}),E[i]={type:R.h.Normal,value:{sum:c,count:h,countNums:d,sumx2:f,product:v,max:p,min:g,dis:m,mid:_}},k.summary||(k.summary={}),k.summary[i]=(0,R.XE)(E[i].value,a)}if(l===R.t3.Formula){var T,b={},I={},w=P(e);try{for(w.s();!(T=w.n()).done;){var A=T.value,F=n.subtotalList[A].unit[i].value;for(var D in F.sum)b[D]||(b[D]=0),b[D]=R.FB.add(b[D],F.sum[D]),I[D]||(I[D]=[]),I[D]=I[D].concat(F.custom[D])}}catch(e){w.e(e)}finally{w.f()}var N=n.subtotalList[t],O=N.unit;O||(N.unit=O={}),O[i]={type:R.h.Formula,value:{sum:b,custom:I}},N.formulaSummary||(N.formulaSummary={}),N.formulaSummary[i]=(0,R.Dw)((function(e){return n.getFormulaValue(i,e)}),O[i].value,s)}};for(i.s();!(o=i.n()).done;)a()}catch(e){i.e(e)}finally{i.f()}}}},{key:"calcSubtotal",value:function(e){var t=this,n=this.subtotalList[e];if(n){var r,o=P(this.measureIndexes);try{var i=function(){var e=r.value,o=e.cacheFieldName,i=e.summaryTypes,a=e.formulaSummaryTypes,s=n.unit[o];if(!s)throw new Error("unit is not exist, cacheFieldName:".concat(V(o),", measureIndexesLength:").concat(t.measureIndexes.length,", itemUnitLength:").concat(JSON.stringify(Object.keys(n.unit).length)));if(s.type===R.h.Normal){n.summary||(n.summary={});var l=s.value;n.summary[o]=(0,R.XE)(l,i)}else{n.formulaSummary||(n.formulaSummary={});var u=s.value;n.formulaSummary[o]=(0,R.Dw)((function(e){return t.getFormulaValue(o,e)}),u,a)}};for(o.s();!(r=o.n()).done;)i()}catch(e){o.e(e)}finally{o.f()}}}},{key:"createNode",value:function(e,t,n,r,o,i){var a=new Q(e,t,n,o,i);return a.level=r,r!==this._indexOrderLength?a.subtotalIndex=this.getIndex():a.isLeaf=!0,a}},{key:"updateDataToNode",value:function(e,t,n,r,o,i){for(var a=e,s=i?this._rowIndexOrder:this._colIndexOrder,l=[],u=0;u<this._indexOrderLength;u++){var c=s[u],h=c.fieldName,d=c.index,f=t[d]||U;l.push(f);var v=a.getChildByName(f);if(!v){var p=o?o[d]:void 0;if((v=this.createNode(h,f,n[d],u+1,p,r[d])).setParentSubtotalIndex(a.subtotalIndex),a.addChild(v),l.length!==this._rowDeep+this._colDeep)if(i){var g=Math.max(0,this._rowDeep+this._colDeep-l.length),m=l.concat(se.PlaceholderStr.repeat(g).split(""));this.axisPoolManager.addPath2Index(m,v.subtotalIndex)}else{var _=Math.min(this._rowDeep,this._rowDeep+this._colDeep-l.length),y=l.slice(this._colDeep).concat(se.PlaceholderStr.repeat(_).split("")),C=this._colDeep-Math.min(this._colDeep,l.length),S=l.slice(0,this._colDeep-C).concat(se.PlaceholderStr.repeat(C).split(""));this.axisPoolManager.addPath2Index(y.concat(S),v.subtotalIndex)}}a=v}return a}},{key:"getSummaryValue",value:function(e,t,n){var r=this.subtotalList[t].summary;if(r&&r[e]&&void 0!==r[e][n])return r[e][n]}},{key:"getFormulaSummaryValue",value:function(e,t,n){var r=this.subtotalList[t].formulaSummary;if(r&&r[e]&&void 0!==r[e][n])return r[e][n]}},{key:"getShowDataAsValue",value:function(e,t,n){var r=this.showDataManager.getContentValue(e,t,n),o=r.type,i=r.value;switch(o){case"valid":return i;case"empty":default:return this._showDataAsStateValue.emptyValueShowAs;case"error":return this._showDataAsStateValue.errorValueShowAs}}},{key:"handleSort",value:function(){var e=this;this._sortManager.handleSort((function(t){var n,r=t.getSortNodeList(),o=t.direction,i=P(r);try{for(i.s();!(n=i.n()).done;){var a,s=(0,S.Z)(n.value,2)[1],l=0===o?s.level:e._rowDeep+s.level;null===(a=e.getFieldShowDataAs(l))||void 0===a||a.setShowDataAsBaseItems(s.itemName,s.children.map((function(e){return e.itemName})))}}catch(e){i.e(e)}finally{i.f()}}))}},{key:"getFormulaValue",set:function(e){this._getFormulaValue=e},get:function(){return this._getFormulaValue||fe}}]),e}(),pe=function(e,t,n,r,o){return{fieldName:[].concat(e.fieldName,[t]),itemName:[].concat(e.itemName,[n===U?"":n]),dataTypes:[].concat(e.dataTypes,[r]),valueFieldIndex:o}},ge=function(e,t){var n,r=!1,o=null==t||null===(n=t.labelFilter)||void 0===n?void 0:n.type;if(o===a.Normal?r=!t.labelFilter.isAll:o===a.Condition&&(r=!0),!e||r)return!e&&r?16:e&&r?32:8;switch(e){case"asc":return 2;case"desc":return 4;default:return 8}},me=function(){function e(){(0,E.Z)(this,e)}return(0,T.Z)(e,[{key:"buildContext",value:function(e,t,n){e.reset();var r=t._isValueDimInCol(),o=t._isValueDimInRow(),i=t.valueIndex,a={},s=0;o&&0===i&&(a[H]=0,s++);var l,u=P(t.rowFields);try{for(u.s();!(l=u.n()).done;){a[l.value.fieldName]=s,o&&s+1===i&&(a[H]=s,s++),s++}}catch(e){u.e(e)}finally{u.f()}var c={},h=1;r&&0===i&&(c[H]=0,h++);var d,f=P(t.colFields);try{for(f.s();!(d=f.n()).done;){c[d.value.fieldName]=h,r&&h===i&&(c[H]=h,h++),h++}}catch(e){f.e(e)}finally{f.f()}var v=this.getValueFieldInfo(t.valueFields),p=v.valueFieldInfos,g=v.valueMap;return e.setValueFieldInfos(p),{summaryManager:n,rowDeep:t.rowFields.length,valueFieldsCount:t.valueFields.length,valueFields:t.valueFields,fieldsModel:t,dataModel:e,rowModel:e.row,colModel:e.col,corner:e.corner,valueModel:e.value,rowRoot:n.rowRootNode,colRoot:n.colRootNode,rowHeaderColMap:a,colHeaderRowMap:c,colDeep:t.colFields.length,rowHiddenSubtotalInfo:n._rowHiddenSubtotalInfo,colHiddenSubtotalInfo:n._colHiddenSubtotalInfo,isValueDimInCol:r,valueIndex:i,isValueDimInRow:o,valueFieldInfos:p,valueMap:g,collapseInfo:t.collapseInfo,repeatLabelInfo:t.repeatLabelInfo}}},{key:"render",value:function(e,t,n){var r=this.buildContext(e,t,n);this.buildPageModel(r),this.buildColModel(r),this.buildRowModel(r),this.buildCornerArea(r),r=null}},{key:"buildCornerArea",value:function(e){var t=e.valueFieldsCount,n=e.dataModel,r=e.corner,o=e.colModel,i=e.rowModel,a=e.fieldsModel,s=e.valueFieldInfos,l=e.rowDeep,u=e.colDeep;if(1===t&&l>0&&(n.setValue(r,0,0,s[0].fieldName),n.setCellStyleType(r,0,0,1)),l>0)for(var c=o.range.rowCount,h=i.range.colCount,d=a.rowFields,f=0;f<h;f++){var v=d[f],p=void 0!==(null==v?void 0:v.fieldName)?void 0:0;if(n.setValue(r,c-1,f,null==v?void 0:v.fieldName,void 0,p),v){var g,m=ge(null===(g=v.sortInfo)||void 0===g?void 0:g.sortType,v.filterInfo);n.setButtonState(r,c-1,f,m)}n.setCellStyleType(r,c-1,f,2)}0===l&&u>0&&t>=1&&n.setValue(r,o.range.rowCount-1,0,void 0,void 0,0)}},{key:"getNodeActualSize",value:function(e,t){return t.itemSize+t.totalSize}},{key:"_getPageFieldValue",value:function(e,t){var n,r=null===(n=e.filterInfo)||void 0===n?void 0:n.labelFilter;if(!r)return{keyType:1};if(r.type===a.Condition)return{keyType:2};if(r.isAll)return{keyType:1};if(1===r.list.length){var o=""===r.list[0]?3:t.getFieldDataType(e.fieldName)||void 0;return{value:r.list[0],type:o}}return{keyType:2}}},{key:"buildPageModel",value:function(e){var t=e.fieldsModel,n=e.dataModel,r=n.page,o=t.pageFields,i=o.length>0?2:-1,a=o.length>0?o.length:-1;r.range={rowCount:a,colCount:i};var s,l=P(o.entries());try{for(l.s();!(s=l.n()).done;){var u=(0,S.Z)(s.value,2),c=u[0],h=u[1];n.setValue(r,c,0,h.fieldName);var d=this._getPageFieldValue(h,t),f=d.value,v=d.type,p=d.keyType;n.setValue(r,c,1,f,v,p);var g=ge(void 0,h.filterInfo);n.setButtonState(r,c,1,g)}}catch(e){l.e(e)}finally{l.f()}}},{key:"buildColModel",value:function(e){var t,n=e.colModel,r=e.colRoot,o=e.colDeep,i=e.isValueDimInCol,a=e.valueIndex,s=e.valueFieldInfos,l=e.colHeaderRowMap,u=e.valueFieldsCount;t=0===o?u:this.getNodeActualSize(e,r),n.colHeaderRowMap=l;var c=0;i&&o>0&&(c=1),n.range={rowCount:1+o+c,colCount:t},this.updateFirstColHeader(e);var h={fieldName:[],itemName:[],dataTypes:[]},d=[];if(i&&(d=s),i&&0===a){var f,v=0,p=P(d);try{for(p.s();!(f=p.n()).done;){var g=f.value;v+=this.buildColChild(e,r,v,h,[g])}}catch(e){p.e(e)}finally{p.f()}}else this.buildColChild(e,r,0,h,d);0!==o?this.buildColTotal(e,r,t-this.getNodeTotalSize("col",e,r),h,d):this.buildNoneColumnColTotal(e,r,s),this.buildColPathMap(e)}},{key:"buildNoneColumnColTotal",value:function(e,t,n){var r,o=e.dataModel,i=e.colModel,a=e.summaryManager,s=this.getNodeActualSize(e,t),l=0,u=P(n);try{for(u.s();!(r=u.n()).done;){var c=r.value.fieldName;o.setValue(i,0,l,c),o.setCellStyleType(i,0,l,7),o.setPivotInfo(i,l,{fieldName:[],items:[],types:[],path:"",isSubTotal:!0,isBlankRow:!1,isTopSubTotal:!1,level:0,size:s,rowPathIndexMap:a.getRowTotalNodePathIndexMapByIndex(t.subtotalIndex),valueFieldName:c,labelType:t.type}),l++}}catch(e){u.e(e)}finally{u.f()}}},{key:"buildColChild",value:function(e,t,n,r,o){var i=e.colDeep,a=0;if(t.level<i)if(t.isCollapse)this.buildColTotal(e,t,n,r,o);else{var s,l=P(t.children);try{for(l.s();!(s=l.n()).done;){var u=s.value,c=this.getNodeActualSize(e,u);this.buildColNode(e,u,n,pe(r,u.fieldName,u.itemName,u.type),o),n+=c,a+=c}}catch(e){l.e(e)}finally{l.f()}}return r=null,a}},{key:"getVisibleTotalSize",value:function(e,t,n){var r=e.valueIndex,o="row"===n?[e.rowDeep,e.rowHiddenSubtotalInfo]:[e.colDeep,e.colHiddenSubtotalInfo],i=(0,S.Z)(o,2),a=i[0],s=i[1];return t.isCollapse||s[t.level]||t.level===a&&r===t.level?0:this.getNodeTotalSize(n,e,t)}},{key:"getRepeatLabelCount",value:function(e,t,n){var r,o=e.repeatLabelInfo,i=t.fieldName,a=o[n],s=null===(r=o.fields)||void 0===r?void 0:r[i];return(a?!1===s:!0!==s)?0:this.getNodeActualSize(e,t)-this.getVisibleTotalSize(e,t,n)-1}},{key:"buildColNode",value:function(e,t,n,r,o){var i=e.dataModel,a=e.colModel,s=e.colHeaderRowMap,l=e.colDeep,u=e.valueIndex,c=e.isValueDimInCol,h=e.summaryManager,d=s[t.fieldName],f=void 0!==t.originCellValue?{date:t.originCellValue,text:t.itemName}:t.itemName;i.setValue(a,d,n,f,t.type),i.setCellStyleType(a,d,n,7);for(var v=this.getRepeatLabelCount(e,t,"col"),p=0;p<v;p++)i.setValue(a,d,n+1+p,f,t.type),i.setCellStyleType(a,d,n+1+p,14);t.level<l&&i.setButtonState(a,d,n,t.isCollapse?128:64);var g=n,m=this.getNodeActualSize(e,t);if(c&&t.level===u){var _,y=P(o);try{for(y.s();!(_=y.n()).done;){var C=_.value,S=this.buildColChild(e,t,n,r,[C]);i.setValue(a,d+1,n,C.fieldName),i.setCellStyleType(a,d+1,n,7),t.level===l&&i.setPivotInfo(a,n,{fieldName:r.fieldName.concat(),items:r.itemName.concat(),types:r.dataTypes.concat(),path:r.itemName.join(R.ar),isSubTotal:!1,isBlankRow:!1,isTopSubTotal:!1,level:t.level,size:m,rowPathIndexMap:h.getRowTotalNodePathIndexMapByIndex(t.subtotalIndex),valueFieldName:C.fieldName,labelType:t.type}),t.level===l&&(S=1),n+=S}}catch(e){y.e(e)}finally{y.f()}}else{var k;this.buildColChild(e,t,n,r,o);var E=c&&t.level>u&&o.length>0?null===(k=o[0])||void 0===k?void 0:k.fieldName:void 0;t.level===l&&i.setPivotInfo(a,n,{fieldName:r.fieldName.concat(),items:r.itemName.concat(),types:r.dataTypes.concat(),path:r.itemName.join(R.ar),isSubTotal:!1,isBlankRow:!1,isTopSubTotal:!1,level:t.level,size:m,rowPathIndexMap:h.getRowTotalNodePathIndexMapByIndex(t.subtotalIndex),valueFieldName:E,labelType:t.type})}this.buildColTotal(e,t,g+this.getNodeActualSize(e,t)-this.getNodeTotalSize("col",e,t),r,o),r=null}},{key:"buildColTotal",value:function(e,t,n,r,o){var i=e.colModel,a=e.colHeaderRowMap,s=e.dataModel,l=e.isValueDimInCol,u=e.colDeep,c=e.valueIndex,h=e.colHiddenSubtotalInfo,d=e.summaryManager;if(!(t.level>=u)&&(t.isCollapse||!h[t.level])){var f=t.isRoot?1:a[t.fieldName],v=r.itemName.join(R.ar),p=this.getNodeActualSize(e,t);if(l&&t.level<=c){var g,m=void 0!==t.originCellValue,_=P(o);try{for(_.s();!(g=_.n()).done;){var y=g.value,C={text:t.itemName,suffix:y.fieldName};m&&(C.date=t.originCellValue),s.setValue(i,f,n,C,t.type),s.setCellStyleType(i,f,n,7),s.setPivotInfo(i,n,{fieldName:r.fieldName.concat(),items:r.itemName.concat(),types:r.dataTypes.concat(),path:v,isSubTotal:!0,isBlankRow:!1,isTopSubTotal:!1,level:t.level,size:p,rowPathIndexMap:d.getRowTotalNodePathIndexMapByIndex(t.subtotalIndex),valueFieldName:y.fieldName,labelType:t.type}),n++}}catch(e){_.e(e)}finally{_.f()}}else{var S,k={text:t.itemName,keyType:3,date:t.originCellValue},E=void 0!==t.originCellValue?{date:t.originCellValue,text:t.itemName}:t.itemName,T=t.isCollapse?E:k;s.setValue(i,f,n,T,t.type),s.setCellStyleType(i,f,n,7),t.level<u&&t.isCollapse&&s.setButtonState(i,f,n,t.isCollapse?128:64),s.setPivotInfo(i,n,{fieldName:r.fieldName.concat(),items:r.itemName.concat(),types:r.dataTypes.concat(),path:v,isSubTotal:!0,isBlankRow:!1,isTopSubTotal:!1,level:t.level,size:p,rowPathIndexMap:d.getRowTotalNodePathIndexMapByIndex(t.subtotalIndex),valueFieldName:null===(S=o[0])||void 0===S?void 0:S.fieldName,labelType:t.type})}}}},{key:"buildColPathMap",value:function(e){var t=e.colModel,n=e.isValueDimInCol,r=t.pivotInfos,o={};if(r)for(var i=0;i<r.length;i++){var a,s=r[i],l=s.items,u=s.valueFieldName,c=[],h=P(l);try{for(h.s();!(a=h.n()).done;){var d=a.value;c.push(""===d?U:d)}}catch(e){h.e(e)}finally{h.f()}var f=c.join(R.ar);n?o[Ce(f,u||"")||""]=i:o[f||""]=i}e.colPathMap=o}},{key:"getValueFieldInfo",value:function(e){var t,n=[],r=0,o={},i=P(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;n.push({cacheName:a.sourceName,summaryType:a.summaryType,fieldName:a.fieldName,showDataAsInfo:a._showDataAsInfo,summaryMode:a.summaryMode,formulaSummaryType:a.formulaSummaryType}),o[a.fieldName]=r,r++}}catch(e){i.e(e)}finally{i.f()}return{valueFieldInfos:n,valueMap:o}}},{key:"updateFirstColHeader",value:function(e){var t=e.dataModel,n=e.colModel,r=e.colHeaderRowMap,o=e.fieldsModel,i=0;for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a)){var s=o.getFieldByName(a),l=a===H?void 0:a,u=a===H?0:void 0;if(t.setValue(n,0,i,l,void 0,u),t.setCellStyleType(n,0,i,8),s){var c,h=ge(null===(c=s.sortInfo)||void 0===c?void 0:c.sortType,s.filterInfo);t.setButtonState(n,0,i,h)}i++}}},{key:"getNodeTotalSize",value:function(e,t,n){var r=t.valueIndex,o=t.valueFieldsCount,i=n.level;return("row"===e?t.isValueDimInRow:t.isValueDimInCol)&&i<=r?o:1}}]),e}(),_e=function(e){function t(){return(0,E.Z)(this,t),(0,m.Z)(this,(0,y.Z)(t).apply(this,arguments))}return(0,C.Z)(t,e),(0,T.Z)(t,[{key:"buildRowModel",value:function(e){var t,n=e.dataModel,r=e.rowModel,o=e.rowRoot,i=e.rowDeep,a=e.colDeep,s=e.valueFieldsCount,l=e.isValueDimInRow,u=e.valueFieldInfos,c=e.valueIndex,h=e.rowHeaderColMap,d=0===i&&0===s?0:this.getNodeActualSize(e,o);r.rowHeaderColMap=h;var f=u,v=0;l?(t=d-s,v+=1):t=d-1;var p=i+v;0===i&&(p=s>=1&&0!==a?1:0),r.range={rowCount:d,colCount:p};var g={fieldName:[],itemName:[],dataTypes:[]};if(l&&0===c){var m,_=0,y=0,C=d-this.getNodeTotalSize("row",e,o),S=P(f);try{for(S.s();!(m=S.n()).done;){var k=m.value;n.setValue(r,_,0,k.fieldName),n.setCellStyleType(r,_,0,3);var E=this.buildRowChild(e,o,_,g,[k]);0===i?this.buildContentNode(e,o,C+y,"",[k],g):this.buildContentTotal(e,"",C,f,o.level,Boolean(o.isCollapse)),_+=E,y++}}catch(e){S.e(e)}finally{S.f()}this.buildRowTotal(e,o,C,g,f)}else this.buildRowChild(e,o,0,g,f),this.buildRowTotal(e,o,t,g,f),0===i?this.buildContentNode(e,o,0,"",f,g):this.buildContentTotal(e,"",t,f,o.level,Boolean(o.isCollapse))}},{key:"buildRowTotal",value:function(e,t,n,r,o){var i=e.rowModel,a=e.rowHeaderColMap,s=e.dataModel,l=e.isValueDimInRow,u=e.isValueDimInCol,c=e.valueIndex,h=e.rowHiddenSubtotalInfo,d=e.rowDeep;if(!h[t.level]||t.isCollapse){var f=t.isRoot?0:a[t.fieldName],v=r.itemName.join(R.ar),p=this.getNodeActualSize(e,t);if(l&&t.level<=c){var g,m=n,_=0!==t.level||t.isCollapse?5:6,y=void 0!==t.originCellValue,C=P(o);try{for(C.s();!(g=C.n()).done;){var S=g.value.fieldName,k={text:t.itemName,suffix:S};y&&(k.date=t.originCellValue),s.setValue(i,m,f,k,t.type),s.setPivotInfo(i,m,{fieldName:r.fieldName.concat(),items:r.itemName.concat(),types:r.dataTypes.concat(),path:v,isSubTotal:!0,isBlankRow:!1,isTopSubTotal:!1,size:p,level:t.level,labelType:t.type,valueFieldName:S});for(var E=f;E<d+1;E++)s.setCellStyleType(i,m,E,_);m++}}catch(e){C.e(e)}finally{C.f()}}else{var T,b=this.getRowTotalValue(t,d,o),I=void 0!==t.originCellValue?{date:t.originCellValue,text:t.itemName}:t.itemName,w=t.isCollapse?I:b,A=0===t.level&&0!==d?12:t.isCollapse?6:5;s.setValue(i,n,f,w,t.type),t.isCollapse&&(s.setButtonState(i,n,f,t.isCollapse?128:64),s.setCellStyleType(i,n,f,4)),s.setPivotInfo(i,n,{fieldName:r.fieldName.concat(),items:r.itemName.concat(),types:r.dataTypes.concat(),path:v,isSubTotal:!0,isBlankRow:!1,size:p,isTopSubTotal:!1,level:t.level,labelType:t.type,valueFieldName:u||null===(T=o[0])||void 0===T?void 0:T.fieldName});for(var F=f;F<d;F++)s.setCellStyleType(i,n,F,A);0===d&&o[0]&&s.setCellStyleType(i,n,0,A)}}}},{key:"getRowTotalValue",value:function(e,t,n){var r={text:e.itemName,keyType:3};return e.isRoot&&0===t&&n[0]&&(r={text:e.itemName,suffix:n[0].fieldName}),void 0!==e.originCellValue&&(r.date=e.originCellValue),r}},{key:"buildRowNode",value:function(e,t,n,r,o){var i=e.dataModel,a=e.rowModel,s=e.rowHeaderColMap,l=e.rowDeep,u=e.valueFieldsCount,c=e.isValueDimInRow,h=e.valueIndex,d=e.rowHiddenSubtotalInfo,f=s[t.fieldName],v=r.itemName.join(R.ar),p=t.level,g=void 0!==t.originCellValue?{date:t.originCellValue,text:t.itemName}:t.itemName;i.setValue(a,n,f,g,t.type),i.setCellStyleType(a,n,f,3);for(var m=this.getRepeatLabelCount(e,t,"row"),_=0;_<m;_++)i.setValue(a,n+1+_,f,g,t.type),i.setCellStyleType(a,n+1+_,f,13);t.level<l&&(i.setButtonState(a,n,f,t.isCollapse?128:64),i.setCellStyleType(a,n,f,4));var y=this.getNodeActualSize(e,t);if(c&&t.level===h){var C,S=n,k=n+this.getNodeActualSize(e,t)-u,E=P(o);try{for(E.s();!(C=E.n()).done;){var T=C.value;i.setValue(a,S,f+1,T.fieldName),i.setCellStyleType(a,S,f+1,3),t.level===l&&i.setPivotInfo(a,S,{fieldName:r.fieldName.concat(),items:r.itemName.concat(),types:r.dataTypes.concat(),path:v,isSubTotal:!1,isBlankRow:!1,isTopSubTotal:!1,level:t.level,size:y,valueFieldName:T.fieldName,labelType:t.type});var b=0;p<l?(b=this.buildRowChild(e,t,S,r,[T]),d[t.level]&&!t.isCollapse||(this.buildRowTotal(e,t,k,r,[T]),this.buildContentTotal(e,Pe(r.itemName),k,[T],t.level,Boolean(t.isCollapse)))):(this.buildContentNode(e,t,S,"",[T],r),b=1),S+=b,k++}}catch(e){E.e(e)}finally{E.f()}}else if(p<l){this.buildRowChild(e,t,n,r,o);var I=n+this.getNodeActualSize(e,t)-this.getNodeTotalSize("row",e,t);d[t.level]&&!t.isCollapse||(this.buildRowTotal(e,t,I,r,o),this.buildContentTotal(e,Pe(r.itemName),I,o,t.level,Boolean(t.isCollapse)))}else{var w,A;this.buildContentNode(e,t,n,"",o,r),c&&(A=null===(w=o[0])||void 0===w?void 0:w.fieldName),i.setPivotInfo(a,n,{fieldName:r.fieldName.concat(),items:r.itemName.concat(),types:r.dataTypes.concat(),path:v,isSubTotal:!1,isBlankRow:!1,isTopSubTotal:!1,level:t.level,size:y,valueFieldName:A,labelType:t.type})}}},{key:"buildContentNode",value:function(e,t,n,r,o,i){var a=e.valueModel,s=e.dataModel,l=e.colPathMap,u=e.isValueDimInCol,c=e.valueFieldsCount,h=e.summaryManager,d=e.colDeep;if(0!==c){var f=this.buildNodePathForShowDataAs(i.itemName,i.dataTypes,r,d);if(u){var v,p=P(o);try{for(p.s();!(v=p.n()).done;){var g=v.value,m=l[Ce(r,g.fieldName)],_=h.getShowDataAsValue(g,t.subtotalIndex,f);s.setValue(a,n,m,_),s.setCellStyleType(a,n,m,10)}}catch(e){p.e(e)}finally{p.f()}}else if(o.length>0){var y=l[r],C=h.getShowDataAsValue(o[0],t.subtotalIndex,f);s.setValue(a,n,y,C),s.setCellStyleType(a,n,y,10)}t.isLeaf||this.buildContentChild(e,t,n,r,o,i)}}},{key:"buildContentTotal",value:function(e,t,n,r,o,i){var a=e.colModel,s=e.dataModel,l=e.valueModel,u=e.isValueDimInCol,c=e.valueFieldInfos,h=e.valueMap,d=e.valueFieldsCount,f=e.summaryManager,v=e.rowHiddenSubtotalInfo,p=e.rowDeep,g=e.colDeep;if((!v[o]||i)&&0!==d&&a.pivotInfos){var m,_=P(a.pivotInfos.entries());try{for(_.s();!(m=_.n()).done;){var y=(0,S.Z)(m.value,2),C=y[0],k=y[1],E=k.rowPathIndexMap,T=k.valueFieldName,b=k.items,I=k.types;if(E&&void 0!==E[t]){var R=this.buildTotalPathForShowDataAs(t,b,I,p,g),w=void 0;if(u){var A=c[h[T]];if(!A)throw new Error("valueFieldInfo is not found, valueFieldName:".concat(V(T),",valueMapIndex:").concat(h[T],",valueFieldInfosLength:").concat(c.length));w=f.getShowDataAsValue(A,E[t],R),s.setValue(l,n,C,w),s.setCellStyleType(l,n,C,0===o?12:11)}else{var F,D=n,N=P(r);try{for(N.s();!(F=N.n()).done;){var O=F.value;w=f.getShowDataAsValue(O,E[t],R),s.setValue(l,D,C,w),s.setCellStyleType(l,D,C,0===o?12:11),D++}}catch(e){N.e(e)}finally{N.f()}}}}}catch(e){_.e(e)}finally{_.f()}}}},{key:"buildContentChild",value:function(e,t,n,r,o,i){var a,s=P(t.children);try{for(s.s();!(a=s.n()).done;){var l=a.value;this.buildContentNode(e,l,n,Ce(r,l.itemName||U),o,i)}}catch(e){s.e(e)}finally{s.f()}}},{key:"buildRowChild",value:function(e,t,n,r,o){var i=e.rowDeep,a=0;if(t.isCollapse)return 0;if(t.level<i){var s,l=P(t.children);try{for(l.s();!(s=l.n()).done;){var u=s.value,c=this.getNodeActualSize(e,u);this.buildRowNode(e,u,n,pe(r,u.fieldName,u.itemName,u.type),o),n+=c,a+=c}}catch(e){l.e(e)}finally{l.f()}}return a}},{key:"buildNodePathForShowDataAs",value:function(e,t,n,r){for(var o=[],i=0;i<e.length;i++){var a=e[i],s=t[i];o.push(3===s?U:a)}var l=0===r?[]:n.split(R.ar).map((function(e){return""===e?se.PlaceholderStr:e})),u=l.concat(se.PlaceholderStr.repeat(r-l.length).split(""));return o.concat(u)}},{key:"buildTotalPathForShowDataAs",value:function(e,t,n,r,o){for(var i=e.split(R.ar).map((function(e){return""===e?se.PlaceholderStr:e})),a=i.concat(se.PlaceholderStr.repeat(r-i.length).split("")),s=[],l=0;l<t.length;l++){var u=t[l],c=n[l];s.push(3===c?U:u)}var h=s.concat(se.PlaceholderStr.repeat(o-s.length).split(""));return a.concat(h)}}]),t}(me),ye=function(){function e(){(0,E.Z)(this,e),this.cacheCollection={},this._requesterCollection={},this._useServerCalc=!1,this.formatterService=new F.FormatterService,this._maxSupportVersion=2.1,this._formulaService=null}return(0,T.Z)(e,[{key:"setCacheByJSON",value:function(e,t){var n=this.cacheCollection[e];if(n)n.fromJSON(t);else{var r=new R.SL(e,[],[],[],{t:D,formatterService:this.getFormatterService()});r.fromJSON(t),this.cacheCollection[e]=r}}},{key:"createCache",value:function(e,t,n,r,o){var i=(0,R._R)(t,n,r,o,this.getText.bind(this)),a=new R.SL(e,i,t.slice(1),o,{t:this.getText.bind(this),formatterService:this.getFormatterService()}),s=a._name;return this.cacheCollection[s]=a,s}},{key:"registerRequester",value:function(e,t){this._requesterCollection[e]=t}},{key:"unregisterRequester",value:function(e){delete this._requesterCollection[e]}},{key:"getFormatterService",value:function(){return this.formatterService}},{key:"setFormatterService",value:function(e){this.formatterService=e}},{key:"updateCacheName",value:function(e,t){var n=this.cacheCollection[e];n&&(delete this.cacheCollection[e],n._name=t,this.cacheCollection[t]=n)}},{key:"setCacheForService",value:function(e,t){this.cacheCollection[e]=t}},{key:"removeCache",value:function(e){this.cacheCollection[e]&&delete this.cacheCollection[e]}},{key:"setI18n",value:function(e){this._i18n=e}},{key:"getText",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return this._i18n?null===(t=this._i18n)||void 0===t?void 0:t.call.apply(t,[this,e].concat(r)):R.rH.apply(void 0,[e].concat(r))}},{key:"setFormulaService",value:function(e){this._formulaService=e}},{key:"getFormulaService",value:function(){return this._formulaService}},{key:"getCacheByName",value:function(e){return this.cacheCollection[e]}},{key:"getRequesterByName",value:function(e){return this._requesterCollection[e]}},{key:"getCube",value:function(e,t,n,r){var o=this.getCacheByName(e);return new R.mx(o,t,n,r,(0,R.EC)(this.formatterService))}},{key:"getDataSourceInfo",value:function(e,t){var n=this.getCacheByName(e);return n?be(n,t):[]}},{key:"getItemListByFieldName",value:function(e,t){var n;return null===(n=this.getCacheByName(e))||void 0===n?void 0:n.getItemListByFieldName(t)}},{key:"getItemTypeListByFieldName",value:function(e,t){var n;return null===(n=this.getCacheByName(e))||void 0===n?void 0:n.getItemTypeList(t)}},{key:"getItemTypeByFieldName",value:function(e,t){var n;return null===(n=this.getCacheByName(e))||void 0===n?void 0:n.getItemTypeByFieldName(t)}},{key:"getDataRecordsFromCache",value:function(e,t){var n=this;return t.map((function(t){return n.getCacheByName(e).getRowValue(t)}))}},{key:"getLabelFilterItems",value:function(e,t,n){var r=this.getItemListByFieldName(e,t);if(!n)return r;var o=n.list;return n.isAll?r:o}},{key:"getDependMap",value:function(e,t,n){var r,o=this.getFormulaService(),i={},a=this.getCacheByName(t),s=a.getNormalFieldDisplayNameList(),l=P(n);try{for(l.s();!(r=l.n()).done;){var u=r.value;if(u.summaryMode===R.t3.Formula){var c,h,d=null===(c=a.getCacheFieldByName(u.sourceName))||void 0===c||null===(h=c.getCalculateFieldInfo())||void 0===h?void 0:h.formula;o.initFormula(e,u.sourceName,d,s),i[u.sourceName]=o.getRefList(e,u.sourceName)}}}catch(e){l.e(e)}finally{l.f()}return i}},{key:"reset",value:function(){this.cacheCollection={},this._requesterCollection={}}},{key:"dispose",value:function(){Object.values(this.cacheCollection).forEach((function(e){return e.reset()})),this.cacheCollection={},this._requesterCollection={}}},{key:"maxSupportVersion",get:function(){return this._maxSupportVersion}},{key:"useServerCalc",get:function(){return this._useServerCalc},set:function(e){this._useServerCalc=e}}]),e}(),Ce=(new ye,function(e,t){return""!==e?e+R.ar+t:t}),Se=function(e,t,n){var r={pivotCacheFieldId:e.cacheFieldId,fieldName:e.fieldName,cacheFieldName:e.sourceName,isRow:n,isDim:t};return r.filterInfo=e.filterInfo,t&&(r.sortInfo=e.sortInfo),r},ke=function(e){var t,n=e.dim,r=n.row,o=n.col,i=n.hide,a=n.page,s=[],l=P(r);try{for(l.s();!(t=l.n()).done;){var u=t.value;s.push(Se(u,!0,!0))}}catch(e){l.e(e)}finally{l.f()}var c,h=P(o);try{for(h.s();!(c=h.n()).done;){var d=c.value;s.push(Se(d,!0,!1))}}catch(e){h.e(e)}finally{h.f()}var f,v=P(i.concat(a));try{for(v.s();!(f=v.n()).done;){var p=f.value;s.push(Se(p,!1,!1))}}catch(e){v.e(e)}finally{v.f()}return s},Ee=function(e){var t,n=[],r=P(e.measure);try{for(r.s();!(t=r.n()).done;){var o,i=t.value,a=i.showDataAsInfo,s=i.cacheFieldId,l=i.summaryMode;l===R.t3.Formula?n.push({pivotCacheFieldId:s,summaryMode:l,formulaSummaryType:i.formulaSummaryType,showDataAsInfo:i.showDataAsInfo}):n.push({pivotCacheFieldId:s,summaryMode:null!==(o=l)&&void 0!==o?o:R.t3.Normal,summaryType:i.summaryType,showDataAsInfo:a})}}catch(e){r.e(e)}finally{r.f()}return n};function Te(e,t){return t.filter((function(e){return"normal"===e.type})).map((function(t,n){return{fieldName:t.fieldName,dataType:t.dataType,id:t.id,displayName:t.displayName,format:e[n]}}))}var be=function(e,t){return e.getDataSourceInfo(t)},Ie=function(e,t,n){var r=Fe(e,t,n);n.setCacheForService(r.getCacheName(),e);var o=r.toDimQuery(),i=r.toMeasureQuery(),a=function(e,t,n){var r,o=t.getFormulaService(),i={},a=e.getNormalFieldDisplayNameList(),s=e._name,l=P(n);try{for(l.s();!(r=l.n()).done;){var u=r.value;if(u.summaryMode===R.t3.Formula){var c,h,d=null===(c=e.getCacheFieldByName(u.sourceName))||void 0===c||null===(h=c.getCalculateFieldInfo())||void 0===h?void 0:h.formula;o.initFormula(s,u.sourceName,d,a),i[u.sourceName]=o.getRefList(s,u.sourceName)}}}catch(e){l.e(e)}finally{l.f()}return i}(e,n,r.valueFields);return new R.mx(e,o,i,a,(0,R.EC)(n.getFormatterService()))},Re=function(e,t,n,r,o){var i=t.toDimQuery(),a=t.toMeasureQuery(),s=t.hiddenTotalInfo,l=t.valueFields.concat(),u=t.rowFields.length,c=t.colFields.length,h=t._host,d=h.getName(),f=h.service,v=f.getFormulaService(),p=new ve(e,i,s,l,r);p.getFormulaValue=function(e,r){if(!f.getCacheByName(t._cacheName).getCalculateCacheFieldByName(e)||!v)return{errorCode:-1,value:o||""};try{var i=v.getValue(d,e,r);if(i.isError){var a=i.value,s=i.errorCode,l=i.errorInfoArgs;return void 0===l?{value:a,errorCode:s}:{value:a,errorCode:s,errorInfoArgsId:n.getFormulaErrorInfoArgsId(l)}}return i.value}catch(e){return{errorCode:-1,value:o||""}}};var g=p.buildNode(),m=g.rowRootNode,_=g.colRootNode;p.reduceRowNode(m,[]),p.reduceColNode(_,[]),t.colFields.length>0&&0===t.rowFields.length&&z(t._broadcaster,(function(){t.updateValuePosition(0,0)}));var y=t._isValueDimInRow(),C=t._isValueDimInCol(),S=t.valueIndex;return p.buildSizeForTabular(m,y?S:-1,u,y?a.length:1,p._rowHiddenSubtotalInfo,t.collapseInfo,!0,[]),p.buildSizeForTabular(_,C?S:-1,c,C?a.length:1,p._colHiddenSubtotalInfo,t.collapseInfo,!1,[]),p.handleSort(),(new _e).render(n,t,p),p};function we(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=t.getFieldByName(n),i=null==o?void 0:o.getFormat();return i||r?i:null==e?void 0:e.getFieldFormat(null==o?void 0:o.sourceName)}function Ae(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o={},i=t.pageFields,a=t.rowFields,s=t.colFields,l=t.valueFields,u=i.concat(a,s,l),c=P(u);try{for(c.s();!(n=c.n()).done;){var h=n.value,d=h.fieldName,f=we(e,t,d,r);null!=f&&(o[d]=f)}}catch(e){c.e(e)}finally{c.f()}return o}var Fe=function(e,t,n){var r=t.fields,o=t.cacheName,i=new $({service:n,getName:function(){return o}},"");return i.fromJSON(r),i.clone(e)},De=function(e,t,n,r){var o=Fe(e,n,r);r.setCacheForService(o.getCacheName(),e);var i=new xe,a=o.createFieldDateGroupMap();i.setGroupMap(a),Re(t,o,i,{emptyValueShowAs:n.emptyValueShowAs,errorValueShowAs:n.errorValueShowAs},n.errorFormulaCalcShowAs||"#REF!");var s=Ae(e,o);return i.setFormatMap(s),delete o._host,i};var Ne,Pe=function(e){for(var t=e[0]||U,n=1;n<e.length;n++){var r=""===e[n]?U:e[n];""!==t?t+=R.ar+r:t=r}return t},Oe=function(e){switch(e){case R.wl.sum:return"".concat(D("CreationDoc_Sheets_PivotTable_SumItem"),":");case R.wl.average:return"".concat(D("CreationDoc_Sheets_PivotTable_AverageItem"),":");case R.wl.count:return"".concat(D("CreationDoc_Sheets_PivotTable_CountItem"),":");case R.wl.countNums:return"".concat(D("CreationDoc_Sheets_PivotTable_CountNumbersItem"),":");case R.wl.max:return"".concat(D("CreationDoc_Sheets_PivotTable_MaximumItem"),":");case R.wl.min:return"".concat(D("CreationDoc_Sheets_PivotTable_MinimumItem"),":");case R.wl.product:return"".concat(D("CreationDoc_Sheets_PivotTable_ChengjiItem"),":");case R.wl.stdDev:return"".concat(D("CreationDoc_Sheets_PivotTable_BiaoZhunPianChaItem"),":");case R.wl.stdDevp:return"".concat(D("CreationDoc_Sheets_PivotTable_ZongTiBiaoZhunPianChaItem"),":");case R.wl.var:return"".concat(D("CreationDoc_Sheets_PivotTable_FangChaItem"),":");case R.wl.varp:return"".concat(D("CreationDoc_Sheets_PivotTable_ZongTiFangChaItem"),":");case R.wl.distinct:return"".concat(D("LarkCCM_Sheets_PivotTable_DistinctCount"),":");case R.wl.mid:return"".concat(D("LarkCCM_Sheets_PivotTable_Median_Dropdown"),":");default:return"".concat(D("CreationDoc_Sheets_PivotTable_CountItem"),":")}},Me=function(e,t){var n=Oe(t);return e.split(n)},Le=[14,13],xe=function(){function e(){(0,E.Z)(this,e),this.page={dataTable:{},range:{rowCount:-1,colCount:-1}},this.corner={dataTable:{}},this.row={dataTable:{},_pathMap:{},range:{rowCount:-1,colCount:-1},pivotInfos:[]},this.col={dataTable:{},_pathMap:{},range:{rowCount:-1,colCount:-1},pivotInfos:[]},this.value={dataTable:{}},this.valueFieldInfos=[],this.formatMap={},this.size=0,this.version=Math.random(),this.errorInfoArgsMap={},this.errorInfoArgsList=[]}return(0,T.Z)(e,[{key:"setGroupMap",value:function(e){this.groupMap=e}},{key:"getCellInfoFromArea",value:function(e,t,n){return e&&e[t]&&e[t][n]}},{key:"getPositionAreaInfo",value:function(e,t){var n=this.row,r=this.col,o=r.range.rowCount,i=n.range.rowCount+o,a=n.range.colCount,s=a+r.range.colCount;return e<o&&t<a&&e>=0&&t>=0?{areaType:"corner",offsetRow:e,offsetCol:t}:e<o&&t>=a?{areaType:"colDim",offsetRow:e,offsetCol:t-a}:e>=o&&t<a?{areaType:"rowDim",offsetRow:e-o,offsetCol:t}:e>=o&&t>=a&&e<=i&&t<=s?{areaType:"value",offsetRow:e-o,offsetCol:t-a}:{areaType:"none",offsetRow:e,offsetCol:t}}},{key:"getCellData",value:function(e,t){var n=this.row,r=this.col,o=this.corner,i=this.value,a=r.range.rowCount,s=n.range.rowCount+a,l=n.range.colCount,u=l+r.range.colCount;return e<a&&t<l&&e>=0&&t>=0?this.getCellInfoFromArea(o.dataTable,e,t):e<a&&t>=l?this.getCellInfoFromArea(r.dataTable,e,t-l):e>=a&&t<l?this.getCellInfoFromArea(n.dataTable,e-a,t):e>=a&&t>=l&&e<=s&&t<=u?this.getCellInfoFromArea(i.dataTable,e-a,t-l):void 0}},{key:"getPageCellData",value:function(e,t){var n=this.page,r=n.dataTable,o=n.range,i=o.rowCount,a=o.colCount;if(e>=0&&e<=i&&t>=0&&t<=a)return this.getCellInfoFromArea(r,e,t)}},{key:"setValueFieldInfos",value:function(e){this.valueFieldInfos=e.map((function(e){e.showDataAsInfo;return(0,g.Z)(e,N)}))}},{key:"setValue",value:function(e,t,n,r,o,i){var a=e.dataTable;if(void 0===a[t]&&(a[t]={}),void 0===a[t][n]&&(a[t][n]={}),void 0!==o||void 0!==i)if((0,R.yD)(r))void 0!==o&&(r.type=o),void 0!==i&&(r.keyType=i);else{var s=r;r={type:o,keyType:i},void 0!==s&&(r.text=s)}a[t][n].value=r,this.size+=150}},{key:"setCellStyleType",value:function(e,t,n,r){var o=e.dataTable;void 0===o[t]&&(o[t]={}),void 0===o[t][n]&&(o[t][n]={}),o[t][n].styleType=r}},{key:"setButtonState",value:function(e,t,n,r){e.dataTable[t][n].buttonState=r}},{key:"setPivotInfo",value:function(e,t,n){void 0===n.valueFieldName&&delete n.valueFieldName,e.pivotInfos[t]=n,e._pathMap[n.path]=t}},{key:"destroy",value:function(){delete this.page,delete this.corner,delete this.row,delete this.col,delete this.value,delete this.formatMap,delete this.valueFieldInfos}},{key:"toJSON",value:function(){var e=function(e){return{dataTable:Object.keys(e.dataTable).reduce((function(t,n){return t[n]=Object.keys(e.dataTable[n]).reduce((function(t,r){return t[r]=Object.assign(e.dataTable[n][r]),"object"==(0,b.Z)(e.dataTable[n][r].value)&&(t[r].value=Object.assign(e.dataTable[n][r].value)),t}),{}),t}),{})}},t=function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(t){var n=e(t);return n.range=Object.assign(t.range),n})),n=function(e){var n=t(e);return n.pivotInfos=e.pivotInfos.map((function(e){var t=Object.assign(e);return t.fieldName=Object.assign(e.fieldName),t.items=Object.assign(e.items),t.types=Object.assign(e.types),e.rowPathIndexMap&&(t.rowPathIndexMap=Object.assign(e.rowPathIndexMap)),t})),n._pathMap=Object.assign(e._pathMap),e.colHeaderRowMap&&(n.colHeaderRowMap=Object.assign(e.colHeaderRowMap)),e.colHeaderRowMap&&(n.colHeaderRowMap=Object.assign(e.colHeaderRowMap)),n};return{page:t(this.page),corner:e(this.corner),row:n(this.row),col:n(this.col),value:e(this.value),valueFieldInfos:this.valueFieldInfos.map((function(e){return Object.assign(e)})),formatMap:Object.assign(this.formatMap),groupMap:this.groupMap?Object.assign(this.groupMap):{},errorInfoArgsMap:this.errorInfoArgsMap?Object.assign(this.errorInfoArgsMap):{},errorInfoArgsList:this.errorInfoArgsList?Object.assign(this.errorInfoArgsList):[]}}},{key:"fromJSON",value:function(e){var t=e.page,n=e.corner,r=e.row,o=e.col,i=e.value,a=e.valueFieldInfos,s=e.formatMap,l=e.groupMap,u=e.errorInfoArgsMap,c=e.errorInfoArgsList;this.page=t,this.corner=n,this.row=r,this.col=o,this.value=i,this.valueFieldInfos=a||[],this.formatMap=s||{},this.groupMap=l||{},this.errorInfoArgsMap=u||{},this.errorInfoArgsList=c||[]}},{key:"reset",value:function(){this.page={dataTable:{},range:{rowCount:-1,colCount:-1}},this.corner={dataTable:{}},this.row={dataTable:{},_pathMap:{},range:{rowCount:-1,colCount:-1},pivotInfos:[]},this.col={dataTable:{},_pathMap:{},range:{rowCount:-1,colCount:-1},pivotInfos:[]},this.value={dataTable:{}},this.formatMap={},this.valueFieldInfos=[]}},{key:"getRangeSize",value:function(){var e=this.page,t=this.col,n=this.row,r=n.range.rowCount+t.range.rowCount,o=n.range.colCount+t.range.colCount,i=null;-1!==e.range.rowCount&&-1!==e.range.colCount&&(i=e.range);var a=null;return r>0&&o>0&&(a={rowCount:r,colCount:o}),{page:i,content:a}}},{key:"getCellValue",value:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=null===(n=this.getCellData(e,t))||void 0===n?void 0:n.value;return void 0===o?r:o}},{key:"getPageCellValue",value:function(e,t){var n;return null===(n=this.getPageCellData(e,t))||void 0===n?void 0:n.value}},{key:"getCellInfo",value:function(e,t,n){var r,o=this,i=o.getPositionAreaInfo(e,t),a=i.areaType,s=i.offsetRow,l=i.offsetCol;switch(a){case"corner":r=function(e,t,n){var r,o=e.corner.dataTable,i=e.getCellInfoFromArea(o,t,n),a=null==i?void 0:i.value;return r=null!==a&&"object"==(0,b.Z)(a)?a.text:a,Object.assign({styleType:1},i,{areaType:"corner",fieldName:r})}(o,s,l);break;case"colDim":r=function(e,t,n,r){var o=e.col,i=o.dataTable,a=o.pivotInfos,s=e.getCellInfoFromArea(i,n,r),l=null!=s&&s.styleType||n?7:8;if(!a[r])return{areaType:"none"};var u=a[r],c=u.isBlankRow,h=u.isSubTotal,d=u.isTopSubTotal,f=u.level,v=u.items,p=u.valueFieldName,g=u.fieldName,m=u.types,_=g[t-1];if(!_){var y=null==s?void 0:s.value;_="object"==(0,b.Z)(y)?y.text:y}return Object.assign({},s,{styleType:l,areaType:"colDim",fieldName:_,fieldNameList:g,isBlankCol:c,isSubTotal:h,isTopSubTotal:d,level:f,items:v,types:m,measureFieldName:p})}(o,e,s,l);break;case"rowDim":r=function(e,t,n,r){var o=e.row,i=o.dataTable,a=o.pivotInfos,s=e.getCellInfoFromArea(i,n,r);if(!a[n])return{areaType:"none"};var l=a[n],u=l.isBlankRow,c=l.isSubTotal,h=l.isTopSubTotal,d=l.level,f=l.items,v=l.valueFieldName,p=l.fieldName,g=l.types,m=p[t];return void 0===m&&0===p.length&&(m=v),Object.assign({styleType:3},s,{areaType:"rowDim",fieldName:m,fieldNameList:p,isBlankRow:u,isSubTotal:c,isTopSubTotal:h,level:d,items:f,types:g,measureFieldName:v})}(o,t,s,l);break;case"value":var u=null==n?void 0:n._isValueDimInRow();r=function(e,t,n,r,o){var i=e.row,a=e.col,s=e.value,l=i.pivotInfos,u=a.pivotInfos,c=s.dataTable,h=e.getCellInfoFromArea(c,n,r);if(!l[n]||!u[r])return{areaType:"none"};var d=l[n],f=d.items,v=d.isSubTotal,p=d.isBlankRow,g=d.valueFieldName,m=d.isTopSubTotal,_=d.level,y=d.fieldName,C=d.types,S=u[r],k=S.items,E=S.isSubTotal,T=S.isBlankRow,b=S.valueFieldName,I=S.isTopSubTotal,R=S.level,w=S.fieldName,A=S.types,F=o?g:b;!F&&t[0]&&(F=t[0].fieldName);var D,N="value";return v&&E?N="total":v?N="rowSummary":E&&(N="colSummary"),"total"!==N&&"rowSummary"!==N||(D=0===_?12:11),Object.assign({styleType:D},h,{rowItems:f,rowTypes:C,colItems:k,colTypes:A,areaType:N,measureFieldName:F,isBlankCol:T,isBlankRow:p,isSubTotal:v||E,isTopSubTotal:m||I,rowLevel:_,colLevel:R,rowFieldNameList:y,colFieldNameList:w})}(o,(null==n?void 0:n.valueFields)||[],s,l,u);break;default:r={areaType:"none"}}return r}},{key:"getCellStyleType",value:function(e,t){var n;return null===(n=this.getCellData(e,t))||void 0===n?void 0:n.styleType}},{key:"getCellButtonState",value:function(e,t){var n;return null===(n=this.getCellData(e,t))||void 0===n?void 0:n.buttonState}},{key:"getRepeatLabelInfo",value:function(e,t){var n,r=null===(n=this.getCellData(e,t))||void 0===n?void 0:n.styleType;return Le.includes(r)?{isRepeatLabel:!0,dim:13===r?"row":"col"}:{isRepeatLabel:!1}}},{key:"getPageCellInfo",value:function(e,t){var n=this.page,r=n.dataTable,o=n.range;if(!(e<0||t<0||e>o.rowCount||t>o.colCount)){var i,a=this.getCellInfoFromArea(r,e,t);if(1===t){var s,l=null===(s=this.getCellInfoFromArea(r,e,0))||void 0===s?void 0:s.value;return i=(0,R.yD)(l)?l.text:l,Object.assign({},a,{areaType:"page",fieldName:i})}return a&&((0,R.yD)(a.value)?i=a.value.text:void 0!==a.value&&(i=a.value)),Object.assign({},a,{areaType:"page",fieldName:i})}}},{key:"getPageCellButtonState",value:function(e,t){var n;return null===(n=this.getPageCellData(e,t))||void 0===n?void 0:n.buttonState}},{key:"getDataArray",value:function(){return{page:this.page,row:this.row,col:this.col,corner:this.corner,value:this.value}}},{key:"setFormatMap",value:function(e){this.formatMap=e,this.size+=150*Object.keys(e).length}},{key:"getFieldFormat",value:function(e){return this.formatMap[e]}},{key:"getSize",value:function(){return this.size}},{key:"getFormulaErrorInfoArgsId",value:function(e){var t=Ve(e),n=this.errorInfoArgsMap[t];if(void 0!==n)return n;var r=this.errorInfoArgsList.push(e)-1;return this.errorInfoArgsMap[t]=r,r}},{key:"getErrorInfoArgsFromId",value:function(e){return this.errorInfoArgsList[e]}}]),e}(),Ve=function(e){for(var t=[],n=Object.keys(e),r=0;r<n.length;r++){var o=n[r],i=e[o];t.push("".concat(o).concat(":").concat(i))}return t.join(";")},Ze=function(){function e(t){var n=t.cacheName,r=t.service;(0,E.Z)(this,e),this._emptyValueShowAs="",this._errorValueShowAs="Error",this._errorFormulaCalcShowAs="#REF!",this._name="",this._config={},this.service=r,this._broadcaster=new G,this._fieldsModel=new $(this,n)}return(0,T.Z)(e,[{key:"destroy",value:function(){}},{key:"getBroadcaster",value:function(){return this._broadcaster}},{key:"_getServiceRequester",value:function(){return this.service.getRequesterByName(this._name)}},{key:"setCacheName",value:function(e){this._fieldsModel._cacheName=e}},{key:"getCacheName",value:function(){return this._fieldsModel._cacheName}},{key:"setName",value:function(e){this._name=e}},{key:"getName",value:function(){return this._name}},{key:"updateCache",value:function(e,t,n,r,o,i){this._fieldsModel.updateCache(e,t,n,r,o,i)}},{key:"refreshGroup",value:function(e){this._fieldsModel.refreshGroup(e)}},{key:"refreshCalculateField",value:function(e,t){var n=this,r=this.service.getCacheByName(this.getCacheName());if(r){var o=r.getNormalFieldDisplayNameList(),i=this._name,a=e.map((function(e){var t,r=null===(t=e.calculateFieldInfo)||void 0===t?void 0:t.formula,a=n.service.getFormulaService();return r&&a&&(e.calculateFieldInfo.formula=a.decompile(i,r,o)),e}));this._fieldsModel.refreshCalculateField(a,t)}}},{key:"addField",value:function(e,t,n,r){return void 0===n&&(n=1),void 0===r&&(r=this._fieldsModel._getFieldByArea(n).length),this._fieldsModel.addField(e,t,n,r)}},{key:"setFormulaSummaryType",value:function(e,t){return this._fieldsModel.setFormulaSummaryType(e,t)}},{key:"addCalculateField",value:function(e,t,n){return void 0===n&&(n=this._fieldsModel._getFieldByArea(4).length),this._fieldsModel.addCalculateField(e,t,n)}},{key:"removeCalculateField",value:function(e){return this._fieldsModel.removeCalculateField(e)}},{key:"setCalculateCacheField",value:function(e,t){return this._fieldsModel.setCalculateCacheField(e,t)}},{key:"removeCalculateCacheField",value:function(e){return this._fieldsModel.removeCalculateCacheField(e)}},{key:"removeField",value:function(e){this._fieldsModel.removeField(e)}},{key:"getNormalCacheFieldCount",value:function(){return this._fieldsModel.getNormalCacheFieldCount()}},{key:"getCalcCacheFieldCount",value:function(){return this._fieldsModel.getCalcCacheFieldCount()}},{key:"removeAllFieldByCacheFieldId",value:function(e){this._fieldsModel.removeAllFieldByCacheFieldId(e)}},{key:"updateField",value:function(e,t,n){if(void 0===t&&(t=this._fieldsModel.getFieldArea(e)),void 0===t)throw B;void 0===n&&(n=this._fieldsModel._getFieldByArea(t).length),this._fieldsModel.moveField(e,t,n)}},{key:"setCollapse",value:function(e,t,n){this._fieldsModel.setCollapse(e,t,n)}},{key:"getCollapse",value:function(e,t){return this._fieldsModel.getCollapse(e,t)}},{key:"setHiddenTotalInfo",value:function(){var e,t=arguments.length<=0?void 0:arguments[0],n=(e=arguments.length-1)<0||arguments.length<=e?void 0:arguments[e];if("fields"!==t)"fieldDefault"!==t?this._fieldsModel.setGrandTotalHiddenInfo(t,n):this._fieldsModel.setSubTotalHiddenInfo(n);else{var r=arguments.length<=1?void 0:arguments[1];this._fieldsModel.setFieldTotalHiddenInfo(r,n)}}},{key:"getHiddenTotalInfo",value:function(e,t){return"fields"===e?this._fieldsModel.getFieldTotalHiddenInfo(t):"fieldDefault"===e?this._fieldsModel.getSubTotalHiddenInfo():this._fieldsModel.getGrandTotalHiddenInfo(e)}},{key:"setRepeatLabelInfo",value:function(){var e,t=arguments.length<=0?void 0:arguments[0],n=(e=arguments.length-1)<0||arguments.length<=e?void 0:arguments[e];if("fields"!==t)this._fieldsModel.setDimRepeatLabelInfo(t,n);else{var r=arguments.length<=1?void 0:arguments[1];this._fieldsModel.setFieldRepeatLabelInfo(r,n)}}},{key:"getRepeatLabelInfo",value:function(e,t){return"fields"===e?this._fieldsModel.getFieldRepeatLabelInfo(t):this._fieldsModel.getDimRepeatLabelInfo(e)}},{key:"updateValuePosition",value:function(e,t){this._fieldsModel.updateValuePosition(e,t)}},{key:"setSummaryType",value:function(e,t){this._fieldsModel.setSummaryType(e,t)}},{key:"setShowDataAsInfo",value:function(e,t){this._fieldsModel.setShowDataAsInfo(e,t)}},{key:"getFieldFormat",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return we(this.service.getCacheByName(this._fieldsModel._cacheName),this._fieldsModel,e,t)}},{key:"setFieldFormat",value:function(e,t){this._fieldsModel.setFieldFormat(e,t)}},{key:"getInverseArea",value:function(e){return 2===e?1:1===e?2:void 0}},{key:"getSortInfo",value:function(e){return this._fieldsModel.getSortInfo(e)}},{key:"setSortInfo",value:function(e,t){this._fieldsModel.setSortInfo(e,t)}},{key:"getFieldByArea",value:function(e){return this._fieldsModel._getFieldByArea(e)}},{key:"getFieldByName",value:function(e){return this._fieldsModel.getFieldByName(e)}},{key:"getFieldArea",value:function(e){return this._fieldsModel.getFieldArea(e)}},{key:"getViewFieldBySourceName",value:function(e,t){return this._fieldsModel.getViewFieldBySourceName(e,t)}},{key:"getViewFieldListBySourceName",value:function(e,t){return this._fieldsModel.getViewFieldListBySourceName(e,t)}},{key:"getFieldIndexByName",value:function(e){return this._fieldsModel.getFieldIndexByName(e)}},{key:"getDataSourceInfo",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._fieldsModel.getDataSourceInfo(e)}},{key:"setLabelFilter",value:function(e,t){this._fieldsModel.setLabelFilter(e,t)}},{key:"getLabelFilterInfo",value:function(e){var t=this._fieldsModel.getFieldByName(e);if(t)return t.getLabelFilter()}},{key:"getGroupRuleByFieldName",value:function(e,t){return this._fieldsModel.getGroupRuleByFieldName(e,t)}},{key:"renameField",value:function(e,t){this._fieldsModel.renameField(e,t)}},{key:"checkFieldNameExist",value:function(e,t){return this._fieldsModel.checkFieldNameExistInField(t)||this._fieldsModel.checkFieldNameExistInDataSource(e,t)}},{key:"refresh",value:function(){var e,t=this,n=this.service.useServerCalc;this.getBroadcaster().broadcastImmediate({type:"DATA_VIEW_REFRESH_START",data:{isRemote:n}});var r=new xe;if(this._version&&this._version>this.service.maxSupportVersion)return this.getBroadcaster().broadcastImmediate({type:"VERSION_TOO_HIGH",data:void 0}),r;var o=0;if(n)return null!==(e=this._getServiceRequester())&&void 0!==e&&e.updateVersion().fetchView().then((function(e){r.fromJSON(e),t.getBroadcaster().broadcastImmediate({type:"DATA_VIEW_REFRESH",data:{dataModel:r,isRemote:n,errorState:o}})})).catch((function(e){console.error("[PIVOT] server calc error!",e),t.getBroadcaster().broadcastImmediate({type:"DATA_VIEW_REFRESH_ERROR",data:{isRemote:n}})})),r;try{var i=this.service.getCacheByName(this.getCacheName()),a=Boolean(i),s=this._fieldsModel.createFieldDateGroupMap();if(r.setGroupMap(s),a){var l=this._fieldsModel.clone(i),u=l.query();Re(u,l,r,{errorValueShowAs:this._errorValueShowAs,emptyValueShowAs:this._emptyValueShowAs},this._errorFormulaCalcShowAs);var c=Ae(i,this._fieldsModel);r.setFormatMap(c),this.dirtyFieldModelCube(!1),this._fieldsModel._queryCubeCache=l._queryCubeCache,l=null}else o=1;this.getBroadcaster().broadcastImmediate({type:"DATA_VIEW_REFRESH",data:{dataModel:r,isRemote:n,errorState:o}})}catch(r){console.error("PIVOT RENDER ERROR:"+r),this.getBroadcaster().broadcastImmediate({type:"DATA_VIEW_REFRESH_ERROR",data:{isRemote:n}})}return r}},{key:"getEmptyValueShowAs",value:function(){return this._emptyValueShowAs}},{key:"getErrorValueShowAs",value:function(){return this._errorValueShowAs}},{key:"setEmptyValueShowAs",value:function(e){this._emptyValueShowAs=e}},{key:"setErrorValueShowAs",value:function(e){this._errorValueShowAs=e}},{key:"getErrorFormulaCalcShowAs",value:function(){return this._errorFormulaCalcShowAs}},{key:"setErrorFormulaCalc",value:function(e){this._errorFormulaCalcShowAs=e}},{key:"markHiddenTotalInfoEdited",value:function(){1===this._version&&(this._version=1.1)}},{key:"toJSON",value:function(){var e,t=this._fieldsModel.toJSON(),n=(null===(e=this.service.getCacheByName(this._fieldsModel._cacheName))||void 0===e?void 0:e.getDataSourceInfo(!1))||[];return{fields:t,cacheName:this._fieldsModel.getCacheName(),emptyValueShowAs:this._emptyValueShowAs,errorValueShowAs:this._errorValueShowAs,errorFormulaCalcShowAs:this._errorFormulaCalcShowAs,version:this._version,rangeId:"",config:this._config||{},cacheFieldInfo:n}}},{key:"getCacheFieldByFieldName",value:function(e){return this._fieldsModel.getCacheFieldByFieldName(e)}},{key:"getPivotCache",value:function(){var e=this.getCacheName();return this.service.getCacheByName(e)}},{key:"getDateGroupedFieldInPageRowColDim",value:function(e){return this._fieldsModel.getDateGroupedFieldInPageRowColDim(e)}},{key:"getGroupedFieldInPageRowColDim",value:function(e){return this._fieldsModel.getGroupedFieldInPageRowColDim(e)}},{key:"getAllGroupedRulesInPageRowColDim",value:function(e){return this._fieldsModel.getAllGroupedRulesInPageRowColDim(e)}},{key:"fromJSON",value:function(e,t){this._fieldsModel.fromJSON(e.fields),this._fieldsModel.refreshCalculateField(e.cacheFieldInfo,!0),this._emptyValueShowAs=e.emptyValueShowAs,this._errorValueShowAs=e.emptyValueShowAs,this._version=e.version,this._config=e.config||this._config,this.dirtyFieldModelCube(!0),this._broadcaster.resetBroadcastStatus(),this._broadcaster.broadcast({type:"FROM_JSON",data:{json:e,source:t}})}},{key:"elementGroup",value:function(e,t){0===t.groupListMap.size?this.ungroup(e):this.group(e,t)}},{key:"group",value:function(e,t){return this._fieldsModel.group(e,t)}},{key:"ungroup",value:function(e){this._fieldsModel.ungroup(e)}},{key:"renameElementGroup",value:function(e,t,n){var r=this.getGroupRuleByFieldName(e,!0);null!==r&&"element"===r.type&&((0,R.EG)(r.groupListMap,t,n),this.elementGroup(e,r))}},{key:"autoDateGroup",value:function(e){return this._fieldsModel.autoDateGroup(e)}},{key:"dirtyFieldModelCube",value:function(e){this._fieldsModel.dirtyCube(e)}},{key:"getFieldModelJSON",value:function(){return this._fieldsModel.toJSON()}},{key:"setFieldModelJSON",value:function(e){this._fieldsModel.fromJSON(e)}},{key:"getConfig",value:function(){return this._config}},{key:"getAutoFitCol",value:function(){return this._config.autoFitCol}},{key:"setAutoFitCol",value:function(e){this._config.autoFitCol=e,this._broadcaster.broadcast({type:"SET_AUTO_FIT_COL",data:{autoFitCol:e}})}}]),e}();!function(e){e[e.NEW_HIDDEN_TOTAL_INFO=1]="NEW_HIDDEN_TOTAL_INFO",e[e.NEW_HIDDEN_TOTAL_INFO_EDITED=1.1]="NEW_HIDDEN_TOTAL_INFO_EDITED",e[e.NEW_CALC_FIELD=2.1]="NEW_CALC_FIELD",e[e.LATEST=2.1]="LATEST",e[e.OLDEST=1]="OLDEST"}(Ne||(Ne={}));var Be=function e(){(0,E.Z)(this,e)}},vsh_26246:function(e,t,n){n.d(t,{lb:function(){return g},i7:function(){return v},FW:function(){return f}});var r=n("vsh_65498"),o=n("vsh_61332"),i=n.n(o),a=n("vsh_7459"),s=n("vsh_63738");function l(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var c=function(e){return e?e.formatter?e.formatter.formatCached:e.autoFormatter?e.autoFormatter.formatCached:"":""},h=function(e,t){var n,r="",o=t.attachment,i=t.mention,a=l(e);try{for(a.s();!(n=a.n()).done;){var s,u,c=n.value,h=c.type,d=c.text,f=c.id;"embed-image"===h||(r+="attachment"===h?null===(s=o[f])||void 0===s?void 0:s.text:"mention"===h?null===(u=i[f])||void 0===u?void 0:u.text:d)}}catch(e){a.e(e)}finally{a.f()}return r},d=function(e,t,n,o,i,l){var u=[],c={};if(!e||!e.rows)return{data:u,formatMap:c};for(var d=(0,s.createFormatter)(l,"yyyy/MM/dd HH:mm:ss"),f=e.rows,v=0;v<f.length;v++){var p=[];f[v]&&(p=f[v].columns);for(var g=[],m=0;m<p.length;m++){var _=p[m],y=null==_?void 0:_.value,C=!(null==_||!_.reminderId),S=y,k=null==_?void 0:_.styleId;if(void 0!==y){if(void 0===k)y instanceof Array&&(S=h(y,o));else if("number"==typeof S&&(t.has(k)||C)){var E=t.get(k);C&&!E&&(E=d),0!==v?(S=(0,a.vs)(_.value),isNaN(S.getTime())?S=y:c[m]||(c[m]=E.getFormatCode())):S=E.format(S)}else"number"==typeof S&&n.has(k)?S=n.get(k).format(S):y instanceof Array&&(S=h(y,o));var T=(0,r.Z)(S);"string"===T?S=""===S?null:S.substring(0,1e3):"boolean"===T&&(S=S?"TRUE":"FALSE"),g[Number(m)]=S}}g.length>0&&(u[Number(v)]=g)}if(u.length<i.rowCount)for(var b=u.length;b<i.rowCount;b++)u[b]=[];return{data:u,formatMap:c}},f=function(e,t,n){return 0},v=function(e,t,n,r){var o,i=new Map,a=new Map;return function(e,t,n,r){if(t)for(var o in t){var i=c(t[o]);if(i){var a=(0,s.createFormatter)(e,i);"@"===i&&r.set(Number(o),a),(0,s.isDateTimeFormatter)(a)&&n.set(Number(o),a)}}}(r.getFormatterService(),null===(o=t.entities)||void 0===o?void 0:o.styles,i,a),d(e,i,a,t,n,r.getFormatterService())},p=function e(t){return"object"!=(0,r.Z)(t)||null===t?JSON.stringify(t):Array.isArray(t)?"[".concat(t.map((function(e){return null==e?null:e})).map(e).join(","),"]"):"{".concat(Object.keys(t).filter((function(e){return void 0!==t[e]})).sort().map((function(n){return"".concat(JSON.stringify(n),":").concat(e(t[n]))})).join(","),"}")},g=function(e){var t=e.fields,n=t.dim,r=t.measure,o=n.page,a=n.hide,s=n.row,l=n.col,u=[];[o,a,s,l].forEach((function(e){e.forEach((function(e){e&&u.push(m(e))}))})),u.sort((function(e,t){return e.fieldName>t.fieldName?0:1}));var c=[];return r.forEach((function(e){e&&c.push(m(e))})),i()(p(u)+"-"+p(c))},m=function(e){var t=e.sourceName,n=e.fieldName,r=e.filterInfo,o=e.summaryType,i=e.fieldType;return{sourceName:t,fieldName:n,filterInfo:r,summaryType:o,hasArrayList:o===a.wl.distinct||o===a.wl.mid,fieldType:i}}},vsh_7459:function(e,t,n){n.d(t,{FB:function(){return qe},$w:function(){return E},VT:function(){return It},Z_:function(){return bt},ar:function(){return Re},vA:function(){return kt},_O:function(){return Tt},h:function(){return Et},SL:function(){return Ot},NM:function(){return ue},uu:function(){return ke},OQ:function(){return Se},yi:function(){return Ee},N5:function(){return he},t3:function(){return ve},l3:function(){return pe},gK:function(){return fe},Zv:function(){return ge},_h:function(){return _e},wl:function(){return de},PO:function(){return Te},mx:function(){return jt},aE:function(){return M},Dw:function(){return Xe},XE:function(){return $e},$r:function(){return st},Og:function(){return dt},EC:function(){return Ie},rH:function(){return Ft},sX:function(){return P},RZ:function(){return oe},vs:function(){return re},V8:function(){return Q},El:function(){return ut},_R:function(){return Nt},Ki:function(){return at},Zu:function(){return mt},MN:function(){return ie},WH:function(){return I},Rr:function(){return F},J_:function(){return se},JK:function(){return R},gn:function(){return b},ic:function(){return T},yD:function(){return ae},GD:function(){return N},hU:function(){return L},EG:function(){return O},kc:function(){return At},Uf:function(){return Ae}});var r,o,i=n("vsh_56589"),a=n("vsh_74561"),s=n("vsh_12064"),l=n("vsh_22462"),u=n("vsh_73455"),c=n("vsh_65498"),h=n("vsh_1139"),d=n("vsh_98652"),f=n("vsh_19264"),v=n("vsh_4175"),p=n("vsh_47246"),g=n("vsh_86670"),m=n("vsh_22485"),_=n("vsh_84784"),y=n("vsh_63738"),C=n("vsh_24627");function S(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return k(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return k(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var E=function(){function e(t){var n=this;(0,f.Z)(this,e),this._bitMap=new Map,t&&t.size&&t.forEach((function(e){return n.addDecimalNum(e)}))}return(0,v.Z)(e,[{key:"isEmpty",value:function(){return 0===this._bitMap.size}},{key:"getBitOffset",value:function(e){return this._bitMap.get(e)}},{key:"iterBitOffset",value:function(e){this._bitMap.forEach((function(t,n){return e(n,t)}))}},{key:"iterDecimalNum",value:function(e){this._bitMap.forEach((function(t,n){for(var r=0;0!==t;++r)1==(1&t)&&e(n+r),t>>>=1}))}},{key:"addDecimalNum",value:function(e){var t=e%30,n=e-t,r=1<<t;this.unionBitOffset(n,r)}},{key:"setBitOffset",value:function(e,t){this._bitMap.set(e,t)}},{key:"unionBitOffset",value:function(e,t){var n=this._bitMap.get(e);void 0!==n?this._bitMap.set(e,n|t):this._bitMap.set(e,t)}},{key:"intersectBitOffset",value:function(e,t){var n=this._bitMap.get(e);void 0!==n&&(0===(n&=t)?this._bitMap.delete(e):this._bitMap.set(e,n))}},{key:"union",value:function(e){e.iterBitOffset(this.unionBitOffset.bind(this))}},{key:"intersect",value:function(e){var t=this;e.isEmpty()&&(this._bitMap=new Map),this.iterBitOffset((function(n){var r=e.getBitOffset(n);void 0!==r?t.intersectBitOffset(n,r):t._bitMap.delete(n)}))}},{key:"clone",value:function(){var t=new e;return this.iterBitOffset(t.setBitOffset.bind(t)),t}},{key:"toArray",value:function(){var e=[];return this.iterDecimalNum((function(t){return e.push(t)})),e}},{key:"toJSON",value:function(){return(0,d.Z)(this._bitMap)}},{key:"fromJSON",value:function(e){this._bitMap=new Map(e)}}]),e}();function T(e){return"normal"===e.getType()}function b(e){return"grouped"===e.getType()}function I(e){return"calculate"===e.getType()}var R=function(e){return b(e)&&"date"===e.getGroupRule().type};function w(e){if("element"===e.type){var t=new Map(e.groupListMap.map((function(e){var t=(0,h.Z)(e,2);return[t[0],t[1].map((function(e){switch(e.type){case 1:case 0:case 4:return e.value;default:return new Date(e.value)}}))]})));return Object.assign({},e,{groupListMap:t})}return e}function A(e){if("element"===e.type){var t=Array.from(e.groupListMap).map((function(e){var t=(0,h.Z)(e,2);return[t[0],t[1].map((function(e){switch((0,c.Z)(e)){case"string":return{type:1,value:e};case"number":return{type:0,value:e};case"boolean":return{type:4,value:e};default:return{type:2,value:e.toISOString()}}}))]}));return Object.assign({},e,{groupListMap:t})}return e}function F(e,t){var n,r=S(t.groupListMap);try{for(r.s();!(n=r.n()).done;){var o,i=S((0,h.Z)(n.value,2)[1]);try{for(i.s();!(o=i.n()).done;){if(ct(e,o.value))return!0}}catch(e){i.e(e)}finally{i.f()}}}catch(e){r.e(e)}finally{r.f()}return!1}function D(e,t,n){switch((0,c.Z)(t)){case"string":case"number":case"boolean":return void e.add(t);default:var r,o=S(n);try{for(o.s();!(r=o.n()).done;){if(ft(r.value,t))return}}catch(e){o.e(e)}finally{o.f()}return n.push(t),void e.add(t)}}function N(e,t,n){if(!(t.length<=1)){var r,o=new Set,i=[],a=S(t);try{for(a.s();!(r=a.n()).done;){var s=r.value;if(D(o,s,i),"string"==typeof s){var l=e.get(s);if(l){var u,c=S(l);try{for(c.s();!(u=c.n()).done;){D(o,u.value,i)}}catch(e){c.e(e)}finally{c.f()}}e.delete(s)}}}catch(e){a.e(e)}finally{a.f()}var h=n(t[0]);e.set(h,Array.from(o))}}function P(e,t){var n,r=S(t);try{for(r.s();!(n=r.n()).done;){var o=n.value;e.delete(o)}}catch(e){r.e(e)}finally{r.f()}}function O(e,t,n){if(t!==n){var r=new Set,o=[],i=e.get(n);if(i){var a,s=S(i);try{for(s.s();!(a=s.n()).done;){D(r,a.value,o)}}catch(e){s.e(e)}finally{s.f()}}var l=null;if("string"==typeof t&&(l=e.get(t)||null,e.delete(t)),l){var u,c=S(l);try{for(c.s();!(u=c.n()).done;){D(r,u.value,o)}}catch(e){c.e(e)}finally{c.f()}}else D(r,t,o);e.set(n,Array.from(r))}}function M(e,t,n){if(!(t.length<=1)){var r,o=new Set,i=[],a=S(t);try{for(a.s();!(r=a.n()).done;){D(o,r.value,i)}}catch(e){a.e(e)}finally{a.f()}var s=Array.from(o);L(e,s,n);var l=x(s,n),u=e.get(l);if(u){var c,h=S(u);try{for(h.s();!(c=h.n()).done;){D(o,c.value,i)}}catch(e){h.e(e)}finally{h.f()}s=Array.from(o)}e.set(l,s)}}function L(e,t,n){if(0!==t.length){var r,o=new Set,i=new Set,a=new Set,s=[],l=S(t);try{for(l.s();!(r=l.n()).done;){var u=r.value;switch((0,c.Z)(u)){case"string":o.add(u);break;case"number":i.add(u);break;case"boolean":a.add(u);break;default:s.push(u)}}}catch(e){l.e(e)}finally{l.f()}var d,f=new Map,v=S(e);try{for(v.s();!(d=v.n()).done;){var p=(0,h.Z)(d.value,2),g=p[0],m=p[1],_=!1,y=m.filter((function(e){var t=!1;switch((0,c.Z)(e)){case"string":t=o.has(e);break;case"number":t=i.has(e);break;case"boolean":t=a.has(e);break;default:var n,r=S(s);try{for(r.s();!(n=r.n()).done;){if(ft(n.value,e)){t=!0;break}}}catch(e){r.e(e)}finally{r.f()}}return t&&(_=!0),!t}));if(_)if(y.length>0){if(e.set(g,y),x(m,n)===g){var C=x(y,n);g!==C&&f.set(g,C)}}else e.delete(g)}}catch(e){v.e(e)}finally{v.f()}var k,E=S(f);try{for(E.s();!(k=E.n()).done;){var T=(0,h.Z)(k.value,2);O(e,T[0],T[1])}}catch(e){E.e(e)}finally{E.f()}}}function x(e,t){var n=e.slice(0,3).map((function(e){return t(e)})).join(", ");return e.length>3&&(n+=", ..."),n}function V(e){return String(e)}function Z(e){return String(e)}function B(e,t){return"".concat(e<10?"0"+String(e):String(e),":").concat(t<10?"0"+String(t):String(t))}function H(e){return String(e)}function U(e,t){return e("CreationDoc_Sheets_PivotTable_XMonth",t)}function j(e,t,n){return e("CreationDoc_Sheets_PivotTable_XMonthYDay",t,n)}function G(e){return"Q".concat(e)}function K(e){return String(e)}function W(e,t,n){return e("CreationDoc_Sheets_PivotTable_XYearYMonth",t,n)}function z(e,t){return"".concat(e,"-Q").concat(t)}function Y(e,t,n){return"".concat(e,"-").concat(t,"-").concat(n)}function J(e,t){return(0,g.round)(e,t)}function q(e,t){return"< ".concat(J(e,t))}function $(e,t){return"> ".concat(J(e,t))}function X(e,t,n){return"".concat(J(e,n)," - ").concat(J(t,n))}function Q(e,t){return e("CreationDoc_Sheets_PivotTable_ColumnName",t)}var ee=function(e){function t(){return(0,f.Z)(this,t),(0,s.Z)(this,(0,l.Z)(t).apply(this,arguments))}return(0,u.Z)(t,e),(0,v.Z)(t,[{key:"setValue",value:function(e){this.value=e,this.compareValue=void 0}},{key:"clone",value:function(){return new t(this.value)}}]),t}(m.NumberVar),te=new(function(){function e(){(0,f.Z)(this,e),this.lOperand=new ee(0),this.rOperand=new ee(0)}return(0,v.Z)(e,[{key:"equals",value:function(e,t){return this.lOperand.getValue()!==e&&this.lOperand.setValue(e),this.rOperand.getValue()!==t&&this.rOperand.setValue(t),this.lOperand.equals(this.rOperand)}},{key:"doubleEqual",value:function(e,t){return m.NumberVar.doubleEqual(e,t)}},{key:"greaterThan",value:function(e,t){return this.lOperand.getValue()!==e&&this.lOperand.setValue(e),this.rOperand.getValue()!==t&&this.rOperand.setValue(t),this.lOperand.greaterThan(this.rOperand)}},{key:"lessThan",value:function(e,t){return this.lOperand.getValue()!==e&&this.lOperand.setValue(e),this.rOperand.getValue()!==t&&this.rOperand.setValue(t),this.lOperand.lessThan(this.rOperand)}},{key:"greaterThanEquals",value:function(e,t){return this.lOperand.getValue()!==e&&this.lOperand.setValue(e),this.rOperand.getValue()!==t&&this.rOperand.setValue(t),this.lOperand.greaterThanEquals(this.rOperand)}},{key:"lessThanEquals",value:function(e,t){return this.lOperand.getValue()!==e&&this.lOperand.setValue(e),this.rOperand.getValue()!==t&&this.rOperand.setValue(t),this.lOperand.lessThanEquals(this.rOperand)}}]),e}());function ne(e){var t;return"number"==typeof e?e:"boolean"==typeof e?e?1:0:e instanceof Date?_.SheetDate.fromUTCDate(e).toNumber():null!==(t=(0,m.parseNumber)(e))&&void 0!==t?t:NaN}function re(e){return e instanceof Date?e:_.SheetDate.fromNumber(ne(e)).getUTCDate()}function oe(e,t,n){var r=e.getFormatter(n);if(t instanceof Date){var o=_.SheetDate.fromUTCDate(t).toNumber();return isNaN(o)?t.toString():r.format(o)}return r.format(t)}function ie(e,t,n,r){var o=function(e,t,n){var r=_.SheetDate.fromNumber(ne(t));if(r.milliseconds>=500){var o=e.getFormatter(n).getFormatters().some((function(e){return e.getFormatRules().hasMillisecondsToken}));!o&&r.setDateTime({seconds:r.seconds+1})}return r}(e,n);switch(r){case"minute":var i=o.minutes;return{cellValue:V(i),sortPriority:i,originCellValue:n,isDateGroupItem:!0};case"hour":var a=o.hours;return{cellValue:Z(a),sortPriority:a,originCellValue:n,isDateGroupItem:!0};case"hourMinute":var s=o.hours,l=o.minutes;return{cellValue:B(s,l),sortPriority:100*s+l,originCellValue:n,isDateGroupItem:!0};case"date":var u=o.date;return{cellValue:H(u),sortPriority:u,originCellValue:n,isDateGroupItem:!0};case"month":var c=o.month;return{cellValue:U(t,c),sortPriority:c,originCellValue:n,isDateGroupItem:!0};case"monthDate":var h=o.month,d=o.date;return{cellValue:j(t,h,d),sortPriority:100*h+d,originCellValue:n,isDateGroupItem:!0};case"quarter":var f=Math.floor(o.getUTCDate().getUTCMonth()/3)+1;return{cellValue:G(f),sortPriority:f,originCellValue:n,isDateGroupItem:!0};case"year":var v=o.year;return{cellValue:K(v),sortPriority:v,originCellValue:n,isDateGroupItem:!0};case"yearMonth":var p=o.year,g=o.month;return{cellValue:W(t,p,g),sortPriority:100*p+g,originCellValue:n,isDateGroupItem:!0};case"yearQuarter":var m=o.year,y=Math.floor(o.getUTCDate().getUTCMonth()/3)+1;return{cellValue:z(m,y),sortPriority:10*m+y,originCellValue:n,isDateGroupItem:!0};case"yearMonthDate":var C=o.year,S=o.month,k=o.date;return{cellValue:Y(C,S,k),sortPriority:100*(100*C+S)+k,originCellValue:n,isDateGroupItem:!0};default:return{cellValue:n}}}function ae(e){return"object"==(0,c.Z)(e)&&null!==e}function se(e){return ae(e)&&"[object Date]"===Object.prototype.toString.call(e)}var le,ue,ce,he,de,fe,ve,pe,ge,me,_e,ye,Ce,Se,ke,Ee,Te,be,Ie=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new y.FormatterService("zh",(function(e,t){return new y.I18NService(e,t,{currencies:Object.keys((0,C.w9Z)())})}));return{formatNumber:ne,formatText:function(t,n){return oe(e,t,n)},formatUTCDate:function(e){return re(e)}}};!function(e){e[e.seconds=0]="seconds",e[e.minutes=1]="minutes",e[e.hours=2]="hours",e[e.days=3]="days",e[e.months=4]="months",e[e.quarters=5]="quarters",e[e.years=6]="years"}(le||(le={})),function(e){e[e.number=0]="number",e[e.text=1]="text",e[e.date=2]="date",e[e.blank=3]="blank",e[e.booleanValue=4]="booleanValue"}(ue||(ue={})),function(e){e[e.row=0]="row",e[e.col=1]="col"}(ce||(ce={})),function(e){e[e.page=0]="page",e[e.row=1]="row",e[e.col=2]="col",e[e.hidden=3]="hidden",e[e.value=4]="value"}(he||(he={})),function(e){e[e.average=0]="average",e[e.count=1]="count",e[e.countNums=2]="countNums",e[e.max=3]="max",e[e.min=4]="min",e[e.product=5]="product",e[e.stdDev=6]="stdDev",e[e.stdDevp=7]="stdDevp",e[e.sum=8]="sum",e[e.var=9]="var",e[e.varp=10]="varp",e[e.distinct=11]="distinct",e[e.mid=12]="mid"}(de||(de={})),function(e){e[e.normal=0]="normal",e[e.percentOfTotal=1]="percentOfTotal",e[e.percentOfCol=2]="percentOfCol",e[e.percentOfRow=3]="percentOfRow",e[e.percent=4]="percent",e[e.percentOfParentRow=5]="percentOfParentRow",e[e.percentOfParentCol=6]="percentOfParentCol",e[e.percentOfParent=7]="percentOfParent",e[e.difference=8]="difference",e[e.percentDiff=9]="percentDiff",e[e.runTotal=10]="runTotal",e[e.percentOfRunningTotal=11]="percentOfRunningTotal",e[e.rankAscending=12]="rankAscending",e[e.rankDescending=13]="rankDescending",e[e.index=14]="index"}(fe||(fe={})),function(e){e[e.Normal=0]="Normal",e[e.Formula=1]="Formula"}(ve||(ve={})),function(e){e[e.sum=1]="sum",e[e.custom=2]="custom"}(pe||(pe={})),function(e){e.field="field",e.value="value"}(ge||(ge={})),function(e){e.normal="normal",e.rowSummary="rowSummary",e.colSummary="colSummary",e.total="total"}(me||(me={})),function(e){e.desc="desc",e.asc="asc",e.customSort="customSort"}(_e||(_e={})),function(e){e[e.item=0]="item",e[e.next=1]="next",e[e.before=2]="before"}(ye||(ye={})),function(e){e[e.button=0]="button",e[e.corner=1]="corner",e[e.topRight=2]="topRight"}(Ce||(Ce={})),function(e){e[e.caption=0]="caption",e[e.date=1]="date",e[e.number=2]="number",e[e.relation=3]="relation"}(Se||(Se={})),function(e){e[e.equal=0]="equal",e[e.notEqual=1]="notEqual",e[e.beginsWith=2]="beginsWith",e[e.notBeginsWith=3]="notBeginsWith",e[e.endsWith=4]="endsWith",e[e.notEndsWith=5]="notEndsWith",e[e.contains=6]="contains",e[e.notContains=7]="notContains",e[e.empty=8]="empty",e[e.notEmpty=9]="notEmpty"}(ke||(ke={})),function(e){e[e.equal=0]="equal",e[e.notEqual=1]="notEqual",e[e.earlierThan=2]="earlierThan",e[e.earlierThanOrEqual=3]="earlierThanOrEqual",e[e.laterThan=4]="laterThan",e[e.laterThanOrEqual=5]="laterThanOrEqual",e[e.between=6]="between",e[e.notBetween=7]="notBetween",e[e.tomorrow=8]="tomorrow",e[e.today=9]="today",e[e.yesterday=10]="yesterday",e[e.nextWeek=11]="nextWeek",e[e.thisWeek=12]="thisWeek",e[e.lastWeek=13]="lastWeek",e[e.nextMonth=14]="nextMonth",e[e.thisMonth=15]="thisMonth",e[e.lastMonth=16]="lastMonth",e[e.nextQuarter=17]="nextQuarter",e[e.thisQuarter=18]="thisQuarter",e[e.lastQuarter=19]="lastQuarter",e[e.nextYear=20]="nextYear",e[e.thisYear=21]="thisYear",e[e.lastYear=22]="lastYear",e[e.yearToDate=23]="yearToDate",e[e.quarter=24]="quarter",e[e.month=25]="month"}(Ee||(Ee={})),function(e){e[e.equal=0]="equal",e[e.notEqual=1]="notEqual",e[e.greaterThan=2]="greaterThan",e[e.greaterThanOrEqual=3]="greaterThanOrEqual",e[e.lessThan=4]="lessThan",e[e.lessThanOrEqual=5]="lessThanOrEqual",e[e.between=6]="between",e[e.notBetween=7]="notBetween",e[e.empty=8]="empty",e[e.notEmpty=9]="notEmpty",e[e.count=10]="count",e[e.percent=11]="percent",e[e.sum=12]="sum"}(Te||(Te={})),function(e){e[e.and=0]="and",e[e.or=1]="or",e[e.not=2]="not"}(be||(be={}));var Re="-&-",we="-|-",Ae=function(e){return e[0]<e[1]?e:[e[1],e[0]]},Fe=function(e,t,n){return new RegExp(t+De(e)+n)},De=function(e){return e.replace(/[|\\{}()[\]^$+.]/g,"\\$&").replace(/~~|~\?|~\*|\?|\*/g,(function(e){switch(e){case"~~":return"~";case"~?":return"\\?";case"~*":return"\\*";case"?":return".";case"*":return"[\\s\\S]*";default:return e}}))},Ne=function(e){var t=new Date(e);return t.setMinutes(t.getMinutes()+t.getTimezoneOffset()),t},Pe=function(e){return e.setMinutes(e.getMinutes()+e.getTimezoneOffset()),e},Oe=864e5,Me=function(e){return e.setHours(0,0,0,0),function(e){return e.getTime()-60*e.getTimezoneOffset()*1e3}(e)},Le=function(e){var t=e.getDay(),n=0===t?6:t-1;return e.setDate(e.getDate()-n),Me(e)},xe=function(e){return e.setDate(1),Me(e)},Ve=function(e){var t=e.getMonth(),n=3*Math.floor(t/3);return e.setMonth(n,1),xe(e)},Ze=function(e){return e.setMonth(0,1),xe(e)},Be=function(e,t){return e.setMonth(e.getMonth()+t,15),e},He=function(e,t){return Be(e,3*t)},Ue=function(e,t){return e.setFullYear(e.getFullYear()+t,e.getMonth(),15),e},je=-1,Ge=1,Ke=0,We=function(e,t){return e===t?Ke:e<t?je:Ge},ze=function(e,t){return e===t?Ke:t<e?je:Ge},Ye=function(e,t,n){var r=[e[n],e[t]];e[t]=r[0],e[n]=r[1]},Je=function(){function e(t){(0,f.Z)(this,e),this.compareFn="max"===t?ze:We,this.heap=[],this.sum=0}return(0,v.Z)(e,[{key:"getLeftIndex",value:function(e){return 2*e+1}},{key:"getRightIndex",value:function(e){return 2*e+2}},{key:"getParentIndex",value:function(e){if(0===e)return Math.floor((e-1)/2)}},{key:"size",value:function(){return this.heap.length}},{key:"isEmpty",value:function(){return this.size()<=0}},{key:"clear",value:function(){this.heap=[]}},{key:"insert",value:function(e){if(null!=e){var t=this.heap.length;return this.heap.push(e),this.siftUp(t),this.sum+=e,!0}return!1}},{key:"siftDown",value:function(e){var t=e,n=this.getLeftIndex(e),r=this.getRightIndex(e),o=this.size();n<o&&this.compareFn(this.heap[t],this.heap[n])===Ge&&(t=n),r<o&&this.compareFn(this.heap[t],this.heap[r])===Ge&&(t=r),e!==t&&(Ye(this.heap,e,t),this.siftDown(t))}},{key:"siftUp",value:function(e){for(var t=this.getParentIndex(e);e>0&&this.compareFn(this.heap[t],this.heap[e])===Ge;)Ye(this.heap,t,e),e=t,t=this.getParentIndex(e)}},{key:"extract",value:function(){if(!this.isEmpty()){if(1===this.size()){var e=this.heap.shift();return this.sum-=e,e}var t=this.heap[0];return this.heap[0]=this.heap.pop(),this.siftDown(0),this.sum-=t,t}}},{key:"getAsArray",value:function(){return this.heap}}]),e}(),qe=function(){function e(){(0,f.Z)(this,e)}return(0,v.Z)(e,null,[{key:"add",value:function(e,t){return e+t}},{key:"minus",value:function(e,t){return e-t}},{key:"multiply",value:function(e,t){return e*t}},{key:"divide",value:function(e,t){return e/t}},{key:"sqrt",value:function(e){return Math.sqrt(e)}}]),e}(),$e=function(e,t){var n,r={},o=S(t);try{for(o.s();!(n=o.n()).done;){var i=n.value;void 0!==i&&(r[i]=et[i](e))}}catch(e){o.e(e)}finally{o.f()}return r},Xe=function(e,t,n){var r,o={},i=S(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;void 0!==a&&(o[a]=Qe[a](e,t))}}catch(e){i.e(e)}finally{i.f()}return o},Qe=(r={},(0,a.Z)(r,pe.sum,(function(e,t){return e(t.sum)})),(0,a.Z)(r,pe.custom,(function(e,t){return e(t.custom)})),r),et=(o={},(0,a.Z)(o,de.sum,(function(e){return e.sum})),(0,a.Z)(o,de.average,(function(e){var t=e.sum,n=e.countNums;return qe.divide(t,n)})),(0,a.Z)(o,de.product,(function(e){return e.product})),(0,a.Z)(o,de.countNums,(function(e){return e.countNums})),(0,a.Z)(o,de.count,(function(e){return e.count})),(0,a.Z)(o,de.max,(function(e){return e.max})),(0,a.Z)(o,de.min,(function(e){return e.min})),(0,a.Z)(o,de.stdDev,(function(e){var t=e.countNums,n=e.sumx2,r=e.sum;return qe.sqrt(Math.max(0,qe.divide(qe.minus(qe.multiply(t,n),qe.multiply(r,r)),qe.multiply(t,t-1))))})),(0,a.Z)(o,de.stdDevp,(function(e){var t=e.countNums,n=e.sumx2,r=e.sum;return qe.sqrt(Math.max(0,qe.divide(qe.minus(qe.multiply(t,n),qe.multiply(r,r)),qe.multiply(t,t))))})),(0,a.Z)(o,de.var,(function(e){var t=e.countNums,n=e.sumx2,r=e.sum;return Math.max(0,qe.divide(qe.minus(qe.multiply(t,n),qe.multiply(r,r)),qe.multiply(t,t-1)))})),(0,a.Z)(o,de.varp,(function(e){var t=e.countNums,n=e.sumx2,r=e.sum;return Math.max(0,qe.divide(qe.minus(qe.multiply(t,n),qe.multiply(r,r)),qe.multiply(t,t)))})),(0,a.Z)(o,de.distinct,(function(e){var t=e.dis;return t?Object.keys(t).length:0})),(0,a.Z)(o,de.mid,(function(e){var t=e.mid;return t?tt(t):void 0})),o),tt=function(e){e.sort((function(e,t){return e-t}));var t=Math.floor(e.length/2)-1;return e.length%2==0?(e[t]+e[t+1])/2:e[t+1]},nt=function(e,t,n,r){var o={};if(void 0!==t&&null!==e&&(o[t]=t),null===e)return{sum:0,count:0,countNums:0,sumx2:0,product:1,max:-1/0,min:1/0,dis:n?o:null,mid:r?[]:null};var i="number"==typeof e;return{sum:i?e:0,count:1,countNums:i?1:0,sumx2:i?qe.multiply(e,e):0,product:i?e:1,max:i?e:-1/0,min:i?e:1/0,dis:n?o:null,mid:r?i?[e]:[]:null}},rt=function(e,t,n){var r,o="number"==typeof t;o?(e.sum=qe.add(t,e.sum),e.count+=1,e.countNums+=1,e.sumx2=qe.add(qe.multiply(t,t),e.sumx2),e.max=Math.max(e.max,t),e.min=Math.min(e.min,t),e.product=qe.multiply(t,e.product)):null!==t&&(e.count+=1),null!==e.dis&&void 0!==n&&null!==t&&(e.dis[n]=n),null!==e.mid&&null!==t&&o&&(null===(r=e.mid)||void 0===r||r.push(t))},ot=function(e){for(var t={sum:{},custom:{}},n=Object.keys(e),r=0;r<n.length;r++){var o=n[r],i=e[o],a="number"==typeof i;t.sum[o]=a?i:0,t.custom[o]=[i]}return t},it=function(e,t){for(var n=Object.keys(t),r=0;r<n.length;r++){var o=n[r],i=t[o],a="number"==typeof i,s=e.sum,l=e.custom;a&&(s[o]=qe.add(i,s[o])),l[o].push(i)}},at=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return""+e};function st(e){var t=(0,c.Z)(e);return"string"===t||"number"===t?String(e):se(e)?e.toISOString():""}function lt(e){var t=(0,c.Z)(e);return"string"===t?{value:String(e),type:""===e?3:1}:"number"===t?{value:String(e),type:0}:"boolean"===t?{value:String(e),type:4}:se(e)?{value:e.toISOString(),type:2}:void 0===e||""===e||null===e?{value:"",type:3}:{value:String(e),type:1}}function ut(e,t){switch(e){case 2:return t===Number(t)+""?function(e){return new Date(Math.round(864e5*e-22091616e5))}(Number(t)):new Date(t);case 0:var n=Number(t);if(!Number.isNaN(n))return n;break;case 3:return"";case 4:return Boolean(t);case 1:return t}return t}function ct(e,t){return e===t||!(!se(e)||!se(t))&&ft(e,t)}function ht(e){if(!e)return!1;for(var t in e)return!1;return!0}function dt(e){for(var t="";e>0;){var n=e%26;0===n&&(n=26),t=(n+9).toString(36)+t,e=(e-n)/26}return t.toUpperCase()}function ft(e,t){return e.getTime()===t.getTime()}var vt=function(e){var t=e.formatUTCDate;return{2:function(e){return new Date(e)},0:t&&function(e){return t(Number(e))},1:t&&function(e){return t(e)},4:null}},pt=function(e,t){var n=e.formatText;return{2:n&&function(e){return n(new Date(e),t||"YYYY/MM/DD")},0:n&&function(e){return n(Number(e),t)},1:function(e){return e},4:null}},gt=function(e){var t=e.formatNumber;return{2:t&&function(e){return t(new Date(e))},0:function(e){return Number(e)},1:t&&function(e){return t(e)},4:null}},mt=function(e,t){for(var n=e,r=2;t(n);r++)n="".concat(e,"-").concat(r);return n},_t=function(){function e(t,n,r,o,i){var a=this;(0,f.Z)(this,e),this._indexMap=new Map,this._itemList=[],this._itemTypeList=[],this._containsDecimal=!1,this._containsDate=!1,this._containsBlank=!1,this._containsText=!1,this._containsInteger=!1,this._containsNumber=!1,this._containsBooleanValue=!1,this._minDate=null,this._maxDate=null,this._minValue=null,this._maxValue=null,this._itemListMap=new Map,this.setDataType=function(e){a._dataType=e},this.getId=function(){return a._id},this.getContainsBlank=function(){return a._containsBlank},this.setContainBlock=function(e){a._containsBlank=e},this.getContainsDecimal=function(){return a._containsDecimal},this.getType=function(){return a._type},this.getName=function(){return a._name},this.getDisplayName=function(){return a._displayName},this.setDisplayName=function(e){a._displayName=String(e)},this.getDataType=function(){return a._dataType},this._parent=o,this._type=t,this._id=i||at(n),this._name=String(n),this._displayName=String(n),this._dataType=r,this._indexMap=new Map,this._itemList=[],this._itemListMap=new Map}return(0,v.Z)(e,[{key:"getMinDate",value:function(){return this._minDate}},{key:"getMaxDate",value:function(){return this._maxDate}},{key:"getSharedIndex",value:function(e,t,n){if(2===n)return this._itemListMap.get(t.toISOString());var r=this.getKeyWithUpdateType(e).key;return this._itemListMap.get(r)}},{key:"addCellValue",value:function(e,t){var n,r=this.getKeyWithUpdateType(t),o=r.key,i=r.type,a=this._indexMap;if(void 0===a.get(o)){a.set(o,new E);var s=this._itemList.push(o);this._itemTypeList.push(i),this._itemListMap.set(o,s-1)}null===(n=a.get(o))||void 0===n||n.addDecimalNum(e)}},{key:"getKeyWithUpdateType",value:function(e){var t=(0,c.Z)(e);return void 0===e?(this._containsBlank=!0,{key:"",type:3}):"number"===t?{key:this._getNumberKeyWithUpdateType(e),type:0}:"boolean"===t?(this._containsBooleanValue=!0,{key:String(e),type:4}):"string"===t&&""!==e?(this._containsText=!0,{key:String(e),type:1}):e instanceof Date?{key:this._getDateKeyWithUpdateType(e),type:2}:{key:"",type:3}}},{key:"_getNumberKeyWithUpdateType",value:function(e){var t=Number.isInteger(e);return!this._containsInteger&&t&&(this._containsInteger=!0),this._containsDecimal||t||(this._containsDecimal=!0),(null===this._minValue||e<this._minValue)&&(this._minValue=e),(null===this._maxValue||e>this._maxValue)&&(this._maxValue=e),String(e)}},{key:"_getDateKeyWithUpdateType",value:function(e){return this._containsDate=!0,(null===this._minDate||e.getTime()<this._minDate.getTime())&&(this._minDate=e),(null===this._maxDate||e.getTime()>this._maxDate.getTime())&&(this._maxDate=e),e.toISOString()}},{key:"updateFieldType",value:function(){!this._containsBooleanValue||this._containsDate||this._containsInteger||this._containsDecimal||this._containsText?!this._containsDate||this._containsInteger||this._containsDecimal||this._containsText||this._containsBooleanValue?!this._containsInteger&&!this._containsDecimal||this._containsDate||this._containsText||this._containsBooleanValue?this._dataType=1:this._dataType=0:this._dataType=2:this._dataType=4}},{key:"getItemList",value:function(){return this._itemList.concat([])}},{key:"getItemTypeList",value:function(){return this._itemTypeList.concat([])}},{key:"getIndexBitMapByItemList",value:function(e){var t,n=new E,r=S(e);try{for(r.s();!(t=r.n()).done;){var o=t.value,i=this._indexMap.get(o);void 0!==i&&n.union(i)}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"getIndexMap",value:function(){return this._indexMap}},{key:"toJSON",value:function(){var e,t,n,r={},o={},i=S(this._indexMap);try{for(i.s();!(n=i.n()).done;){var a=(0,h.Z)(n.value,2),s=a[0],l=a[1];r[s]=l.toJSON()}}catch(e){i.e(e)}finally{i.f()}var u,c=S(this._itemListMap);try{for(c.s();!(u=c.n()).done;){var d=(0,h.Z)(u.value,2),f=d[0],v=d[1];o[f]=v}}catch(e){c.e(e)}finally{c.f()}return{type:this._type,id:this._id,name:this._name,displayName:this._displayName,dataType:this._dataType,itemList:this._itemList.concat(),itemListMap:o,itemTypeList:this._itemTypeList.concat(),indexMap:r,containsDecimal:this._containsDecimal,containsDate:this._containsDate,containsBlank:this._containsBlank,containsText:this._containsText,containsBooleanValue:this._containsBooleanValue,containsInteger:this._containsInteger,minDate:null===(e=this._minDate)||void 0===e?void 0:e.getTime(),maxDate:null===(t=this._maxDate)||void 0===t?void 0:t.getTime(),minValue:this._minValue,maxValue:this._maxValue}}},{key:"fromJSON",value:function(e){var t,n=e.name,r=e.displayName,o=e.dataType,i=e.itemList,a=e.itemTypeList,s=e.indexMap,l=e.itemListMap,u=e.containsDecimal,c=e.containsDate,h=e.containsBlank,d=e.containsText,f=e.containsInteger,v=e.minDate,p=e.maxDate,g=e.minValue,m=e.maxValue,_=e.containsBooleanValue,y=new Map;for(var C in s)if(s.hasOwnProperty(C)){var S=new E;S.fromJSON(s[C]),y.set(C,S)}this._name=String(n),this._displayName=String(r),this._dataType=o,this._itemList=i,this._itemTypeList=a,this._indexMap=y,this._itemListMap=new Map(Object.entries(null!==(t=l)&&void 0!==t?t:{})),this._containsDecimal=u,this._containsDate=c,this._containsBlank=h,this._containsText=d,this._containsInteger=f,this._minDate=v?new Date(v):null,this._maxDate=p?new Date(p):null,this._maxValue=m,this._minValue=g,this._containsBooleanValue=_}},{key:"getMaxMinInfo",value:function(){var e,t;return{minDate:null===(e=this._minDate)||void 0===e?void 0:e.toISOString(),maxDate:null===(t=this._maxDate)||void 0===t?void 0:t.toISOString(),maxValue:this._maxValue,minValue:this._minValue}}},{key:"getFieldSourceInfo",value:function(e){var t=this.getName,n=this.getDisplayName,r=this._itemList,o=this.getDataType,i=this.getType,a=this.getId,s=this.getContainsBlank,l=this.getContainsDecimal,u=this._itemTypeList,c=this._containsDate,h=this._containsText,d=this._containsInteger,f=i(),v=this.getMaxMinInfo(),p=v.minDate,g=v.minValue,m=v.maxDate,_=v.maxValue;if(e){var y=l();return{minDate:p,minValue:g,maxDate:m,maxValue:_,containsDate:c,containsText:h,containsInteger:d,containsNumber:d||y,displayName:n(),fieldName:t(),items:r.concat(),itemTypeList:u.concat(),dataType:o(),id:a(),type:f,containsBlank:s(),containsDecimal:y}}var C={displayName:n(),fieldName:t(),dataType:o(),id:a(),type:f,minValue:g,maxValue:_,containsBlank:s(),containsDecimal:l()};return void 0!==p&&(C.minDate=p),void 0!==m&&(C.maxDate=m),C}},{key:"dispose",value:function(){var e=this;e._indexMap=new Map,e._itemList=[],e._itemTypeList=[],e._itemListMap=new Map,delete e._parent}}]),e}(),yt=function(e){function t(e,n,r,o,i){var a;return(0,f.Z)(this,t),(a=(0,s.Z)(this,(0,l.Z)(t).call(this,"normal",e,n,o,i)))._format=null,a._dataSourceCol=r,a}return(0,u.Z)(t,e),(0,v.Z)(t,[{key:"getFormat",value:function(){return this._format}},{key:"setFormat",value:function(e){this._format=e}},{key:"getDataSourceCol",value:function(){return this._dataSourceCol}},{key:"toJSON",value:function(){return Object.assign({},(0,i.Z)((0,l.Z)(t.prototype),"toJSON",this).call(this),{dataSourceCol:this._dataSourceCol,format:this._format})}},{key:"fromJSON",value:function(e){(0,i.Z)((0,l.Z)(t.prototype),"fromJSON",this).call(this,e),void 0!==e.dataSourceCol&&(this._dataSourceCol=e.dataSourceCol),e.format&&this.setFormat(e.format)}},{key:"getFieldSourceInfo",value:function(e){return Object.assign({},(0,i.Z)((0,l.Z)(t.prototype),"getFieldSourceInfo",this).call(this,e),{type:this._type})}}]),t}(_t);function Ct(e,t,n,r,o){var i=r-n,a=Math.max((0,y.getDecimalDigitsLength)(t),(0,y.getDecimalDigitsLength)(n),(0,y.getDecimalDigitsLength)(r));if(te.lessThanEquals(i,0))return{cellValue:e};var s=e-n;if(te.lessThan(s,0))return{cellValue:q(n,a),sortPriority:-1};if(te.greaterThan(e,r))return{cellValue:$(r,a),sortPriority:(0,g.floorWith15Digits)((r-n)/t)+1};var l=r-t;if(te.equals(function(e,t){return e-t*(0,g.floorWith15Digits)(e/t)}(i,t),0)&&te.lessThanEquals(l,e))return{cellValue:X(l,r,a),sortPriority:(0,g.floorWith15Digits)((r-n)/t)};var u=(0,g.floorWith15Digits)(s/t),c=n+u*t,h=c+t;return!o.containsDecimal&&Number.isInteger(t)&&Number.isInteger(n)&&Number.isInteger(r)&&(h-=1),te.greaterThan(h,r)&&(h=r),{cellValue:X(c,h,a),sortPriority:u}}function St(e,t,n){if("number"!=typeof e)return{cellValue:e};var r=t.startNum,o=t.endNum,i=t.groupInterval;return te.lessThanEquals(i,0)?{cellValue:e}:void 0===r?void 0===o?function(e,t,n){var r=(0,g.floorWith15Digits)(e/t),o=r*t,i=o+t;return!n.containsDecimal&&Number.isInteger(t)&&(i-=1),{cellValue:X(o,i,(0,y.getDecimalDigitsLength)(t)),sortPriority:r}}(e,i,n):function(e,t,n,r){var o=e-n,i=Math.max((0,y.getDecimalDigitsLength)(t),(0,y.getDecimalDigitsLength)(n));if(te.greaterThan(o,0))return{cellValue:$(n,i),sortPriority:0};if(te.lessThanEquals(n-t,e))return{cellValue:X(n-t,n,i),sortPriority:-1};var a=(0,g.floorWith15Digits)(o/t),s=n+a*t,l=s+t;return!r.containsDecimal&&Number.isInteger(t)&&Number.isInteger(n)&&(l-=1),{cellValue:X(s,l,i),sortPriority:a}}(e,i,o,n):void 0===o?function(e,t,n,r){var o=e-n,i=Math.max((0,y.getDecimalDigitsLength)(t),(0,y.getDecimalDigitsLength)(n));if(te.lessThan(o,0))return{cellValue:q(n,i),sortPriority:-1};var a=(0,g.floorWith15Digits)(o/t),s=n+a*t,l=s+t;return!r.containsDecimal&&Number.isInteger(t)&&Number.isInteger(n)&&(l-=1),{cellValue:X(s,l,i),sortPriority:a}}(e,i,r,n):Ct(e,i,r,o,n)}var kt,Et,Tt,bt,It,Rt=function(e){function t(e,n,r,o,i,a,u){var c;(0,f.Z)(this,t),(c=(0,s.Z)(this,(0,l.Z)(t).call(this,"grouped",e,n,a,u)))._originCellValue=[],c._originalCacheFieldId=o.getId(),c._groupRule=i;for(var h=o.getDataSourceCol(),d=0;d<r.length;d++){var v=r[d];if(Array.isArray(v)){var p=v[h];if(void 0===p)c.addCellValue(d,"");else{var g=c.groupCellValue(p||"",c._groupRule,{containsDecimal:o.getContainsDecimal()}).cellValue;c.addCellValue(d,g)}}}return c}return(0,u.Z)(t,e),(0,v.Z)(t,[{key:"addCellValue",value:function(e,t){var n,r=this.getKeyWithUpdateType(t),o=r.key,i=r.type,a=this._indexMap;if(void 0===a.get(o)){a.set(o,new E);var s=this._itemList.push(o);this._itemTypeList.push(i),this._itemListMap.set(o,s-1),this._originCellValue.push(t)}null===(n=a.get(o))||void 0===n||n.addDecimalNum(e)}},{key:"getOriginalCacheFieldId",value:function(){return this._originalCacheFieldId}},{key:"getGroupRule",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return e?(0,p.default)(this._groupRule):this._groupRule}},{key:"toJSON",value:function(){return Object.assign({},(0,i.Z)((0,l.Z)(t.prototype),"toJSON",this).call(this),{originalCacheFieldId:this._originalCacheFieldId,groupRule:A(this._groupRule)})}},{key:"getFieldSourceInfo",value:function(e){var n=(0,i.Z)((0,l.Z)(t.prototype),"getFieldSourceInfo",this).call(this,e),r=A(this._groupRule),o=this.getOriginalCacheFieldId();return Object.assign({},n,{type:this._type,groupRule:r,originalId:o})}},{key:"fromJSON",value:function(e){(0,i.Z)((0,l.Z)(t.prototype),"fromJSON",this).call(this,e),e.groupRule&&e.originalCacheFieldId&&(this._groupRule=w(e.groupRule),this._originalCacheFieldId=e.originalCacheFieldId)}},{key:"groupCellValue",value:function(e,t,n){switch(t.type){case"date":return this._groupCellValueByDateGroupRule(e,t);case"number":return St(e,t,n);case"element":return function(e,t){var n,r=S(t.groupListMap);try{for(r.s();!(n=r.n()).done;){var o,i=(0,h.Z)(n.value,2),a=i[0],s=S(i[1]);try{for(s.s();!(o=s.n()).done;)if(ct(e||"",o.value))return{cellValue:a}}catch(e){s.e(e)}finally{s.f()}}}catch(e){r.e(e)}finally{r.f()}return{cellValue:e}}(e,t);default:return{cellValue:e}}}},{key:"_groupCellValueByDateGroupRule",value:function(e,t){return se(e)?this._groupCellValueByDateGroupBy(e,t.groupBy):{cellValue:e}}},{key:"_groupCellValueByDateGroupBy",value:function(e,t){var n=this._parent.depends,r=n.t;return ie(n.formatterService,r,e,t)}}]),t}(_t),wt=function(e){function t(e,n,r,o){var i,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return(0,f.Z)(this,t),(i=(0,s.Z)(this,(0,l.Z)(t).call(this,"calculate",n,a,r,o)))._calculateFieldInfo=e,i}return(0,u.Z)(t,e),(0,v.Z)(t,[{key:"setCalculateFieldInfo",value:function(e){this._calculateFieldInfo=e}},{key:"getCalculateFieldInfo",value:function(){return this._calculateFieldInfo}},{key:"getFormula",value:function(){return this._calculateFieldInfo.formula}},{key:"getFormulaSummaryType",value:function(){return this._calculateFieldInfo.formulaSummaryType}},{key:"refresh",value:function(e){var t=e.displayName,n=e.calculateFieldInfo,r=e.dataType;this.setDisplayName(t),this.setCalculateFieldInfo(n),this.setDataType(r)}},{key:"fromJSON",value:function(e){(0,i.Z)((0,l.Z)(t.prototype),"fromJSON",this).call(this,e),e.calculateFieldInfo&&(this._calculateFieldInfo=e.calculateFieldInfo)}},{key:"toJSON",value:function(){return Object.assign({},(0,i.Z)((0,l.Z)(t.prototype),"toJSON",this).call(this),{calculateFieldInfo:this._calculateFieldInfo})}},{key:"getFieldSourceInfo",value:function(e){var n=this._type,r=this._calculateFieldInfo;return Object.assign({},(0,i.Z)((0,l.Z)(t.prototype),"getFieldSourceInfo",this).call(this,e),{type:n,calculateFieldInfo:Object.assign({},r)})}}]),t}(_t),At="-$-i18-$-",Ft=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.join(At)},Dt=function(){function e(){(0,f.Z)(this,e),this._t=Ft}return(0,v.Z)(e,[{key:"setT",value:function(e){this._t=e}},{key:"t",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return this._t.apply(this,[e].concat(n))}}]),e}(),Nt=(new Dt,function(e,t,n,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Ft,i=e[0]||[],a=i.length;if(n&&n.colCount>a)for(var s=a;s<n.colCount;s++)i[s]=void 0;i&&0!==i.length||(i=new Array((null==n?void 0:n.colCount)||0));var l=new Map,u=new Map,c=new Map;(r||[]).forEach((function(e){var t=e.id,n=e.fieldName,r=e.displayName;l.set(n,t),u.set(n,r),c.set(t,n)}));var d,f=[],v=(null==n?void 0:n.col)||0,p=new Map,g=S(i.entries());try{for(g.s();!(d=g.n()).done;){var m=(0,h.Z)(d.value,2),_=m[0],y=m[1],C=void 0,k=void 0;if(void 0===y||""===y||null===y){k=dt(v+_+1),C=c.get(k)||Q(o,k);var E=l.get(C)||k;f.push({fieldName:C,dataType:1,id:E,displayName:u.get(C),format:t[_]}),p.set(C,1)}else{var T=String(y);C=y;for(var b=2;void 0!==p.get(T);++b)T="".concat(C,"-").concat(b);C=T,f.push({fieldName:T,dataType:1,id:l.get(T),displayName:u.get(T),format:t[_]}),p.set(T,1)}}}catch(e){g.e(e)}finally{g.f()}return f}),Pt={t:Ft,formatterService:new y.FormatterService},Ot=function(){function e(t,n,r,o,i){(0,f.Z)(this,e),this._fieldsCollection={},this._fieldsIdMap={},this._fieldsList=[],this._initFields(n),this._initData(r),this._data=r,this._name=t,this.depends=i?Object.assign({},Pt,{},i):Pt,o&&o.length>0&&this.buildVirtualCacheFieldByCacheInfo(o),this._fieldsList.filter((function(e){return"normal"===e.getType()})).forEach((function(e){e.updateFieldType()}))}return(0,v.Z)(e,[{key:"buildVirtualCacheFieldByCacheInfo",value:function(e){var t,n=S(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;if("grouped"===r.type){var o=r.groupRule,i=r.originalId,a=r.id,s=r.displayName,l=r.fieldName,u=this.getCacheFieldById(i);if(u&&T(u)){var c=this.createGroupedCacheField(u,w(o),a,l);s&&c.setDisplayName(s)}}if("calculate"===r.type){var h=r.id,d=r.displayName,f=r.fieldName,v=r.calculateFieldInfo,p=r.dataType;this.addCalculateCacheFieldImp(v,f,h,p).setDisplayName(d)}}}catch(e){n.e(e)}finally{n.f()}}},{key:"buildGroupByCacheInfo",value:function(e){var t,n=S(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;if("grouped"===r.type){var o=r.groupRule,i=r.originalId,a=r.id,s=r.displayName,l=r.fieldName,u=this.getCacheFieldById(i);if(u&&T(u)){var c=this.createGroupedCacheField(u,w(o),a,l);s&&c.setDisplayName(s)}}}}catch(e){n.e(e)}finally{n.f()}}},{key:"getFieldCount",value:function(){return this._fieldsList.length}},{key:"_initFields",value:function(e){var t,n=S(e.entries());try{for(n.s();!(t=n.n()).done;){var r=(0,h.Z)(t.value,2),o=r[0],i=r[1],a=i.fieldName,s=i.dataType,l=i.id,u=i.format,c=i.displayName,d=this.addNormalCacheField(a,s,o,l);u&&d.setFormat(u),c&&d.setDisplayName(c)}}catch(e){n.e(e)}finally{n.f()}}},{key:"_initData",value:function(e){for(var t=this._fieldsList,n=0;n<e.length;++n){var r=e[n];if(Array.isArray(r)){var o,i=S(t);try{for(i.s();!(o=i.n()).done;){var a=o.value;if(T(a)){var s=r[a.getDataSourceCol()];void 0===s&&(s="",a.setContainBlock(!0)),a.addCellValue(n,s)}}}catch(e){i.e(e)}finally{i.f()}}else{var l,u=S(t);try{for(u.s();!(l=u.n()).done;){var c=l.value;T(c)&&c.addCellValue(n,null)}}catch(e){u.e(e)}finally{u.f()}}}}},{key:"_addCacheField",value:function(e){return this._fieldsIdMap[e.getId()]=e,this._fieldsCollection[e.getName()]=e,this._fieldsList.push(e),e}},{key:"addNormalCacheField",value:function(e,t,n,r){var o=this._fieldsCollection,i=mt(e,(function(e){return Boolean(o[e])})),a=new yt(i,t,n,this,r);return this._addCacheField(a)}},{key:"getCalculateCacheFieldById",value:function(e){var t=this.getCacheFieldById(e);return t&&I(t)?t:null}},{key:"getCalculateCacheFieldByName",value:function(e){var t=this.getCacheFieldById(e);return t&&I(t)?t:null}},{key:"getCalculateCacheFieldList",value:function(){return this._fieldsList.filter((function(e){return I(e)}))}},{key:"addCalculateCacheFieldImp",value:function(e,t,n,r){var o=this._fieldsCollection,i=mt(t,(function(e){return Boolean(o[e])})),a=new wt(e,i,this,n,r);return this._addCacheField(a)}},{key:"createGroupedCacheField",value:function(e,t,n,r){return this._addGroupedCacheFieldImp(e,t,n,r)}},{key:"addGroupedCacheField",value:function(e,t){return this._addGroupedCacheFieldImp(e,t)}},{key:"_addGroupedCacheFieldImp",value:function(e,t,n,r){if(!r){var o=e.getName();r=this.getFieldNameByGroupRule(o,t)||""}var i=this._fieldsCollection,a=mt(r,(function(e){return Boolean(i[e])})),s=new Rt(a,1,this._data,e,t,this,n);return this._addCacheField(s)}},{key:"removeField",value:function(e){var t=this._fieldsIdMap[e];if(t){var n=t.getName();delete this._fieldsIdMap[e],delete this._fieldsCollection[n];for(var r=0;r<this._fieldsList.length&&this._fieldsList[r].getId()!==e;++r);this._fieldsList.splice(r,1)}}},{key:"getCacheFieldByName",value:function(e){return this._fieldsCollection[e]}},{key:"getCacheFieldById",value:function(e){return this._fieldsIdMap[e]}},{key:"getGroupRuleByFieldId",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.getCacheFieldById(e);return n&&b(n)?n.getGroupRule(t):null}},{key:"getItemListByFieldName",value:function(e){var t;return null===(t=this._fieldsCollection[e])||void 0===t?void 0:t.getItemList()}},{key:"getItemTypeByFieldName",value:function(e){return this._fieldsCollection[e].getDataType()}},{key:"getItemTypeList",value:function(e){var t;return null===(t=this._fieldsCollection[e])||void 0===t?void 0:t.getItemTypeList()}},{key:"getDataSourceInfo",value:function(e){return this._fieldsList.map((function(t){return t.getFieldSourceInfo(e)}))}},{key:"getFieldIndex",value:function(e){if(0===this._fieldsList.length)return-1;var t,n=0,r=S(this._fieldsList);try{for(r.s();!(t=r.n()).done;){if(t.value.getId()===e)return n;n++}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"getRowValue",value:function(e){return this._data[e]}},{key:"getCellValueWithSortPriority",value:function(e,t,n){var r=this.getCacheFieldByName(t);if(r){if(T(r)){var o=this._data[e];if(!Array.isArray(o))return{cellValue:null};var i=o[r.getDataSourceCol()];if(i instanceof Date){var a=i;return i=function(e){return(e.getTime()-Date.UTC(1899,11,30))/864e5}(i),{cellValue:void 0===i?null:i,type:2,originCellValue:a}}return{cellValue:void 0===i?null:i}}if(b(r)){var s=r.getOriginalCacheFieldId(),l=this.getCacheFieldById(s);if(!l||!T(l))return{cellValue:null};var u=this._data[e];if(!Array.isArray(u))return{cellValue:null};var c=u[l.getDataSourceCol()],h=r.getGroupRule();return void 0===c&&"element"!==h.type?{cellValue:null}:r.groupCellValue(c,h,{containsDecimal:l.getContainsDecimal()})}}return{cellValue:null}}},{key:"getFieldFormat",value:function(e){var t=this.getCacheFieldByName(e);if(t){if(T(t))return t.getFormat();if(b(t)){var n=t.getOriginalCacheFieldId(),r=this.getCacheFieldById(n);return r&&T(r)?r.getFormat():null}}return null}},{key:"getDataRecordsNum",value:function(){return this._data.length}},{key:"toJSON",value:function(){var e=this._fieldsList.map((function(e){return e.toJSON()}));return{data:this.getDataToJSON(),name:this._name,fields:e}}},{key:"getDataToJSON",value:function(){for(var e=this._data,t=e.length,n=new Array(t),r=0;r<t;r++){var o=[];if(e[r]){var i,a=S(e[r]);try{for(a.s();!(i=a.n()).done;){var s=i.value;s instanceof Date?o.push({date:s.getTime()}):o.push(s)}}catch(e){a.e(e)}finally{a.f()}}n[r]=o}return n}},{key:"getDataFromJSON",value:function(e){for(var t=e.length,n=new Array(t),r=0;r<t;r++){var o=[];if(e[r]){var i,a=S(e[r]);try{for(a.s();!(i=a.n()).done;){var s=i.value;ae(s)?o.push(new Date(s.date)):o.push(s)}}catch(e){a.e(e)}finally{a.f()}}n[r]=o}return n}},{key:"fromJSON",value:function(e){var t=e.data,n=e.name,r=e.fields;this.reset(),this._data=this.getDataFromJSON(t),this._name=n;var o,i=[],a=S(r);try{for(a.s();!(o=a.n()).done;){var s=o.value;switch(s.type){case"normal":var l=s.name,u=s.dataType,c=s.dataSourceCol,h=s.id;this.addNormalCacheField(l,u,c,h).fromJSON(s);break;case"calculate":case"grouped":i.push(s);break;default:var d=s.name,f=s.dataType,v=s.dataSourceCol,p=s.id;void 0!==v?this.addNormalCacheField(d,f,v,p).fromJSON(s):i.push(s)}}}catch(e){a.e(e)}finally{a.f()}for(var g=0,m=i;g<m.length;g++){var _=m[g];if("grouped"===_.type){var y=_.originalCacheFieldId,C=_.groupRule,k=_.id,E=_.name;if(y){var T=this.getCacheFieldById(y);T&&C&&this.createGroupedCacheField(T,w(C),k,E).fromJSON(_)}}if("calculate"===_.type){var b=_.calculateFieldInfo,I=_.name,R=_.id,A=_.dataType;this.addCalculateCacheFieldImp(b,I,R,A).fromJSON(_)}}}},{key:"getGroupList",value:function(){var e,t=[],n=S(this._fieldsList);try{for(n.s();!(e=n.n()).done;){var r=e.value;b(r)&&t.push(r)}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"isDisplayNameExist",value:function(e){var t,n=S(this._fieldsList);try{for(n.s();!(t=n.n()).done;){if(t.value.getDisplayName()===e)return!0}}catch(e){n.e(e)}finally{n.f()}return!1}},{key:"getNormalFieldDisplayNameList",value:function(){var e,t=[],n=S(this._fieldsList);try{for(n.s();!(e=n.n()).done;){var r=e.value;T(r)&&t.push(r.getDisplayName())}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"getFieldByDisplayName",value:function(e){var t,n=S(this._fieldsList);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.getDisplayName()===e)return r}}catch(e){n.e(e)}finally{n.f()}return null}},{key:"reset",value:function(){this._fieldsCollection={},this._fieldsIdMap={},this._fieldsList=[],this._fieldsList.forEach((function(e){return e.dispose()})),delete this._data}},{key:"refreshGroup",value:function(e){var t,n=[],r=S(this._fieldsList);try{for(r.s();!(t=r.n()).done;){var o=t.value;b(o)&&n.push(o.getId())}}catch(e){r.e(e)}finally{r.f()}for(var i=0,a=n;i<a.length;i++){var s=a[i];this.removeField(s)}e&&e.length>0&&this.buildGroupByCacheInfo(e)}},{key:"refreshCalculateField",value:function(e){var t,n=[],r=S(this._fieldsList);try{for(r.s();!(t=r.n()).done;){var o=t.value;I(o)&&n.push(o.getId())}}catch(e){r.e(e)}finally{r.f()}var i,a=[],s=S(e);try{for(s.s();!(i=s.n()).done;){var l=i.value;if("calculate"===l.type){var u=l.id,c=l.displayName,h=l.fieldName,d=l.calculateFieldInfo,f=l.dataType,v=this.getCacheFieldById(u);v?(v.refresh(l),a.push(u)):this.addCalculateCacheFieldImp(d,h,u,f).setDisplayName(c)}}}catch(e){s.e(e)}finally{s.f()}var p,g=n.filter((function(e){return!a.includes(e)})),m=S(g);try{for(m.s();!(p=m.n()).done;){var _=p.value;this.removeField(_)}}catch(e){m.e(e)}finally{m.f()}}},{key:"refresh",value:function(e,t,n){var r=this._fieldsCollection;this.reset();for(var o=0;o<e.length;o++){var i=e[o],a=i.fieldName,s=i.dataType,l=i.format,u=i.displayName,c="";r[a]&&(c=r[a].getId());var h=this.addNormalCacheField(a,s,o,c);u&&h.setDisplayName(u),l&&h.setFormat(l)}this._data=t,this._initData(t),n&&n.length>0&&this.buildVirtualCacheFieldByCacheInfo(n),this._fieldsList.filter((function(e){return"normal"===e.getType()})).forEach((function(e){e.updateFieldType()}))}},{key:"getFieldNameByGroupRule",value:function(e,t){return"date"===t.type?this.getFieldNameByDateGroupBy(e,t.groupBy):this.formatFieldNameByNormalGroupRule(e)}},{key:"formatFieldNameByNormalGroupRule",value:function(e){return this.depends.t("LarkCCM_Sheets_PivotTable_DateGroup_GroupedFieldName",{fieldName:e})}},{key:"getFieldNameByDateGroupBy",value:function(e,t){switch(t){case"minute":return function(e,t){return e("LarkCCM_Sheets_PivotTable_FieldNameDateGroupMin",{fieldName:t})}(this.depends.t,e);case"hour":return function(e,t){return e("LarkCCM_Sheets_PivotTable_DateGroup_FieldNameHour",{fieldName:t})}(this.depends.t,e);case"hourMinute":return function(e,t){return e("LarkCCM_Sheets_PivotTable_DateGroup_FieldNameHourMin",{fieldName:t})}(this.depends.t,e);case"date":return function(e,t){return e("LarkCCM_Sheets_PivotTable_DateGroup_FieldNameDate",{fieldName:t})}(this.depends.t,e);case"month":return function(e,t){return e("LarkCCM_Sheets_PivotTable_DateGroup_FieldNameMonth",{fieldName:t})}(this.depends.t,e);case"monthDate":return function(e,t){return e("LarkCCM_Sheets_PivotTable_DateGroup_FieldNameMonthWithDate",{fieldName:t})}(this.depends.t,e);case"quarter":return function(e,t){return e("LarkCCM_Sheets_PivotTable_DateGroup_FieldNameQuarter",{fieldName:t})}(this.depends.t,e);case"year":return function(e,t){return e("LarkCCM_Sheets_PivotTable_DateGroup_FieldNameYear",{fieldName:t})}(this.depends.t,e);case"yearMonth":return function(e,t){return e("LarkCCM_Sheets_PivotTable_DateGroup_FieldNameYearMonth",{fieldName:t})}(this.depends.t,e);case"yearQuarter":return function(e,t){return e("LarkCCM_Sheets_PivotTable_DateGroup_FieldNameYearQuarter",{fieldName:t})}(this.depends.t,e);case"yearMonthDate":return function(e,t){return e("LarkCCM_Sheets_PivotTable_DateGroup_FieldNameYearMonthQuarter",{fieldName:t})}(this.depends.t,e);default:return this.formatFieldNameByNormalGroupRule(e)}}}]),e}();!function(e){e[e.Normal=0]="Normal",e[e.Condition=1]="Condition"}(kt||(kt={})),function(e){e[e.Normal=1]="Normal",e[e.Formula=2]="Formula"}(Et||(Et={})),function(e){e.Date="date",e.Number="number",e.Element="element"}(Tt||(Tt={})),function(e){e.Minute="minute",e.Hour="hour",e.HourMinute="hourMinute",e.Date="date",e.Month="month",e.MonthDate="monthDate",e.Quarter="quarter",e.Year="year",e.YearMonth="yearMonth",e.YearQuarter="yearQuarter",e.YearMonthDate="yearMonthDate"}(bt||(bt={})),function(e){e.Normal="normal",e.Grouped="grouped",e.Calculate="calculate"}(It||(It={}));var Mt=function(e,t,n){var r,o=e[t];if("function"==typeof o)r=o();else{var i=(0,e[o.oppositeTo])();r=function(e){return!i(e)}}var a=n&&n.has(t);return function(e,t){return t?a:r(e)}},Lt=function(){function e(){(0,f.Z)(this,e)}return(0,v.Z)(e,[{key:"needWildCards",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.indexOf("*")>-1||e.indexOf("?")>-1}},{key:"exec",value:function(e,t){var n=this._convertItem(e,t),r=n.value,o=n.isEmpty;return!n.noConvert&&this._exec(r,o)}},{key:"_convertItem",value:function(e,t){if(3===t)return{value:e,isEmpty:!0,noConvert:!1};if(!this._conditionConverter)return{value:e,isEmpty:!1,noConvert:!0};var n=this._conditionConverter[t];return n?{value:n(e),isEmpty:!1,noConvert:!1}:{value:e,isEmpty:!1,noConvert:!0}}}]),e}(),xt=function(e){function t(e,n,r){var o;return(0,f.Z)(this,t),(o=(0,s.Z)(this,(0,l.Z)(t).call(this)))._compareTypesAllowEmpty=new Set([7,8]),o.compareType=e,o._conditionConverter=n,o.expect=r,o.beforeExec(),o}return(0,u.Z)(t,e),(0,v.Z)(t,[{key:"toJSON",value:function(){return{conType:0,compareType:this.compareType,expect:this.expect}}},{key:"setExecWithoutWildCards",value:function(){var e=this.expect,t={0:function(){var t=e.toLowerCase();return function(e){return e.toLowerCase()===t}},1:{oppositeTo:0},2:function(){var t=e.toLowerCase();return function(e){return e.toLowerCase().startsWith(t)}},3:{oppositeTo:2},4:function(){var t=e.toLowerCase();return function(e){return e.toLowerCase().endsWith(t)}},5:{oppositeTo:4},6:function(){var t=e.toLowerCase();return function(e){return e.toLowerCase().includes(t)}},7:{oppositeTo:6},8:function(){return function(e){return!e}},9:{oppositeTo:8}};this._exec=Mt(t,this.compareType,this._compareTypesAllowEmpty)}},{key:"setExecWithWildCards",value:function(){var e,t=this.expect,n=!1;switch(this.compareType){case 0:e=Fe(t,"^","$");break;case 1:e=Fe(t,"^","$"),n=!0;break;case 2:e=Fe(t,"^","");break;case 3:e=Fe(t,"^",""),n=!0;break;case 4:e=Fe(t,"","$");break;case 5:e=Fe(t,"","$"),n=!0;break;case 6:e=Fe(t,"","");break;case 7:e=Fe(t,"",""),n=!0}e&&(this._exec=function(t){return n?!e.test(t):e.test(t)})}},{key:"beforeExec",value:function(){this.setExecWithoutWildCards()}}]),t}(Lt),Vt=function(e){function t(e,n){var r;return(0,f.Z)(this,t),(r=(0,s.Z)(this,(0,l.Z)(t).call(this)))._conditionConverter=null,r.compareType=e,r.expect=n,r.beforeExec(),r}return(0,u.Z)(t,e),(0,v.Z)(t,[{key:"exec",value:function(){return this._exec.apply(this,arguments)}},{key:"toJSON",value:function(){return{conType:3,compareType:this.compareType,expect:this.expect}}},{key:"beforeExec",value:function(){var e=[];switch(this.expect.forEach((function(t){e.push(Ht(t))})),this.compareType){case 0:this._exec=function(){for(var t=0;t<e.length;t++){var n;if(!(n=e[t]).exec.apply(n,arguments))return!1}return!0};break;case 1:this._exec=function(){for(var t=0;t<e.length;t++){var n;if((n=e[t]).exec.apply(n,arguments))return!0}return!1};break;case 2:this._exec=function(){var t;return 1===e.length&&!(t=e[0]).exec.apply(t,arguments)}}}}]),t}(Lt),Zt=function(e){function t(e,n,r,o){var i;return(0,f.Z)(this,t),(i=(0,s.Z)(this,(0,l.Z)(t).call(this))).wholeDay=!1,i._compareTypesAllowEmpty=new Set([7]),i.compareType=e,i._conditionConverter=n,i.expect=r,i.wholeDay=!!o,i.beforeExec(),i}return(0,u.Z)(t,e),(0,v.Z)(t,[{key:"toJSON",value:function(){return{conType:this.conType,compareType:this.compareType,wholeDay:this.wholeDay,expect:this.expect}}},{key:"beforeExec",value:function(){var e=this.expect,t=this.wholeDay,n=function(){return function(e){var t=new Date,n=t.getTimezoneOffset();return t.setMinutes(t.getMinutes()-(e-n)),t}(e)},r={0:function(){if(!t)return function(t){return t.getTime()===e};var n=Ne(e),r=Me(n),o=r+Oe;return function(e){var t=e.getTime();return t>=r&&t<o}},1:{oppositeTo:0},2:function(){if(!t)return function(t){return t.getTime()<e};var n=Ne(e),r=Me(n);return function(e){return e.getTime()<r}},4:function(){if(!t)return function(t){return t.getTime()>e};var n=Ne(e),r=Me(n)+Oe;return function(e){return e.getTime()>=r}},3:{oppositeTo:4},5:{oppositeTo:2},6:function(){var n=Ae(e),r=(0,h.Z)(n,2),o=r[0],i=r[1];if(!t)return function(e){var t=e.getTime();return o<=t&&t<=i};var a=Me(Ne(o)),s=Me(Ne(i))+Oe;return function(e){var t=e.getTime();return a<=t&&t<s}},7:{oppositeTo:6},8:function(){var e=Me(n())+Oe,t=e+Oe;return function(n){var r=n.getTime();return r>=e&&r<t}},9:function(){var e=Me(n()),t=e+Oe;return function(n){var r=n.getTime();return r>=e&&r<t}},10:function(){var e=Me(n()),t=e-Oe;return function(n){var r=n.getTime();return r>=t&&r<e}},11:function(){var e=7*Oe,t=Le(n())+e,r=t+e;return function(e){var n=e.getTime();return n>=t&&n<r}},12:function(){var e=Le(n()),t=e+7*Oe;return function(n){var r=n.getTime();return r>=e&&r<t}},13:function(){var e=Le(n()),t=e-7*Oe;return function(n){var r=n.getTime();return r>=t&&r<e}},14:function(){var e=Be(n(),1),t=xe(e),r=Be(n(),2),o=xe(r);return function(e){var n=e.getTime();return n>=t&&n<o}},15:function(){var e=xe(n()),t=Be(n(),1),r=xe(t);return function(t){var n=t.getTime();return n>=e&&n<r}},16:function(){var e=xe(n()),t=Be(n(),-1),r=xe(t);return function(t){var n=t.getTime();return n>=r&&n<e}},17:function(){var e=He(n(),1),t=Ve(e),r=He(n(),2),o=Ve(r);return function(e){var n=e.getTime();return n>=t&&n<o}},18:function(){var e=Ve(n()),t=He(n(),1),r=Ve(t);return function(t){var n=t.getTime();return n>=e&&n<r}},19:function(){var e=Ve(n()),t=He(n(),-1),r=Ve(t);return function(t){var n=t.getTime();return n>=r&&n<e}},20:function(){var e=Ue(n(),1),t=Ze(e),r=Ue(n(),2),o=Ze(r);return function(e){var n=e.getTime();return n>=t&&n<o}},21:function(){var e=Ze(n()),t=Ue(n(),1),r=Ze(t);return function(t){var n=t.getTime();return n>=e&&n<r}},22:function(){var e=Ze(n()),t=Ue(n(),-1),r=Ze(t);return function(t){var n=t.getTime();return n>=r&&n<e}},23:function(){var e=Me(n())+Oe,t=Ze(n());return function(n){var r=n.getTime();return r>=t&&r<e}},24:function(){var t=new Set;return e.forEach((function(e){for(var n=3*(e-1),r=0;r<3;r++)t.add(n+r)})),function(e){return t.has(Pe(e).getMonth())}},25:function(){var t=new Set(e.map((function(e){return e-1})));return function(e){return t.has(Pe(e).getMonth())}}};this._exec=Mt(r,this.compareType,this._compareTypesAllowEmpty)}}]),t}(Lt),Bt=function(e){function t(e,n,r,o){var i;return(0,f.Z)(this,t),(i=(0,s.Z)(this,(0,l.Z)(t).call(this)))._compareTypesAllowEmpty=new Set([7,8]),i.compareType=e,i._conditionConverter=n,i.expect=r,void 0!==o?i.isTop=o:i.beforeExec(),i}return(0,u.Z)(t,e),(0,v.Z)(t,[{key:"toJSON",value:function(){var e;return e="number"==typeof this.expect?this.expect:[this.expect[0],this.expect[1]],{conType:this.conType,compareType:this.compareType,isTop:this.isTop,expect:e}}},{key:"getHeap",value:function(){var e;e=this.isTop?"max":"min";var t,n=new Je(e),r=S(this._top10List);try{for(r.s();!(t=r.n()).done;){var o=t.value;n.insert(o)}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"setTop10List",value:function(e){this._top10List=e,this.beforeExec()}},{key:"beforeExec",value:function(){var e=this,t=this.expect,n={0:function(){return function(e){return te.equals(e,t)}},1:{oppositeTo:0},2:function(){return function(e){return te.greaterThan(e,t)}},4:function(){return function(e){return te.lessThan(e,t)}},3:{oppositeTo:4},5:{oppositeTo:2},6:function(){var e=Ae(t),n=(0,h.Z)(e,2),r=n[0],o=n[1];return function(e){return te.lessThanEquals(r,e)&&te.lessThanEquals(e,o)}},7:{oppositeTo:6},8:function(){return function(){return!1}},9:function(){return function(){return!0}},10:function(){for(var n=e.getHeap(),r={},o=0;o<t;o++)r[n.extract()]=!0;return e._topKMap=r,function(t){return Boolean(e._topKMap[t])}},11:function(){for(var n=e.getHeap(),r=n.sum*Math.max(Math.min(t,1),0),o=n.size(),i={},a=0,s=0;s<o&&te.lessThan(a,r);s++){var l=n.extract();a+=l,i[l]=!0}return e._topKMap=i,function(t){return Boolean(e._topKMap[t])}},12:function(){for(var n=e.getHeap(),r=n.size(),o={},i=0,a=0;a<r&&te.lessThan(i,t);a++){var s=n.extract();i+=s,o[s]=!0}return e._topKMap=o,function(t){return Boolean(e._topKMap[t])}}};this._exec=Mt(n,this.compareType,this._compareTypesAllowEmpty)}}]),t}(Lt);function Ht(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ie(),n=arguments.length>2?arguments[2]:void 0;switch(e.conType){case 0:var r=e.compareType,o=e.expect,i=pt(t,n);return new xt(r,i,o);case 3:var a=e.compareType,s=e.expect;return new Vt(a,s);case 1:var l=vt(t),u=e.compareType,c=e.expect,h=e.wholeDay;return new Zt(u,l,c,h);case 2:var d=gt(t),f=e.compareType,v=e.expect,p=e.isTop;return new Bt(f,d,v,p)}}function Ut(e,t,n,r){var o,i=[];if(t.labelFilter&&void 0!==(null===(o=t.labelFilter.condition)||void 0===o?void 0:o.conType)){for(var a=t.labelFilter,s=1===a.condition.conType&&r&&R(n)?r:n,l=T(s)&&s.getFormat()||void 0,u=s.getItemList(),c=s.getItemTypeList(),h=Ht(a.condition,e,l),d=0,f=u.length;d<f;d++)h.exec(u[d],c[d])&&i.push(u[d]);return{isAll:!1,indexBitMap:s.getIndexBitMapByItemList(i)}}if(void 0===t.labelFilter)return{isAll:!0};var v=t.labelFilter,p=v.list;return v.isAll?{isAll:!0}:(i=p,{isAll:!1,indexBitMap:n.getIndexBitMapByItemList(i)})}var jt=function(){function e(t,n,r,o,i){(0,f.Z)(this,e),this._filterTypeConverter=i||Ie(),this._pathPool={},this.indexOrder=this._getPathIndex(t,n),this.measureIndexes=this.createMeasureIndex(t,r),this._needDistinctMap=this.getNeedDistinctMap(t,r),this._needMidMap=this.getNeedMidMap(t,r),this._itemList=[],this._indexList=[],this._cache=t,this._dependMap=o||{},this._queryItem(t,n),this._cache=null}return(0,v.Z)(e,[{key:"getCubeIndexInfo",value:function(){return this._indexList.map((function(e){return e.concat([])}))}},{key:"getNeedDistinctMap",value:function(e,t){var n=new Map;return t.forEach((function(t){var r=t.summaryMode,o=t.pivotCacheFieldId;if(r===ve.Normal&&t.summaryType===de.distinct){var i=e.getCacheFieldById(o);i&&n.set(i.getName(),!0)}})),n}},{key:"getNeedMidMap",value:function(e,t){var n=new Map,r=new Map;return t.forEach((function(t){var o=t.summaryMode,i=t.pivotCacheFieldId;if(o===ve.Normal&&t.summaryType===de.mid){var a=e.getCacheFieldById(i);a&&(n.set(a.getName(),!0),r.set(i,[]))}})),this._valueMapList=r,n}},{key:"getCubeInfo",value:function(){return{_itemList:this._itemList.map((function(e){var t=e.path,n=e.unit,r=e.type,o=e.sortPriorityMap,i=e.groupOriginValues;return{path:t.concat(),type:r.concat(),unit:Object.assign({},n),sortPriorityMap:Object.assign({},o),groupOriginValues:i.concat()}})),indexOrder:this.indexOrder.map((function(e){return{fieldName:e.fieldName}})),measureIndexes:this.measureIndexes.map((function(e){var t=e.cacheFieldName,n=e.summaryTypes,r=e.formulaSummaryTypes,o=e.summaryMode;return{cacheFieldName:t,summaryTypes:n.concat([]),formulaSummaryTypes:r.concat([]),summaryMode:o}}))}}},{key:"createMeasureIndex",value:function(e,t){for(var n=t.length,r=[],o={},i=0;i<n;i++){var a=t[i],s=a.pivotCacheFieldId,l=a.summaryMode,u=e.getCacheFieldById(s);if(u){var c=l===ve.Formula;if(void 0===o[s])u&&(o[s]=r.push({cacheFieldName:u.getName(),summaryTypes:c?[]:[a.summaryType],formulaSummaryTypes:c?[a.formulaSummaryType]:[],summaryMode:c?l:ve.Normal})-1);else if(c){var h=r[o[s]].formulaSummaryTypes,d=a.formulaSummaryType;h.includes(d)||r[o[s]].formulaSummaryTypes.push(d)}else{var f=r[o[s]].summaryTypes,v=a.summaryType;f.includes(v)||r[o[s]].summaryTypes.push(v)}}}return r}},{key:"_getPathIndex",value:function(e,t){var n,r=[],o=S(t);try{for(o.s();!(n=o.n()).done;){var i=n.value,a=i.cacheFieldName,s=i.isDim;e.getCacheFieldByName(a)&&s&&r.push({fieldName:a})}}catch(e){o.e(e)}finally{o.f()}return r}},{key:"getIndexBitMapByFilterInfos",value:function(e,t){var n,r=[],o=S(t);try{for(o.s();!(n=o.n()).done;){var i=n.value,a=i.filterInfo;if(a&&!ht(a)){var s=e.getCacheFieldByName(i.cacheFieldName);if(s){var l=b(s)?e.getCacheFieldById(s.getOriginalCacheFieldId()):void 0,u=Ut(this._filterTypeConverter,a,s,l);u.isAll||r.push(u.indexBitMap)}}}}catch(e){o.e(e)}finally{o.f()}if(r.length>0){for(var c=r[0].clone(),h=1;h<r.length;++h)c.intersect(r[h]);return c}return null}},{key:"_queryItem",value:function(e,t){var n=this,r=this.getIndexBitMapByFilterInfos(e,t);if(r)r.iterDecimalNum((function(t){n._addData(e.getCellValueWithSortPriority.bind(e),t)}));else for(var o=e.getDataRecordsNum(),i=0;i<o;++i)this._addData(e.getCellValueWithSortPriority.bind(e),i)}},{key:"_addData",value:function(e,t){var n=this._getDimPath(e,t),r=this._pathPool[n];if(void 0===r)r=this._createItem(e,t),this._pathPool[n]=r;else{var o,i=this._itemList[r].unit,a=S(this.measureIndexes);try{for(a.s();!(o=a.n()).done;){var s=o.value.cacheFieldName,l=i[s];if(l.type===Et.Normal){var u=e(t,s),c=u.cellValue,h=u.originCellValue,d=u.type,f=this.getSharedIndexWhenNeed(c,s,h,d);Boolean(this._needMidMap.get(s))&&this.collectNeedCellValue(s,c),rt(l.value,c,f)}else{var v,p=null===(v=this._cache)||void 0===v?void 0:v.getCacheFieldByName(s),g=this._getCellValueMapWhenCalculateField(e,p,t);it(l.value,g)}}}catch(e){a.e(e)}finally{a.f()}}this._indexList[r].push(t)}},{key:"_getCellValueMapWhenCalculateField",value:function(e,t,n){var r=this._dependMap[t.getName()];if(!r||0===r.length)return{};var o,i={},a=S(r);try{for(a.s();!(o=a.n()).done;){var s=o.value,l=e(n,s).cellValue;i[s]=l}}catch(e){a.e(e)}finally{a.f()}return i}},{key:"getSharedIndexWhenNeed",value:function(e,t,n,r){var o,i,a;return this._needDistinctMap.get(t)&&(a=null===(o=this._cache)||void 0===o||null===(i=o.getCacheFieldByName(t))||void 0===i?void 0:i.getSharedIndex(e,n,r)),a}},{key:"_createItem",value:function(e,t){var n,r=this.getDimPathList(e,t),o=r.path,i=r.typeList,a=r.sortPriorityMap,s=r.groupOriginValues,l={},u=S(this.measureIndexes);try{for(u.s();!(n=u.n()).done;){var c,h=n.value.cacheFieldName,d=null===(c=this._cache)||void 0===c?void 0:c.getCalculateCacheFieldByName(h);if(d&&I(d)){var f=this._getCellValueMapWhenCalculateField(e,d,t);l[h]={type:Et.Formula,value:ot(f)}}else{var v=e(t,h),p=v.cellValue,g=v.originCellValue,m=v.type,_=this.getSharedIndexWhenNeed(p,h,g,m),y=Boolean(this._needMidMap.get(h));y&&this.collectNeedCellValue(h,p),l[h]={type:Et.Normal,value:nt(p,_,Boolean(this._needDistinctMap.get(h)),y)}}}}catch(e){u.e(e)}finally{u.f()}return this._indexList.push([]),this._itemList.push({unit:l,path:o,type:i,sortPriorityMap:a,groupOriginValues:s})-1}},{key:"collectNeedCellValue",value:function(e,t){var n;"number"==typeof t&&(null===(n=this._valueMapList.get(e))||void 0===n||n.push(t))}},{key:"getDetail",value:function(e){var t=[],n=new Map;this.indexOrder.map((function(e,t){var r=e.fieldName;n.set(r,t)}));var r,o=[],i=S(e);try{for(i.s();!(r=i.n()).done;){var a=r.value,s=a.fieldName,l=a.itemName;o.push({fieldName:s,itemName:l,index:n.get(s)})}}catch(e){i.e(e)}finally{i.f()}var u,c=0,h=S(this._itemList);try{for(h.s();!(u=h.n()).done;){var d=u.value.path;this._isMatchItem(o,d)&&(t=t.concat(this._indexList[c])),c++}}catch(e){h.e(e)}finally{h.f()}return t}},{key:"_isMatchItem",value:function(e,t){var n,r=S(e);try{for(r.s();!(n=r.n()).done;){var o=n.value,i=o.itemName;if(t[o.index]!==i)return!1}}catch(e){r.e(e)}finally{r.f()}return!0}},{key:"_getDimPath",value:function(e,t){for(var n="",r=0;r<this.indexOrder.length;r++){var o=this.indexOrder[r].fieldName,i=e(t,o).cellValue;""===n?n=o+we+i:n+=Re+o+we+i}return n}},{key:"getDimPathList",value:function(e,t){for(var n=[],r=[],o={},i=[],a=0;a<this.indexOrder.length;++a){var s=e(t,this.indexOrder[a].fieldName),l=s.cellValue,u=s.sortPriority,c=s.type,h=s.originCellValue,d=s.isDateGroupItem,f=lt(l),v=f.value,p=f.type;n.push(v),2===c?r.push(2):r.push(p),d&&(i[a]=null==h?void 0:h.getTime()),void 0!==u&&(o[a]=u)}return{path:n,typeList:r,sortPriorityMap:o,groupOriginValues:i}}},{key:"dispose",value:function(){var e;null!==(e=this._cache)&&void 0!==e&&e.reset(),this.indexOrder=[],this._pathPool={}}}]),e}()}}]);
//# sourceMappingURL=//slardar.bytedance.net/api_v2/browser/jserr/get_sourcemap?bid=docs_pc&js_filename=sheet_plugin.22427d4a.js